<!DOCTYPE html>
        <html>
        <head>
            <meta charset="UTF-8">
            <title>SCIM Gateway</title>
            <style>
/* From extension vscode.github */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only],
.vscode-high-contrast:not(.vscode-high-contrast-light) img[src$=\#gh-light-mode-only],
.vscode-high-contrast-light img[src$=\#gh-dark-mode-only] {
	display: none;
}

</style>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css">
<link href="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.css" rel="stylesheet" type="text/css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item {
    list-style-type: none;
}

.task-list-item-checkbox {
    margin-left: -20px;
    vertical-align: middle;
    pointer-events: none;
}
</style>
<style>
:root {
  --color-note: #0969da;
  --color-tip: #1a7f37;
  --color-warning: #9a6700;
  --color-severe: #bc4c00;
  --color-caution: #d1242f;
  --color-important: #8250df;
}

</style>
<style>
@media (prefers-color-scheme: dark) {
  :root {
    --color-note: #2f81f7;
    --color-tip: #3fb950;
    --color-warning: #d29922;
    --color-severe: #db6d28;
    --color-caution: #f85149;
    --color-important: #a371f7;
  }
}

</style>
<style>
.markdown-alert {
  padding: 0.5rem 1rem;
  margin-bottom: 16px;
  color: inherit;
  border-left: .25em solid #888;
}

.markdown-alert>:first-child {
  margin-top: 0
}

.markdown-alert>:last-child {
  margin-bottom: 0
}

.markdown-alert .markdown-alert-title {
  display: flex;
  font-weight: 500;
  align-items: center;
  line-height: 1
}

.markdown-alert .markdown-alert-title .octicon {
  margin-right: 0.5rem;
  display: inline-block;
  overflow: visible !important;
  vertical-align: text-bottom;
  fill: currentColor;
}

.markdown-alert.markdown-alert-note {
  border-left-color: var(--color-note);
}

.markdown-alert.markdown-alert-note .markdown-alert-title {
  color: var(--color-note);
}

.markdown-alert.markdown-alert-important {
  border-left-color: var(--color-important);
}

.markdown-alert.markdown-alert-important .markdown-alert-title {
  color: var(--color-important);
}

.markdown-alert.markdown-alert-warning {
  border-left-color: var(--color-warning);
}

.markdown-alert.markdown-alert-warning .markdown-alert-title {
  color: var(--color-warning);
}

.markdown-alert.markdown-alert-tip {
  border-left-color: var(--color-tip);
}

.markdown-alert.markdown-alert-tip .markdown-alert-title {
  color: var(--color-tip);
}

.markdown-alert.markdown-alert-caution {
  border-left-color: var(--color-caution);
}

.markdown-alert.markdown-alert-caution .markdown-alert-title {
  color: var(--color-caution);
}

</style>
        
        </head>
        <body class="vscode-body vscode-light">
            <h1 id="scim-gateway">SCIM Gateway</h1>
<p><a href="https://app.travis-ci.com/github/jelhub/scimgateway"><img src="https://app.travis-ci.com/jelhub/scimgateway.svg?branch=master" alt="Build Status"></a> <a href="https://www.npmjs.com/package/scimgateway"><img src="https://img.shields.io/npm/v/scimgateway.svg?style=flat-square&amp;label=latest" alt="npm Version"></a><a href="https://www.npmjs.com/package/scimgateway"><img src="https://img.shields.io/npm/dm/scimgateway.svg?style=flat-square" alt="npm Downloads"></a> <a href="https://elshaug.xyz/docs/scimgateway#disqus_thread"><img src="https://jelhub.github.io/images/chat.svg" alt="chat disqus"></a> <a href="https://github.com/jelhub/scimgateway"><img src="https://img.shields.io/github/forks/jelhub/scimgateway.svg?style=social&amp;label=Fork" alt="GitHub forks"></a></p>
<hr>
<p>Author: Jarle Elshaug</p>
<p>Validated through IdP's:</p>
<ul>
<li>Symantec/Broadcom Identity Manager</li>
<li>Microsoft Entra ID</li>
<li>One Identity Manager/OneLogin</li>
<li>Okta</li>
<li>Omada</li>
<li>SailPoint/IdentityNow</li>
</ul>
<p>Latest news:</p>
<ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7644#section-3.7">SCIM Bulk Operations</a> now supported</li>
<li>Remote real-time log subscription for monitoring and centralized logging<br>
using browser and url: <code>https://&lt;host&gt;/logger</code><br>
<code>curl -N https://&lt;host&gt;/logger -u user:password</code><br>
custom client API, see configuration notes</li>
<li>By configuring the chainingBaseUrl, it is now possible to chain multiple gateways in sequence, such as <code>gateway1-&gt;gateway2-&gt;gateway3-&gt;endpoint</code>. In this setup, gateway beave much like a reverse proxy, validating authorization at each step unless PassThrough mode is enabled. Chaining is also supported in stream subscriber mode</li>
<li>Email, onError and sendMail() supports more secure RESTful OAuth for Microsoft Exchange Online (ExO) and Google Workspace Gmail, alongside traditional SMTP Auth for all mail systems. HelperRest supports a wide range of common authentication methods, including basicAuth, bearerAuth, tokenAuth, oauth, oauthSamlBearer, oauthJwtBearer and Auth PassTrough</li>
<li>Major version <strong>v5.0.0</strong> marks a shift from JavaScript to native TypeScript and prioritizes <a href="https://bun.sh/">Bun</a> over Node.js. This upgrade requires some modifications to existing plugins.</li>
<li><strong>BREAKING</strong>: <a href="https://elshaug.xyz/docs/scim-stream">SCIM Stream</a> is the modern way of user provisioning letting clients subscribe to messages instead of traditional IGA top-down provisioning. SCIM Gateway now offers enhanced functionality with support for message subscription and automated provisioning using SCIM Stream</li>
<li>Authentication PassThrough letting plugin pass authentication directly to endpoint for avoid maintaining secrets at the gateway. E.g., using Entra ID application OAuth</li>
<li>Supports OAuth Client Credentials authentication</li>
<li>Major version <strong>v4.0.0</strong> getUsers() and getGroups() replacing some deprecated methods. No limitations on filtering/sorting. Admin user access can be linked to specific baseEntities. New MongoDB plugin</li>
<li>ipAllowList for restricting access to allowlisted IP addresses or subnets e.g. Azure IP-range</li>
<li>General LDAP plugin configured for Active Directory</li>
<li><a href="https://elshaug.xyz/docs/plugsso">PlugSSO</a> using SCIM Gateway</li>
<li>Each authentication configuration allowing more than one admin user including option for readOnly</li>
<li>Codebase moved from callback of h... to the the promise(d) land of async/await</li>
<li>Supports configuration by environments and external files</li>
<li>Health monitoring through &quot;/ping&quot; URL, and option for error notifications by email</li>
<li>Entra ID user provisioning including license management e.g. Office 365, installed and configured within minutes!</li>
<li>Includes API Gateway for none SCIM/provisioning - becomes what you want it to become</li>
<li>Running SCIM Gateway as a Docker container</li>
</ul>
<h2 id="overview">Overview</h2>
<p>SCIM Gateway facilitates user management using the standardized REST-based SCIM 1.1 or 2.0 protocol, offering easier, more powerful, and consistent provisioning while avoiding vendor lock-in. Acting as a translator for incoming SCIM requests, the gateway seamlessly enables CRUD functionality (create, read, update, and delete) for users and groups. By implementing endpoint-specific protocols, it ensures precise and efficient provisioning across diverse destinations. With the gateway, your diverse destinations effectively become SCIM endpoints, streamlining integration and simplifying user management.</p>
<p><img src="https://jelhub.github.io/images/ScimGateway.svg" alt=""></p>
<p>SCIM Gateway is based on popular asynchronous event driven framework <a href="https://bun.sh/">Bun</a> or <a href="https://nodejs.dev/">Node.js</a> using TypeScript/JavaScript. It is cloud and firewall friendly. Runs on almost all operating systems, and may load balance between hosts (horizontal) and cpu's (vertical).</p>
<p><strong>Following example plugins are included:</strong></p>
<ul>
<li>
<p><strong>Loki</strong> (NoSQL Document-Oriented Database)<br>
SCIM Gateway becomes a standalone SCIM endpoint<br>
Demonstrates user provisioning towards document-oriented database<br>
Using <a href="https://github.com/techfort/LokiJS">LokiJS</a> for a fast, in-memory document-oriented database (much like MongoDB/PouchDB)<br>
Default gives two predefined test users loaded using in-memory only (no persistence)<br>
Configuration <code>{&quot;persistence&quot;: true}</code> gives persistence file store (no test users)<br>
Example of a fully functional SCIM Gateway plugin</p>
</li>
<li>
<p><strong>MongoDB</strong> (NoSQL Document-Oriented Database)<br>
Same as plugin &quot;Loki&quot;, but using external MongoDB<br>
Shows how to implement a highly configurable multi tenant or multi endpoint solution through <code>baseEntity</code> in URL</p>
</li>
<li>
<p><strong>SCIM</strong> (REST Webservice)<br>
Demonstrates user provisioning towards REST-Based endpoint (type SCIM)<br>
Using plugin Loki as SCIM endpoint through HelperRest<br>
Can be used as SCIM version-gateway e.g. 1.1=&gt;2.0 or 2.0=&gt;1.1</p>
</li>
<li>
<p><strong>Soap</strong> (SOAP Webservice)<br>
Demonstrates user provisioning towards SOAP-Based endpoint<br>
Example WSDLs are included<br>
Using endpoint &quot;Forwardinc&quot; as an example (comes with Symantec/Broadcom/CA IM SDK - SDKWS)<br>
Shows how to implement a highly configurable multi tenant or multi endpoint solution through <code>baseEntity</code> in URL</p>
</li>
<li>
<p><strong>MSSQL</strong> (MSSQL Database)<br>
Demonstrates user provisioning towards MSSQL database</p>
</li>
<li>
<p><strong>SAP HANA</strong> (SAP HANA Database)<br>
Demonstrates SAP HANA specific user provisioning</p>
</li>
<li>
<p><strong>Entra ID</strong> (REST Webservices)<br>
Entra ID user provisioning including license management (App Service plans) e.g. Office 365<br>
Using Microsoft Graph API through HelperRest<br>
Using customized SCIM attributes according to Microsoft Graph API<br>
Includes Symantec/Broadcom ConnectorXpress metafile for creating provisioning &quot;Azure - ScimGateway&quot; endpoint type</p>
</li>
<li>
<p><strong>LDAP</strong> (Directory)<br>
Fully functional LDAP plugin<br>
Pre-configured for Microsoft Active Directory<br>
Using endpointMapper (like plugin-entra-id) for attribute mapping flexibility</p>
</li>
<li>
<p><strong>API</strong> (REST Webservices)<br>
Demonstrates API Gateway/plugin functionality using post/put/patch/get/delete combined with HelperRest<br>
None SCIM plugin, becomes what you want it to become.<br>
Methods included can also be used in standard SCIM plugins<br>
Endpoint complexity could be put in this plugin, and client could instead communicate through Gateway using your own simplified REST specification.<br>
One example of usage could be creation of tickets in ServiceDesk and also the other way, closing a ticket could automatically approve/reject corresponding workflow in IdP.</p>
</li>
</ul>
<h2 id="installation">Installation</h2>
<h4 id="install-bun">Install Bun</h4>
<p><a href="https://bun.sh/">Bun</a> is a prerequisite and must be installed on the server.</p>
<p>Note, Bun installs by default in the current user’s <code>HOMEPATH\.bun</code>. To install it elsewhere, set <code>BUN_INSTALL=&lt;install-path&gt;</code> as a global or system environment variable before installing. The installation will add Bun to the current user’s path, but consider adding it to the global or system path for easier access across all users.</p>
<h4 id="install-scim-gateway">Install SCIM Gateway</h4>
<p>Open a command window (run as administrator)<br>
Create your own package directory e.g. c:\my-scimgateway and install SCIM Gateway within this package.</p>
<pre><code>mkdir c:\my-scimgateway
cd c:\my-scimgateway
bun init -y
bun install scimgateway
bun pm trust scimgateway
</code></pre>
<p><strong>c:\my-scimgateway</strong> will now be <code>&lt;package-root&gt;</code></p>
<p>index.ts, lib and config directories containing example plugins have been copied to your package from the original scimgateway package located under node_modules. Bun requires <code>bun pm trust scimgateway</code> for allowing postinstall copying these files.</p>
<p>If internet connection is blocked, we could install on another machine and copy the <code>&lt;package-root&gt;</code> folder.</p>
<h4 id="startup-and-verify-default-loki-plugin">Startup and verify default Loki plugin</h4>
<pre><code>bun c:\my-scimgateway

Start a browser (note, Edge do not pop-up logon dialog box when using http)

http://localhost:8880/ping
=&gt; Health check with a &quot;hello&quot; response

http://localhost:8880/Users
http://localhost:8880/Groups
=&gt; Logon using gwadmin/password and two users and groups should be listed  

Start a new browser for log monitoring (info level)
using url: http://localhost:8880/logger

http://localhost:8880/Users/bjensen
http://localhost:8880/Groups/Admins
or
http://localhost:8880/Users?filter=userName eq &quot;bjensen&quot;
http://localhost:8880/Groups?filter=displayName eq &quot;Admins&quot;
=&gt; Lists all attributes for specified user/group

http://localhost:8880/Groups?filter=displayName eq &quot;Admins&quot;&amp;excludedAttributes=members
http://localhost:8880/Groups?filter=members.value eq &quot;bjensen&quot;&amp;attributes=id,displayName,members.value
http://localhost:8880/Users?filter=userName eq &quot;bjensen&quot;&amp;attributes=userName,id,name.givenName
http://localhost:8880/Users?filter=meta.created ge &quot;2010-01-01T00:00:00Z&quot;&amp;attributes=userName,name.familyName,meta.created
http://localhost:8880/Users?filter=emails.value co &quot;@example.com&quot;&amp;attributes=userName,name.familyName,emails&amp;sortBy=name.familyName&amp;sortOrder=descending
=&gt; Filtering and attribute examples

&quot;Ctrl + c&quot; to stop the SCIM Gateway
</code></pre>
<blockquote>
<p>Tip, take a look at bun test scripts located in <code>node_modules\scimgateway\test\lib</code></p>
</blockquote>
<blockquote>
<p>If using Node.js instead of Bun, scimgateway must be downloaded from github because Node.js does not support native typescript used by modules. Startup will then be:<br>
node --experimental-strip-types c:\my-scimgateway\index.ts</p>
</blockquote>
<h4 id="upgrade-scim-gateway">Upgrade SCIM Gateway</h4>
<p>Not needed after a fresh install</p>
<p>The best and easiest way to upgrade is renaming existing scimgateway package folder, create a new one and do a fresh installation. After the installation we copy <code>index.ts, config and lib folder</code> (customized plugins) from previous installation to the new installation. You should also read the version history to see if custom plugins needs to be updated.</p>
<p>Alternatives are:</p>
<p>Upgrade to latest minor version:</p>
<pre><code>cd c:\my-scimgateway
bun install scimgateway
</code></pre>
<p>Note, always backup/copy c:\my-scimgateway before upgrading. Custom plugins and corresponding configuration files will not be affected.</p>
<p>To force a major upgrade (version x.*.* =&gt; y.*.*) that will brake compability with any existing custom plugins, we have to include the <code>@latest</code> suffix in the install command:<br>
<code>bun install scimgateway@latest</code></p>
<h5 id="avoid-re-adding-the-files-created-during-postinstall">Avoid (re-)adding the files created during <code>postinstall</code></h5>
<p>For production we do not need example plugins to be incuded by the <code>postinstall</code> job<br>
Bun will by default exlude any <code>postinstall</code> jobs unless we have trusted the scimgateway package using the <code>bun pm trust scimgateway</code> that updates package.json <code>{ trustedDependencies: [&quot;scimgateway&quot;] }</code></p>
<p>For Node.js (and also Bun), we might set the property <code>scimgateway_postinstall_skip = true</code> in <code>.npmrc</code> or setting environment <code>SCIMGATEWAY_POSTINSTALL_SKIP = true</code></p>
<h2 id="configuration">Configuration</h2>
<p><strong>index.ts</strong> defines one or more plugins to be started by the <code>const plugins</code> setting.</p>
<pre><code>// example starting all default plugins:
// const plugins = ['loki', 'scim', 'entra-id', 'ldap', 'mssql', 'api', 'mongodb', 'saphana', 'soap']

const plugins = ['loki']

for (const plugin of plugins) {
  try {
    await import(`./lib/plugin-${plugin}.ts`)
  } catch (err: any) {
    console.error(err)
  }
}
</code></pre>
<p>Each endpoint plugin needs a TypeScript file (.ts) and a configuration file (.json).<br>
<strong>They both must have the same naming prefix</strong>. For SAP Hana endpoint we have:</p>
<blockquote>
<p>lib\plugin-saphana.ts<br>
config\plugin-saphana.json</p>
</blockquote>
<p>Edit specific plugin configuration file according to your needs.<br>
Below shows an example of config\plugin-saphana.json</p>
<pre><code>{
  &quot;scimgateway&quot;: {
    &quot;port&quot;: 8884,
    &quot;localhostonly&quot;: false,
    &quot;chainingBaseUrl&quot;: null,
    &quot;scim&quot;: {
      &quot;version&quot;: &quot;2.0&quot;,
      &quot;skipTypeConvert&quot; : false,
      &quot;skipMetaLocation&quot; false,
      &quot;groupMemberOfUser&quot;: false
      &quot;usePutSoftSync&quot; : false
    },
    &quot;log&quot;: {
      &quot;loglevel&quot;: {
        &quot;file&quot;: &quot;debug&quot;,
        &quot;console&quot;: &quot;error&quot;
      },
      &quot;customMasking&quot;: []
    },
    &quot;auth&quot;: {
      &quot;basic&quot;: [
        {
          &quot;username&quot;: &quot;gwadmin&quot;,
          &quot;password&quot;: &quot;password&quot;,
          &quot;readOnly&quot;: false,
          &quot;baseEntities&quot;: []
        }
      ],
      &quot;bearerToken&quot;: [
        {
          &quot;token&quot;: null,
          &quot;readOnly&quot;: false,
          &quot;baseEntities&quot;: []
        }
      ],
      &quot;bearerJwtAzure&quot;: [
        {
          &quot;tenantIdGUID&quot;: null,
          &quot;readOnly&quot;: false,
          &quot;baseEntities&quot;: []
        }
      ],
      &quot;bearerJwt&quot;: [
        {
          &quot;secret&quot;: null,
          &quot;publicKey&quot;: null,
          &quot;options&quot;: {
            &quot;issuer&quot;: null
           },
          &quot;readOnly&quot;: false,
          &quot;baseEntities&quot;: []
        }
      ],
      &quot;bearerOAuth&quot;: [
        {
          &quot;clientId&quot;: null,
          &quot;clientSecret&quot;: null,
          &quot;readOnly&quot;: false,
          &quot;baseEntities&quot;: []
        }
      ],
      &quot;passThrough&quot;: {
         &quot;enabled&quot;: false,
         &quot;readOnly&quot;: false,
         &quot;baseEntities&quot;: []
      }
    },
    &quot;certificate&quot;: {
      &quot;key&quot;: null,
      &quot;cert&quot;: null,
      &quot;ca&quot;: null,
      &quot;pfx&quot;: {
        &quot;bundle&quot;: null,
        &quot;password&quot;: null
      }
    },
    &quot;ipAllowList&quot;: [],
    &quot;email&quot;: {
      &quot;auth&quot;: {
        &quot;type&quot;: &quot;oauth&quot;,
        &quot;options&quot;: {
          &quot;tenantIdGUID&quot;: null,
          &quot;clientId&quot;: null,
          &quot;clientSecret&quot;: null
        }
      },
      &quot;emailOnError&quot;: {
        &quot;enabled&quot;: false,
        &quot;from&quot;: null,
        &quot;to&quot;: null
      }
    },
    &quot;stream&quot;: {
      &quot;baseUrls&quot;: [],
      &quot;certificate&quot;: {
        &quot;ca&quot;: null
      },
      &quot;subscriber&quot;: {
        &quot;enabled&quot;: false,
        &quot;entity&quot;: {
          &quot;undefined&quot;: {
            &quot;nats&quot;: {
              &quot;tenant&quot;: null,
              &quot;subject&quot;: null,
              &quot;jwt&quot;: null,
              &quot;secret&quot;: null
            },
            &quot;deleteUserOnLastGroupRoleRemoval&quot;: false,
            &quot;convertRolesToGroups&quot;: false,
            &quot;generateUserPassword&quot;: false,
            &quot;modifyOnly&quot;: false,
            &quot;replaceDomains&quot;: []
          }
        }
      },
      &quot;publisher&quot;: {
        &quot;enabled&quot;: false,
        &quot;entity&quot;: {
          &quot;undefined&quot;: {
            &quot;nats&quot;: {
              &quot;tenant&quot;: null,
              &quot;subject&quot;: null,
              &quot;jwt&quot;: null,
              &quot;secret&quot;: null
            }
          }
        }
      }
    }
  },
  &quot;endpoint&quot;: {
    &quot;host&quot;: &quot;hostname&quot;,
    &quot;port&quot;: 30015,
    &quot;username&quot;: &quot;username&quot;,
    &quot;password&quot;: &quot;password&quot;,
    &quot;saml_provider&quot;: &quot;saml_provider_name&quot;
  }
}
</code></pre>
<p>Configuration file have two main JSON objects: <code>scimgateway</code> and <code>endpoint</code></p>
<p>Definitions in <code>scimgateway</code> object have fixed attributes, but values can be modified. Sections not used/configured can be removed. This object is used by the core functionality of the SCIM Gateway.</p>
<p>Definitions in <code>endpoint</code> object are customized according to our plugin code. Plugin typically need this information for communicating with endpoint</p>
<ul>
<li>
<p><strong>port</strong> - Gateway will listen on this port number. Clients (e.g. Provisioning Server) will be using this port number for communicating with the gateway</p>
</li>
<li>
<p><strong>localhostonly</strong> - true or false. False means gateway accepts incoming requests from all clients. True means traffic from only localhost (127.0.0.1) is accepted.</p>
</li>
<li>
<p><strong>chainingBaseUrl</strong> - baseUrl for chaining anohter gateway, syntax: <code>http(s)://host:port</code>. If defined, gateway beave much like a reverse proxy, validating authorization unless PassThrough mode is enabled. See <code>Configuration notes</code> for details</p>
</li>
<li>
<p><strong>idleTimeout</strong> - default 120, sets the the number of seconds to wait before timing out a connection due to inactivity</p>
</li>
<li>
<p><strong>scim.version</strong> - &quot;1.1&quot; or &quot;2.0&quot;. Default is &quot;2.0&quot;.</p>
</li>
<li>
<p><strong>scim.skipTypeConvert</strong> - true or false, default false. Multivalue attributes supporting types e.g. emails, phoneNumbers, ims, photos, addresses, entitlements and x509Certificates (but not roles, groups and members) will be become &quot;type converted objects&quot; when sent to modifyUser and createUser. This for simplicity of checking attributes included and also for the endpointMapper method (used by plugin-ldap and plugin-entra-id), e.g.:</p>
<pre><code>  &quot;emails&quot;: {
    &quot;work&quot;: {&quot;value&quot;: &quot;jsmith@example.com&quot;, &quot;type&quot;: &quot;work&quot;},
    &quot;home&quot;: {&quot;value&quot;: &quot;&quot;, &quot;type&quot;: &quot;home&quot;, &quot;operation&quot;: &quot;delete&quot;},
    &quot;undefined&quot;: {&quot;value&quot;: &quot;jsmith@hotmail.com&quot;}
  }  

  skipTypeConvert set to true gives attribute &quot;as-is&quot;: array, allow duplicate types including blank, but values to be deleted have been marked with &quot;operation&quot;: &quot;delete&quot;

  &quot;emails&quot;: [
    {&quot;value&quot;: &quot;jsmith@example.com&quot;, &quot;type&quot;: &quot;work&quot;},
    {&quot;value&quot;: &quot;john.smith.org&quot;, &quot;type&quot;: &quot;home&quot;, &quot;operation&quot;: &quot;delete&quot;},
    {&quot;value&quot;: &quot;jsmith@hotmail.com&quot;}
  ]  
</code></pre>
</li>
<li>
<p><strong>scim.skipMetaLocation</strong> - true or false, default false. If set to true, <code>meta.location</code> which contains protocol and hostname from request-url, will be excluded from response e.g. <code>&quot;{...,meta&quot;:{&quot;location&quot;:&quot;https://my-company.com/&lt;...&gt;&quot;}}</code>. If using reverse proxy and not including headers <code>X-Forwarded-Proto</code> and <code>X-Forwarded-Host</code>, originator will be the proxy and we might not want to expose internal protocol and hostname being used by the proxy request.</p>
</li>
<li>
<p><strong>scim.groupMemberOfUser</strong> - true or false, default false. If body contains groups and groupMemberOfUser=true, groups attribute will remain at user object (groups are member of user) instead of default user member of groups that will use modifyGroup method for maintaining group members.</p>
</li>
<li>
<p><strong>scim.usePutSoftSync</strong> - true or false, default false. <code>PUT /Users/bjensen</code> will replace the user bjensen with body content. If set to <code>true</code>, only PUT body content will be replaced. Any additional existing user attributes and groups supported by plugin will remain as-is.</p>
</li>
<li>
<p><strong>log.loglevel.file</strong> - off, debug, info, warn or error. Default off. Output to plugin-logfile e.g. <code>logs\plugin-saphana.log</code></p>
</li>
<li>
<p><strong>log.loglevel.console</strong> - off, debug, info, warn or error. Default off. Output to stdout and errors to stderr</p>
</li>
<li>
<p><strong>log.loglevel.push</strong> - off, debug, info, warn or error. Default info. Push to stream that can be used by client subscriber</p>
</li>
<li>
<p><strong>log.logDirectory</strong> - custom defined log directory e.g. <code>/var/log/scimgateway</code> that will override default <code>&lt;scimgateway path&gt;/logs</code>. If not exist it will be created.</p>
</li>
<li>
<p><strong>log.customMasking</strong> - array of attributes to be masked e.g. <code>&quot;customMasking&quot;: [&quot;SSN&quot;, &quot;weight&quot;]</code>. By default SCIM Gateway includes masking of some standard attributes like password.</p>
</li>
<li>
<p><strong>log.colorize</strong> - default true, gives colorized and minimized console output, if redirected to stdout/stderr standard JSON formatted output and no colors. Set to false give standard JSON</p>
</li>
<li>
<p><strong>log.maxSize</strong> - default 20 (MB) log file size</p>
</li>
<li>
<p><strong>log.maxFiles</strong> - default 5, keep only the last 5 logs - note, new and rotated file on startup</p>
</li>
<li>
<p><strong>auth</strong> - Contains one or more authentication/authorization methods used by clients for accessing gateway - may also include:</p>
<ul>
<li><strong>auth.xx.readOnly</strong> - true/false, true gives read only access - only allowing <code>GET</code> requests for corresponding admin user</li>
<li><strong>auth.xx.baseEntities</strong> - array containing one or more <code>baseEntity</code> allowed for this user e.g. [&quot;client-a&quot;] - empty array allowing all.<br>
<strong>Methods are disabled by setting corresponding admin user to null or remove methods not used</strong></li>
</ul>
</li>
<li>
<p><strong>auth.basic</strong> - Array of one ore more basic authentication objects - Basic Authentication with <strong>username</strong>/<strong>password</strong>. Note, we set a clear text password that will become encrypted when gateway is started.</p>
</li>
<li>
<p><strong>auth.bearerToken</strong> - Array of one or more bearer token objects - Shared token/secret (supported by Entra ID). Clear text value will become encrypted when gateway is started.</p>
</li>
<li>
<p><strong>auth.bearerJwtAzure</strong> - Array of one or more JWT used by Azure SyncFabric. <strong>tenantIdGUID</strong> must be set to Entra ID Tenant ID.</p>
</li>
<li>
<p><strong>auth.bearerJwt</strong> - Array of one or more standard JWT objects. Using <strong>secret</strong> or <strong>publicKey</strong> for signature verification. publicKey should be set to the filename of public key or certificate pem-file located in <code>&lt;package-root&gt;\config\certs</code> or absolute path being used. Clear text secret will become encrypted when gateway is started. <strong>options.issuer</strong> is mandatory. Other options may also be included according to jsonwebtoken npm package definition.</p>
</li>
<li>
<p><strong>auth.bearerOAuth</strong> - Array of one or more Client Credentials OAuth configuration objects. <strong><code>clientId</code></strong> and <strong><code>clientSecret</code></strong> are mandatory. clientSecret value will become encrypted when gateway is started. OAuth token request url is <strong>/oauth/token</strong> e.g. <code>http://localhost:8880/oauth/token</code></p>
</li>
<li>
<p><strong>auth.passThrough</strong> - Setting <strong>auth.passThrough.enabled=true</strong> will bypass SCIM Gateway authentication. Gateway will instead pass ctx containing authentication header to the plugin. Plugin could then use this information for endpoint authentication and we don't have any password/token stored at the gateway. Note, this also requires plugin binary having <code>scimgateway.authPassThroughAllowed = true</code> and endpoint logic for handling/passing ctx.request.header.authorization</p>
</li>
<li>
<p><strong>certificate</strong> - If not using TLS certificate, set &quot;key&quot;, &quot;cert&quot; and &quot;ca&quot; to <strong>null</strong>. When using TLS, &quot;key&quot; and &quot;cert&quot; have to be defined with the filename corresponding to the primary-key and public-certificate. Both files must be located in the <code>&lt;package-root&gt;\config\certs</code> directory unless absolute path being defined e.g:</p>
<pre><code>  &quot;certificate&quot;: {
    &quot;key&quot;: &quot;key.pem&quot;,
    &quot;cert&quot;: &quot;cert.pem&quot;,
    &quot;ca&quot;: &quot;ca.pem&quot; // if several: &quot;ca&quot;: [&quot;ca1.pem&quot;, &quot;ca2.pem&quot;]
  }  
</code></pre>
<p>Example of how to make a self signed certificate:</p>
<pre><code>  openssl.exe req -nodes -newkey rsa:2048 -x509 -sha256 -days 3650 -keyout key.pem -out cert.pem -subj &quot;/O=My Company/OU=Application/CN=SCIM Gateway&quot; -addext &quot;subjectAltName=DNS:localhost,DNS:127.0.0.1,DNS:*.mycompany.com&quot; -addext &quot;extendedKeyUsage=serverAuth&quot; -addext &quot;keyUsage=digitalSignature&quot;
</code></pre>
<p>Note, when using Symantec/Broadcom Provisioning, the &quot;certificate authority - CA&quot; also must be imported on the Connector Server. For self-signed certificate, CA and the certificate (public key) is the same.</p>
<p>PFX / PKCS#12 bundle can be used instead of key/cert/ca e.g:</p>
<pre><code>  &quot;pfx&quot;: {
    &quot;bundle&quot;: &quot;certbundle.pfx&quot;,
    &quot;password&quot;: &quot;password&quot;
  }
</code></pre>
<p>Note, we should normally use certificate (https) for communicating with SCIM Gateway unless we install gateway locally on the manager (e.g. on the provisioning Connector Server). When installed on the manager, we could use <code>http://localhost:port</code> or <code>http://127.0.0.1:port</code> which will not be passed down to the data link layer for transmission. We could then also set {&quot;localhostonly&quot;: true}</p>
</li>
<li>
<p><strong>ipAllowList</strong> - Array of one or more IPv4/IPv6 subnets (CIDR) allowed for incoming traffic.  E.g. using Entra ID as IdP, we would like to restrict access to IP addresses used by Azure. Azure IP-range can be downloaded from: <a href="https://azureipranges.azurewebsites.net">https://azureipranges.azurewebsites.net</a>, enter <strong>AzureActiveDirectory</strong> in the search list and select JSON download. Copy the &quot;addressPrefixes&quot; array content and paste into ipAllowList array. CIDR single IP-host syntax is a.b.c.d/32. Note, front-end HTTP proxy or a load balancer must include client IP-address in the <strong>X-Forwarded-For</strong> header. Configuration example:</p>
<pre><code>  &quot;ipAllowList&quot;: [
    &quot;13.64.151.161/32&quot;,
    &quot;13.66.141.64/27&quot;,
    ...
    &quot;2603:1056:2000::/48&quot;,
    &quot;2603:1057:2::/48&quot;
  ]
</code></pre>
</li>
<li>
<p><strong>email</strong> - Sending email from plugin or automated error notifications emailOnError. For emailOnError only the first error will be sent until sendInterval have passed. Supporting both SMTP Auth and modern REST OAuth. For OAuth, currently Microsoft Exchange Online (ExO) and Google Workspace Gmail are supported - see configuration notes</p>
</li>
<li>
<p><strong>email.auth</strong> - Authentication configuration</p>
</li>
<li>
<p><strong>email.auth.type</strong> - <code>oauth</code> or <code>smtp</code></p>
</li>
<li>
<p><strong>email.auth.options</strong> - Authentication options - note, different options for type oauth and smtp</p>
</li>
<li>
<p><strong>email.auth.options.tenantIdGUID (oauth/ExO)</strong> - Entra tenant id or domain name</p>
</li>
<li>
<p><strong>email.auth.options.clientId (oauth/ExO)</strong> - Entra OAuth application Client ID</p>
</li>
<li>
<p><strong>email.auth.options.clientSecret (oauth/ExO)</strong> - Entra OAuth application Client Secret</p>
</li>
<li>
<p><strong>email.auth.options.serviceAccountKeyFile (oauth/Gmail)</strong> - Google Service Account key json-file name located in the <code>package-root&gt;\config\certs</code> directory unless absolute path being defined</p>
</li>
<li>
<p><strong>email.auth.options.host (smtp)</strong> - Mailserver e.g. &quot;<a href="http://smtp.gmail.com">smtp.gmail.com</a>&quot; - mandatory for smtp</p>
</li>
<li>
<p><strong>email.auth.options.port (smtp)</strong> - Port used by mailserver e.g. 587, 25 or 465 - mandatory for smtp</p>
</li>
<li>
<p><strong>email.auth.options.username (smtp)</strong> - Mail account for authentication normally same as sender of the email, e.g. &quot;<a href="mailto:user@gmail.com">user@gmail.com</a>&quot;</p>
</li>
<li>
<p><strong>email.auth.options.password (smtp)</strong> - Mail account password</p>
</li>
<li>
<p><strong>email.proxy</strong> - Proxy configuration if using mailproxy</p>
</li>
<li>
<p><strong>email.proxy.host</strong> - Proxy host e.g. <code>http://proxy-host:1234</code></p>
</li>
<li>
<p><strong>email.proxy.username</strong> - username if authentication is required</p>
</li>
<li>
<p><strong>email.proxy.password</strong> - password if authentication is required</p>
</li>
<li>
<p><strong>email.emailOnError</strong> - Contains configuration for sending error notifications by email. Note, only the first error will be sent until sendInterval have passed</p>
</li>
<li>
<p><strong>email.emailOnError.enabled</strong> - true or false, value set to true will enable email notifications</p>
</li>
<li>
<p><strong>email.emailOnError.sendInterval</strong> - Default 15. Mail notifications on error are deferred until sendInterval <strong>minutes</strong> have passed since the last notification.</p>
</li>
<li>
<p><strong>email.emailOnError.from</strong> - Sender email addresses e.g: &quot;<a href="mailto:noreply@example.com">noreply@example.com</a>&quot;. <strong>Mandatory for oauth</strong>. For smtp email.auth.options.username will be used</p>
</li>
<li>
<p><strong><a href="http://email.emailOnError.to">email.emailOnError.to</a></strong> - Comma separated list of recipients email addresses e.g: &quot;<a href="mailto:someone@example.com">someone@example.com</a>&quot;</p>
</li>
<li>
<p><strong><a href="http://email.emailOnError.cc">email.emailOnError.cc</a></strong> - Optional comma separated list of cc mail addresses</p>
</li>
<li>
<p><strong>email.emailOnError.subject</strong> - Optional mail subject, default <code>SCIM Gateway error message</code></p>
</li>
<li>
<p><strong>stream</strong> - See <a href="https://elshaug.xyz/docs/scim-stream">SCIM Stream</a> for configuration details</p>
</li>
<li>
<p><strong>endpoint</strong> - Contains endpoint specific configuration according to customized <strong>plugin code</strong>.</p>
</li>
</ul>
<h3 id="configuration-notes---general">Configuration notes - general</h3>
<ul>
<li>
<p>Custom Schemas, ServiceProviderConfig and ResourceType can be used if <code>./lib/scimdef-v2.json or scimdef-v1.json</code> exists. Original scimdef-v2.json/scimdef-v1.json can be copied from node_modules/scimgateway/lib to your plugin/lib and customized.</p>
</li>
<li>
<p>Using reverse proxy and we want ipAllowList and correct meta.location response, following headers must be set by proxy: <code>X-Forwarded-For</code>, <code>X-Forwarded-Proto</code> and <code>X-Forwarded-Host</code></p>
</li>
<li>
<p>Setting environment variable <code>SEED</code> with some random characters will override default password seeding logic. This also allow copying configuration file with encrypted secrets from one machine to another.</p>
</li>
<li>
<p>All configuration can be set based on environment variables. Syntax will then be <code>&quot;process.env.&lt;ENVIRONMENT&gt;&quot;</code> where <code>&lt;ENVIRONMENT&gt;</code> is the environment variable used. E.g. scimgateway.port could have value &quot;process.env.PORT&quot;, then using environment variable PORT.</p>
</li>
<li>
<p>All configuration values can be moved to a single external file having JSON dot notation content with plugin name as parent JSON object. Syntax in original configuration file used by the gateway will then be <code>&quot;process.file.&lt;path&gt;&quot;</code> where <code>&lt;path&gt;</code> is the file used. E.g. key endpoint.password could have value &quot;process.file./var/run/vault/secrets.json&quot;</p>
</li>
<li>
<p>All configuration values can be moved to multiple external files, each file containing one single value. Syntax in original configuration file used by the gateway will then be <code>&quot;process.text.&lt;path&gt;&quot;</code> where <code>&lt;path&gt;</code> is the file which contains raw (<code>UTF-8</code>) character value. E.g. key endpoint.password could have value &quot;process.text./var/run/vault/endpoint.password&quot;.</p>
<p>Example:</p>
<pre><code>  {
    &quot;scimgateway&quot;: {
      ...
      &quot;port&quot;: &quot;process.env.PORT&quot;,
      ...
      &quot;loglevel&quot;: {
        &quot;file&quot;: &quot;process.env.LOG_LEVEL_FILE&quot;,
        ...
      &quot;auth&quot;: {
        &quot;basic&quot;: [
          {
            &quot;username&quot;: &quot;process.file./var/run/vault/secrets.json&quot;,
            &quot;password&quot;: &quot;process.file./var/run/vault/secrets.json&quot;
          },
          ...
        ],
        &quot;bearerJwt&quot;: [
           &quot;secret&quot;: &quot;process.text./var/run/vault/jwt.secret&quot;,
           &quot;publicKey&quot;: &quot;process.text./var/run/vault/jwt.pub&quot;,
  		 ...
  	  ],
        ...
      },
    &quot;endpoint&quot;: {
      ...
      &quot;username&quot;: &quot;process.file./var/run/vault/secrets.json&quot;,
      &quot;password&quot;: &quot;process.file./var/run/vault/secrets.json&quot;,
      ...
    }
  }  
</code></pre>
<p>jwt.secret file content example:</p>
<pre><code>  thisIsSecret
</code></pre>
<p>secrets.json file content example for plugin-soap:</p>
<pre><code>  {
    &quot;plugin-soap.scimgateway.auth.basic[0].username&quot;: &quot;gwadmin&quot;,
    &quot;plugin-soap.scimgateway.auth.basic[0].password&quot;: &quot;password&quot;,
    &quot;plugin-soap.endpoint.username&quot;: &quot;superuser&quot;,
    &quot;plugin-soap.endpoint.password&quot;: &quot;secret&quot;
  }  
</code></pre>
</li>
</ul>
<h3 id="configuration-notes---email-using-microsoft-exchange-online-exo">Configuration notes - Email, using Microsoft Exchange Online (ExO)</h3>
<ul>
<li>
<p>Entra ID application must have application permissions <code>Mail.Send</code></p>
</li>
<li>
<p>To prevent the sending of emails from any defined mailboxes, an ExO <code>ApplicationAccessPolicy</code> must be defined through PowerShell.</p>
<p>First create a mail-enabled security-group that only includes those users (mailboxes) the application is allowed to send from<br>
Note, <code>mail enabled security group</code> cannot be created from portal, only from admin or admin.exchange console</p>
<pre><code>  ##Connect to Exchange
  Install-Module -Name ExchangeOnlineManagement
  Connect-ExchangeOnline
   
  ##Create ApplicationAccessPolicy
  New-ApplicationAccessPolicy -AppId &lt;AppClientID&gt; -PolicyScopeGroupId &lt;MailEnabledSecurityGrpId&gt; -AccessRight RestrictAccess -Description &quot;Restrict app to specific mailboxes&quot;
</code></pre>
</li>
</ul>
<h3 id="configuration-notes---email-using-google-workspace-gmail">Configuration notes - Email, using Google Workspace Gmail</h3>
<ul>
<li>
<p><a href="https://console.cloud.google.com">https://console.cloud.google.com</a></p>
<ul>
<li>IAM &amp; Admin &gt; Service Accounts &gt; Create Service Account
<ul>
<li>Name=email-sender</li>
<li>Create and Continue</li>
<li>Grant this service account access to project - not needed</li>
<li>Grant users access to this service - not needed</li>
</ul>
</li>
<li>IAM &amp; Admin &gt; Service Accounts &gt; &quot;email-sender&quot; account &gt; Keys
<ul>
<li>Add Key &gt; Create new key &gt; JSON</li>
<li>download json Service Account Key file, refere to configuration <code>email.auth.options.serviceAccountKeyFile</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="https://admin.google.com">https://admin.google.com</a></p>
<ul>
<li>Security &gt; Access and data control &gt; API controls
<ul>
<li>Manage Domain Wide Delegation &gt; Add new</li>
<li>Client ID = id of service account created</li>
<li>OAuth scope = <code>https://www.googleapis.com/auth/gmail.send</code></li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="https://admin.google.com">https://admin.google.com</a></p>
<ul>
<li>Billing &gt; Subscriptions - verify Google Workspace license</li>
<li>Directory &gt; Users &gt; &quot;user&quot;</li>
<li>Licenses &gt; Edit &gt; enable Google Workspace license<br>
<code>email.emailOnError.from</code> mail address must have Google Workspace license</li>
</ul>
</li>
</ul>
<h3 id="configuration-notes---gateway-chainging-and-chainingbaseurl">Configuration notes - Gateway chainging and chainingBaseUrl</h3>
<p>By configuring the <code>chainingBaseUrl</code>, it is possible to chain multiple gateways in sequence, such as <code>gateway1-&gt;gateway2-&gt;gateway3-&gt;endpoint</code>. In this setup, gateway behave much like a reverse proxy, validating authorization at each step unless PassThrough mode is enabled. Chaining is also supported in stream subscriber mode</p>
<pre><code>{
  &quot;scimgateway&quot;: {
    ...
    &quot;chainingBaseUrl&quot;: &quot;https:\\gateway2:8880&quot;,
    ...
    &quot;auth&quot;: {
      ...
      &quot;passThrough&quot;: {
        &quot;enabled&quot;: false,
        &quot;readOnly&quot;: false,
        &quot;baseEntities&quot;: []
      }
	  ...
    }
  },
  ...
}
</code></pre>
<p>Using above configuration example on gateway1, incoming requests will be routed to <code>https:\\gateway2:8880</code></p>
<p>The plugin and its associated authentication configuration can mirror the setup running on the final gateway. However, in chaining mode, the plugin binary is used solely for initializing and configuring the gateway. This allows for the use of a simplified <code>plugin-&lt;name&gt;.ts</code> binary containing only the essential mandatory components:</p>
<pre><code>// start - mandatory plugin initialization
const ScimGateway: typeof import('scimgateway').ScimGateway = await (async () =&gt; {
  try {
    return (await import('scimgateway')).ScimGateway
  } catch (err) {
    const source = './scimgateway.ts'
    return (await import(source)).ScimGateway
  }
})()
const scimgateway = new ScimGateway()
const config = scimgateway.getConfig()
scimgateway.authPassThroughAllowed = false
// end - mandatory plugin initialization
</code></pre>
<p>Using <code>scimgateway.authPassThroughAllowed = true</code> and <code>plugin-&lt;name&gt;.json</code> configuration <code>scimgateway.auth.passThrough=true</code> enables Authentication PassTrhough</p>
<h3 id="configuration-notes---helperrest-used-by-plugins">Configuration notes - HelperRest used by plugins</h3>
<p>For REST endpoints, plugins may use HelperRest to simplify authentication and communication<br>
doRequest() executes REST request and return response<br>
<code>doRequest(&lt;baseEntity&gt;, &lt;method&gt;, &lt;path&gt;, &lt;body&gt;, &lt;ctx&gt;, &lt;options&gt;)</code></p>
<ul>
<li>baseEntity - 'undefined' if not used and must correspond with endpoint configuration that defines baseUrls and connection options.</li>
<li>method - GET, PATCH, PUT, DELETE</li>
<li>path - either full url or just the path that will be added to baseUrl. Using full url will override baseUrl. Using path is preferred because of auth caching logic and simplicity</li>
<li>body - optional body to be used</li>
<li>ctx - optional, passing authorization header if Auth PassThrough is enabled</li>
<li>opt - optional, connection options that will extend/override any endpoint.entity.undefined.connection definitions</li>
</ul>
<p>Configuration showing connection settings:</p>
<pre><code>{
  &quot;scimgateway&quot;: {
    ...
  }
  &quot;endpoint&quot;: {
    &quot;entity&quot;: {
      &quot;undefined&quot;: {
        &quot;connection&quot;: {
          &quot;baseUrls&quot;: [],
          &quot;auth&quot;: {
            &quot;type&quot;: &quot;xxx&quot;,
            &quot;options&quot;: {
              ...
              &quot;jwtPayload&quot;: {},
              &quot;samlPayload&quot;: {},
              &quot;tls&quot;: {} // files located in ./config/certs
            }
          },
          &quot;options&quot;: {
            &quot;headers&quot;: {},
            &quot;tls&quot;: {} // files located in ./config/certs
          },
          &quot;proxy&quot;: {}
        }
      }
    }
  }
}
</code></pre>
<ul>
<li>baseUrls - Endpoint URL. Several may be defined for failower. There are retry logic on connection failures</li>
<li>auth.type - defines authentication being used: <code>basic</code>, <code>oauth</code>, <code>token</code>, <code>bearer</code>, <code>oauthSamlBearer</code> or <code>oauthJwtBearer</code></li>
<li>auth.options - for each valid type there are different options. tenantIdGUID is special for Entra ID and serviceAccountKeyFile is special for Google. Using these will simplify and reduce options to be included. Also note we do not need to include baseUrls when using tenantIdGUID/serviceAccountKeyFile as long as endpoint is Entra ID (Microsoft Graph) or Google.</li>
</ul>
<p>Example using basic auth:</p>
<pre><code>&quot;connection&quot;: {
  &quot;baseUrls&quot;: [
    &quot;https://localhost:8880&quot;
  ],
  &quot;auth&quot;: {
    &quot;type&quot;: &quot;basic&quot;,
    &quot;options&quot;: {
      &quot;username&quot;: &quot;gwadmin&quot;,
      &quot;password&quot;: &quot;password&quot;
    }
  },
  &quot;options&quot;: {
    &quot;tls&quot;: {
      &quot;rejectUnauthorized&quot;: false,
      &quot;ca&quot;: &quot;ca.pem&quot;
    }
  }
}
</code></pre>
<p>Example Entra ID (plugin-entra-id) using clientId/clientSecret:</p>
<pre><code>&quot;connection&quot;: {
  &quot;baseUrls&quot;: [],
  &quot;auth&quot;: {
    &quot;type&quot;: &quot;oauth&quot;,
    &quot;options&quot;: {
      &quot;tenantIdGUID&quot;: &quot;&lt;tenantId&gt;&quot;,
      &quot;clientId&quot;: &quot;&lt;clientId&gt;&quot;,
      &quot;clientSecret&quot;: &quot;&lt;clientSecret&gt;&quot;
    }
  }
}
</code></pre>
<p>Example Entra ID (plugin-entra-id) using certificate secret:</p>
<pre><code>&quot;connection&quot;: {
  &quot;baseUrls&quot;: [],
  &quot;auth&quot;: {
    &quot;type&quot;: &quot;oauth&quot;,
    &quot;options&quot;: {
      &quot;tenantIdGUID&quot;: &quot;&lt;tenantId&gt;&quot;,
      &quot;clientId&quot;: &quot;&lt;clientId&gt;&quot;,
      &quot;tls&quot;: {
        &quot;key&quot;: &quot;key.pem&quot;,
        &quot;cert&quot;: &quot;cert.pem&quot;
      }
    }
  }
}
</code></pre>
<p>Example using general OAuth:</p>
<pre><code>&quot;connection&quot;: {
  &quot;baseUrls&quot;: [&lt;&quot;endpointUrl&quot;&gt;],
  &quot;auth&quot;: {
    &quot;type&quot;: &quot;oauth&quot;,
    &quot;options&quot;: {
      &quot;tokenUrl&quot;: &quot;&lt;tokenUrl&gt;&quot;
      &quot;clientId&quot;: &quot;&lt;clientId&gt;&quot;,
      &quot;clientSecret&quot;: &quot;&lt;clientSecret&gt;&quot;
    }
  }
}
</code></pre>
<p>Please see code editor method HelperRest doRequest() IntelliSense for type and option details</p>
<h3 id="configuration-notes---remote-real-time-log-subscription">Configuration notes - Remote real-time log subscription</h3>
<p>Using remote real-time log subscription we may implement custom logic like monitoring and centralized logging</p>
<ul>
<li>using browser and url: <a href="https://host/logger">https://host/logger</a></li>
<li>curl -N <a href="https://host/logger">https://host/logger</a> -u gwread:password</li>
<li>curl -N <a href="https://host/logger">https://host/logger</a> -H &quot;Authorization: Bearer secret&quot;</li>
<li>custom client API</li>
</ul>
<p>We may configure read-only user/secret for log collection purpose</p>
<pre><code>&quot;auth&quot;: {
  &quot;basic&quot;: [
    {
      &quot;username&quot;: &quot;gwadmin&quot;,
      &quot;password&quot;: &quot;password&quot;,
      &quot;readOnly&quot;: false,
      &quot;baseEntities&quot;: []
    },
    {
      &quot;username&quot;: &quot;gwread&quot;,
      &quot;password&quot;: &quot;password&quot;,
      &quot;readOnly&quot;: true,
      &quot;baseEntities&quot;: []
    }
  ],
  &quot;bearerToken&quot;: [
    {
      &quot;token&quot;: &quot;secret&quot;,
      &quot;readOnly&quot;: true,
      &quot;baseEntities&quot;: []
    }
  ],
  ...
}
</code></pre>
<p>push logger using default <code>info</code> log level<br>
push log level may be customized by configuration</p>
<pre><code>&quot;log&quot;: {
  &quot;loglevel&quot;: {
    &quot;push&quot;: &quot;debug&quot;
  }
}
</code></pre>
<p>Example code implementing subscriber for real-time log messages collection</p>
<pre><code>let headers = new Headers()
headers.append('Authorization', 'Basic ' + btoa('gwadmin' + ':' + 'password'))

// message handling and custom logic
// we could also do JSON.parse(message) and granular filtering on log &quot;level&quot;
const messageHandler = async (message: string) =&gt; {
  console.log(message)
}

let ignoreCatch = false
do { // retry loop when connection closed or service unavailable
  if (ignoreCatch) ignoreCatch = false

  try {
    const resp = await fetch(&quot;http://localhost:8880/logger&quot;, {
      method: &quot;GET&quot;,
      headers: headers,
    })

    const reader = resp.body.pipeThrough(new TextDecoderStream()).getReader()
    console.log('Now awaiting log events...\n')

    while (true) {
      const { value, done } = await reader.read()
      if (done) break
      if (value.at(-1) !== '\n') continue
      const message = value.slice(0, -1)
      messageHandler(message)
    }

    // shouldn't be here... authentication failure?
    const e = {
     url: resp.url,
      status: resp.status,
      statusText: resp.statusText
    }
    console.error('error', e)

  } catch (err: any) {
    if (['ConnectionClosed', 'ConnectionRefused', 'ECONNRESET'].includes(err.code)) {
      console.log('Connection closed or service unavailable')
      ignoreCatch = true
      await Bun.sleep(10 * 1000)
    } else console.error(err)
  }

} while (ignoreCatch)

console.log('\n\ndone!')
</code></pre>
<h2 id="manual-startup">Manual startup</h2>
<p>Gateway can be started from a command window running in administrative mode</p>
<p>3 ways to start:</p>
<pre><code>bun c:\my-scimgateway

bun c:\my-scimgateway\index.ts

&lt;package-root&gt;bun .
</code></pre>
<p><kbd>Ctrl</kbd>+<kbd>c</kbd> to stop</p>
<h2 id="automatic-startup---windows-task-scheduler">Automatic startup - Windows Task Scheduler</h2>
<p>Start Windows Task Scheduler (taskschd.msc), right click on &quot;Task Scheduler Library&quot; and choose &quot;Create Task&quot;</p>
<pre><code>General tab:  
-----------
Name = SCIM Gateway
User account = SYSTEM
Run with highest privileges

Triggers tab:
-------------
Begin the task = At startup

Actions tab:
------------
Action = Start a program
Program/script = &lt;install path&gt;\bun.exe
Arguments = c:\my-scimgateway

Settings - tab:
---------------
Stop the task if runs longer than = Disabled (greyed out)
</code></pre>
<p>Verification:</p>
<ul>
<li>Right click task - <strong>Run</strong>, verify process node.exe (SCIM Gateway) can be found in the task manager (not the same as task scheduler). Also verify logfiles <code>&lt;pakage-root&gt;\logs</code></li>
<li>Right click task - <strong>End</strong>, verify process node.exe have been terminated and disappeared from task manager</li>
<li><strong>Reboot</strong> server and verify SCIM Gateway have been automatically started</li>
</ul>
<h2 id="running-as-a-isolated-virtual-docker-container">Running as a isolated virtual Docker container</h2>
<p>On Linux systems we may also run SCIM Gateway as a Docker image (using docker-compose)</p>
<ul>
<li>Docker Pre-requisites:<br>
<strong>docker-ce<br>
docker-compose</strong></li>
</ul>
<ul>
<li>
<p>Install SCIM Gateway within your own package and copy provided docker files:</p>
<pre><code>  mkdir /opt/my-scimgateway  
  cd /opt/my-scimgateway  
  bun init -y  
  bun install scimgateway  
  bun pm trust scimgateway  
  cp ./config/docker/* .  
</code></pre>
<p><strong>docker-compose.yml</strong>   &lt;== Here is where you would set the exposed port and environment<br>
<strong>Dockerfile</strong>   &lt;== Main dockerfile<br>
<strong>DataDockerfile</strong>   &lt;== Handles volume mapping<br>
<strong>docker-compose-debug.yml</strong> &lt;== Debugging<br>
<strong>docker-compose-mssql.yml</strong> &lt;== Example including MSSQL docker image</p>
</li>
<li>
<p>Create a scimgateway user on your Linux VM.</p>
<pre><code>  adduser scimgateway
</code></pre>
</li>
<li>
<p>Create a directory on your VM host for the scimgateway configs:</p>
<pre><code>  mkdir /home/scimgateway/config
</code></pre>
</li>
<li>
<p>Copy your updated configuration file e.g. /opt/my-scimgateway/config/plugin-loki.json to /home/scimgateway/config.  Use scp to perform the copy.</p>
<p>NOTE: /home/scimgateway/config is where all important configuration and loki datastore will reside outside of the running docker container.  If you upgrade scimgateway you won't lose your configurations and data.</p>
</li>
<li>
<p>Build docker images and start it up</p>
<pre><code>  docker-compose up --build -d
</code></pre>
<p>NOTE: Add the -d flag to run the command above detached.</p>
<p>Be sure to confirm that port 8880 is available with a simple http request</p>
<p>If using default plugin-loki and we have configured <code>{&quot;persistence&quot;: true}</code>, we could confirm scimgateway created loki.db:</p>
<pre><code>  su scimgateway  
  cd /home/scimgateway/config  
  ls loki.db  
</code></pre>
</li>
</ul>
<p>To list running containers information:<br>
<code>docker ps</code></p>
<p>To list available images:<br>
<code>docker images</code></p>
<p>To view the logs:<br>
<code>docker logs scimgateway</code></p>
<p>To execute command within your running container:<br>
<code>docker exec scimgateway &lt;bash command&gt;</code></p>
<p>To stop scimgateway:<br>
<code>docker-compose stop</code></p>
<p>To restart scimgateway:<br>
<code>docker-compose start</code></p>
<p>To debug running container (using Visual Studio Code):<br>
<code>docker-compose -f docker-compose.yml -f docker-compose-debug.yml up -d</code><br>
Start Visual Studio Code and follow <a href="https://code.visualstudio.com/docs/nodejs/nodejs-debugging">these</a> debugging instructions</p>
<p>To upgrade scimgateway docker image (remove the old stuff before running docker-compose up --build):</p>
<pre><code>docker rm scimgateway  
docker rm $(docker ps -a -q); docker rmi $(docker images -q -f &quot;dangling=true&quot;)  
</code></pre>
<h2 id="entra-id-as-idp-using-scim-gateway">Entra ID as IdP using SCIM Gateway</h2>
<p>Entra ID could do automatic user provisioning by synchronizing users towards SCIM Gateway, and gateway plugins will update endpoints.</p>
<p>Plugin configuration file must include <strong>SCIM Version &quot;2.0&quot;</strong> (scimgateway.scim.version) and either <strong>Bearer Token</strong> (scimgateway.auth.bearerToken[x].token) or <strong>Entra ID Tenant ID GUID</strong> (scimgateway.auth.bearerJwtAzure[x].tenantIdGUID) or both:</p>
<pre><code>scimgateway: {
  &quot;scim&quot;: {
    &quot;version&quot;: &quot;2.0&quot;,
    ...
  },
  ...
  &quot;auth&quot;: {
    &quot;bearerToken&quot;: [
      {
        &quot;token&quot;: &quot;shared-secret&quot;
      }
    ],
    &quot;bearerJwtAzure&quot;: [
      {
        &quot;tenantIdGUID&quot;: &quot;xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx&quot;
      }
    ]
  }
  ...
}
</code></pre>
<p><code>token</code> configuration must correspond with &quot;Secret Token&quot; defined in Entra ID<br>
<code>tenantIdGUID</code> configuration must correspond with Entra ID Tenant ID</p>
<p>In Azure Portal:
<code>Azure-Microsoft Entra ID-Enterprise Application-&lt;My Application&gt;-Provisioning-Secret Token</code><br>
Note, when &quot;Secret Token&quot; is left blank, Azure will use JWT (tenantIdGUID)</p>
<p><code>Azure-Microsoft Entra ID-Overview-Tenant ID</code></p>
<p>User mappings attributes between AD and SCIM also needs to be configured</p>
<p><code>Azure-Microsoft Entra ID-Enterprise Application-&lt;My Application&gt;-Provisioning-Edit attribute mappings-Mappings</code></p>
<p>Entra ID default SCIM attribute mapping for <strong>USER</strong> must have:</p>
<pre><code>userPrincipalName mapped to userName (matching precedence #1)  
</code></pre>
<p>Entra ID default SCIM attribute mapping for <strong>GROUP</strong> must have:</p>
<pre><code>displayName mapped to displayName (matching precedence #1)  
members mapped to members  
</code></pre>
<p>Some notes related to Entra ID:</p>
<ul>
<li>
<p>Entra ID SCIM <a href="https://learn.microsoft.com/en-us/entra/identity/app-provisioning/use-scim-to-provision-users-and-groups">documentation</a></p>
</li>
<li>
<p>For using OAuth/JWT credentials, Entra ID configuration &quot;Secret Token&quot; (bearer token) should be blank. Plugin configuration must then include bearerJwtAzure.tenantIdGUID. Click &quot;Test Connection&quot; in Azure to verify</p>
</li>
<li>
<p>Entra ID do a regular check for a &quot;non&quot; existing user/group. This check seems to be a &quot;keep alive&quot; to verify connection.</p>
</li>
<li>
<p>Entra ID first checks if user/group exists, if not exist they will be created (no explore of all users like CA Identity Manager)</p>
</li>
<li>
<p>Deleting a user in Entra ID sends a modify user <code>{&quot;active&quot;:&quot;False&quot;}</code> which means user should be disabled. This logic is default set in attribute mappings expression rule <code>Switch([IsSoftDeleted], , &quot;False&quot;, &quot;True&quot;, &quot;True&quot;, &quot;False&quot;)</code>. Standard SCIM &quot;DELETE&quot; method seems not to be used.</p>
</li>
</ul>
<h2 id="symantec-identity-manager-as-idp-using-scim-gateway">Symantec Identity Manager as IdP using SCIM Gateway</h2>
<p>Using Symantec/Broadcom Identity Manger, plugin configuration must use <strong>SCIM Version &quot;1.1&quot;</strong> (scimgateway.scim.version).</p>
<p>In the Provisioning Manager we could use <code>Endpoint type = SCIM (DYN Endpoint)</code> or create our own custom endpoint type based on this one</p>
<p>SCIM endpoint configuration example for Loki plugin (plugin-loki)</p>
<pre><code>Endpoint Name = Loki-8880  
User Name = gwadmin  
Password = password  
SCIM Authentication Method = HTTP Basic Authentication  
SCIM Based URL = http://localhost:8880  

or:  

SCIM Based URL = http://localhost:8880/&lt;baseEntity&gt;
</code></pre>
<p>Username, password and port must correspond with plugin configuration file. For &quot;Loki&quot; plugin it will be <code>config\plugin-loki.json</code></p>
<p>&quot;SCIM Based URL&quot; refer to the FQDN (or localhost) having SCIM Gateway installed. Portnumber must be included. Use HTTPS instead of HTTP if SCIM Gateway configuration includes certificates.</p>
<p>&quot;baseEntity&quot; is optional. This is a parameter used for multi tenant or multi endpoint solutions. We could create several endpoints having same base url with unique baseEntity. e.g:</p>
<p><a href="http://localhost:8880/client-a">http://localhost:8880/client-a</a><br>
<a href="http://localhost:8880/client-b">http://localhost:8880/client-b</a></p>
<p>Each baseEntity should then be defined in the plugin configuration file with custom attributes needed. Please see examples in plugin-soap.json</p>
<h2 id="entra-id-provisioning">Entra ID provisioning</h2>
<p>Using plugin-entra-id we could do user provisioning towards Entra ID</p>
<p>For testing purposes we could get an Azure free account</p>
<h3 id="entra-id-configuration">Entra ID configuration</h3>
<ul>
<li>Logon to <a href="https://portal.azure.com">Azure</a> as global administrator</li>
<li>Microsoft Entra ID - App registrations
<ul>
<li>Click &quot;New registration&quot;</li>
<li>Name = SCIM Gateway Inbound</li>
<li>Select: Accounts in this organizational directory only</li>
<li>Click &quot;Register&quot;</li>
<li>Overview:
<ul>
<li>Copy &quot;Application (client) ID&quot;</li>
<li>Copy &quot;Directory (tentant) ID&quot;</li>
</ul>
</li>
<li>Certificates &amp; secrets:
<ul>
<li>Click &quot;New client secret&quot;</li>
<li>Description = SCIM Gateway Inbound secret#1</li>
<li>Select an appropriate &quot;Expires&quot;</li>
<li>Click &quot;Add&quot;</li>
<li>Copy &quot;Value&quot; of the new secret that was created</li>
</ul>
</li>
<li>API permissions: - Add a permission - Microsoft Graph - Application permissions
<ul>
<li>Optionally remove any defaults included e.g. User.Read</li>
<li>Click &quot;Add a permission&quot;</li>
<li>Microsoft Graph</li>
<li>Application permissions</li>
<li>Directory - Directory.ReadWriteAll</li>
<li>Organization - Organization.ReadWrite.All</li>
<li>Click &quot;Add permissions&quot;</li>
</ul>
</li>
<li>API permissions: - Grant Admin consent<br>
Or we could go to Enterprise application to grant these consents:
<ul>
<li>Microsoft Entra ID - Enterprise applications - SCIM Gateway Inbound
<ul>
<li>Permissions:
<ul>
<li>Click &quot;Grant admin consent for [tenant name]&quot;</li>
<li>In the logon dialog, logon as global administrator</li>
<li>In permissions request dialog, click &quot;Accept&quot;</li>
<li>Click &quot;Refresh&quot;, directory and organization permissions are now listed and OK</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Seems Application needs to be member of &quot;User administrator&quot; for having privileges to manage office/mobile phone on users that is member of any administrator roles</strong></p>
<p>Also note, enable/disable user (accountEnabled - through Graph API) will fail if user have an &quot;Administrator&quot; role other than above mentioned &quot;User Administrator&quot; e.g. &quot;Group Administrator&quot;/&quot;Application Administrator&quot;. To be sure we can enable/disable all users,  application needs to be member of <strong>&quot;Global administrator&quot;</strong> - 62e90394-69f5-4237-9190-012177145e10.</p>
<ul>
<li>Microsoft Entra ID - Manage - Roles and administrators
<ul>
<li>Search: User administrator</li>
<li>Click on role <strong>User administrator</strong></li>
<li>Click &quot;Add assignments&quot;</li>
<li>Click &quot;No member selected&quot; to add members</li>
<li>Search: SCIM Gateway Inbound (name of the application we have created)</li>
<li>Select the application name that shows up and click &quot;Add&quot;</li>
<li>Click Next</li>
<li>Assignment type=Active and enable &quot;Permanent assigned&quot;, add some justification text and click &quot;Assign&quot;</li>
</ul>
</li>
</ul>
<h3 id="scim-gateway-configuration">SCIM Gateway configuration</h3>
<p><strong>Edit index.ts</strong><br>
Set plugin to be started to <code>entra-id</code></p>
<pre><code>const plugins = ['entra-id']
</code></pre>
<p><strong>Edit plugin-entra-id.json</strong></p>
<p>Note, for Symantec/Broadcom Provisioning we must use SCIM version 1.1</p>
<pre><code>scimgateway: {
  &quot;scim&quot;: {
    &quot;version&quot;: &quot;1.1&quot;
  },
</code></pre>
<p><code>username</code> and <code>password</code> used to connect the SCIM Gateway must be defined.</p>
<pre><code>    &quot;auth&quot;: {
      &quot;basic&quot;: [
        {
          &quot;username&quot;: &quot;gwadmin&quot;,
          &quot;password&quot;: &quot;password&quot;,
          &quot;readOnly&quot;: false,
          &quot;baseEntities&quot;: []
        }
      ],
</code></pre>
<p>Update <code>tenantIdGUID</code>, <code>clientID</code> and <code>clientSecret</code> according to what you copied from the previous Entra ID configuration.</p>
<p>If using proxy, set proxy.host to <code>&quot;http://&lt;FQDN-ProxyHost&gt;:&lt;port&gt;&quot;</code> e.g <code>&quot;http://proxy.mycompany.com:3128&quot;</code></p>
<pre><code>&quot;endpoint&quot;: {
  &quot;entity&quot;: {
    &quot;undefined&quot;: {
	  &quot;connection&quot;: {
	    &quot;baseUrls&quot;: [
		  &quot;not in use for Entra ID when tenantIdGUID is defined&quot;
	    ],
	    &quot;auth&quot;: {
		  &quot;type&quot;: &quot;oauth&quot;,
		  &quot;options&quot;: {
		    &quot;tokenUrl&quot;: &quot;oauth token_url - not in use when tenantIdGUID is defined&quot;,
		    &quot;tenantIdGUID&quot;: &quot;Entra ID Tenant ID (GUID) or Primary domain name - only used by plugin-entra-id&quot;,
		    &quot;clientId&quot;: &quot;oauth client_id - Entra ID: Application ID&quot;,
		    &quot;clientSecret&quot;: &quot;oauth client_secret - Entra ID: generated application secret value&quot;
		  }
	    },
	    &quot;proxy&quot;: {
		  &quot;host&quot;: null,
		  &quot;username&quot;: null,
		  &quot;password&quot;: null
	    }
	  }
    }
  },
  &quot;map&quot;: {
    ...
  }
}
</code></pre>
<p>Note, clientSecret and any proxy.password will become encrypted in this file on the first Azure connection.</p>
<p>For multi-tenant or multi-endpoint support, we may add several entities:</p>
<pre><code>&quot;endpoint&quot;: {
  &quot;entity&quot;: {
    &quot;undefined&quot;: {
		...
    },
    &quot;client-a&quot;: {
		...
    },
    &quot;client-b&quot;: {
		...
    }
  }
}
</code></pre>
<p>For additional details, see baseEntity description.</p>
<p>Note, we should normally use certificate (https) for communicating with SCIM Gateway unless we install gateway locally on the manager (e.g. on the CA Connector Server). When installed on the manager, we could use <code>http://localhost:port</code> or <code>http://127.0.0.1:port</code> which will not be passed down to the data link layer for transmission. We could then also set {&quot;localhostonly&quot;: true}</p>
<h3 id="using-symantecbroadcom-provisioning">Using Symantec/Broadcom Provisioning</h3>
<p>Create a new endpoint type &quot;Azure - ScimGateway&quot;</p>
<ul>
<li>Start SCIM Gateway
<ul>
<li>Using plugin-entra-id: <code>const plugins = ['entra-id']</code> in <code>index.ts</code></li>
<li>username, password and port defined in <code>plugin-entra-id.json</code> must also be known</li>
</ul>
</li>
<li>Start ConnectorXpress</li>
<li>Setup Data Sources
<ul>
<li>Add</li>
<li>Layer7 (this is SCIM)</li>
<li>Name = SCIM Gateway-8881</li>
<li>Base URL = <a href="http://localhost:8881">http://localhost:8881</a> (SCIM Gateway installed locally on Connector Server)</li>
</ul>
</li>
<li>Add the new &quot;Azure - ScimGateway&quot; endpoint type
<ul>
<li>Metadata - Import - &quot;my-scimgateway\node_modules\scimgateway\config\resources\Azure - ScimGateway.xml&quot;</li>
<li>Select the datasource we created - SCIM Gateway-8881</li>
<li>Enter password for the user defined in datasource (e.g. gwadmin/password)</li>
<li>On the right - expand Provisioning Servers - your server - and logon</li>
<li>Right Click &quot;Endpoint Types&quot;, Create New Endpoint Type
<ul>
<li>You may use default name &quot;Azure - ScimGateway&quot; and click &quot;OK&quot; to create endpoint</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Note, metafile &quot;Azure - ScimGateway.xml&quot; is based on CA &quot;Azure - WSL7&quot; with some minor adjustments like using Microsoft Graph API attributes instead of Azure AD Graph attributes.</p>
<p><strong>Provisioning Manager configuration</strong></p>
<p><code>Endpoint type = Azure - ScimGateway (DYN Endpoint)</code></p>
<p>Endpoint configuration example:</p>
<pre><code>Endpoint Name = AzureAD-8881  
User Name = gwadmin  
Password = password  
SCIM Authentication Method = HTTP Basic Authentication  
SCIM Based URL = http://localhost:8881  
or  
SCIM Based URL = http://localhost:8881/&lt;baseEntity&gt;  
</code></pre>
<p>For details, please see section &quot;CA Identity Manager as IdP using SCIM Gateway&quot;</p>
<h2 id="scim-gateway-rest-api">SCIM Gateway REST API</h2>
<pre><code>Create = POST http://localhost:8880/Users  
(body contains the user information)

Update = PATCH http://localhost:8880/Users/&lt;id&gt;
(body contains the attributes to be updated)

Search/Read = GET http://localhost:8880/Users?userName eq 
&quot;userID&quot;&amp;attributes=&lt;comma separated list of scim-schema defined attributes&gt;

Search/explore all users:
GET http://localhost:8880/Users?attributes=userName

Delete = DELETE http://localhost:8880/Users/&lt;id&gt;
</code></pre>
<p>Discovery:</p>
<pre><code>GET http://localhost:8880/ServiceProviderConfigs
Specification compliance, authentication schemes, data models.

GET http://localhost:8880/Schemas
Introspect resources and attribute extensions.
</code></pre>
<p>Note:</p>
<ul>
<li>userName (mandatory) = UserID</li>
<li>id (mandatory) = Unique id. Could be set to the same as UserID but don't have to.</li>
</ul>
<h2 id="api-gateway">API Gateway</h2>
<p>SCIM Gateway also works as an API Gateway when using url <code>/api</code> or <code>/&lt;baseEntity&gt;/api</code></p>
<p>Following methods for the none SCIM based api-plugin are supported:</p>
<pre><code>	GET /api  
	GET /api?queries  
	GET /api/{id}  
	POST /api + body  
	PUT /api/{id} + body  
	PATCH /api/{id} + body  
	DELETE /api/{id}  
</code></pre>
<p>These methods can also be used in standard SCIM plugins<br>
Please see example plugin: <strong>plugin-api.ts</strong></p>
<h2 id="how-to-build-your-own-plugins">How to build your own plugins</h2>
<p>For JavaScript coding editor you may use <a href="https://code.visualstudio.com/" title="Visual Studio Code">Visual Studio Code</a></p>
<p>Preparation:</p>
<ul>
<li>Copy &quot;best matching&quot; example plugin e.g. <code>lib\plugin-mssql.ts</code> and <code>config\plugin-mssql.json</code> and rename both copies to your plugin name prefix e.g. plugin-mine.ts and plugin-mine.json</li>
<li>Edit plugin-mine.json and define a unique port number for the gateway setting</li>
<li>Edit index.ts and include your plugin in the startup e.g. <code>const plugins = ['mine']');</code></li>
<li>Start SCIM Gateway and verify using using your own SCIM API requests or your IdP/IGA system.</li>
</ul>
<p>Now we are ready for custom coding by editing plugin-mine.ts
Coding should be done step by step and each step should be verified and tested before starting the next</p>
<ol>
<li><strong>Turn off group functionality</strong> - getGroups to return empty response (gateway automatically use getGroups for some of the methods if groups not included)<br>
Please see plugin-saphana that do not use groups.</li>
<li><strong>getUsers</strong> (test provisioning retrieve all accounts and single account)</li>
<li><strong>createUser</strong> (test provisioning new account)</li>
<li><strong>deleteUser</strong> (test provisioning delete account)</li>
<li><strong>modifyUser</strong> (test provisioning modify account)</li>
<li><strong>Turn on group functionality</strong> - getGroups having logic for returning groups if groups are supported</li>
<li><strong>getGroups</strong> (test provisioning retrieve groups)</li>
<li><strong>modifyGroup</strong> (test provisioning modify group members)</li>
<li><strong>createGroup</strong> (test provisioning new group)</li>
<li><strong>deleteGroup</strong> (test provisioning delete account)</li>
</ol>
<p>Template used by CA Provisioning role should only include endpoint supported attributes defined in our plugin. Template should therefore have no links to global user for none supported attributes (e.g. remove %UT% from &quot;Job Title&quot; if our endpoint/code do not support title)</p>
<p>CA Provisioning using default SCIM endpoint do not support SCIM Enterprise User Schema Extension (having attributes like employeeNumber, costCenter, organization, division, department and manager). If we need these or other attributes not found in CA Provisioning, we could define our own by using the free-text &quot;type&quot; definition in the multivalue entitlements or roles attribute. In the template entitlements definition, we could for example define type=Company and set value to %UCOMP%. Please see plugin-soap.ts using Company as a multivalue &quot;type&quot; definition.</p>
<p>Using CA Connector Xpress we could create a new SCIM endpoint type based on the original SCIM. We could then add/remove attributes and change from default assign &quot;user to groups&quot; to assign &quot;groups to user&quot;. There are also other predefined endpoints based on the original SCIM. You may take a look at &quot;ServiceNow - WSL7&quot; and &quot;Zendesk - WSL7&quot;.</p>
<p>For project setup:</p>
<ul>
<li>Datasource =  Layer7 (CA API) - this is SCIM</li>
<li>Layer7 Base URL = SCIM Gateway url and port (SCIM Base URL)</li>
<li>Authentication = Basic Authentication<br>
(connect using gwadmin/password defined in plugin config-file)</li>
</ul>
<h3 id="how-to-change-user-member-of-groups-to-group-member-of-users">How to change &quot;user member of groups&quot; to &quot;group member of users&quot;</h3>
<p>Using Connector Xpress based on the original SCIM endpoint.</p>
<p>Delete defaults:<br>
Group - Associations - with User Account<br>
Group - Attributes - members<br>
User Account - Attributes - Group Membership</p>
<p>Create new attribute:<br>
User Account - Attributes: Groups - Flexi DN - Multivalue - <strong>groups</strong></p>
<p>Create User - Group associations:<br>
User Account - Accociations - <strong>Direct association with = Group</strong><br>
User Account - Accociations - with Group</p>
<p>Note, &quot;Include a Reverse Association&quot; - not needed if we don't need Group object functionality e.g list/add/remove group members</p>
<p>User Attribute = <strong>Physical Attribute = Groups</strong><br>
Match Group = By Attribute = ID</p>
<p>Objects Must Exist<br>
Use DNs in Attribute = activated (toggled on)</p>
<p>Include a Reverse Association (if needed)<br>
Group Attribute = <strong>Virtual Attribute = User Membership</strong><br>
Match User Account = By Attribute = User Name</p>
<p>Note, groups should be capability attribute (updated when account is synchronized with template):<br>
advanced options - <strong>Synchronized</strong> = enabled (toggled on)</p>
<h2 id="methods">Methods</h2>
<p>Plugins should have following initialization:</p>
<pre><code>// start - mandatory plugin initialization
const ScimGateway: typeof import('scimgateway').ScimGateway = await (async () =&gt; {
  try {
	return (await import('scimgateway')).ScimGateway
  } catch (err) {
	const source = './scimgateway.ts'
	return (await import(source)).ScimGateway
  }
})()
const scimgateway = new ScimGateway()
const config = scimgateway.getConfig()
scimgateway.authPassThroughAllowed = false
// end - mandatory plugin initialization
</code></pre>
<p>If using REST, we could also include the HelperRest:</p>
<pre><code>// start - mandatory plugin initialization
...
const HelperRest: typeof import('scimgateway').HelperRest = await (async () =&gt; {
  try {
	return (await import('scimgateway')).HelperRest
  } catch (err) {
	const source = './scimgateway.ts'
	return (await import(source)).HelperRest
  }
})()
...
// end - mandatory plugin initialization
</code></pre>
<p>Plugins should include following SCIM Gateway methods:</p>
<ul>
<li>scimgateway.getUsers()</li>
<li>scimgateway.createUser()</li>
<li>scimgateway.deleteUser()</li>
<li>scimgateway.modifyUser()</li>
<li>scimgateway.getGroups()</li>
<li>scimgateway.createGroup()</li>
<li>scimgateway.deleteGroup()</li>
<li>scimgateway.modifyGroup()</li>
</ul>
<p>In addition following general API methods are available for use:</p>
<ul>
<li>scimgateway.postApi()</li>
<li>scimgateway.putApi()</li>
<li>scimgateway.patchApi()</li>
<li>scimgateway.getApi()</li>
<li>scimgateway.deleteApi()</li>
</ul>
<p>In code editor (e.g., Visual Studio Code), method details and documentation are shown by IntelliSense</p>
<h2 id="license">License</h2>
<p>MIT © <a href="https://www.elshaug.xyz">Jarle Elshaug</a></p>
<h2 id="change-log">Change log</h2>
<h3 id="v530">v5.3.0</h3>
<p>[Improved]</p>
<ul>
<li><a href="https://datatracker.ietf.org/doc/html/rfc7644#section-3.7">SCIM Bulk Operations</a> now supported</li>
<li>Dependencies bump</li>
</ul>
<h3 id="v525">v5.2.5</h3>
<p>[Fixed]</p>
<ul>
<li>endpointMapper (used by plugin-entra-id and plugin-ldap) in v5 when using mapping type=array, the first element was excluded on outbound mapping in some use cases</li>
</ul>
<h3 id="v524">v5.2.4</h3>
<p>[Improved]</p>
<ul>
<li>New configuration <code>log.logDirectory</code> for custom defined log directory e.g. <code>/var/log/scimgateway</code> that will override default <code>&lt;scimgateway path&gt;/logs</code>.<br>
<strong>Thanks to <a href="https://github.com/gerritlansing">@Gerrit Lansing</a></strong></li>
<li>Base URL like <code>/scim/v1</code> and <code>/scim/v2</code> is now supported, also with baseEntity e.g. <code>/scim/v2/client1/Users</code></li>
</ul>
<h3 id="v523">v5.2.3</h3>
<p>[Fixed]</p>
<ul>
<li>GET /ResourceTypes was missing in v5</li>
</ul>
<h3 id="v522">v5.2.2</h3>
<p>[Fixed]</p>
<ul>
<li>
<p>plugin-ldap, tls configuration now supported for Bun &gt; v1.2.4, previously environments had to be used</p>
<pre><code>  &quot;tls&quot;: {
  	&quot;ca&quot;: &quot;ca-file-name&quot;, // located in config/certs
  	&quot;rejectUnauthorized&quot;: true
  }
</code></pre>
</li>
</ul>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v521">v5.2.1</h3>
<p>[Fixed]</p>
<ul>
<li>Logger did not use the correct plugin rollover filename when the gateway ran multiple plugins</li>
</ul>
<h3 id="v520">v5.2.0</h3>
<p>[Improved]</p>
<ul>
<li>
<p>Logger have been redesigned</p>
<p>Supports console, file and push (client subscriber) logging<br>
Remote real-time log subscription, see configuration notes<br>
JSON formatted log messages<br>
UTC (Coordinated Universal Time)<br>
File logging will rotate on startup<br>
File logging now includes configuration options for maxFiles and maxSize<br>
Console using default colorized and minimized output. If redirecting stdout/stderr, standard JSON will be used and no color encoding</p>
</li>
</ul>
<h3 id="v518">v5.1.8</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-ldap, dn that includes double underscore <code>__</code> not correctly handled</li>
</ul>
<h3 id="v517">v5.1.7</h3>
<p>[Fixed]</p>
<ul>
<li>Using gateway certificate CA, the CA did not load correctly. It now also supports an array of multiple CAs.</li>
</ul>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v516">v5.1.6</h3>
<p>[Improved]</p>
<ul>
<li>HelperRest, payload/claims configuration now defined in auth.options.jwtPayload and auth.options.samlPayload. Previously all was defiend in auth.options</li>
<li>README configuration notes updated</li>
</ul>
<h3 id="v515">v5.1.5</h3>
<p>[Improved]</p>
<ul>
<li>404 NOT_FOUND is now logged as a warning instead of error</li>
</ul>
<h3 id="v514">v5.1.4</h3>
<p>[Fixed]</p>
<ul>
<li>Postinstall failed using the new Bun v1.2.0</li>
</ul>
<h3 id="v513">v5.1.3</h3>
<p>[Fixed]</p>
<ul>
<li>
<p>HelperRest, auth.type=<code>oauthJwtBearer</code> and auth.options=<code>tenantIdGUID</code></p>
<p>Configuration example using Entra ID application having uploaded cert.pem as certificate secret:</p>
<pre><code>  &quot;endpoint&quot;: {
    &quot;entity&quot;: {
      &quot;undefined&quot;: {
        &quot;connection&quot;: {
          &quot;baseUrls&quot;: [],
          &quot;auth&quot;: {
            &quot;type&quot;: &quot;oauthJwtBearer&quot;,
            &quot;options&quot;: {
              &quot;tenantIdGUID&quot;: &quot;Entra ID Tenant ID (GUID)&quot;,
              &quot;clientId&quot;: &quot;&lt;application clientId&gt;&quot;,
              &quot;tls&quot;: { // files located in ./config/certs
                &quot;key&quot;: &quot;key.pem&quot;,
                &quot;cert&quot;: &quot;cert.pem&quot;
              }
            }
          }
        }
      }
    }
  }
</code></pre>
<p>Please see code editor method HelperRest doRequest() IntelliSense for details</p>
<p>Note, this fix may break <code>plugin-entra-id</code> if baseUrls configuration not empty. If baseUrl not empty, it will be used. If empty, baseUrl will automatically be set according to graph api when using tenantIdGUID definition</p>
</li>
</ul>
<h3 id="v512">v5.1.2</h3>
<p>[Improved]</p>
<ul>
<li>Simplified some initialization logic</li>
</ul>
<h3 id="v511">v5.1.1</h3>
<p>[Fixed]</p>
<ul>
<li>SCIM Gateway failed to start on linux using Bun &gt;= v1.1.43</li>
</ul>
<h3 id="v510">v5.1.0</h3>
<p>[Improved]</p>
<ul>
<li>
<p>By configuring the <code>chainingBaseUrl</code>, it is now possible to chain multiple gateways in sequence, such as <code>gateway1-&gt;gateway2-&gt;gateway3-&gt;endpoint</code>. In this setup, gateway beave much like a reverse proxy, validating authorization at each step unless PassThrough mode is enabled. Chaining is also supported in stream subscriber mode</p>
<p>Please see <code>Configuration notes</code> for details</p>
</li>
</ul>
<h3 id="v5015">v5.0.15</h3>
<p>[Improved]</p>
<ul>
<li>HelperRest, auth.type=oauthSamlAssertion and auth.type=oauthJwtAssertion have been updated to <code>oauthSamlBearer</code> and <code>oauthJwtBearer</code> for consistency</li>
</ul>
<h3 id="v5014">v5.0.14</h3>
<p>[Improved]</p>
<ul>
<li>email now supports Google Workspace Gmail using REST OAuth</li>
<li>email workaround for ExO national characters introduced in v5.0.7 not needed anymore - ExO/GraphApi seems to have been fixed</li>
<li>some minor cosmetics on email message layout formatting when using plain text message</li>
<li>HelperRest now includes authentication type <code>oauthJwtAssertion</code></li>
</ul>
<h3 id="v5013">v5.0.13</h3>
<p>[Improved]</p>
<ul>
<li>scim-stream, using the new reorganized nats.js v3 client library</li>
<li>cosmetics, <code>use strict</code> not needed and removed because ES modules are always strict mode</li>
</ul>
<h3 id="v5012">v5.0.12</h3>
<p>[Fixed]</p>
<ul>
<li>HelperRest doRequest() incorrect Auth PassThrough handling</li>
</ul>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v5011">v5.0.11</h3>
<p>[Fixed]</p>
<ul>
<li>OAuth token response on error missing error_description in v5</li>
<li>HelperRest doRequest() now also includes retry logic on invalid token that has not expired - will renew token</li>
</ul>
<h3 id="v5010">v5.0.10</h3>
<p>[Improved]</p>
<ul>
<li>OAuth token request now accept missing or invalid Content-Type header</li>
</ul>
<h3 id="v509">v5.0.9</h3>
<p>[Improved]</p>
<ul>
<li>HelperRest doRequest() now support configuration auth type <code>oauthSamlAssertion</code> for OAuth SAML token assertion. Please see code editor method IntelliSense for details</li>
</ul>
<h3 id="v508">v5.0.8</h3>
<p>[Fixed]</p>
<ul>
<li>Ensure Bun compatibility with Azure Reverse Proxy for large and long running response</li>
<li>HelperRest was not compatible with Node.js</li>
<li>plugin-mssql, some error handling should not throw an error</li>
<li>Configuration files updated according to the v5 configuration syntax of <code>scimgateway.auth.bearerOAuth</code> - <code>clientId/clientSecret</code> now replacing deprecated <code>client_id/client_secret</code></li>
</ul>
<h3 id="v507">v5.0.7</h3>
<p>[Improved]</p>
<ul>
<li>plugin-mssql all methods now implemented, also includes docker and dbinit configuration, <strong>thanks to <a href="https://github.com/phavekes">@Peter Havekes</a> and <a href="https://github.com/mrvanes">@mrvanes</a></strong></li>
</ul>
<p>[Fixed]</p>
<ul>
<li>mail sending option introduced in v5.0.6 did not fully support national special charcters when using Microsoft Exchange Online and html formatted email</li>
</ul>
<h3 id="v506">v5.0.6</h3>
<p>[Improved]</p>
<ul>
<li>new configuration option: <code>scimgateway.idleTimeout</code> default 120, sets the the number of seconds to wait before timing out a connection due to inactivity</li>
<li>deprecated configuration option: <code>scimgateway.payloadSize</code> Bun using default maxRequestBodySize 128MB</li>
<li>new configuration option: <code>scimgateway.email</code> replacing legacy <code>scimgateway.emailOnError</code> (legacy still supported). Email now support oauth authentication</li>
</ul>
<p><strong>old configuration:</strong></p>
<pre><code>{
  &quot;scimgateway&quot;: {
    ...
    &quot;emailOnError&quot;: {
      &quot;smtp&quot;: {
        &quot;enabled&quot;: false,
        &quot;host&quot;: null,
        &quot;port&quot;: 587,
        &quot;proxy&quot;: null,
        &quot;authenticate&quot;: true,
        &quot;username&quot;: null,
        &quot;password&quot;: null,
        &quot;sendInterval&quot;: 15,
        &quot;to&quot;: null,
        &quot;cc&quot;: null
      }
    },
    ...
  },
  ...
}
</code></pre>
<p><strong>new configuration:</strong><br>
Using Microsoft Exchange Online and oauth authencation which also is default and recommended by Microsoft. For other mail servers and options like SMTP AUTH (basic/oauth), please see configuration description. Plugin may also send mail using method scimgateway.sendMail()</p>
<pre><code>{
  &quot;scimgateway&quot;: {
    ...
    &quot;email&quot;: {
      &quot;auth&quot;: {
        &quot;type&quot;: &quot;oauth&quot;,
        &quot;options&quot;: {
          &quot;tenantIdGUID&quot;: null,
          &quot;clientId&quot;: null,
          &quot;clientSecret&quot;: null
        }
      },
      &quot;emailOnError&quot;: {
        &quot;enabled&quot;: false,
        &quot;from&quot;: null,
        &quot;to&quot;: null
      }
    },
    ...
  },
  ...
}
</code></pre>
<p>Configuration notes when using oauth and tenantIdGUID - Microsoft Exchange Online (ExO):</p>
<ul>
<li>
<p>Entra ID application must have application permissions <code>Mail.Send</code></p>
</li>
<li>
<p>To prevent the sending of emails from any defined mailboxes, an ExO <code>ApplicationAccessPolicy</code> must be defined through PowerShell.</p>
<p>First create a mail-enabled security-group that only includes those users (mailboxes) the application is allowed to send from<br>
Note, <code>mail enabled security group</code> cannot be created from portal, only from admin or admin.exchange console</p>
<pre><code>  ##Connect to Exchange
  Install-Module -Name ExchangeOnlineManagement
  Connect-ExchangeOnline
   
  ##Create ApplicationAccessPolicy
  New-ApplicationAccessPolicy -AppId &lt;AppClientID&gt; -PolicyScopeGroupId &lt;MailEnabledSecurityGrpId&gt; -AccessRight RestrictAccess -Description &quot;Restrict app to specific mailboxes&quot;
</code></pre>
</li>
</ul>
<h3 id="v505">v5.0.5</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-ldap, dn special character not correct for ascii code 128(dec)/80(hex)</li>
</ul>
<h3 id="v504">v5.0.4</h3>
<p>[Improved]</p>
<ul>
<li>minor type definition cosmetics</li>
</ul>
<h3 id="v503">v5.0.3</h3>
<p>[Fixed]</p>
<ul>
<li>unauthorized connection when using configuration bearerJwtAzure</li>
</ul>
<p>[Improved]</p>
<ul>
<li>minor type definition cosmetics</li>
</ul>
<h3 id="v502">v5.0.2</h3>
<p>[Improved]</p>
<ul>
<li>minor cosmetics readme updates</li>
</ul>
<h3 id="v501">v5.0.1</h3>
<p>[Fixed]</p>
<ul>
<li>postinstall did not update index.ts when default bun index.ts did exist</li>
</ul>
<h3 id="v500">v5.0.0</h3>
<p><strong>[MAJOR]</strong></p>
<p>Major version v5.0.0 marks a shift to native TypeScript support and prioritizes <a href="https://bun.sh/">Bun</a> over Node.js.</p>
<p>Besides going from JavaScript to TypeScript, following can be mentioned:</p>
<ul>
<li>
<p>Code editor now having IntelliSense showing available methods and documentation details for scimgateway methods</p>
</li>
<li>
<p>index.ts having new logic for starting plugins e.g.: <code>const plugins = ['ldap']</code> for starting plugin-ldap</p>
</li>
<li>
<p>If using Node.js: node must be version &gt;= 22.6.0, scimgateway must be downloaded from github (because stripping types is currently unsupported for files under node_modules) and startup argument <code>--experimental-strip-types</code> e.g.; <code>node --experimental-strip-types index.ts</code></p>
</li>
<li>
<p>Plugins can use <code>scimgateway.HelperRest()</code> for REST functionality. Previously this logic was included in each plugin that used REST.</p>
<pre><code>  // start - mandatory plugin initialization
  ...
  const HelperRest: typeof import('scimgateway').HelperRest = await (async () =&gt; {
    try {
  	return (await import('scimgateway')).HelperRest
    } catch (err) {
  	const source = './scimgateway.ts'
  	return (await import(source)).HelperRest
    }
  })()
  ...
  // end - mandatory plugin initialization  
</code></pre>
<p>Note, HelperRest use fetch which is not fully supported by Node.js regarding TLS.<br>
For TLS and Node.js, environment must instead be used and set before started, e.g.,:<br>
<code>export NODE_EXTRA_CA_CERTS=/package-path/config/certs/ca.pem</code><br>
or
<code>export NODE_TLS_REJECT_UNAUTHORIZED=0</code></p>
</li>
<li>
<p>Configuration secrets (password, secret, token, client_secret, ... ) defined in the <code>endpoint</code> section of the configuration file, will automatically be encrypted/decrypted. If there are secrets not handled by the automated encryption/decryption, we may use <code>scimgateway.getSecret()</code>. In the old version, corresponding method was named scimgateway.getPassword().</p>
</li>
<li>
<p>kubernetes configuration and logic have been removed. Kubernetes can use default <code>/ping</code> url for healthchecks, and graceful shutdown is taken care of the gateway</p>
</li>
<li>
<p>In case using custom schemas defined in lib/scimdef-v1/v2.js, these files have now changed to scimdef-v1/v2.json</p>
</li>
<li>
<p><code>config/docker/Dockerfile</code> now using Bun</p>
</li>
<li>
<p>plugin-entra, modify licenses/servicePlans is not included anymore, only listing. For license management we instead use groups.</p>
</li>
<li>
<p>plugin-ldap, for LDAPS/TLS and Bun, we must use environments e.g.:<br>
<code>export NODE_EXTRA_CA_CERTS=/package-path/config/certs/ca.pem</code><br>
or
<code>export NODE_TLS_REJECT_UNAUTHORIZED=0</code></p>
</li>
</ul>
<p><strong>How to migrate existing plugins:</strong></p>
<ul>
<li>
<p>Remove old index.js, use the new index.ts and update <code>const plugins = ['xxx']</code> to include your plugin name(s)</p>
</li>
<li>
<p>Rename plugin-xxx.js to plugin-xxx.ts</p>
</li>
<li>
<p>import must be used instead of require for loading modules e.g.:<br>
const Loki = require('lokijs') =&gt; <code>import Loki from 'lokijs'</code></p>
</li>
<li>
<p>Use the new mandatory settings:</p>
<pre><code>  // start - mandatory plugin initialization
  const ScimGateway: typeof import('scimgateway').ScimGateway = await (async () =&gt; {
    try {
      return (await import('scimgateway')).ScimGateway
    } catch (err) {
      const source = './scimgateway.ts'
      return (await import(source)).ScimGateway
    }
  })()
  const scimgateway = new ScimGateway()
  const config = scimgateway.getConfig()
  scimgateway.authPassThroughAllowed = false
  // end - mandatory plugin initialization
</code></pre>
</li>
<li>
<p>Use the new <code>config</code> object (mentioned above) which contains the <code>scimgatway.endpoint</code> configuration having automated encryption/decryption of any attributes named password, secret, client_secret, token and APIKey</p>
</li>
<li>
<p>The old scimgateway.getPassword() is not normally not needed because of scimgateway automated <code>config</code> logic. If needed, use the new scimgateway.getSecret().</p>
</li>
<li>
<p>Use the new logging syntax:</p>
<pre><code>  replace: scimgateway.logger.debug(`${pluginName}[${baseEntity}] xxx`)  
  with: scimgateway.logDebug(baseEntity, `xxx`)
</code></pre>
</li>
<li>
<p>Use scimgateway.HelperRest() for REST functionlity, also supports Auth PassThrough</p>
</li>
<li>
<p>scimgateway.endpointMapper() may be used for inbound/outbound attribute mappings</p>
</li>
<li>
<p>In general when using TypeScript, variables should be type-defined: <code>let isDone: boolean = false</code>, <code>catch (err: any)</code>, ...</p>
</li>
</ul>
<h3 id="v4512">v4.5.12</h3>
<p>[Improved]</p>
<ul>
<li>plugin-ldap, new configuration { allowModifyDN: true } allows DN being changed based on modified mapping or namingAttribute</li>
</ul>
<h3 id="v4511">v4.5.11</h3>
<p>[Improved]</p>
<ul>
<li>deleteUser will try to revoke user from groups before deleting user</li>
<li>advanced or-filter (e.g., used by One Identity Manager) will be chunked and handled by scimgateway as separate calls to plugin</li>
<li>baseEntity now included in scimgateway log entries like plugin log entries</li>
</ul>
<p>[Fixed]</p>
<ul>
<li>
<p>plugin-ldap, using OpenLDAP - configuration { &quot;isOpenLdap&quot;: true } and adding an already existing group member returned 500 Error instead of 200 OK.</p>
</li>
<li>
<p>plugin-ldap, using OpenLDAP in combination with endpoint user mapping <code>&quot;type&quot;:&quot;array&quot;</code> and <code>&quot;typeInbound&quot;:&quot;string&quot;</code> for handling comma separated SCIM string mapping towards an endpoint array/multivalue attribute, did not return correct sort order of the comma separated string when using OpenLDAP.   Mapping example:</p>
<pre><code>  &quot;&lt;endpointAttr&gt;&quot;: {
    &quot;mapTo&quot;: &quot;&lt;scimAttr&gt;&quot;,
    &quot;type&quot;: &quot;array&quot;,
    &quot;typeInbound&quot;: &quot;string&quot;
  },
</code></pre>
</li>
</ul>
<h3 id="v4510">v4.5.10</h3>
<p>[Fixed]</p>
<ul>
<li>PUT changes introduced in v4.5.7 had incorrect check of configuration groupMemberOfUser (default not set)</li>
</ul>
<h3 id="v459">v4.5.9</h3>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v458">v4.5.8</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-ldap failed when using national special characters and some other LDAP special characters in DN</li>
</ul>
<p>Note, plugin-ldap now has following new configuration:</p>
<pre><code>&quot;ldap&quot;: {
  &quot;isOpenLdap&quot;: false,
  ...
  &quot;namingAttribute&quot;: {
	&quot;user&quot;: [
	  {
		&quot;attribute&quot;: &quot;CN&quot;,
		&quot;mapTo&quot;: &quot;userName&quot;
	  }
	],
	&quot;group&quot;: [
	  {
		&quot;attribute&quot;: &quot;CN&quot;,
		&quot;mapTo&quot;: &quot;displayName&quot;
	  }
	]
  },
  ...
}
</code></pre>
<p><code>isOpenLdap</code> true/false decides whether or not OpenLDAP Foundation protocol should be used for national characters and special characters in DN. For Active Directory, default isOpenLdap=false should be used.</p>
<p><code>namingAttribute</code> can now be linked to scim <code>mapTo</code> attribute and is not hardcoded like it was in previous version.</p>
<p>Previous <code>userNamingAttr</code> and <code>groupNamingAttr</code> shown below, is now deprecated</p>
<pre><code>&quot;ldap&quot;: {
  ...
  &quot;userNamingAttr&quot;: &quot;CN&quot;,
  &quot;groupNamingAttr&quot;: &quot;CN&quot;,
  ...
}
</code></pre>
<h3 id="v457">v4.5.7</h3>
<p>[Fixed]</p>
<ul>
<li>PUT changes introduced in v4.4.6 did not handle PUT /Groups correctly</li>
</ul>
<p>[Improved]</p>
<ul>
<li>configuration scim.usePutGroupMemberOfUser replaced by scim.groupMemberOfUser</li>
<li>misc cosmetics</li>
</ul>
<h3 id="v456">v4.5.6</h3>
<p>[Improved]</p>
<ul>
<li>plugin-ldap preserve multivalue-attribute order on modify. Do not apply to groups/members.</li>
</ul>
<h3 id="v455">v4.5.5</h3>
<p>[Fixed]</p>
<ul>
<li>PUT /Groups/xxx failed on final group lookup and returned error</li>
<li>endpointMapper failed to correctly map customExtensions in certain use cases</li>
</ul>
<h3 id="v454">v4.5.4</h3>
<p>[Fixed]</p>
<ul>
<li>Delete User missing url-decoding of id e.g. using ldap-dn as id</li>
</ul>
<h3 id="v453">v4.5.3</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-api configuration file having new credentials for dummy-json testing</li>
</ul>
<p>[Improved]</p>
<ul>
<li>
<p>Dependencies bump</p>
</li>
<li>
<p>plugin-loki and plugin-mongodb, minor improvements for handling raw mulitivalue updates when not using default skipTypeConvert=false</p>
</li>
<li>
<p>endpointMapper supporting comma separated string to be converted to array, e.g.:<br>
SCIM otherMails = &quot;<a href="mailto:myAlias1@company.com">myAlias1@company.com</a><a href="mailto:,myAlias2@company.com">,myAlias2@company.com</a><a href="mailto:,myAlias3@company.com">,myAlias3@company.com</a>&quot;</p>
<p>endpointMapper configuration for endpoint attribute emails of type array:</p>
<p>&quot;map&quot;: {
&quot;user&quot;: {
&quot;emails&quot;: {
&quot;mapTo&quot;: &quot;otherMails&quot;,
&quot;type&quot;: &quot;array&quot;,
&quot;typeInbound&quot;: &quot;string&quot;
},
...</p>
</li>
</ul>
<h3 id="v451">v4.5.1</h3>
<p>[Improved]</p>
<ul>
<li>scim-stream, client reconnect improvements</li>
</ul>
<h3 id="v450">v4.5.0</h3>
<p>[Improved]</p>
<ul>
<li>scim-stream, scimgateway now supports stream publishing mode having <a href="https://elshaug.xyz/docs/scim-stream">SCIM Stream</a> as a prerequisite. In this mode, standard incoming SCIM requests from your Identity Provider (IdP) or API are directed and published to the stream. Subsequently, one of the gateways subscribing to the channel utilized by the publisher will manage the SCIM request, and response back to the publisher. Using SCIM Stream we have <code>egress/outbound only traffic</code> and get loadbalancing/failover by adding more gateways subscribing to same channel.</li>
<li>scim-stream, subscriber will do automatic retry until connected when plugin not able to connect to endpoint (offline endpoint)</li>
<li>plugin-ldap, modifyGroup now supports all attributes and not only add/remove members</li>
<li>certificate absolute path may be used in plugin configuration file instead of default relative path</li>
<li>dependencies bump</li>
</ul>
<h3 id="v446">v4.4.6</h3>
<p>[Improved]</p>
<ul>
<li>Some PUT logic redesign. More granularity on mulitvalues, instead of including all elements, now only those that differ are sent to modifyUser.</li>
</ul>
<h3 id="v445">v4.4.5</h3>
<p>[Fixed]</p>
<ul>
<li>PATCH group members=[] should remove all members</li>
<li>scim-stream modify user fix</li>
</ul>
<p>[Improved]</p>
<ul>
<li>plugin-entra-id, plugin-scim and plugin-api having updated <code>REST endpoint helpers-template</code> that includes <code>tokenAuth</code> (now used by plugin-api). Auth PassTrhough also supported for oauth/tokenAuth endpoint</li>
<li>PUT improvements</li>
</ul>
<h3 id="v444">v4.4.4</h3>
<p>[Improved]</p>
<ul>
<li>New configuration: <strong>scim.skipMetaLocation</strong><br>
true or false, default false. If set to true, <code>meta.location</code> which contains protocol and hostname from request-url, will be excluded from response e.g. <code>&quot;{...,meta&quot;:{&quot;location&quot;:&quot;https://my-company.com/&lt;...&gt;&quot;}}</code>. If using reverse proxy and not including headers <code>X-Forwarded-Proto</code> and <code>X-Forwarded-Host</code>, originator will be the proxy and we might not want to expose internal protocol and hostname being used by the proxy request.</li>
</ul>
<p>Below is an example of nginx reverse proxy configuration supporting SCIM Gateway ipAllowList and correct meta.location response:</p>
<pre><code>proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header X-Forwarded-Proto $scheme;
proxy_set_header X-Forwarded-Host $http_host;
</code></pre>
<h3 id="v443">v4.4.3</h3>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v442">v4.4.2</h3>
<p>[Improved]</p>
<ul>
<li>scim-stream subscriber configuration have been changed:<br>
old: <code>&quot;convertRolesToGroups&quot;: false</code><br>
new: <code>&quot;skipConvertRolesToGroups&quot;: false</code><br>
This means convert roles to groups is default behavior unless skipConvertRolesToGroups=true</li>
</ul>
<h3 id="v441">v4.4.1</h3>
<p>[Improved]</p>
<ul>
<li>scim-stream subscriber using latest api and some additional recovery logic<br>
Prerequisite: <a href="https://elshaug.xyz/docs/scim-stream">SCIM Stream</a> version &gt; v1.0.0</li>
</ul>
<p>[Fixed]</p>
<ul>
<li>plugin-loki was missing async await and could cause problems in some stress test use cases</li>
</ul>
<h3 id="v440">v4.4.0</h3>
<p>[Improved]</p>
<ul>
<li>SCIM Gateway now offers enhanced functionality with support for message subscription and automated provisioning using <a href="https://elshaug.xyz/docs/scim-stream">SCIM Stream</a></li>
<li>plugin-entra-id, plugin-scim and plugin-api having updated <code>REST endpoint helpers-template</code> to address and resolve endpoint throttling</li>
</ul>
<p>Note, module soap is not default included anymore. SOAP based plugins e.g., plugin-soap therefore needs <code>npm install soap</code> for including module in your package</p>
<h3 id="v430">v4.3.0</h3>
<p>[Improved]</p>
<ul>
<li>configuration <code>scimgateway.scim.port</code> can now be set to 0 or removed for deactivating listener</li>
<li>configuration <code>cimgateway.scim.usePutSoftSync</code> set to <code>true</code> now includes additional logic that do not change existing user attributes not included in PUT body content</li>
<li>createUser/createGroup no longer return id if id have not been returned by plugin or by getUser filtering on userName. Previously userName was returned as id when missing plugin logic.</li>
<li>plugin-ldap supporting simpel filtering</li>
<li>plugin-loki using baseEntity configuration for supporting multi loki endpoints</li>
<li>plugin-azure-ad renamed to plugin-entra-id</li>
<li>plugin-entra-id and plugin-scim now using an updated default REST helpers-template that gives more flexible endpoint authentication support like OAuth, Basic, Bearer, custom-headers, no-auth,...</li>
<li>Dependencies bump</li>
</ul>
<h3 id="v4217">v4.2.17</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-loki incorrect unique filtering</li>
</ul>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v4215">v4.2.15</h3>
<p>[Improved]</p>
<ul>
<li>
<p>Plugin can set error statusCode returned by scimgateway through error object key <code>err.name</code>. This can be done by adding suffix <code>#code</code> to <a href="http://err.name">err.name</a> where code is HTTP status code e.g., <code>err.name += '#401'</code>. This can be useful for auth.PassThrough and other scenarios like createUser where user already exist (409) and modifyUser where user does not exist (404)</p>
<p>This change replace statusCode logic introduced in v4.2.11</p>
</li>
</ul>
<h3 id="v4214">v4.2.14</h3>
<p>[Fixed]</p>
<ul>
<li>PUT now returning 404 instead of 500 when trying to update a user/group that does not exist</li>
</ul>
<h3 id="v4213">v4.2.13</h3>
<p>[Fixed]</p>
<ul>
<li><code>/ping</code> now excluded from info logs. If we want ping logging, use something else than lowercase e.g., <code>/Ping</code> or <code>/PING</code></li>
</ul>
<h3 id="v4212">v4.2.12</h3>
<p>[Improved]</p>
<ul>
<li>Schemas, ServiceProviderConfig and ResourceType can be customized if <code>lib/scimdef-v2.js (or scimdef-v1.js)</code> exists. Original scimdef-v2.js/scimdef-v1.js can be copied from node_modules/scimgateway/lib to your plugin/lib and customized.</li>
</ul>
<h3 id="v4211">v4.2.11</h3>
<p>[Improved]</p>
<p>Note, obsolete - see v4.2.15 comments</p>
<ul>
<li>Plugin can set error statusCode returned by scimgateway through error message. Error message must then contain string <code>&quot;statusCode&quot;:xxx</code> where xxx is HTTP status code e.g., 401. Plugin using REST will have statusCode automatically included in error message thrown by plugin. This could be useful for auth.PassThrough.</li>
</ul>
<h3 id="v4210">v4.2.10</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-ldap broken after dependencies bump of ldapjs (from 2.x.x to 3.x.x) in version 4.2.7</li>
</ul>
<h3 id="v429">v4.2.9</h3>
<p>[Fixed]</p>
<ul>
<li>installation require nodejs &gt;= v.16.0.0 due to previous dependencies bump</li>
</ul>
<h3 id="v428">v4.2.8</h3>
<p>[Fixed]</p>
<ul>
<li>PUT did not allow group name to be modified</li>
</ul>
<h3 id="v427">v4.2.7</h3>
<p>[Improved]</p>
<ul>
<li>new plugin configuration <strong>scim.usePutGroupMemberOfUser</strong> can be set to true or false, default false. <code>PUT /Users/&lt;user&gt;</code> will replace user with body content. If body contains groups and usePutGroupMemberOfUser=true, groups will be set on user object (groups are member of user) instead of default user member of groups</li>
<li>plugin-forwardinc renamed to plugin-soap</li>
<li>Dependencies bump</li>
</ul>
<p>[Fixed]</p>
<ul>
<li>plugin-azure-ad fixed some issues introduced in v4.2.4</li>
<li>plugin-mongodb fixed some issues introduced in v4.2.4</li>
</ul>
<h3 id="v426">v4.2.6</h3>
<p>[Fixed]</p>
<ul>
<li>cosmetics related to 401 error handling introduced in v4.2.4</li>
</ul>
<h3 id="v425">v4.2.5</h3>
<p>[Fixed]</p>
<ul>
<li>travis test build cosmetics</li>
</ul>
<h3 id="v424">v4.2.4</h3>
<p>[Improved]</p>
<ul>
<li>provided plugins now supports Auth PassThrough. See helpers methods like getClientIdentifier(), getCtxAuth() and changes in doRequest() and getServiceClient(). In general, PassThrough is supported for both basic and bearer auth. Password/secret/client_secret are then not needed in configuration file. Username may still be needed in configuration file depended on how logic is implemented (ref. mongodb/mssql) and what auth beeing used (basic/bearer). Plugin scim, api and azure-ad are all REST plugins having the same helpers (but, some minor differences to azure-ad using OAuth and the getAccessToken() method)</li>
</ul>
<h3 id="v423">v4.2.3</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-loki and plugin-mongodb, for multi-value attributes like emails,phoneNumbers,... that includes primary attribute, only one is allowed having primary value set to true in the multi-value set.</li>
</ul>
<h3 id="v422">v4.2.2</h3>
<p>[Fixed]</p>
<ul>
<li>some minor SCIM protocol complient adjustments for beeing fully SCIM API complient with <a href="https://scimvalidator.microsoft.com">https://scimvalidator.microsoft.com</a></li>
</ul>
<h3 id="v421">v4.2.1</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-azure-ad createUser failed when manager was included</li>
<li>plugin-ldap slow when not using group/groupBase configuration</li>
</ul>
<h3 id="v420">v4.2.0</h3>
<p>[Improved]</p>
<ul>
<li>
<p>Kubernetes health checks and shutdown handler support</p>
<p>Plugin configuration prerequisite: <strong>kubernetes.enabled=true</strong></p>
<pre><code>  &quot;kubernetes&quot;: {
    &quot;enabled&quot;: true,
    &quot;shutdownTimeout&quot;: 15000,
    &quot;forceExitTimeout&quot;: 1000
  }
</code></pre>
<p><strong>Thanks to <a href="https://github.com/osbornk">@Kevin Osborn</a></strong></p>
</li>
</ul>
<h3 id="v4115">v4.1.15</h3>
<p>[Improved]</p>
<ul>
<li>
<p>Authentication PassThrough for passing the authentication directly to plugin without being processed by scimgateway. Plugin can then pass this authentication to endpoint for avoid maintaining secrets at the gateway.</p>
<p>Plugin configuration prerequisites: <strong>auth.passThrough.enabled=true</strong></p>
<pre><code>  &quot;auth&quot;: {
     ...
     &quot;passThrough&quot;: {
       &quot;enabled&quot;: true,
       &quot;readOnly&quot;: false,
       &quot;baseEntities&quot;: []
     }
     ...
   }
</code></pre>
<p>Plugin binary prerequisites:</p>
<pre><code>  scimgateway.authPassThroughAllowed = true
  // also need endpoint logic for handling/passing ctx.request.header.authorization
</code></pre>
<p>For upgrading existing custom plugins, above mention prerequisites needs to be included and in addition all plugin methods must include the <code>ctx</code> parameter e.g.:</p>
<pre><code>  scimgateway.getUsers = async (baseEntity, getObj, attributes, ctx)
  // tip, see provided example plugins
</code></pre>
<p><strong>Thanks to <a href="https://github.com/osbornk">@Kevin Osborn</a></strong></p>
</li>
</ul>
<h3 id="v4114">v4.1.14</h3>
<p>[Fixed]</p>
<ul>
<li>Do not create logs directory or log-file when configuration <code>log.loglevel.file</code> not defined or set to <code>&quot;off&quot;</code>. This fix will allow SCIM Gateway to run on systems having read-only disk like Google Cloud App Engine Standard</li>
</ul>
<h3 id="v4112">v4.1.12</h3>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v4111">v4.1.11</h3>
<p>[Fixed]</p>
<ul>
<li>basic auth logon dialog should not show up when not configured</li>
</ul>
<h3 id="v4110">v4.1.10</h3>
<p>[Improved]</p>
<ul>
<li>new plugin configuration <code>payloadSize</code>. If not defined, default &quot;1mb&quot; will be used. There are cases which large groups could exceed default size and you may want to increase by setting your own size e.g. &quot;5mb&quot;<br>
<strong>Thanks to <a href="https://github.com/SamMurphyDev">@Sam Murphy*</a></strong></li>
</ul>
<p>[Fixed]</p>
<ul>
<li>using <code>GET /Users</code>, scimgateway automatically adds groups if not included by plugin. This operation calls plugin getGroups having attributes=['members.value', 'id', 'displayName']. Now, <code>members.value</code> is excluded. This attribute was in use and could cause unneeded load when having many group members.</li>
</ul>
<h3 id="v419">v4.1.9</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-azure-ad.json configuration file introduced in v.4.1.7 was missing passwordProfile attribute mappings</li>
<li>Symantec/Broadcom/CA ConnectorXpress configuration file <code>config\resources\Azure - ScimGateway.xml</code> now using standard text on manager attribute instead of selection dialogbox.</li>
</ul>
<h3 id="v418">v4.1.8</h3>
<p>[Fixed]</p>
<ul>
<li>endpointMap and Symantec/Broadcom/CA ConnectorXpress configuration file <code>config\resources\Azure - ScimGateway.xml</code> introduced in v.4.1.7 had some missing logic</li>
</ul>
<h3 id="v417">v4.1.7</h3>
<p><strong>Note, this version breaks compability with previous versions of plugin-azure-ad</strong></p>
<p>[Improved]</p>
<ul>
<li>endpointMap moved from scimgateway to plugin-azure-ad</li>
<li>plugin-azure-ad.json configuration file now includes attribute mapping giving flexibility to add or customize AAD-SCIM attribute mappings</li>
<li>Symantec/Broadcom/CA ConnectorXpress configuration file <code>config\resources\Azure - ScimGateway.xml</code> for defining the Azure endpoint, have been updated with some new attributes according to plugin-azure-ad.json attribute mappings</li>
</ul>
<h3 id="v416">v4.1.6</h3>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v415">v4.1.5</h3>
<p>[Improved]</p>
<p>SCIM Gateway related news:</p>
<ul>
<li><a href="https://elshaug.xyz/docs/scim-stream">SCIM Stream</a> is the modern way of user provisioning letting clients subscribe to messages instead of traditional IGA top-down provisioning. SCIM Stream includes <strong>SCIM Stream Gateway</strong>, the next generation SCIM Gateway that supports message subscription and automated provisioning</li>
</ul>
<h3 id="v414">v4.1.4</h3>
<p>[Fixed]</p>
<ul>
<li>TypeConvert logic for multivalue attribute <code>addresses</code> did not correctly catch duplicate entries</li>
<li>PUT (Replace User) configuration <code>scim.usePutSoftsync=true</code> will also prevent removing any existing roles that are not included in body.roles ref. v4.1.3</li>
</ul>
<h3 id="v413">v4.1.3</h3>
<p>[Fixed]</p>
<ul>
<li>createUser response did not include the id that was returned by plugin</li>
</ul>
<p>[Improved]</p>
<ul>
<li>
<p>PUT (Replace User) now includes group handling. Using configuration <code>scim.usePutSoftsync=true</code> will prevent removing any existing groups that are not included in body.groups</p>
<p>Example:</p>
<pre><code>  PUT /Users/bjensen
  {
    ...
    &quot;groups&quot;: [
      {&quot;value&quot;:&quot;Employees&quot;,&quot;display&quot;:&quot;Employees&quot;},
      {&quot;value&quot;:&quot;Admins&quot;,&quot;display&quot;:&quot;Admins&quot;}
     ],
    ...
  }
</code></pre>
</li>
</ul>
<h3 id="v412">v4.1.2</h3>
<p>[Improved]</p>
<ul>
<li>
<p>endpointMapper supporting one to many mappings using a comma separated list of attributes in the <code>mapTo</code></p>
<p>Configuration example:</p>
<pre><code>  &quot;map&quot;: {
    &quot;user&quot;: {
      &quot;PersonnelNumber&quot;: {
        &quot;mapTo&quot;: &quot;id,userName&quot;,
        &quot;type&quot;: &quot;string&quot;
      },
      ...
    }
  }
</code></pre>
</li>
</ul>
<h3 id="v411">v4.1.1</h3>
<p>[Improved]</p>
<ul>
<li>
<p>plugin-ldap support userFilter/groupFilter configuration for restricting scope</p>
<p>Configuration example:</p>
<pre><code>  {
    ...
    &quot;userFilter&quot;: &quot;(memberOf=CN=grp1,OU=Groups,DC=test,DC=com)(!(memberOf=CN=Domain Admins,CN=Users,DC=test,DC=com))&quot;,
    &quot;groupFilter&quot;: &quot;(!(cn=grp2))&quot;,
    ...
  }
</code></pre>
</li>
</ul>
<h3 id="v410">v4.1.0</h3>
<p>[Improved]</p>
<ul>
<li>
<p>Supporting OAuth Client Credentials authentication</p>
<p>Configuration example:</p>
<pre><code>  &quot;bearerOAuth&quot;: [
    {
      &quot;client_id&quot;: &quot;my_client_id&quot;,
      &quot;client_secret&quot;: &quot;my_client_secret&quot;,
      &quot;readOnly&quot;: false,
      &quot;baseEntities&quot;: []
    }
  ]
</code></pre>
<p>In example above, client using SCIM Gateway must have OAuth configuration:</p>
<pre><code>  client_id = my_client_id
  client_secret = my_client_secret
  token request url = http(s)://&lt;host&gt;:&lt;port&gt;/oauth/token
</code></pre>
</li>
</ul>
<h3 id="v401">v4.0.1</h3>
<p>[Improved]</p>
<ul>
<li>
<p>create user/group supporting externalId</p>
</li>
<li>
<p>plugin-restful renamed to plugin-scim</p>
</li>
<li>
<p>plugin-ldap having improved SID/GUID support for Active Directory, also supporting domain map of userPrincipalName e.g. Azure AD =&gt; Active Directory</p>
<pre><code>  &quot;userPrincipalName&quot;: {
     &quot;mapTo&quot;: &quot;userName&quot;,
     &quot;type&quot;: &quot;string&quot;,
     &quot;mapDomain&quot;: {
       &quot;inbound&quot;: &quot;test.onmicrosoft.com&quot;,
       &quot;outbound&quot;: &quot;my-company.com&quot;
  }
</code></pre>
</li>
<li>
<p>postinstall copying example plugins may be skipped by setting the property <code>scimgateway_postinstall_skip = true</code> in <code>.npmrc</code> or by setting environment <code>SCIMGATEWAY_POSTINSTALL_SKIP = true</code></p>
</li>
<li>
<p>Secrets now also support key-value storage. The key defined in plugin configuration have syntax <code>process.text.&lt;path&gt;</code> where <code>&lt;path&gt;</code> is the file which contains raw (UTF-8) character value. E.g. configuration <code>endpoint.password</code> could have value <code>process.text./var/run/vault/endpoint.password</code>, and the corresponding file contains the secret. <strong>Thanks to <a href="https://github.com/rotty3000">@Raymond Augé</a></strong></p>
</li>
</ul>
<h3 id="v400">v4.0.0</h3>
<p><strong>[MAJOR]</strong></p>
<ul>
<li>New <code>getUsers()</code> replacing deprecated exploreUsers(), getUser() and getGroupUsers()</li>
<li>New <code>getGroups()</code> replacing deprecated exploreGroups(), getGroup() and getGroupMembers()</li>
<li>Fully filter and sort support</li>
<li>Authentication configuration may now include a baseEntities array containing one or more <code>baseEntity</code> allowed for corresponding admin user</li>
<li>New plugin-mongodb, <strong>Thanks to <a href="https://github.com/fribeiro-keeps">@Filipe Ribeiro</a> and <a href="https://github.com/jmaferreira">@Miguel Ferreira</a> (KEEP SOLUTIONS)</strong></li>
</ul>
<p>Note, using this major version <strong>require existing custom plugins to be upgraded</strong>. If you do not want to upgrade your custom plugins, the old version have to be installed using: <code>npm install scimgateway@3.2.11</code></p>
<p>How to upgrade your custom plugins:</p>
<pre><code>Replace: scimgateway.exploreUsers = async (baseEntity, attributes, startIndex, count) =&gt; {
With: scimgateway.getUsers = async (baseEntity, getObj, attributes) =&gt; {
</code></pre>
<p>See comments in provided plugins regarding the new <code>getObj</code>. Also note that <code>attributes</code> is now an array and not a comma separated string like previous versions</p>
<p>In the very beginning, add:</p>
<pre><code>  // mandatory if-else logic - start
  if (getObj.operator) {
    if (getObj.operator === 'eq' &amp;&amp; ['id', 'userName', 'externalId'].includes(getObj.attribute)) {
      // mandatory - unique filtering - single unique user to be returned - correspond to getUser() in versions &lt; 4.x.x
    } else if (getObj.operator === 'eq' &amp;&amp; getObj.attribute === 'group.value') {
      // optional - only used when groups are member of users, not default behavior - correspond to getGroupUsers() in versions &lt; 4.x.x
      throw new Error(`${action} error: not supporting groups member of user filtering: ${getObj.rawFilter}`)
    } else {
      // optional - simpel filtering
      throw new Error(`${action} error: not supporting simpel filtering: ${getObj.rawFilter}`)
    }
  } else if (getObj.rawFilter) {
    // optional - advanced filtering having and/or/not - use getObj.rawFilter
    throw new Error(`${action} error: not supporting advanced filtering: ${getObj.rawFilter}`)
  } else {
    // mandatory - no filtering (!getObj.operator &amp;&amp; !getObj.rawFilter) - all users to be returned - correspond to exploreUsers() in versions &lt; 4.x.x
  }
  // mandatory if-else logic - end
</code></pre>
<p>In the new getUsers() replacing exploreUsers() &quot;as-is&quot;, we then need some logic in the last &quot;else&quot; statement listed above.<br>
We also need to add logic from existing getGroup() and getGroupMembers()<br>
<strong>Please have a look at provieded plugins to see different ways of doing this logic.</strong></p>
<pre><code>Replace: scimgateway.exploreGroups = async (baseEntity, attributes, startIndex, count) =&gt; {
With: scimgateway.getGroups = async (baseEntity, getObj, attributes) =&gt; {
</code></pre>
<p>In the very beginning, add:</p>
<pre><code>  // mandatory if-else logic - start
  if (getObj.operator) {
    if (getObj.operator === 'eq' &amp;&amp; ['id', 'displayName', 'externalId'].includes(getObj.attribute)) {
      // mandatory - unique filtering - single unique user to be returned - correspond to getUser() in versions &lt; 4.x.x
    } else if (getObj.operator === 'eq' &amp;&amp; getObj.attribute === 'members.value') {
      // mandatory - return all groups the user 'id' (getObj.value) is member of - correspond to getGroupMembers() in versions &lt; 4.x.x
      // Resources = [{ id: &lt;id-group&gt;&gt; , displayName: &lt;displayName-group&gt;, members [{value: &lt;id-user&gt;}] }]
    } else {
      // optional - simpel filtering
      throw new Error(`${action} error: not supporting simpel filtering: ${getObj.rawFilter}`)
    }
  } else if (getObj.rawFilter) {
    // optional - advanced filtering having and/or/not - use getObj.rawFilter
    throw new Error(`${action} error: not supporting advanced filtering: ${getObj.rawFilter}`)
  } else {
    // mandatory - no filtering (!getObj.operator &amp;&amp; !getObj.rawFilter) - all groups to be returned - correspond to exploreGroups() in versions &lt; 4.x.x
  }
  // mandatory if-else logic - end
</code></pre>
<p>In the new getGroups() replacing exploreGroups() &quot;as-is&quot;, we then need some logic in the last &quot;else&quot; statement listed above.<br>
We also need to add logic from existing getGroup() and getGroupMembers()<br>
<strong>Please have a look at provieded plugins to see different ways of doing this logic.</strong></p>
<pre><code>Delete deprecated exploreUsers(), getUser(), getGroupUsers(), exploreGroups(), getGroup() and getGroupMembers()
</code></pre>
<h3 id="v3211">v3.2.11</h3>
<p>[Fixed]</p>
<ul>
<li>errorhandling related to running scimgateway as unikernel</li>
</ul>
<h3 id="v3210">v3.2.10</h3>
<p>[Fixed]</p>
<ul>
<li>for SCIM 2.0 exploreUsers/exploreGroups now includes schemas/resourceType on each object in the Resources response. This may be required by som IdP's.</li>
</ul>
<p>[Improved]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v329">v3.2.9</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-loki pagination fix</li>
</ul>
<h3 id="v328">v3.2.8</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-ldap <code>objectGUID</code> introduced in v.3.2.7 had some missing logic</li>
</ul>
<h3 id="v327">v3.2.7</h3>
<p>[Improved]</p>
<ul>
<li>
<p>plugin-ldap supports using Active Directory <code>objectGUID</code> instead of <code>dn</code> mapped to <code>id</code><br>
configuration example:</p>
<pre><code>  &quot;objectGUID&quot;: {
    &quot;mapTo&quot;: &quot;id&quot;,
    &quot;type&quot;: &quot;string&quot;
  }
</code></pre>
</li>
</ul>
<p>[Fixed]</p>
<ul>
<li>Return 500 on GET handler error instead of 404<br>
<strong>Thanks to <a href="https://github.com/nipund">@Nipun Dayanath</a></strong></li>
<li>createUser/createRole response now includes id retrieved by getUser/getRole instead of using posted userName/displayName value</li>
</ul>
<h3 id="v326">v3.2.6</h3>
<p>[Fixed]</p>
<ul>
<li>bearerJwt authentication missing public key handling</li>
<li>plugin-azure-ad getGroup did not return all members when group had more than 100 members (Azure page size is 100). getGroup now using paging</li>
</ul>
<h3 id="v325">v3.2.5</h3>
<p>[Fixed]</p>
<ul>
<li>default &quot;type converted object&quot; logic may fail on requests that includes a mix of type and blank type. Now blank type will be converted to type &quot;undefined&quot;, and all types must be unique within the same request. &quot;type converted object&quot; logic can be turned off by configuration <code>scim.skipTypeConvert = true</code></li>
<li>plugin-loki supporting type = &quot;undefined&quot;</li>
</ul>
<p>[Improved]</p>
<ul>
<li>
<p>new configuration <code>scim.skipTypeConvert</code> allowing overriding the default behaviour &quot;type converted object&quot; when set to true. See attribute list for details</p>
</li>
<li>
<p><code>scimgateway.isMultivalue</code> used by plugin-loki have been changed, and <strong>custom plugins using this method must be updated</strong></p>
<pre><code>  old syntax:
  scimgateway.isMultivalue('User', key)

  new syntax:
  scimgateway.isMultiValueTypes(key) 
</code></pre>
</li>
</ul>
<h3 id="v324">v3.2.4</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-loki some code cleanup</li>
</ul>
<h3 id="v323">v3.2.3</h3>
<p>[Fixed]</p>
<ul>
<li>PUT was not according to the SCIM specification</li>
<li>plugin-mssql broken after dependencies bump v3.1.0</li>
<li>plugin-loki getUser using <code>find</code> instead of <code>findOne</code> to ensure returning unique user</li>
</ul>
<h3 id="v322">v3.2.2</h3>
<p>[Fixed]</p>
<ul>
<li>plugins missing logic for handling the virtual readOnly user attribute <code>groups</code> (when <code>&quot;user member of groups&quot;</code>) e.g. GET /Users/bjensen should return all user attributes including the virtual <code>groups</code> attribute. Now this user attribute will be automatically handled by scimgateway if not included in the plugin response.</li>
<li>Pre and post actions onAddGroups/onRemoveGroups introduced in v.3.2.0 has been withdrawn</li>
</ul>
<p>[Improved]</p>
<ul>
<li>scimgateway will do plugin response filtering according to requested attributes/excludedAttributes</li>
</ul>
<h3 id="v321">v3.2.1</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-azure-ad updating businessPhones (Office phone) broken after v3.2.0</li>
<li>plugin-azure-ad listing groups for user did also include Azure roles</li>
<li>SCIM v2.0 none core schema attributes handling</li>
<li>response not always including correct schemas</li>
</ul>
<p>[Improved]</p>
<ul>
<li>roles now using array instead of objects based on type. <strong>Note, this may break your custom plugins if roles logic are in use</strong></li>
</ul>
<h3 id="v320">v3.2.0</h3>
<p>[Improved]</p>
<ul>
<li>
<p>ipAllowList for restricting access to allowlisted IP addresses or subnets e.g. Azure AD IP-range<br>
Configuration example:</p>
<pre><code>  &quot;ipAllowList&quot;: [
    &quot;13.66.60.119/32&quot;,
    &quot;13.66.143.220/30&quot;,
    ...
    &quot;2603:1056:2000::/48&quot;,
    &quot;2603:1057:2::/48&quot;
  ]
</code></pre>
</li>
<li>
<p>Example plugins now configured for SCIM v2.0 instead of v1.1</p>
<p>New configuration:</p>
<pre><code>  &quot;scim&quot;: {
      &quot;version&quot;: &quot;2.0&quot;
  }
</code></pre>
<p>Old configuration:</p>
<pre><code>  &quot;scim&quot;: {
      &quot;version&quot;: &quot;1.1&quot;
  }
</code></pre>
</li>
</ul>
<h3 id="v310">v3.1.0</h3>
<p>[Improved]</p>
<ul>
<li>plugin-ldap a general LDAP plugin pre-configured for Microsoft Active Directory. Using endpointMapper logic (like plugin-azure-ad) for attribute flexibility</li>
<li>Pre and post actions onAddGroups/onRemoveGroups can be configured and needed logic to be  defined in plugin method <code>pre_post_Action</code></li>
<li>Dependencies bump</li>
</ul>
<h3 id="v308">v3.0.8</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-azure-ad delete account fails in v3.x</li>
</ul>
<h3 id="v307">v3.0.7</h3>
<p>[Fixed]</p>
<ul>
<li>Using proxy configuration broken in v3.x</li>
</ul>
<h3 id="v306">v3.0.6</h3>
<p>[Fixed]</p>
<ul>
<li>Dependencies bump</li>
</ul>
<h3 id="v304">v3.0.4</h3>
<p>[Improved]</p>
<ul>
<li>Pagination request having startIndex but no count, now sets count to default 200 and may be overridden by plugin.</li>
</ul>
<h3 id="v303">v3.0.3</h3>
<p>[Fixed]</p>
<ul>
<li>GET /Users?startIndex=1&amp;count=100 with no attributes filter included did not work</li>
</ul>
<h3 id="v302">v3.0.2</h3>
<p>[Fixed]</p>
<ul>
<li>SCIM v2.0 PUT did not work.</li>
</ul>
<h3 id="v301">v3.0.1</h3>
<p>[Improved]</p>
<ul>
<li>
<p>getApi supports body (apiObj).</p>
<p>Old syntax:</p>
<pre><code>  scimgateway.getApi = async (baseEntity, id, apiQuery) =&gt; {
</code></pre>
<p>New syntax:</p>
<pre><code>  scimgateway.getApi = async (baseEntity, id, apiQuery, apiObj) =&gt; {
</code></pre>
</li>
</ul>
<h3 id="v300">v3.0.0</h3>
<p><strong>[MAJOR]</strong></p>
<ul>
<li>getUser/getGroup now using parameter getObj giving more flexibility</li>
<li>deprecated modifyGroupMembers - now using modifyGroup</li>
<li>deprecated configuration <code>scimgateway.scim.customUniqueAttrMapping</code> - replaced by getObj logic</li>
<li>loglevel=off turns of logging</li>
<li>Auth methods allowing more than one user/object including option for readOnly</li>
<li>Includes latest versions of module dependencies</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<p>Note, this is a major upgrade (^2.x.x =&gt; ^3.x.x) that will brake compatibility with any existing custom plugins. To force a major upgrade, suffix <code>@latest</code> must be include in the npm install command, but it's recommended to do a fresh install and copy any custom plugins instead of upgrading an existing package</p>
<p>Old syntax:</p>
<pre><code>scimgateway.getUser = async (baseEntity, userName, attributes) =&gt; {
scimgateway.getGroup = async (baseEntity, displayName, attributes) =&gt; {
scimgateway.modifyGroupMembers = async (baseEntity, id, members) =&gt; {
</code></pre>
<p>New syntax:</p>
<pre><code>scimgateway.getUser = async (baseEntity, getObj, attributes) =&gt; {
  const userName = getObj.identifier // gives v2.x compatibility

scimgateway.getGroup = async (baseEntity, getObj, attributes) =&gt; {
  const displayName = getObj.identifier // gives v2.x compatibility

scimgateway.modifyGroup = async (baseEntity, id, attrObj) =&gt; {
  // attrObj.members corresponds to members in deprecated modifyGroupMembers
</code></pre>
<p>getUser comments:<br>
getObj = <code>{ filter: &lt;filterAttribute&gt;, identifier: &lt;identifier&gt; }</code><br>
e.g: getObj = <code>{ filter: 'userName', identifier: 'bjensen'}</code><br>
filter: userName and id must be supported</p>
<p>getGroup comments:<br>
getObj = <code>{ filter: &lt;filterAttribute&gt;, identifier: &lt;identifier&gt; }</code><br>
e.g: getObj = <code>{ filter: 'displayName', identifier: 'GroupA' }</code><br>
filter: displayName and id must be supported</p>
<p><strong>Please see provided example plugins</strong></p>
<p>Using the new getObj parameter gives more flexibility in the way of lookup a user e.g:<br>
<code>http://localhost:8880/Users?filter=emails.value eq &quot;jsmith@example.com&quot;&amp;attributes=userName,name.givenName</code><br>
getObj = <code>{ filter: 'emails.value', identifier: 'jsmith@example.com'}</code><br>
attributes = <code>'userName,name.givenName'</code></p>
<p>Configuration file, auth settings have changed and now using arrays allowing more than one user/object to be set. <code>&quot;readOnly&quot;: true</code> can also be set for allowing read only access for a spesific user (does not apply to bearerJwtAzure).</p>
<p>New syntax is:</p>
<pre><code>&quot;auth&quot;: {
  &quot;basic&quot;: [
    {
      &quot;username&quot;: &quot;gwadmin&quot;,
      &quot;password&quot;: &quot;password&quot;,
      &quot;readOnly&quot;: false
    }
  ],
  &quot;bearerToken&quot;: [
    {
      &quot;token&quot;: null,
      &quot;readOnly&quot;: false
    }
  ],
  &quot;bearerJwtAzure&quot;: [
    {
      &quot;tenantIdGUID&quot;: null
    }
  ],
  &quot;bearerJwt&quot;: [
    {
      &quot;secret&quot;: null,
      &quot;publicKey&quot;: null,
      &quot;options&quot;: {
        &quot;issuer&quot;: null
      },
      &quot;readOnly&quot;: false
    }
  ]
}
</code></pre>
<h3 id="v2113">v2.1.13</h3>
<p>[Fixed]</p>
<ul>
<li>Plugin configuration referring to an external configuration file using an array did not work.</li>
</ul>
<h3 id="v2111">v2.1.11</h3>
<p>[Fixed]</p>
<ul>
<li>Log masking of xml (SOAP) messages.</li>
</ul>
<h3 id="v2110">v2.1.10</h3>
<p>[Improved]</p>
<ul>
<li>
<p>Log masking of custom defined attributes.<br>
customMasking may include an array of attributes to be masked<br>
e.g. <code>&quot;customMasking&quot;: [&quot;SSN&quot;, &quot;weight&quot;]</code></p>
</li>
<li>
<p>Note, configurationfiles must be changed (old syntax still supported)<br>
old syntax:</p>
<pre><code>  &quot;loglevel&quot;: {
    &quot;file&quot;: &quot;debug&quot;,
    &quot;console&quot;: &quot;error&quot;
  },
</code></pre>
<p>new syntax:</p>
<pre><code>  &quot;log&quot;: {
    &quot;loglevel&quot;: {
      &quot;file&quot;: &quot;debug&quot;,
      &quot;console&quot;: &quot;error&quot;
    },
    &quot;customMasking&quot;: []
  },
</code></pre>
<p>By default SCIM Gateway includes masking of standard attributes like password</p>
</li>
</ul>
<h3 id="v219">v2.1.9</h3>
<p>[Fixed]</p>
<ul>
<li>AAD as IdP broken after content-type validation introduced in v2.1.7</li>
<li>AAD as IdP, none gallery app support</li>
<li>Incorrect SCIM 2.0 multivalue converting</li>
<li>plugin-saphana not correctly ported to v2.x</li>
</ul>
<p><strong>Thanks to Luca Moretto</strong></p>
<h3 id="v218">v2.1.8</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-mssql not correctly ported to v2.x, and some config syntax for this plugin have also changed in newer releases of dependencies.</li>
</ul>
<h3 id="v217">v2.1.7</h3>
<p>[Fixed]</p>
<ul>
<li>Validates content-type when body is included</li>
<li>Case insensitive log-masking</li>
<li>Plugins now don't using deprecated <code>url.parse</code></li>
<li>Misc cosmetics e.g. using const instead of let when not reassigned</li>
</ul>
<h3 id="v216">v2.1.6</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-azure-ad did not return correct error code (<code>err.name = 'DuplicateKeyError'</code>) when failing on creating a duplicate user</li>
</ul>
<p>[Improved]</p>
<ul>
<li>Includes latest versions of module dependencies</li>
</ul>
<h3 id="v214">v2.1.4</h3>
<p>[Fixed]</p>
<ul>
<li>Incorrect SCIM 2.0 error handling after v2.1.0</li>
<li>For duplicate key error, setting <code>err.name = 'DuplicateKeyError'</code> now gives correct status code 409 instead of defult 500 (see plugin-loki.js)</li>
</ul>
<h3 id="v213">v2.1.3</h3>
<p>[Fixed]</p>
<ul>
<li>Standardized the API Gateway response (not SCIM related)</li>
<li>Not allowing plugins to return password</li>
<li>Colorize option now automatically turned off when using stdout/stderr redirect (configuration file <code>loglevel.colorize</code> is not needed)</li>
</ul>
<h3 id="v212">v2.1.2</h3>
<p>[Fixed]</p>
<ul>
<li>SCIM 2.0 may use Operations.value as array and none array (issue #16)</li>
</ul>
<p>[Improved]</p>
<ul>
<li>Option for replacing mandatory userName/displayName attribute by configuring customUniqueAttrMapping</li>
<li>Includes latest versions of module dependencies</li>
</ul>
<h3 id="v211">v2.1.1</h3>
<p>[Fixed]</p>
<ul>
<li>SCIM 2.0 may use Operations.value or Operation.value[] for PATCH syntax of the name object (issue #14)</li>
<li>plugin-loki failed to modify a none existing object, e.g name object not included in Create User</li>
</ul>
<h3 id="v210">v2.1.0</h3>
<p>[Improved]</p>
<ul>
<li>Custom schema attributes can be added by plugin configuration <code>scim.customSchema</code> having value set to filename of a JSON schema-file located in <code>&lt;package-root&gt;/config/schemas</code></li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>
<p>Configurationfiles for custom plugins should be changed<br>
old syntax:</p>
<pre><code>  &quot;scimversion&quot;: &quot;1.1&quot;,  
</code></pre>
<p>new syntax:</p>
<pre><code>  &quot;scim&quot;: {
    &quot;version&quot;: &quot;1.1&quot;,
    &quot;customSchema&quot;: null
  },
</code></pre>
</li>
</ul>
<p>Note, &quot;1.1&quot; is default, if using &quot;2.0&quot; the new syntax must be used.</p>
<h3 id="v202">v2.0.2</h3>
<p>[Fixed]</p>
<ul>
<li>SCIM 2.0 incorrect response for user not found</li>
<li>Did not mask logentries ending with newline</li>
</ul>
<h3 id="v200">v2.0.0</h3>
<p><strong>[MAJOR]</strong></p>
<ul>
<li>Codebase moved from callback to async/await</li>
<li>Koa replacing Express</li>
<li>Some log enhancements</li>
<li>Deprecated cipher methods have been replaced</li>
<li>Plugin restful (REST) and</li>
<li>forwardinc (SOAP) includes failover logic based on endpoints defined in array baseUrls/baseServiceEndpoints.</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<p>Note, this is a major upgrade (^1.x.x =&gt; ^2.x.x) and will brake compatibility with any existing custom plugins. To force a major upgrade, suffix <code>@latest</code> must be include in the npm install command, but it's recommended to do a fresh install and copy any custom plugins instead of upgrading an existing package</p>
<pre><code>cd c:\my-scimgateway
npm install scimgateway@latest
</code></pre>
<p>Custom plugins needs some changes (please see included example plugins)</p>
<ul>
<li><code>scimgateway.on(xxx, function (..., callback)</code> replaced with <code>scimgateway.xxx = async (...)</code> returning a result or throwing an error</li>
<li>Rest and SOAP using <code>doRequest</code> method having endpoint failover logic through array <code>baseUrls/baseServiceEndpoints</code> defined in corresponding plugin configuration file.</li>
<li>Additional argument <code>attributes</code> included in exploreUsers and exploreGroups method</li>
<li>Proxy configuration includes option for user/password</li>
<li>Encrypted passwords in configuration files needs to be reset to clear text passwords</li>
</ul>
<h3 id="v1020">v1.0.20</h3>
<p>[Fixed]</p>
<ul>
<li>HTTP status code 200 and totalResults set to value of 0 when using SCIM 2.0 filter user/group and no resulted user/group found. SCIM 1.1 still using  status code 404.</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>For custom plugins to be compliant with SCIM 2.0, the <code>getUser</code> and <code>getGroup</code> methods needs to be updated. If user/group not found then return <code>callback(null, null)</code> instead of callback(err)</li>
</ul>
<h3 id="v1019">v1.0.19</h3>
<p>[Fixed]</p>
<ul>
<li>Fix related to external configuration (ref. v1.0.18) when running multiple plugins</li>
</ul>
<h3 id="v1018">v1.0.18</h3>
<p>[Improved]</p>
<ul>
<li>Includes latest versions of module dependencies</li>
<li>Loglevel configuration for file and console now separated</li>
<li>Loglevel colorize option (value false could be useful when redirecting console output)</li>
<li>All configuration can be set based on environment variables</li>
<li>All configuration can be set based on correspondig json-content in external file (supports also dot notation)</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>
<p>Configurationfiles for custom plugins should be changed<br>
old syntax:</p>
<pre><code>  loglevel: &quot;debug&quot;
</code></pre>
<p>new syntax:</p>
<pre><code>  &quot;loglevel&quot;: {
    &quot;file&quot;: &quot;debug&quot;,
    &quot;console&quot;: &quot;error&quot;,
    &quot;colorize&quot;: true
  }
</code></pre>
</li>
</ul>
<h3 id="v1014">v1.0.14</h3>
<p>[Fixed]</p>
<ul>
<li>Some multiValued attributes not correctly handled (e.g. addresses)</li>
</ul>
<h3 id="v1013">v1.0.13</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-azure-ad: New version of &quot;Azure - ScimGateway.xml&quot; fixing CA IM RoleDefGenerator problem (related to creating and importing screens in CA IM)</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>Use CA ConnectorXpress, import &quot;Azure - ScimGateway.xml&quot; and deploy/redeploy endpoint</li>
</ul>
<h3 id="v1012">v1.0.12</h3>
<p>[Fixed]</p>
<ul>
<li>Incorrect logging of Express stream messages (type info) when running multiple plugins</li>
</ul>
<h3 id="v1011">v1.0.11</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-azure-ad: proxy configuration did not work</li>
</ul>
<h3 id="v1010">v1.0.10</h3>
<p>[Fixed]</p>
<ul>
<li>An issue with pagination fixed</li>
</ul>
<h3 id="v109">v1.0.9</h3>
<p>[Improved]</p>
<ul>
<li>Cosmetics, changed emailOnError logic - now emitted by logger</li>
</ul>
<h3 id="v108">v1.0.8</h3>
<p>[Improved]</p>
<ul>
<li>Support health monitoring using the &quot;/ping&quot; URL with a &quot;hello&quot; response, e.g. <a href="http://localhost:8880/ping">http://localhost:8880/ping</a>. Useful for frontend load balancing/failover functionality</li>
<li>Option for error notifications by email</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>Configuration files for custom plugins must include the <strong>emailOnError</strong> object for enabling error notifications by email. Please see the syntax in provided example plugins and details described in the &quot;Configuration&quot; section of this document.</li>
</ul>
<h3 id="v107">v1.0.7</h3>
<p>[Improved]</p>
<ul>
<li>Docker now using node v.9.10.0 instead of v.6.9.2</li>
<li>Minor log cosmetics</li>
</ul>
<h3 id="v106">v1.0.6</h3>
<p>[Fixed]</p>
<ul>
<li>Azure AD plugin, failed to create user when licenses (app Service plans) was included</li>
</ul>
<h3 id="v105">v1.0.5</h3>
<p>[Improved]</p>
<ul>
<li>Supporting GET /Users, GET /Groups, PUT method and delete groups</li>
<li>After more than 3 invalid auth attempts, response will be delayed to prevent brute force</li>
</ul>
<p>[Fixed]</p>
<ul>
<li>Some minor compliance fixes</li>
</ul>
<p><strong>Thanks to <a href="https://github.com/ywchuang">@ywchuang</a></strong></p>
<h3 id="v104">v1.0.4</h3>
<p>[Improved]</p>
<ul>
<li>Plugin for Azure AD now supports paging for retrieving users and groups. Any existing metafile used by CA ConnectorXpress (&quot;Azure - ScimGateway.xml&quot;) must be re-deployed.</li>
</ul>
<p>[Fixed]</p>
<ul>
<li>Don't use deprecated existsSync in postinstallation</li>
</ul>
<h3 id="v103">v1.0.3</h3>
<p>[Fixed]</p>
<ul>
<li>Undefined root url not handled correctly after v1.0.0</li>
</ul>
<h3 id="v102">v1.0.2</h3>
<p>[Fixed]</p>
<ul>
<li>License and group defined as capability attributes in metafile used by CA ConnectorXpress regarding plugin-azure-ad</li>
</ul>
<h3 id="v101">v1.0.1</h3>
<p>[Fixed]</p>
<ul>
<li>Mocha test script did not terminate after upgrading from 3.x to 4.x of Mocha</li>
</ul>
<h3 id="v100">v1.0.0</h3>
<p>[Improved]</p>
<ul>
<li>New plugin-azure-ad.js for Azure AD user provisioning including Azure license management e.g. Office 365</li>
<li>Includes latest versions of module dependencies</li>
<li>Module hdb (for SapHana) and saml is not included by default anymore and therefore have to be manually installed if needed.</li>
</ul>
<p><strong>[UPGRADE]</strong><br>
Method <code>getGroupMembers</code> must be updated for all custom plugins</p>
<p>Replace:</p>
<pre><code>scimgateway.on('getGroupMembers', function (baseEntity, id, attributes, startIndex, count, callback) {
...
let ret = {
'Resources' : [],
'totalResults' : null
}
...
ret.Resources.push(userGroup)
...
callback(null, ret)
</code></pre>
<p>With:</p>
<pre><code>scimgateway.on('getGroupMembers', function (baseEntity ,id ,attributes, callback) {
...
let arrRet = []
...
arrRet.push(userGroup)
...
callback(null, arrRet)
</code></pre>
<h3 id="v053">v0.5.3</h3>
<p>[Improved]</p>
<ul>
<li>Includes api gateway/plugin for general none provisioning
<ul>
<li>GET /api</li>
<li>GET /api?queries</li>
<li>GET /api/{id}</li>
<li>POST /api + body</li>
<li>PUT /api/{id} + body</li>
<li>PATCH /api/{id} + body</li>
<li>DELETE /api/{id}</li>
</ul>
</li>
<li>plugin-api.js demonstrates api functionallity (becomes what you want it to become)</li>
</ul>
<h3 id="v052">v0.5.2</h3>
<p>[Improved]</p>
<ul>
<li>One or more of following authentication/authorization methods are accepted:
<ul>
<li>Basic Authentication</li>
<li>Bearer token - shared secret</li>
<li>Bearer token - Standard JSON Web Token (JWT)</li>
<li>Bearer token - Azure JSON Web Token (JWT)</li>
</ul>
</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>Configuration files for custom plugins <code>config/plugin-xxx.json</code> needs to be updated regarding the new <code>scimgateway.auth</code> section:
<ul>
<li>Copy scimgateway.auth section from one of the example plugins</li>
<li>Copy existing scimgateway.username value to new auth.basic.username value</li>
<li>Copy existing scimgateway.password value to new auth.basic.username value</li>
<li>Copy existing scimgateway.oauth.accesstoken value to new auth.bearer.token value</li>
<li>Delete scimgateway.username</li>
<li>Delete scimgateway.password</li>
<li>Delete scimgateway.oauth</li>
</ul>
</li>
</ul>
<h3 id="v046">v0.4.6</h3>
<p>[Improved]</p>
<ul>
<li>Document updated on how to run SCIM Gateway as a Docker container</li>
<li><code>config\docker</code> includes docker configuration examples<br>
<strong>Thanks to <a href="https://github.com/cwatsonc">@cwatsonc</a> and <a href="https://github.com/visualjeff">@visualjeff</a></strong></li>
</ul>
<h3 id="v045">v0.4.5</h3>
<p>[Improved]</p>
<ul>
<li>Environment variable <code>SEED</code> overrides default password seeding</li>
<li>Setting SCIM Gateway port to <code>&quot;process.env.XXX&quot;</code> lets environment variable XXX define the port</li>
<li>Don't validate config-file port number for numeric value (Azure AD - iisnode using a name pipe for communication)</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>Configuration files for custom plugins <code>config/plugin-xxx.json</code> needs to be updated:
<ul>
<li>Encrypted passwords needs to be reset to clear text passwords</li>
<li>Start SCIM Gateway and passwords will become encrypted</li>
</ul>
</li>
</ul>
<h3 id="v044">v0.4.4</h3>
<p>[Improved]</p>
<ul>
<li>NoSQL Document-Oriented Database plugin: <code>plugin-loki</code><br>
This plugin now replace previous <code>plugin-testmode</code><br>
<strong>Thanks to <a href="https://github.com/visualjeff">@visualjeff</a></strong></li>
<li>Minor code/comment reorganizations in provided plugins</li>
<li>Minor adjustments to multi-value logic introduced in v0.4.0</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>Delete depricated <code>lib/plugin-testmode.js</code> and <code>config/plugin-testmode.json</code></li>
<li>Edit index.js, replace tesmode with loki</li>
</ul>
<h3 id="v042">v0.4.2</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-restful minor adjustments to multivalue and cleared attributes logic introduced in v0.4.0</li>
</ul>
<h3 id="v041">v0.4.1</h3>
<p>[Improved]</p>
<ul>
<li>Mocha test scripts for automated testing of plugin-testmode</li>
<li>Automated tests run on <a href="http://Travis-ci.org">Travis-ci.org</a> (click on build badge)</li>
<li><strong>Thanks to <a href="https://github.com/visualjeff">@visualjeff</a></strong></li>
</ul>
<p>[Fixed]</p>
<ul>
<li>Minor adjustments to multi-value logic introduced in v0.4.0</li>
</ul>
<h3 id="v040">v0.4.0</h3>
<p>[Improved]</p>
<ul>
<li>Not using the SCIM standard for handling multivalue attributes and cleared attributes. Changed from array to object based on type. This simplifies plugin-coding for multivalue attributes like emails, phoneNumbers, entitlements, ...</li>
<li>Module dependencies updated to latest versions</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>Custom plugins using multivalue attributes needs to be updated regarding methods createUser and modifyUser. Please see example plugins for details.</li>
</ul>
<h3 id="v038">v0.3.8</h3>
<p>[Fixed]</p>
<ul>
<li>Minor changes related to SCIM specification</li>
</ul>
<h3 id="v037">v0.3.7</h3>
<p>[Improved]</p>
<ul>
<li>PFX / PKCS#12 certificate bundle is supported</li>
</ul>
<h3 id="v036">v0.3.6</h3>
<p>[Improved]</p>
<ul>
<li>SCIM Gateway used by Microsoft Azure Active Directory is supported</li>
<li>SCIM version 2.0 is supported</li>
<li>Create group is supported</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>For custom plugins to support create group, they needs to be updated regarding listener method <code>scimgateway.on('createGroup',...</code> Please see example plugins for details.</li>
</ul>
<h3 id="v035">v0.3.5</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-mssql not included in postinstall</li>
</ul>
<h3 id="v034">v0.3.4</h3>
<p>[Improved]</p>
<ul>
<li>MSSQL example plugin: <code>plugin-mssql</code></li>
<li>Changed multivalue logic in example plugins, now using <code>scimgateway.getArrayObject</code></li>
</ul>
<p>[Fixed]</p>
<ul>
<li>Minor changes related to SCIM specification</li>
</ul>
<h3 id="v033">v0.3.3</h3>
<p>[Fixed]</p>
<ul>
<li>Logic for handling incorrect pagination request to avoid endless loop conditions (there is a pagination bug in CA Identity Manager v.14)</li>
<li>Pagination now supported on getGroupMembers</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>Custom plugins needs to be updated regarding listener method <code>scimgateway.on('getGroupMembers',...</code> New arguments have been added &quot;startIndex&quot; and &quot;count&quot;. Also a new return variable &quot;ret&quot;. Please see example plugins for details.</li>
</ul>
<h3 id="v032">v0.3.2</h3>
<p>[Fixed]</p>
<ul>
<li>Minor changes related to SCIM specification</li>
</ul>
<h3 id="v031">v0.3.1</h3>
<p>[Improved]</p>
<ul>
<li>REST Webservices example plugin: <code>plugin-restful</code></li>
</ul>
<h3 id="v030">v0.3.0</h3>
<p>[Improved]</p>
<ul>
<li>Preferred installation method changed from &quot;global&quot; to &quot;local&quot;</li>
<li><code>&lt;Base URL&gt;/[baseEntity]</code> for multi tenant or multi endpoint flexibility</li>
<li>plugin-forwardinc includes examples of baseEntity, custom soap header and signed saml assertion</li>
<li>Support groups defined on user object &quot;group member of user&quot;</li>
<li>New module dependendcies included: saml, async and callsite</li>
</ul>
<p><strong>[UPGRADE]</strong></p>
<ul>
<li>Use &quot;fresh&quot; install and restore any custom plugins. Custom plugins needs to be updated. Listener method names have changed and method must include &quot;baseEntity&quot; - please see example plugins.</li>
</ul>
<h3 id="v022---v028">v0.2.2 - v0.2.8</h3>
<p>[Doc]</p>
<ul>
<li>Minor readme changes and version bumps</li>
</ul>
<h3 id="v021">v0.2.1</h3>
<p>[Fixed]</p>
<ul>
<li>plugin-forwardinc explore of empty endpoint</li>
</ul>
<h3 id="v020">v0.2.0</h3>
<p>Initial version</p>

            <script async src="https://cdn.jsdelivr.net/npm/katex-copytex@latest/dist/katex-copytex.min.js"></script>
            
        </body>
        </html>