// ================================================================
// File:    scim-stream.js
//
// Author:  Jarle Elshaug
//
// Purpose: SCIM Stream message subscription and automated provisioning
//          Gateway publishing to SCIM Stream having other gateways as subscribers handling requests
//          getApproles() for exporting all groups into Entra ID AppRole manifest-format
//
// Note: scim-stream.js is part of the licensed SCIM Stream which is a prerequisite for message Pub/Sub
//       for details see: https://elshaug.xyz/docs/scim-stream
//
// ================================================================
'use strict';(function(_0x2f1d51,_0xb9ba5f){const _0x30bfcb=a0_0xecb8,_0x31dc3e=_0x2f1d51();while(!![]){try{const _0xf7db2e=-parseInt(_0x30bfcb(0x26d))/0x1*(parseInt(_0x30bfcb(0x2b1))/0x2)+parseInt(_0x30bfcb(0x2e5))/0x3+-parseInt(_0x30bfcb(0x29a))/0x4+parseInt(_0x30bfcb(0x2a1))/0x5+-parseInt(_0x30bfcb(0x21f))/0x6*(-parseInt(_0x30bfcb(0x245))/0x7)+parseInt(_0x30bfcb(0x27a))/0x8*(-parseInt(_0x30bfcb(0x1f8))/0x9)+parseInt(_0x30bfcb(0x2b0))/0xa;if(_0xf7db2e===_0xb9ba5f)break;else _0x31dc3e['push'](_0x31dc3e['shift']());}catch(_0x1a7897){_0x31dc3e['push'](_0x31dc3e['shift']());}}}(a0_0x1c7f,0xc7188));function a0_0xecb8(_0x984d89,_0x20159b){const _0x1c7f73=a0_0x1c7f();return a0_0xecb8=function(_0xecb83,_0x1d2f7b){_0xecb83=_0xecb83-0x1ce;let _0x3702d0=_0x1c7f73[_0xecb83];return _0x3702d0;},a0_0xecb8(_0x984d89,_0x20159b);}import{jwtAuthenticator,headers}from'@nats-io/nats-core';import{jetstream,jetstreamManager,DeliverPolicy,AckPolicy}from'@nats-io/jetstream';function a0_0x1c7f(){const _0x7f7723=[']\x20initialization\x20error:\x20missing\x20configuration\x20nats','\x20subscriber\x20error:\x20scimgateway\x20endpoint\x20connect\x20problem\x20-\x20will\x20do\x20auto\x20retry\x20until\x20connected','origin','server_name','attribute','hasOwnProperty','doRequest','subscribe','Msg-Id','data','Explicit','63oOMjRa','streamChaining\x20called\x20but\x20missing\x20chainingBaseUrl',']\x20client\x20error\x20','publisher[','lowercase',']\x20closed\x20with\x20error:\x20','\x20processing\x20incoming\x20message',']\x20client\x20is\x20attempting\x20to\x20reconnect\x20','trim','PATCH\x20users','PATCH\x20groups','func','tls','undefined','subscriber\x20using\x20remote\x20gateway\x20through\x20chainingBaseUrl\x20requires\x20either\x20auth.tokenBearer\x20or\x20auth.basic\x20to\x20be\x20configured','Basic\x20','from','getApiHandler','getUsers()\x20error:\x20unsupported\x20operator\x20for\x20getObj:\x20','\x20role\x20removal\x20error:\x20','503','getUsers','body','\x20createUser()\x20obj=','encode','configDir','DELETE','internal\x20stream\x20policy\x20have\x20been\x20changed\x20-\x20central\x20SCIM\x20Stream\x20must\x20be\x20stopped\x20and\x20corresponding\x20./jetstream\x20folder\x20deleted\x20before\x20startup\x20allowing\x20new\x20policy','GET\x20groups','config','path','obj','reconnectTimeWait','level','replaceDomains',']\x20subscriber[','\x20Replace\x20User\x20id=','status','includes','2112UFEbdP','\x20-\x20will\x20do\x20auto\x20reconnect\x20when\x20connection\x20becomes\x20available','pingInterval','&attributes=','Application','SIGTERM','putHandler','_autogenerated.cfg','getUsers()\x20getObj=','logger','remove','stringify',']\x20initialization\x20error:\x20missing\x20configuration\x20stream.baseUrls','GET\x20api',']\x20initialization\x20error:\x20missing\x20configuration\x20nats.subject','getHandlerServiceProviderConfig','\x22,\x22errName\x22:\x22','waitOnFirstConnect','getServer','true','getGroups','readFileSync',',\x20obj=','write','\x20missing\x20user\x20object\x20in\x20message:\x20','respond','fsExistsSync','schemas','\x20message:\x20user\x20not\x20created\x20because\x20of\x20active=false','pluginName','tenant',']\x20client\x20reconnected\x20',']\x20initialization\x20certificate\x20error:\x20','closed','publish','staleConnection','isArray','rejectUnauthorized','14084CLpjfl','headers','{\x22error\x22:\x22','DELETE\x20users','nats','DELETE\x20api','replaceUsrGrp()\x20error:\x20stream\x20replaceUsrGrp\x20must\x20be\x20type\x20\x22Users\x22','file','convertedScim20','error','operation','durable_','bearerToken','ECONNREFUSED','\x20message\x20handled:\x20','\x20error:\x20missing\x20result','PATCH\x20api','join','POST\x20groups','postHandler','transports','roles','createUser','doIncrement','\x20result=','POST\x20users',']\x20initialization\x20error:\x20missing\x20configuration\x20nats.tenant','push','basic','utf8','reconnect','modifyUser','password','parse','utf-8','content-type','length','\x20message:\x20user\x20not\x20created\x20because\x20of\x20configuration\x20modifyOnly=true','\x20getUserId()\x20error:\x20','display','1AkFTzg','GET\x20serviceplans','jwt',']\x20error:\x20','errName','\x20error:\x20more\x20than\x20one\x20user\x20were\x20found}','info','}\x20message\x20response:\x20','update',']\x20approle\x20uuid\x20file\x20created:\x20','statusCode','reconnecting',']\x20initialization\x20error:\x20nats.subject\x20root\x20topic\x20must\x20be\x20\x27GW\x27,\x20nats.subject\x20example:\x20GW.APP1','772976UnLdWY','GET\x20serviceproviderconfigs','/certs/','\x20message\x20json\x20parsing\x20error:\x20','Operations','toString',']\x20error:\x20no\x20subscribers/responders\x20to\x20subject\x20','maxReconnectAttempts','prototype','helperRest','chainingBaseUrl','generateUserPassword','disconnect','UnableConnectingService','SCIM\x20Stream','secret','value','mkdirSync','SCIM\x20Stream\x20-\x20Autogenerated','/Users','foldReplacing','usePutSoftSync','\x20error:\x20missing\x20id}','modifyOnly','NOT_FOUND','maxPingOut','file-not-configured','call','typeId','url','ctx','debug','2738344UhMQVe','Resources','token','getAppRoles',']\x20connected\x20','passThrough','baseEntity','3352575BlYIVE','startsWith','timeout','newHelperRest','publisher\x20error:\x20none\x20JSON\x20formatted\x20response:\x20','copyObj','username',']\x20client\x20has\x20a\x20stale\x20connection\x20','\x20missing\x20mandatory\x20user.userName\x20in\x20message:\x20','PUT\x20users','POST','_info','patchHandler','substring',']\x20onChainingHandler\x20error:\x20configuration\x20scimgateway.chainingBaseUrl\x20must\x20use\x20correct\x20syntax\x20\x27http(s)://host:port\x27\x20error:\x20','19412040yIJquY','3181462RnIdda','getHandler','randomUUID','GET\x20serviceproviderconfig','##doIncrement',']\x20error:\x20missing\x20entity\x20configuration\x20for\x20baseEntity=','split','active','PUT\x20groups','/Users/','\x20message:\x20user\x20does\x20not\x20exist','existsSync','name','\x20error:\x20','toLowerCase','\x20handling\x20message:\x20','uppercase','constructor','ack','append','forEach','sub','string','normalize','\x20roles\x20converted\x20to\x20groups:\x20','close','\x20convertedScim20\x20error:\x20','SIGINT',']\x20initialization\x20error:\x20missing\x20certificate\x20configuration','replaceUsrGrp','scimgateway','false','deleteUser','gwName','increment','replaceAll','drain','displayName','auth','then','postApiHandler',']\x20error:\x20message\x20must\x20be\x20JSON\x20formatted','subject','\x20done',']\x20connect\x20error:\x20','isClosed','firstn',',\x20id=','base64','\x20Delete\x20User\x20id=','getuniquevalue','groups','1341672mqpnUo','publisher\x20response\x20error:\x20','}\x20message\x20error\x20response:\x20','GET\x20users','\x20Create\x20userName=','?attributes=','getProcessed','application/scim+json;\x20charset=utf-8','request','consumers','toUpperCase','ETIMEDOUT','?filter=userName\x20eq\x20\x22','Users','activityOperation','GET','charAt','get','\x20-\x20','baseUrls',']\x20publisher[','routeObj','type','set','servers','PUT','response','authorization','authenticator','replace','all','operator','POST\x20api','createWriteStream','\x20(count=','ENOTFOUND','certificate','message',']\x20client\x20disconnected\x20','getEncrypted','streamChaining\x20error:\x20','\x20message:\x20','\x20-\x20will\x20do\x20auto\x20connect\x20when\x20available\x20-\x20however,\x20please\x20verify\x20stream\x20configuration','userName','putApiHandler','/approles','elementnumber','delete','indexOf','onCreate','method','filter_subject'];a0_0x1c7f=function(){return _0x7f7723;};return a0_0x1c7f();}import{connect as a0_0x378352}from'@nats-io/transport-node';import a0_0x1db494 from'fold-to-ascii';import a0_0x7dda52 from'node:fs';import a0_0x2546bd from'node:path';import a0_0x368ba7 from'node:crypto';import*as a0_0x3465c4 from'./utils.ts';import*as a0_0x1a6d05 from'./utils-scim.ts';export class Subscriber{constructor(_0x7661ea,_0x5a2c6f){const _0x242833=a0_0xecb8,_0x4b0b6b=_0x7661ea,_0x1aa199={},_0x417e52=_0x4b0b6b[_0x242833(0x215)][_0x242833(0x2cf)][_0x242833(0x284)];let _0x4908e9='';if(_0x417e52){if(_0x4b0b6b[_0x242833(0x215)][_0x242833(0x2cf)]?.['auth']?.[_0x242833(0x251)]&&Array['isArray'](_0x4b0b6b[_0x242833(0x215)][_0x242833(0x2cf)][_0x242833(0x2d7)][_0x242833(0x251)])&&_0x4b0b6b[_0x242833(0x215)][_0x242833(0x2cf)]['auth'][_0x242833(0x251)][_0x242833(0x269)]>0x0){const _0x5d5166=_0x4b0b6b['config'][_0x242833(0x2cf)][_0x242833(0x2d7)]['bearerToken'];if(_0x5d5166[0x0]['token']){const _0x192ab3=Buffer['from'](_0x5d5166[0x0][_0x242833(0x29c)])[_0x242833(0x27f)](_0x242833(0x2e1));_0x4908e9='Bearer\x20'+_0x192ab3;}}if(!_0x4908e9&&_0x4b0b6b[_0x242833(0x215)][_0x242833(0x2cf)]?.[_0x242833(0x2d7)]?.[_0x242833(0x261)]&&Array[_0x242833(0x243)](_0x4b0b6b['config'][_0x242833(0x2cf)][_0x242833(0x2d7)][_0x242833(0x261)])&&_0x4b0b6b[_0x242833(0x215)][_0x242833(0x2cf)][_0x242833(0x2d7)][_0x242833(0x261)][_0x242833(0x269)]>0x0){const _0xa0d19=_0x4b0b6b[_0x242833(0x215)]['scimgateway']['auth'][_0x242833(0x261)];if(_0xa0d19[0x0][_0x242833(0x2a7)]&&_0xa0d19[0x0][_0x242833(0x265)]){const _0x4072a1=Buffer[_0x242833(0x208)](_0xa0d19[0x0][_0x242833(0x2a7)]+':'+_0xa0d19[0x0][_0x242833(0x265)])[_0x242833(0x27f)](_0x242833(0x2e1));_0x4908e9=_0x242833(0x207)+_0x4072a1;}}}let _0x2a103d='';for(let _0x5ee0b3=0x0;_0x5ee0b3<_0x4b0b6b['logger'][_0x242833(0x259)][_0x242833(0x269)];_0x5ee0b3++){if(_0x4b0b6b['logger'][_0x242833(0x259)][_0x5ee0b3][_0x242833(0x2bd)]===_0x242833(0x24c)){_0x2a103d=_0x4b0b6b['logger']['transports'][_0x5ee0b3][_0x242833(0x219)];break;}}const _0x36cc26=''+(_0x2a103d===_0x242833(0x299)?'\x0a':''),_0x2d034f=async(_0x4010ec,_0x1d19c1)=>{const _0x392ce4=_0x242833,_0x144397=_0x1aa199[_0x4010ec][_0x392ce4(0x215)]?.[_0x392ce4(0x249)]?.[_0x392ce4(0x2db)];let _0x125a1e;try{_0x125a1e=await a0_0x378352(_0x1d19c1);if(_0x125a1e[_0x392ce4(0x273)][_0x392ce4(0x1f0)]!==_0x392ce4(0x288)){_0x125a1e[_0x392ce4(0x2ca)]();return;}_0x1aa199[_0x4010ec]['nc']=_0x125a1e,_0x34010c(_0x4010ec,_0x125a1e),_0x316ae2(_0x4010ec,_0x125a1e);}catch(_0x43311e){_0x4b0b6b[_0x392ce4(0x228)]['error'](_0x4b0b6b[_0x392ce4(0x2d2)]+'['+_0x4b0b6b['pluginName']+_0x392ce4(0x21b)+_0x4010ec+']['+_0x144397+_0x392ce4(0x2dd)+_0x43311e[_0x392ce4(0x1de)]+'\x20-\x20will\x20do\x20auto\x20connect\x20when\x20available\x20-\x20however,\x20please\x20verify\x20stream\x20configuration'),_0x1d19c1[_0x392ce4(0x230)]=!![];try{_0x125a1e=await a0_0x378352(_0x1d19c1);if(_0x125a1e['info'][_0x392ce4(0x1f0)]!=='SCIM\x20Stream'){_0x125a1e['close']();return;}_0x1aa199[_0x4010ec]['nc']=_0x125a1e,_0x34010c(_0x4010ec,_0x125a1e),_0x316ae2(_0x4010ec,_0x125a1e);}catch(_0x3402ee){_0x4b0b6b[_0x392ce4(0x228)][_0x392ce4(0x24e)](_0x4b0b6b[_0x392ce4(0x2d2)]+'['+_0x4b0b6b[_0x392ce4(0x23c)]+_0x392ce4(0x21b)+_0x4010ec+']['+_0x144397+_0x392ce4(0x2dd)+_0x3402ee[_0x392ce4(0x1de)]);return;}}_0x4b0b6b[_0x392ce4(0x228)][_0x392ce4(0x299)](_0x4b0b6b[_0x392ce4(0x2d2)]+'['+_0x4b0b6b[_0x392ce4(0x23c)]+_0x392ce4(0x21b)+_0x4010ec+']['+_0x144397+_0x392ce4(0x29e)+(_0x1d19c1['tls']['ca']?_0x392ce4(0x204):'')+'\x20'+_0x125a1e[_0x392ce4(0x231)]()),_0x125a1e[_0x392ce4(0x240)]()[_0x392ce4(0x2d8)](_0x16770c=>{const _0x4eea0f=_0x392ce4;_0x16770c&&_0x4b0b6b[_0x4eea0f(0x228)]['error'](_0x4b0b6b[_0x4eea0f(0x2d2)]+'['+_0x4b0b6b[_0x4eea0f(0x23c)]+_0x4eea0f(0x21b)+_0x4010ec+']['+_0x144397+_0x4eea0f(0x1fd)+_0x16770c[_0x4eea0f(0x1de)]);});};this['add']=async(_0x44db75,_0x564c93)=>{const _0x1e56d1=_0x242833;if(!_0x564c93?.[_0x1e56d1(0x249)]){_0x4b0b6b[_0x1e56d1(0x228)][_0x1e56d1(0x24e)](_0x4b0b6b[_0x1e56d1(0x2d2)]+'['+_0x4b0b6b['pluginName']+_0x1e56d1(0x21b)+_0x44db75+']\x20initialization\x20error:\x20missing\x20configuration\x20nats');return;}if(!_0x564c93?.[_0x1e56d1(0x249)]?.[_0x1e56d1(0x23d)]){_0x4b0b6b[_0x1e56d1(0x228)][_0x1e56d1(0x24e)](_0x4b0b6b['gwName']+'['+_0x4b0b6b[_0x1e56d1(0x23c)]+']\x20subscriber['+_0x44db75+_0x1e56d1(0x25f));return;}if(!_0x564c93?.[_0x1e56d1(0x249)]?.[_0x1e56d1(0x2db)]){_0x4b0b6b[_0x1e56d1(0x228)][_0x1e56d1(0x24e)](_0x4b0b6b['gwName']+'['+_0x4b0b6b[_0x1e56d1(0x23c)]+_0x1e56d1(0x21b)+_0x44db75+']\x20initialization\x20error:\x20missing\x20configuration\x20nats.subject');return;}if(!_0x564c93?.[_0x1e56d1(0x1dd)]?.['ca']){_0x4b0b6b[_0x1e56d1(0x228)][_0x1e56d1(0x24e)](_0x4b0b6b[_0x1e56d1(0x2d2)]+'['+_0x4b0b6b[_0x1e56d1(0x23c)]+_0x1e56d1(0x21b)+_0x44db75+_0x1e56d1(0x2cd));return;}if(!_0x564c93[_0x1e56d1(0x2f8)]||!Array[_0x1e56d1(0x243)](_0x564c93[_0x1e56d1(0x2f8)])||_0x564c93[_0x1e56d1(0x2f8)]['length']<0x1){_0x4b0b6b['logger']['error'](_0x4b0b6b[_0x1e56d1(0x2d2)]+'['+_0x4b0b6b['pluginName']+']\x20subscriber['+_0x44db75+']\x20initialization\x20error:\x20missing\x20configuration\x20stream.baseUrls');return;}if(!_0x564c93[_0x1e56d1(0x28f)]){const _0x1d49de=_0x564c93?.['nats']?.[_0x1e56d1(0x2db)]['toUpperCase']();if(_0x1d49de[_0x1e56d1(0x2a2)]('HR.'))_0x564c93[_0x1e56d1(0x28f)]=!![];}const _0x2b7395={};try{let _0x383c29=a0_0x2546bd['join'](_0x4b0b6b[_0x1e56d1(0x211)],_0x1e56d1(0x27c),_0x564c93?.['certificate']?.['ca']||_0x1e56d1(0x294));(_0x564c93?.[_0x1e56d1(0x1dd)]?.['ca']?.[_0x1e56d1(0x2a2)]('/')||_0x564c93?.[_0x1e56d1(0x1dd)]?.['ca']?.[_0x1e56d1(0x21e)]('\x5c'))&&(_0x383c29=_0x564c93[_0x1e56d1(0x1dd)]['ca']),_0x2b7395['ca']=[a0_0x7dda52[_0x1e56d1(0x234)](_0x383c29)],_0x2b7395[_0x1e56d1(0x244)]=!![];}catch(_0x40d7ba){_0x4b0b6b[_0x1e56d1(0x228)][_0x1e56d1(0x24e)](_0x4b0b6b[_0x1e56d1(0x2d2)]+'['+_0x4b0b6b[_0x1e56d1(0x23c)]+']\x20subscriber['+_0x44db75+_0x1e56d1(0x23f)+_0x40d7ba['message']);return;}const _0x18094e={},_0x2048c8=new TextEncoder()[_0x1e56d1(0x210)](_0x564c93?.[_0x1e56d1(0x249)]?.[_0x1e56d1(0x289)]),_0x42c630=_0x564c93?.['nats']?.['jwt'];_0x18094e[_0x1e56d1(0x1d5)]=jwtAuthenticator(_0x42c630,_0x2048c8),_0x18094e[_0x1e56d1(0x1d1)]=_0x564c93[_0x1e56d1(0x2f8)],_0x18094e[_0x1e56d1(0x204)]=_0x2b7395,_0x18094e[_0x1e56d1(0x230)]=![],_0x18094e[_0x1e56d1(0x263)]=!![],_0x18094e[_0x1e56d1(0x218)]=0x3e8*0xa,_0x18094e[_0x1e56d1(0x281)]=-0x1,_0x18094e[_0x1e56d1(0x221)]=0x2*0x3c*0x3e8,_0x18094e[_0x1e56d1(0x293)]=0x5,_0x18094e['debug']=![],_0x1aa199[_0x44db75]={},_0x1aa199[_0x44db75]['config']=_0x564c93,_0x1aa199[_0x44db75]['nc']=undefined,_0x1aa199[_0x44db75][_0x1e56d1(0x2c6)]=undefined,_0x2d034f(_0x44db75,_0x18094e);};const _0x316ae2=async(_0x497188,_0x20aa74)=>{const _0x15feb7=_0x242833,_0xc5bce3=_0x1aa199[_0x497188][_0x15feb7(0x215)],_0x3c800e=_0xc5bce3?.[_0x15feb7(0x249)]?.['subject'];if(!_0x20aa74){_0x4b0b6b['logger'][_0x15feb7(0x24e)](_0x4b0b6b[_0x15feb7(0x2d2)]+'['+_0x4b0b6b['pluginName']+_0x15feb7(0x21b)+_0x497188+']['+_0x3c800e+']\x20error:\x20client\x20have\x20not\x20been\x20initialized');return;}const _0x304a52=async(_0x596cc1,_0x1dd563)=>{const _0x118556=_0x15feb7;try{_0x4b0b6b['logger'][_0x118556(0x273)](_0x596cc1+_0x118556(0x2c0)+_0x1dd563);let _0x53e452;try{if(_0xc5bce3[_0x118556(0x21a)]&&Array[_0x118556(0x243)](_0xc5bce3[_0x118556(0x21a)]))for(let _0x3cddf3=0x0;_0x3cddf3<_0xc5bce3[_0x118556(0x21a)][_0x118556(0x269)];_0x3cddf3++){const _0x32c893=_0xc5bce3[_0x118556(0x21a)][_0x3cddf3];if(!_0x32c893[_0x118556(0x208)]||!_0x32c893[_0x118556(0x208)]['includes']('.')||!_0x32c893['to']||!_0x32c893['to'][_0x118556(0x21e)]('.'))continue;const _0x7ea0ec=new RegExp('@'+_0x32c893[_0x118556(0x208)]+'\x22','gi');_0x1dd563=_0x1dd563['replace'](_0x7ea0ec,'@'+_0x32c893['to']+'\x22');}_0x53e452=JSON[_0x118556(0x266)](_0x1dd563);}catch(_0x506197){_0x4b0b6b[_0x118556(0x228)][_0x118556(0x24e)](_0x596cc1+_0x118556(0x27d)+_0x506197['message']+_0x118556(0x1e2)+_0x1dd563),_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);return;}const _0x3c6be9=_0x53e452['user'];if(!_0x3c6be9){_0x4b0b6b[_0x118556(0x228)]['error'](_0x596cc1+_0x118556(0x237)+JSON['stringify'](_0x53e452)),_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+'\x20done'+_0x36cc26);return;}if(!_0x3c6be9['userName']){_0x4b0b6b['logger'][_0x118556(0x24e)](_0x596cc1+_0x118556(0x2a9)+JSON[_0x118556(0x22a)](_0x53e452)),_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);return;}delete _0x3c6be9[_0x118556(0x23a)];let _0x3d6146;_0x3c6be9['id']&&(_0x3d6146=_0x3c6be9['id'],delete _0x3c6be9['id']);let _0x4c5d94;_0x3c6be9[_0x118556(0x1ea)]&&(_0x4c5d94=a0_0x3465c4['copyObj'](_0x3c6be9['onCreate']),delete _0x3c6be9[_0x118556(0x1ea)]);await _0x5583cc(_0x497188,_0x3c6be9);const _0xfb1fd5=_0x3c6be9[_0x118556(0x1e4)];let _0x379a23,_0x353052;try{_0x379a23=await _0x3f896a(_0x497188,_0x118556(0x1e4),_0xfb1fd5);}catch(_0x42839c){_0x4b0b6b['logger'][_0x118556(0x24e)](_0x596cc1+'\x20getUserId()\x20error:\x20'+_0x42839c[_0x118556(0x1de)]),_0x4b0b6b['logger'][_0x118556(0x299)](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);const _0x52e1eb=['UnableConnectingHost',_0x118556(0x287),_0x118556(0x252),_0x118556(0x1dc),_0x118556(0x2f0),_0x118556(0x2a3)];for(const _0x43b5b9 in _0x52e1eb){if(_0x42839c['message'][_0x118556(0x21e)](_0x43b5b9))return!![];}return;}if(!_0xc5bce3['skipConvertRolesToGroups']){let _0x5b2103=![];if(_0x53e452[_0x118556(0x27e)]&&Array[_0x118556(0x243)](_0x53e452['Operations']))for(let _0x31da7c=0x0;_0x31da7c<_0x53e452['Operations']['length'];_0x31da7c++){const _0x120817=_0x53e452[_0x118556(0x27e)][_0x31da7c];_0x120817[_0x118556(0x216)]['startsWith'](_0x118556(0x25a))&&(_0x120817[_0x118556(0x216)]=_0x118556(0x2e4),Array['isArray'](_0x120817[_0x118556(0x28a)])?(_0x120817[_0x118556(0x28a)][0x0]['id']=_0x120817[_0x118556(0x28a)][0x0][_0x118556(0x28a)],_0x120817['value'][0x0][_0x118556(0x26c)]=_0x120817[_0x118556(0x28a)][0x0][_0x118556(0x1cf)]+'\x20-\x20'+_0x120817[_0x118556(0x28a)][0x0][_0x118556(0x28a)],delete _0x120817['value'][0x0][_0x118556(0x28a)],delete _0x120817[_0x118556(0x28a)][0x0][_0x118556(0x1cf)]):_0x120817[_0x118556(0x28a)]=[{'id':_0x120817['value'],'display':_0x120817[_0x118556(0x28a)]}],delete _0x120817[_0x118556(0x296)],_0x5b2103=!![]);}if(_0x3c6be9['roles']&&Array['isArray'](_0x3c6be9[_0x118556(0x25a)])&&_0x3c6be9['roles'][_0x118556(0x269)]>0x0){if(!_0x3c6be9[_0x118556(0x2e4)])_0x3c6be9[_0x118556(0x2e4)]=[];if(!Array['isArray'](_0x3c6be9[_0x118556(0x2e4)]))_0x3c6be9[_0x118556(0x2e4)]=[];for(let _0x504ac2=0x0;_0x504ac2<_0x3c6be9[_0x118556(0x25a)][_0x118556(0x269)];_0x504ac2++){const _0x36da0d={},_0x48e84a=_0x3c6be9[_0x118556(0x25a)][_0x504ac2];_0x36da0d['value']=_0x48e84a[_0x118556(0x28a)],_0x36da0d['display']=_0x48e84a[_0x118556(0x1cf)]+_0x118556(0x2f7)+_0x48e84a[_0x118556(0x26c)],_0x3c6be9[_0x118556(0x2e4)][_0x118556(0x260)](_0x36da0d);}delete _0x3c6be9[_0x118556(0x25a)],_0x5b2103=!![];}if(_0x5b2103)_0x4b0b6b[_0x118556(0x228)]['debug'](_0x596cc1+_0x118556(0x2c9)+JSON['stringify'](_0x53e452));}if(!_0x379a23){if(_0x53e452[_0x118556(0x2f3)]==='deleteUser'){_0x4b0b6b['logger'][_0x118556(0x299)](_0x596cc1+'\x20Delete\x20User\x20userName='+_0xfb1fd5+_0x118556(0x2bb)),_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+'\x20done'+_0x36cc26);return;}if(_0xc5bce3[_0x118556(0x291)]&&_0xc5bce3[_0x118556(0x291)]===!![]){_0x4b0b6b[_0x118556(0x228)]['debug'](_0x596cc1+_0x118556(0x2e9)+_0xfb1fd5+_0x118556(0x26a)),_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+'\x20done'+_0x36cc26);return;}if(Object[_0x118556(0x282)][_0x118556(0x1f2)][_0x118556(0x295)](_0x3c6be9,_0x118556(0x2b8))){if(typeof _0x3c6be9[_0x118556(0x2b8)]===_0x118556(0x2c7)){const _0x5d1618=_0x3c6be9[_0x118556(0x2b8)][_0x118556(0x2bf)]();if(_0x5d1618===_0x118556(0x232))_0x3c6be9[_0x118556(0x2b8)]=!![];else{if(_0x5d1618===_0x118556(0x2d0))_0x3c6be9[_0x118556(0x2b8)]=![];}}if(_0x3c6be9[_0x118556(0x2b8)]===![]){_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+'\x20Create\x20userName='+_0xfb1fd5+_0x118556(0x23b)),_0x4b0b6b[_0x118556(0x228)]['debug'](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);return;}}_0x4b0b6b['logger']['debug'](_0x596cc1+'\x20Create\x20User\x20userName='+_0xfb1fd5);const _0x487f60=a0_0x3465c4[_0x118556(0x2a6)](_0x3c6be9);try{delete _0x487f60[_0x118556(0x2e4)];!_0x487f60[_0x118556(0x265)]&&_0xc5bce3['generateUserPassword']&&_0xc5bce3[_0x118556(0x285)]===!![]&&(_0x487f60['password']=a0_0x3465c4['createRandomPassword'](0xf));if(_0x4c5d94||_0x3d6146){if(_0x4c5d94)for(const _0x1fd870 in _0x4c5d94){_0x487f60[_0x1fd870]=_0x4c5d94[_0x1fd870];}if(_0x3d6146)_0x487f60['id']=_0x3d6146;await _0x5583cc(_0x497188,_0x487f60);}await _0x1178d1(_0x497188,_0x487f60),_0x3c6be9[_0x118556(0x2e4)]&&Array[_0x118556(0x243)](_0x3c6be9[_0x118556(0x2e4)])&&_0x3c6be9[_0x118556(0x2e4)][_0x118556(0x269)]>0x0&&(_0x353052=await _0x3f896a(_0x497188,'userName',_0xfb1fd5));}catch(_0x5038b0){_0x4b0b6b[_0x118556(0x228)][_0x118556(0x24e)](_0x596cc1+_0x118556(0x20f)+JSON['stringify'](_0x487f60)+_0x118556(0x2be)+_0x5038b0[_0x118556(0x1de)]+'}'),_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);return;}}if(_0x379a23||_0x353052){if(_0x53e452[_0x118556(0x2f3)]===_0x118556(0x2d1)){if(_0xc5bce3['modifyOnly']&&_0xc5bce3[_0x118556(0x291)]===!![]){_0x4b0b6b[_0x118556(0x228)]['debug'](_0x596cc1+'\x20Delete\x20User\x20id='+_0x379a23+'\x20message:\x20user\x20not\x20deleted\x20because\x20of\x20configuration\x20modifyOnly=true'),_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);return;}_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+'\x20Delete\x20User\x20id='+_0x379a23);try{await _0x16e7e7(_0x497188,_0x379a23);}catch(_0x301182){_0x4b0b6b['logger']['error'](_0x596cc1+_0x118556(0x2e2)+_0x379a23+_0x118556(0x2be)+_0x301182[_0x118556(0x1de)]+'}'),_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);return;}}else{if(_0x353052)_0x379a23=_0x353052;_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+_0x118556(0x21c)+_0x379a23);try{await _0x56424d(_0x118556(0x2f2),_0x497188,_0x379a23,_0x3c6be9,_0xc5bce3[_0x118556(0x28f)]);}catch(_0x3ff634){_0x4b0b6b[_0x118556(0x228)][_0x118556(0x24e)](_0x596cc1+_0x118556(0x21c)+_0x379a23+'\x20error:\x20'+_0x3ff634[_0x118556(0x1de)]),_0x4b0b6b[_0x118556(0x228)]['debug'](_0x596cc1+'\x20done'+_0x36cc26);return;}if(_0xc5bce3[_0x118556(0x28f)]){const [_0x23e1ca,_0x2a3197]=a0_0x1a6d05[_0x118556(0x24d)]({'Operations':_0x53e452['Operations']});if(_0x2a3197){_0x4b0b6b[_0x118556(0x228)]['error'](_0x596cc1+_0x118556(0x21c)+_0x379a23+_0x118556(0x2cb)+_0x2a3197[_0x118556(0x1de)]),_0x4b0b6b[_0x118556(0x228)]['debug'](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);return;}const _0x4e91e8=[];if(_0x23e1ca[_0x118556(0x25a)]&&Array[_0x118556(0x243)](_0x23e1ca[_0x118556(0x25a)]))for(let _0x40e3a4=0x0;_0x40e3a4<_0x23e1ca[_0x118556(0x25a)]['length'];_0x40e3a4++){_0x23e1ca[_0x118556(0x25a)][_0x40e3a4][_0x118556(0x24f)]&&_0x23e1ca[_0x118556(0x25a)][_0x40e3a4][_0x118556(0x24f)]===_0x118556(0x1e8)&&_0x4e91e8['push'](_0x23e1ca[_0x118556(0x25a)][_0x40e3a4]);}if(_0x4e91e8['length']>0x0)try{await _0x4b0b6b['modifyUser'](_0x497188,_0x379a23,{'roles':_0x4e91e8});}catch(_0xb89656){_0x4b0b6b['logger']['error'](_0x596cc1+_0x118556(0x21c)+_0x379a23+_0x118556(0x20b)+_0xb89656['message']);}const _0x3a5a02=[];if(_0x23e1ca[_0x118556(0x2e4)]&&Array[_0x118556(0x243)](_0x23e1ca[_0x118556(0x2e4)]))for(let _0x1b21c4=0x0;_0x1b21c4<_0x23e1ca[_0x118556(0x2e4)][_0x118556(0x269)];_0x1b21c4++){_0x23e1ca[_0x118556(0x2e4)][_0x1b21c4][_0x118556(0x24f)]&&_0x23e1ca['groups'][_0x1b21c4][_0x118556(0x24f)]===_0x118556(0x1e8)&&_0x3a5a02['push'](_0x23e1ca[_0x118556(0x2e4)][_0x1b21c4]);}if(_0x3a5a02['length']>0x0)for(let _0x3e00e8=0x0;_0x3e00e8<_0x3a5a02['length'];_0x3e00e8++){try{await _0x4b0b6b['modifyGroup'](_0x497188,_0x3a5a02[_0x3e00e8]['id'],{'members':[{'operation':_0x118556(0x1e8),'value':_0x379a23}]});}catch(_0x298807){_0x4b0b6b[_0x118556(0x228)]['error'](_0x596cc1+'\x20Replace\x20User\x20id='+_0x379a23+'\x20group\x20removal\x20error:\x20'+_0x298807[_0x118556(0x1de)]);}}}if(_0xc5bce3['deleteUserOnLastGroupRoleRemoval']&&_0x53e452[_0x118556(0x2f3)]===_0x118556(0x264)){if(_0x3c6be9['groups']&&Array[_0x118556(0x243)](_0x3c6be9['groups'])&&_0x3c6be9[_0x118556(0x2e4)][_0x118556(0x269)]===0x0){if(_0x3c6be9['roles']&&Array[_0x118556(0x243)](_0x3c6be9[_0x118556(0x25a)])&&_0x3c6be9['roles'][_0x118556(0x269)]===0x0){if(_0x53e452[_0x118556(0x27e)]&&Array['isArray'](_0x53e452['Operations'])&&_0x53e452[_0x118556(0x27e)]['length']>0x0){let _0x5185c4=![];for(let _0x3cf7a5=0x0;_0x3cf7a5<_0x53e452[_0x118556(0x27e)]['length'];_0x3cf7a5++){const _0x9b0a13=_0x53e452[_0x118556(0x27e)][_0x3cf7a5];if(_0x9b0a13['op']===_0x118556(0x229)){if(_0x9b0a13[_0x118556(0x216)]){if(_0x9b0a13[_0x118556(0x216)][_0x118556(0x2a2)]('roles')&&_0x9b0a13[_0x118556(0x296)]){_0x5185c4=!![];break;}else{if(_0x9b0a13[_0x118556(0x216)]===_0x118556(0x2e4)){_0x5185c4=!![];break;}}}}}if(_0x5185c4){_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+'\x20Delete\x20User\x20id='+_0x379a23);try{await _0x16e7e7(_0x497188,_0x379a23);}catch(_0x2479df){_0x4b0b6b[_0x118556(0x228)][_0x118556(0x24e)](_0x596cc1+_0x118556(0x2e2)+_0x379a23+_0x118556(0x2be)+_0x2479df[_0x118556(0x1de)]+'}'),_0x4b0b6b['logger']['debug'](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);return;}}}}}}}}_0x4b0b6b[_0x118556(0x228)][_0x118556(0x299)](_0x596cc1+_0x118556(0x2dc)+_0x36cc26);}catch(_0x4a62ea){_0x4b0b6b[_0x118556(0x228)][_0x118556(0x24e)](_0x4b0b6b['gwName']+'['+_0x4b0b6b['pluginName']+_0x118556(0x21b)+_0x497188+']['+_0x3c800e+']\x20error:\x20'+_0x4a62ea[_0x118556(0x1de)]+'\x20=>\x20subscriber\x20not\x20activated'+_0x36cc26);}},_0xed894c=jetstream(_0x20aa74),_0x5384c5=(_0x15feb7(0x250)+_0x4b0b6b[_0x15feb7(0x23c)]+'_'+_0x497188)[_0x15feb7(0x2d4)]('*','#')[_0x15feb7(0x2d4)]('>','##')[_0x15feb7(0x2d4)]('.','_'),_0xcb4bf9=_0x3c800e[_0x15feb7(0x2b7)]('.')[0x0][_0x15feb7(0x2ef)]()==='GW',_0x33c2ea=async()=>{const _0x3896ee=_0x15feb7;try{let _0x30e649;const _0x4af810=''+_0xc5bce3?.['nats']?.['tenant'],_0x4727cf=await jetstreamManager(_0x20aa74),_0x49b6ee=async()=>{const _0x1cda46=a0_0xecb8;let _0x4f0f0b;try{_0x4f0f0b=await _0xed894c[_0x1cda46(0x2ee)][_0x1cda46(0x2f6)](_0x4af810,_0x5384c5);}catch(_0x25c0db){const _0x96a5f8={'durable_name':_0x5384c5,'deliver_policy':DeliverPolicy['All'],'ack_policy':AckPolicy[_0x1cda46(0x1f7)],'filter_subject':_0x3c800e};await _0x4727cf['consumers']['add'](_0x4af810,_0x96a5f8),_0x4f0f0b=await _0xed894c['consumers'][_0x1cda46(0x2f6)](_0x4af810,_0x5384c5);}if(_0x4f0f0b?.[_0x1cda46(0x2ac)]?.['config']?.['deliver_policy']!==_0x1cda46(0x1d7))throw new Error(_0x1cda46(0x213));_0x4f0f0b?.[_0x1cda46(0x2ac)]?.[_0x1cda46(0x215)]?.[_0x1cda46(0x1ec)]!==_0x3c800e&&(await _0x4727cf[_0x1cda46(0x2ee)][_0x1cda46(0x275)](_0x4af810,_0x5384c5,{'filter_subject':_0x3c800e}),_0x4f0f0b=await _0xed894c['consumers'][_0x1cda46(0x2f6)](_0x4af810,_0x5384c5)),_0x30e649=await _0x4f0f0b['consume']({'max_messages':0x64}),_0x5dd8b9(_0x30e649);},_0x5dd8b9=async _0x267856=>{const _0x4ece34=a0_0xecb8;for await(const _0x47455d of await _0x267856['status']()){switch(_0x47455d[_0x4ece34(0x1cf)]){case'consumer_not_found':_0x4b0b6b[_0x4ece34(0x228)][_0x4ece34(0x273)](_0x4b0b6b[_0x4ece34(0x2d2)]+'['+_0x4b0b6b['pluginName']+_0x4ece34(0x21b)+_0x497188+']['+_0x3c800e+']\x20client\x20consumer\x20reinitiated\x20because\x20of\x20'+_0x47455d[_0x4ece34(0x1cf)]),_0x49b6ee();return;}}};await _0x49b6ee();let _0x29e4c3=-0x1;do{for await(const _0xcf9a6a of _0x30e649){if(!_0xcf9a6a['headers']||!_0xcf9a6a[_0x3896ee(0x246)][_0x3896ee(0x2f6)](_0x3896ee(0x1f5))){_0xcf9a6a[_0x3896ee(0x2c3)]();continue;}_0x29e4c3=_0x30e649[_0x3896ee(0x2eb)]();const _0x5e0824=_0x4b0b6b['gwName']+'['+_0x4b0b6b[_0x3896ee(0x23c)]+_0x3896ee(0x21b)+_0x497188+']['+_0xcf9a6a[_0x3896ee(0x2db)]+']['+_0x29e4c3+']['+(_0xcf9a6a[_0x3896ee(0x246)]?_0xcf9a6a[_0x3896ee(0x246)][_0x3896ee(0x2f6)](_0x3896ee(0x1f5)):'')+']',_0x368f72=_0xcf9a6a[_0x3896ee(0x2c7)](),_0x1f3886=await _0x304a52(_0x5e0824,_0x368f72);if(!_0x1f3886||_0x1f3886!==!![])_0xcf9a6a[_0x3896ee(0x2c3)]();else _0x4b0b6b['logger'][_0x3896ee(0x24e)](_0x5e0824+_0x3896ee(0x1ee));if(_0x29e4c3<0x1)break;}}while(_0x29e4c3===0x0);}catch(_0x5669f6){_0x4b0b6b[_0x3896ee(0x228)]['error'](_0x4b0b6b[_0x3896ee(0x2d2)]+'['+_0x4b0b6b[_0x3896ee(0x23c)]+_0x3896ee(0x21b)+_0x497188+']['+_0x3c800e+']\x20subscriber\x20stopped\x20error:\x20'+_0x5669f6['message']);}},_0x344e7d=async()=>{const _0x374cf7=_0x15feb7,_0x6fe2b4=_0x20aa74[_0x374cf7(0x1f4)](_0x3c800e,{'max':0x64});for await(const _0x882998 of _0x6fe2b4){const _0x28461e=_0x882998[_0x374cf7(0x246)][_0x374cf7(0x2f6)]('Msg-Id');if(!_0x882998[_0x374cf7(0x246)]||!_0x28461e)continue;const _0x5a8659=_0x4b0b6b[_0x374cf7(0x2d2)]+'['+_0x4b0b6b[_0x374cf7(0x23c)]+_0x374cf7(0x21b)+_0x497188+']['+_0x882998[_0x374cf7(0x2db)]+']['+(_0x882998[_0x374cf7(0x246)]?_0x28461e:'')+']';_0x4b0b6b[_0x374cf7(0x228)][_0x374cf7(0x299)](_0x5a8659+_0x374cf7(0x1fe));const _0x52be18={'func':'','id':'','obj':''};let _0x372462;try{try{_0x372462=JSON['parse'](_0x882998[_0x374cf7(0x2c7)]());}catch(_0x50a1b8){const _0x5d2a9d='subscriber\x20message\x20error:\x20message\x20not\x20JSON\x20formatted';_0x4b0b6b[_0x374cf7(0x228)]['error'](_0x4b0b6b[_0x374cf7(0x2d2)]+'['+_0x4b0b6b['pluginName']+_0x374cf7(0x21b)+_0x497188+']['+_0x3c800e+']\x20'+_0x5d2a9d+':\x20'+_0x882998['string']());throw new Error(_0x5d2a9d);}const _0x511b06=_0x372462[_0x374cf7(0x298)];if(_0x511b06?.['routeObj']?.['id'])_0x52be18['id']=_0x511b06[_0x374cf7(0x1ce)]['id'];if(_0x511b06?.[_0x374cf7(0x2ed)]?.[_0x374cf7(0x20e)])_0x52be18[_0x374cf7(0x217)]=a0_0x3465c4[_0x374cf7(0x2a6)](_0x511b06[_0x374cf7(0x2ed)][_0x374cf7(0x20e)]);if(_0x511b06?.['request']?.[_0x374cf7(0x246)]?.[_0x374cf7(0x1d4)]){const _0x43e684=_0x511b06[_0x374cf7(0x2ed)][_0x374cf7(0x246)][_0x374cf7(0x1d4)];if(_0x43e684)_0x511b06['request'][_0x374cf7(0x246)][_0x374cf7(0x1d4)]=a0_0x3465c4['getEncrypted'](_0x43e684,_0x28461e);}if(_0x511b06?.[_0x374cf7(0x29f)]?.['headers']?.[_0x374cf7(0x1d4)]){const _0xef6040=_0x511b06[_0x374cf7(0x29f)][_0x374cf7(0x246)][_0x374cf7(0x1d4)];if(_0xef6040)_0x511b06[_0x374cf7(0x29f)][_0x374cf7(0x246)][_0x374cf7(0x1d4)]=a0_0x3465c4[_0x374cf7(0x1e0)](_0xef6040,_0x28461e);}if(_0x4b0b6b['config'][_0x374cf7(0x2cf)][_0x374cf7(0x284)])await _0x170d82(_0x511b06);else{const _0xa7cf29=_0x511b06?.[_0x374cf7(0x1ce)]?.[_0x374cf7(0x1eb)]+'\x20'+_0x511b06?.[_0x374cf7(0x1ce)]?.['handle'];_0x52be18[_0x374cf7(0x203)]=_0xa7cf29;switch(_0xa7cf29){case _0x374cf7(0x2e8):case _0x374cf7(0x214):case _0x374cf7(0x26e):if(_0x511b06['routeObj']['id'])await _0x5a2c6f['getHandlerId'](_0x511b06);else await _0x5a2c6f[_0x374cf7(0x2b2)](_0x511b06);break;case _0x374cf7(0x22c):await _0x5a2c6f[_0x374cf7(0x209)](_0x511b06);break;case'GET\x20schemas':await _0x5a2c6f['getHandlerSchemas'](_0x511b06);break;case _0x374cf7(0x2b4):case _0x374cf7(0x27b):await _0x5a2c6f[_0x374cf7(0x22e)](_0x511b06);break;case _0x374cf7(0x201):case _0x374cf7(0x202):await _0x5a2c6f[_0x374cf7(0x2ad)](_0x511b06);break;case _0x374cf7(0x255):await _0x5a2c6f['patchApiHandler'](_0x511b06);break;case _0x374cf7(0x2aa):case _0x374cf7(0x2b9):await _0x5a2c6f[_0x374cf7(0x225)](_0x511b06);break;case'PUT\x20api':await _0x5a2c6f[_0x374cf7(0x1e5)](_0x511b06);break;case _0x374cf7(0x25e):case _0x374cf7(0x257):await _0x5a2c6f[_0x374cf7(0x258)](_0x511b06);break;case _0x374cf7(0x1d9):await _0x5a2c6f[_0x374cf7(0x2d9)](_0x511b06);break;case _0x374cf7(0x248):case'DELETE\x20groups':await _0x5a2c6f['deleteHandler'](_0x511b06);break;case _0x374cf7(0x24a):await _0x5a2c6f['deleteApiHandler'](_0x511b06);break;default:_0x511b06[_0x374cf7(0x1d3)]=new Response(_0x374cf7(0x292),{'status':0x194});}}if(!_0x511b06[_0x374cf7(0x1d3)])_0x511b06[_0x374cf7(0x1d3)]=null;const _0x1c955e=JSON[_0x374cf7(0x22a)](_0x511b06[_0x374cf7(0x1d3)]);_0x882998[_0x374cf7(0x238)](_0x1c955e),_0x4b0b6b[_0x374cf7(0x228)][_0x374cf7(0x273)](_0x5a8659+_0x374cf7(0x253)+_0x52be18[_0x374cf7(0x203)]+_0x374cf7(0x235)+(_0x52be18['obj']?JSON[_0x374cf7(0x22a)](_0x52be18[_0x374cf7(0x217)]):'')+_0x374cf7(0x2e0)+(_0x52be18['id']?_0x52be18['id']:'')+_0x374cf7(0x274)+_0x1c955e+_0x36cc26);}catch(_0x239fcb){const _0x157214=_0x374cf7(0x247)+_0x239fcb[_0x374cf7(0x1de)]+_0x374cf7(0x22f)+_0x239fcb[_0x374cf7(0x2bd)]+'\x22}';_0x882998[_0x374cf7(0x238)](_0x157214),_0x4b0b6b[_0x374cf7(0x228)][_0x374cf7(0x273)]((_0x5a8659||'')+_0x374cf7(0x253)+_0x52be18[_0x374cf7(0x203)]+',\x20obj='+(_0x52be18[_0x374cf7(0x217)]?JSON[_0x374cf7(0x22a)](_0x52be18['obj']):'')+',\x20id='+(_0x52be18['id']?_0x52be18['id']:'')+_0x374cf7(0x2e7)+_0x157214+_0x36cc26);}}};if(_0xcb4bf9)_0x344e7d();else _0x33c2ea();},_0x34010c=async(_0x8cf3d,_0x5cc98b)=>{const _0x296e21=_0x242833,_0x4ea637=_0x1aa199[_0x8cf3d]['config']?.['nats']?.[_0x296e21(0x2db)];let _0x1b7e09=0x0;for await(const _0x41a8ba of _0x5cc98b[_0x296e21(0x21d)]()){switch(_0x41a8ba['type']){case _0x296e21(0x286):_0x4b0b6b[_0x296e21(0x228)]['error'](_0x4b0b6b[_0x296e21(0x2d2)]+'['+_0x4b0b6b[_0x296e21(0x23c)]+_0x296e21(0x21b)+_0x8cf3d+']['+_0x4ea637+_0x296e21(0x1df)+_0x41a8ba['data']+_0x296e21(0x220)),_0x1b7e09=0x0;break;case'reconnect':_0x4b0b6b[_0x296e21(0x228)][_0x296e21(0x273)](_0x4b0b6b['gwName']+'['+_0x4b0b6b[_0x296e21(0x23c)]+_0x296e21(0x21b)+_0x8cf3d+']['+_0x4ea637+_0x296e21(0x23e)+_0x41a8ba[_0x296e21(0x1f6)]);break;case _0x296e21(0x24e):_0x4b0b6b[_0x296e21(0x228)][_0x296e21(0x24e)](_0x4b0b6b[_0x296e21(0x2d2)]+'['+_0x4b0b6b[_0x296e21(0x23c)]+_0x296e21(0x21b)+_0x8cf3d+']['+_0x4ea637+_0x296e21(0x1fa)+_0x41a8ba[_0x296e21(0x1f6)]);break;case'reconnecting':_0x1b7e09+=0x1;_0x1b7e09%0x1e===0x0&&_0x4b0b6b[_0x296e21(0x228)][_0x296e21(0x299)](_0x4b0b6b[_0x296e21(0x2d2)]+'['+_0x4b0b6b[_0x296e21(0x23c)]+']\x20subscriber['+_0x8cf3d+']['+_0x4ea637+_0x296e21(0x1ff)+_0x41a8ba['data']+_0x296e21(0x1db)+_0x1b7e09+')');break;case _0x296e21(0x242):_0x4b0b6b[_0x296e21(0x228)]['debug'](_0x4b0b6b['gwName']+'['+_0x4b0b6b[_0x296e21(0x23c)]+_0x296e21(0x21b)+_0x8cf3d+']['+_0x4ea637+']\x20client\x20has\x20a\x20stale\x20connection\x20'+_0x41a8ba[_0x296e21(0x1f6)]);break;}}};process['on']('SIGTERM',async()=>{const _0x356cc1=_0x242833;for(const _0x3ea6c1 in _0x1aa199){_0x1aa199[_0x3ea6c1]['nc']&&!_0x1aa199[_0x3ea6c1]['nc']['isClosed']()&&await _0x1aa199[_0x3ea6c1]['nc'][_0x356cc1(0x2d5)]();}}),process['on'](_0x242833(0x2cc),async()=>{const _0x58fc00=_0x242833;for(const _0x2095a0 in _0x1aa199){_0x1aa199[_0x2095a0]['nc']&&!_0x1aa199[_0x2095a0]['nc'][_0x58fc00(0x2de)]()&&await _0x1aa199[_0x2095a0]['nc'][_0x58fc00(0x2d5)]();}});const _0x3f896a=async(_0x2bd130,_0x1ebb15,_0x4f78cf)=>{const _0x46f6ae=_0x242833,_0x538bf4={'attribute':_0x1ebb15,'operator':'eq','value':_0x4f78cf,'rawFilter':undefined,'startIndex':undefined,'count':undefined},_0x365d43=[_0x1ebb15];if(_0x1ebb15!=='id')_0x365d43[_0x46f6ae(0x260)]('id');try{const _0x467ea5=await _0x887639(_0x2bd130,_0x538bf4,_0x365d43);if(!_0x467ea5||!_0x467ea5[_0x46f6ae(0x29b)]||!Array[_0x46f6ae(0x243)](_0x467ea5[_0x46f6ae(0x29b)]))throw new Error(_0x46f6ae(0x227)+JSON[_0x46f6ae(0x22a)](_0x538bf4)+_0x46f6ae(0x254));if(_0x467ea5['Resources'][_0x46f6ae(0x269)]===0x0)return null;else{if(_0x467ea5['Resources']['length']>0x2)throw new Error(_0x46f6ae(0x227)+JSON[_0x46f6ae(0x22a)](_0x538bf4)+_0x46f6ae(0x272));else{const _0x4796d0=_0x467ea5[_0x46f6ae(0x29b)][0x0];if(!_0x4796d0['id'])throw new Error(_0x46f6ae(0x227)+JSON[_0x46f6ae(0x22a)](_0x538bf4)+_0x46f6ae(0x25d)+JSON[_0x46f6ae(0x22a)](_0x4796d0)+_0x46f6ae(0x290));return decodeURIComponent(_0x4796d0['id']);}}}catch(_0x1b6cad){throw new Error(_0x46f6ae(0x227)+JSON['stringify'](_0x538bf4)+'\x20error:\x20'+_0x1b6cad[_0x46f6ae(0x1de)]+'}');}},_0x887639=async(_0x567c53,_0x5d2083,_0x227845)=>{const _0x3baa47=_0x242833;if(!_0x417e52)return await _0x4b0b6b[_0x3baa47(0x20d)](_0x567c53,_0x5d2083,_0x227845);if(!_0x5d2083?.[_0x3baa47(0x1d8)]||_0x5d2083[_0x3baa47(0x1d8)]!=='eq')throw new Error('getUsers()\x20error:\x20unsupported\x20operator\x20for\x20getObj:\x20'+JSON[_0x3baa47(0x22a)](_0x5d2083));if(_0x567c53===_0x3baa47(0x205))_0x567c53=undefined;let _0x2e8912=_0x567c53?'/'+_0x567c53+_0x3baa47(0x28d):'/Users';if(_0x5d2083[_0x3baa47(0x1f1)]==='id'){_0x2e8912+='/'+_0x5d2083[_0x3baa47(0x28a)];if(_0x227845&&_0x227845[_0x3baa47(0x269)]>0x0)_0x2e8912+=_0x3baa47(0x2ea)+_0x227845[_0x3baa47(0x256)](',');}else{if(_0x5d2083[_0x3baa47(0x1f1)]==='userName'){_0x2e8912+=_0x3baa47(0x2f1)+_0x5d2083['value']+'\x22';if(_0x227845&&_0x227845[_0x3baa47(0x269)]>0x0)_0x2e8912+=_0x3baa47(0x222)+_0x227845['join'](',');}else{if(_0x5d2083[_0x3baa47(0x1f1)]==='externalId'){_0x2e8912+='?filter=externalId\x20eq\x20\x22'+_0x5d2083['value']+'\x22';if(_0x227845&&_0x227845[_0x3baa47(0x269)]>0x0)_0x2e8912+='&attributes='+_0x227845[_0x3baa47(0x256)](',');}else throw new Error(_0x3baa47(0x20a)+JSON['stringify'](_0x5d2083));}}return await _0x3a3d7f(_0x567c53,_0x3baa47(0x2f4),_0x2e8912);},_0x1178d1=async(_0x89545d,_0x51fce7)=>{const _0x8c93c1=_0x242833;if(!_0x417e52)return await _0x4b0b6b[_0x8c93c1(0x25b)](_0x89545d,_0x51fce7);if(_0x89545d===_0x8c93c1(0x205))_0x89545d=undefined;const _0x436b3c=_0x89545d?'/'+_0x89545d+'/Users':_0x8c93c1(0x28d);return await _0x3a3d7f(_0x89545d,_0x8c93c1(0x2ab),_0x436b3c,_0x51fce7);},_0x56424d=async(_0x571dc6,_0x1874c5,_0x13b6b7,_0x1dc56f,_0x293bd5)=>{const _0x569e73=_0x242833;if(!_0x571dc6||_0x571dc6['toLowerCase']()!=='users')throw new Error(_0x569e73(0x24b));if(!_0x417e52)return await _0x5a2c6f[_0x569e73(0x2ce)](_0x569e73(0x2f2),_0x1874c5,_0x13b6b7,_0x1dc56f,_0x293bd5);if(_0x1874c5===_0x569e73(0x205))_0x1874c5=undefined;const _0x3c84df=_0x1874c5?'/'+_0x1874c5+_0x569e73(0x2ba)+_0x13b6b7:_0x569e73(0x2ba)+_0x13b6b7;return await _0x3a3d7f(_0x1874c5,_0x569e73(0x1d2),_0x3c84df,_0x1dc56f);},_0x16e7e7=async(_0xc6316f,_0x6c0822)=>{const _0x1a1d51=_0x242833;!_0x417e52&&await _0x4b0b6b[_0x1a1d51(0x2d1)](_0xc6316f,_0x6c0822);if(_0xc6316f==='undefined')_0xc6316f=undefined;const _0x3e6ae7=_0xc6316f?'/'+_0xc6316f+_0x1a1d51(0x2ba)+_0x6c0822:'/Users/'+_0x6c0822;return await _0x3a3d7f(_0xc6316f,_0x1a1d51(0x212),_0x3e6ae7);},_0x30b1b9=_0x52e69b=>{const _0x5dbd7b=_0x242833;if(!_0x52e69b||typeof _0x52e69b!==_0x5dbd7b(0x2c7))return[null,null];_0x52e69b=_0x52e69b[_0x5dbd7b(0x200)]();const _0x310e52=_0x52e69b['indexOf']('(');if(_0x310e52<0x1)return[null,null];if(_0x52e69b[_0x5dbd7b(0x2ae)](_0x52e69b[_0x5dbd7b(0x269)]-0x1)!==')')return[null,null];if(_0xb8da3f(_0x52e69b,'(')!==_0xb8da3f(_0x52e69b,')'))return[null,null];const _0x2d99b7=_0x52e69b[_0x5dbd7b(0x2ae)](0x0,_0x310e52),_0x51c2a1=_0x52e69b[_0x5dbd7b(0x2ae)](_0x310e52+0x1,_0x52e69b[_0x5dbd7b(0x269)]-0x1);let _0x51601c=[];const _0x292da8=_0x51c2a1[_0x5dbd7b(0x2b7)](',');let _0x56cdea='';for(let _0xc9f36b=0x0;_0xc9f36b<_0x292da8['length'];_0xc9f36b++){const _0x4ab97a=_0x56cdea?_0x56cdea+','+_0x292da8[_0xc9f36b]:_0x292da8[_0xc9f36b],_0x284701=_0xb8da3f(_0x4ab97a,'('),_0x516bce=_0xb8da3f(_0x4ab97a,')');if(_0x284701===_0x516bce)_0x51601c[_0x5dbd7b(0x260)](_0x371062(_0x4ab97a,'\x22')),_0x56cdea='';else{if(_0x56cdea)_0x56cdea+=','+_0x292da8[_0xc9f36b];else _0x56cdea+=_0x292da8[_0xc9f36b];}}if(_0x51601c['length']===0x0)_0x51601c=null;return[_0x2d99b7,_0x51601c];};function _0xb8da3f(_0x37bf7c,_0x499b6b){const _0x42bb1c=_0x242833;let _0x64028c=0x0;for(let _0xbccde6=0x0;_0xbccde6<_0x37bf7c[_0x42bb1c(0x269)];_0xbccde6++){_0x37bf7c[_0x42bb1c(0x2f5)](_0xbccde6)===_0x499b6b&&(_0x64028c+=0x1);}return _0x64028c;}const _0x371062=(_0x36cad9,_0x57d269)=>{const _0x290903=_0x242833;if(typeof _0x36cad9!==_0x290903(0x2c7)||typeof _0x57d269!==_0x290903(0x2c7))return _0x36cad9;if(_0x36cad9[_0x290903(0x269)]===0x1)return _0x36cad9;if(_0x57d269['length']!==0x1)return _0x36cad9;return _0x36cad9=_0x36cad9[_0x290903(0x200)](),_0x36cad9[_0x290903(0x2ae)](0x0,0x1)===_0x57d269&&(_0x36cad9=_0x36cad9[_0x290903(0x2ae)](0x1)),_0x36cad9[_0x290903(0x2ae)](_0x36cad9[_0x290903(0x269)]-0x1)===_0x57d269&&(_0x36cad9=_0x36cad9[_0x290903(0x2ae)](0x0,_0x36cad9['length']-0x1)),_0x36cad9;},_0x68548=async(_0x4b8c9b,_0x73e938,_0x59e8db,_0x58286b)=>{const _0x2a82ad=_0x242833;if(!_0x73e938||!_0x59e8db||!_0x58286b)return null;const [_0xe54983,_0x66107a]=_0x30b1b9(_0x58286b);if(!_0xe54983||!_0x66107a){const _0x11526a=_0x58286b[_0x2a82ad(0x2b7)]('(');if(_0x11526a['length']>0x1){const _0x2ff862=[_0x2a82ad(0x1fc),_0x2a82ad(0x2c1),_0x2a82ad(0x2df),'elementnumber','join',_0x2a82ad(0x1d6),_0x2a82ad(0x2c8),'increment',_0x2a82ad(0x2e3)],_0x336924=_0x11526a[0x0][_0x2a82ad(0x2bf)]();if(_0x2ff862[_0x2a82ad(0x21e)](_0x336924))return null;}return _0x58286b;}for(let _0x2f53f2=0x0;_0x2f53f2<_0x66107a[_0x2a82ad(0x269)];_0x2f53f2++){if(_0x66107a[_0x2f53f2][_0x2a82ad(0x2ae)](0x0,0x1)==='['){const _0x590007=_0x66107a[_0x2f53f2][_0x2a82ad(0x1e9)](']');if(_0x590007<0x0)return null;const _0x5984dc=_0x66107a[_0x2f53f2][_0x2a82ad(0x2ae)](0x1,_0x590007),_0x67cab9=_0x5984dc[_0x2a82ad(0x2b7)]('.');let _0x126ebf;for(let _0x2582df=0x0;_0x2582df<_0x67cab9[_0x2a82ad(0x269)];_0x2582df++){if(_0x2582df===0x0)_0x126ebf=_0x73e938[_0x67cab9[_0x2582df]];else{if(!_0x126ebf)return null;_0x126ebf=_0x126ebf[_0x67cab9[_0x2582df]];}}if(!_0x126ebf)return null;_0x66107a[_0x2f53f2]=_0x126ebf;}}for(let _0x5ea7e2=0x0;_0x5ea7e2<_0x66107a[_0x2a82ad(0x269)];_0x5ea7e2++){const [_0xbd4938]=_0x30b1b9(_0x66107a[_0x5ea7e2]);_0xbd4938&&(_0x66107a[_0x5ea7e2]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0x66107a[_0x5ea7e2]));}if(_0x66107a[0x0]===null)return null;switch(_0xe54983['toLowerCase']()){case _0x2a82ad(0x1fc):{if(_0x66107a['length']!==0x1)return null;const [_0xd51cb2]=_0x30b1b9(_0x66107a[0x0]);if(_0xd51cb2)_0x66107a[0x0]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0xd51cb2);if(_0x66107a[0x0]===null)return null;return _0x66107a[0x0][_0x2a82ad(0x2bf)]();}case _0x2a82ad(0x2c1):{if(_0x66107a[_0x2a82ad(0x269)]!==0x1)return null;const [_0xc3ace7]=_0x30b1b9(_0x66107a[0x0]);if(_0xc3ace7)_0x66107a[0x0]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0xc3ace7);if(_0x66107a[0x0]===null)return null;return _0x66107a[0x0][_0x2a82ad(0x2ef)]();}case _0x2a82ad(0x2df):{if(_0x66107a[_0x2a82ad(0x269)]!==0x2)return null;const [_0x5740bc]=_0x30b1b9(_0x66107a[0x0]);if(_0x5740bc)_0x66107a[0x0]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0x5740bc);if(_0x66107a[0x0]===null)return null;if(isNaN(_0x66107a[0x1]))return null;return _0x66107a[0x0]['substring'](0x0,_0x66107a[0x1]);}case _0x2a82ad(0x1e7):{const [_0x57f2e6]=_0x30b1b9(_0x66107a[0x0]);if(_0x66107a['length']<0x2)return null;if(_0x57f2e6)_0x66107a[0x0]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0x57f2e6);if(_0x66107a[0x0]===null)return null;const _0x9338ff=_0x66107a[0x1];if(isNaN(_0x9338ff))return null;let _0x502ed5;if(_0x66107a['length']===0x3)_0x502ed5=_0x66107a[0x0][_0x2a82ad(0x2b7)](_0x66107a[0x2]);else _0x502ed5=_0x502ed5=_0x66107a[0x0][_0x2a82ad(0x2b7)]('\x20');if(_0x9338ff<=_0x502ed5[_0x2a82ad(0x269)])return _0x502ed5[_0x9338ff-0x1];else return'';}case _0x2a82ad(0x1d6):{const [_0x3073d8]=_0x30b1b9(_0x66107a[0x0]);if(_0x3073d8)_0x66107a[0x0]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0x3073d8);if(_0x66107a[0x0]===null)return null;if(_0x66107a[_0x2a82ad(0x269)]!==0x3)return null;return _0x66107a[0x0][_0x2a82ad(0x2d4)](_0x66107a[0x1],_0x66107a[0x2]);}case'normalize':{if(_0x66107a[_0x2a82ad(0x269)]!==0x1)return null;const [_0x2b9e28]=_0x30b1b9(_0x66107a[0x0]);if(_0x2b9e28)_0x66107a[0x0]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0x2b9e28);if(_0x66107a[0x0]===null)return null;return a0_0x1db494[_0x2a82ad(0x28e)](_0x66107a[0x0]);}case _0x2a82ad(0x256):{let _0x11e8db='';for(let _0x2bdfce=0x0;_0x2bdfce<_0x66107a['length'];_0x2bdfce++){const [_0xf59a82]=_0x30b1b9(_0x66107a[_0x2bdfce]);if(_0xf59a82)_0x66107a[_0x2bdfce]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0xf59a82);if(_0x66107a[_0x2bdfce]===null)return null;_0x11e8db+=_0x66107a[_0x2bdfce];}return _0x11e8db;}case _0x2a82ad(0x2d3):{if(_0x66107a[_0x2a82ad(0x269)]>0x2)return null;const [_0x3d8b24]=_0x30b1b9(_0x66107a[0x0]);if(_0x3d8b24)_0x66107a[0x0]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0x3d8b24);if(_0x66107a[0x0]===null)return null;const _0x4dd0f0=parseInt(_0x66107a[0x0]);if(isNaN(_0x4dd0f0))return null;let _0xacaf04=_0x2a82ad(0x2b5);_0xacaf04+=','+_0x66107a[0x0];if(_0x66107a['length']===0x2&&_0x66107a[0x1]['toLowerCase']()===_0x2a82ad(0x232))_0xacaf04+=',true';else _0xacaf04+=',false';return _0xacaf04+='##',_0xacaf04;}case _0x2a82ad(0x2e3):{if(_0x66107a[_0x2a82ad(0x269)]!==0x1)return null;const [_0x4d5783]=_0x30b1b9(_0x66107a[0x0]);if(_0x4d5783)_0x66107a[0x0]=await _0x68548(_0x4b8c9b,_0x73e938,_0x59e8db,_0x4d5783);if(_0x66107a[0x0]===null)return null;let _0x507a94,_0x2f3297=![],_0x56ddf7='';const _0x5c29eb=_0x66107a[0x0][_0x2a82ad(0x2b7)]('##');if(_0x5c29eb[_0x2a82ad(0x269)]>0x2)for(let _0x5ebf24=0x0;_0x5ebf24<_0x5c29eb['length'];_0x5ebf24++){if(_0x5c29eb[_0x5ebf24][_0x2a82ad(0x2a2)](_0x2a82ad(0x25c))){const _0x5ba582=_0x5c29eb[_0x5ebf24][_0x2a82ad(0x2b7)](',');if(_0x5ba582[_0x2a82ad(0x269)]<0x2)return null;const _0x2f28ac=parseInt(_0x5ba582[0x1]);if(isNaN(_0x2f28ac))return null;_0x56ddf7='##'+_0x5c29eb[_0x5ebf24]+'##',_0x507a94=_0x5ba582[0x1],_0x5ba582[_0x2a82ad(0x269)]>0x2&&(_0x2f3297=_0x5ba582[0x2]['toLowerCase']()===_0x2a82ad(0x232));}}let _0x22f1aa,_0x56d6a4=0x0,_0x227e72=0x0;if(_0x507a94){_0x227e72=_0x507a94['length'],_0x56d6a4=0xa;for(let _0xf702c8=0x1;_0xf702c8<_0x227e72;_0xf702c8++){_0x56d6a4*=0xa;}_0x56d6a4-=0x1,_0x22f1aa=parseInt(_0x507a94);if(isNaN(_0x22f1aa))return null;_0x22f1aa-=0x1;}else _0x22f1aa=0x0;do{_0x22f1aa+=0x1;let _0x492854=_0x66107a[0x0];if(_0x507a94!==undefined&&_0x56ddf7){let _0x17d171=_0x22f1aa[_0x2a82ad(0x27f)]();while(_0x17d171['length']<_0x227e72){_0x17d171='0'+_0x17d171;}_0x2f3297?_0x492854=_0x492854[_0x2a82ad(0x1d6)](_0x56ddf7,_0x17d171):(_0x492854=_0x492854[_0x2a82ad(0x1d6)](_0x56ddf7,''),_0x2f3297=!![],_0x22f1aa-=0x1);}try{const _0x69b797=await _0x3f896a(_0x4b8c9b,_0x59e8db,_0x492854);if(!_0x69b797)return _0x492854;}catch(_0x4c24fe){return _0x4b0b6b[_0x2a82ad(0x228)][_0x2a82ad(0x24e)](_0x4b0b6b[_0x2a82ad(0x2d2)]+'['+_0x4b0b6b['pluginName']+']\x20'+_0xe54983+_0x2a82ad(0x26b)+_0x4c24fe[_0x2a82ad(0x1de)]),null;}}while(_0x22f1aa<_0x56d6a4);return null;}default:}return null;},_0x5583cc=async(_0x2218cb,_0x571a0b)=>{const _0x1b5692=_0x242833;for(const _0x2ea401 in _0x571a0b){const _0x25c9b7=_0x571a0b[_0x2ea401],[_0x1993fd,_0x4a0f67]=_0x30b1b9(_0x25c9b7);if(_0x1993fd){const _0x4e7685=''+_0x2ea401,_0x5022ab=_0x1993fd+'('+_0x4a0f67[_0x1b5692(0x256)](',')+')',_0x22454c=await _0x68548(_0x2218cb,_0x571a0b,_0x4e7685,_0x5022ab);if(_0x22454c===null)delete _0x571a0b[_0x2ea401];else _0x571a0b[_0x2ea401]=_0x22454c;}for(const _0x2edb32 in _0x25c9b7){const _0x12472d=_0x25c9b7[_0x2edb32],[_0xbf543e,_0x1aca6a]=_0x30b1b9(_0x12472d);if(_0xbf543e){const _0xf28ed4=_0x2ea401+'.'+_0x2edb32,_0x19f05c=_0xbf543e+'('+_0x1aca6a['join'](',')+')',_0x2c91dc=await _0x68548(_0x2218cb,_0x571a0b,_0xf28ed4,_0x19f05c);if(_0x2c91dc===null)delete _0x25c9b7[_0x2edb32];else _0x25c9b7[_0x2edb32]=_0x2c91dc;}}}return _0x571a0b;},_0x3a3d7f=async(_0x5e6546,_0x87f5a3,_0x5c939c,_0x247516)=>{const _0x588428=_0x242833;if(!_0x417e52)throw new Error(_0x588428(0x1f9));if(!_0x4908e9)throw new Error(_0x588428(0x206));try{if(!_0x4b0b6b['helperRest'])_0x4b0b6b[_0x588428(0x283)]=_0x4b0b6b[_0x588428(0x2a4)]();const _0x4d0fa8={'headers':{'Authorization':_0x4908e9}},_0xef30ac=await _0x4b0b6b[_0x588428(0x283)][_0x588428(0x1f3)](undefined,_0x87f5a3,_0x417e52+_0x5c939c,_0x247516,undefined,_0x4d0fa8);return _0xef30ac[_0x588428(0x20e)];}catch(_0x389557){try{const _0x440ce2=JSON[_0x588428(0x266)](_0x389557['message']);if(_0x440ce2[_0x588428(0x20e)])throw new Error(JSON[_0x588428(0x22a)](_0x440ce2[_0x588428(0x20e)]));throw new Error(_0x389557[_0x588428(0x1de)]);}catch(_0x3d00af){throw new Error(_0x588428(0x1e1)+_0x3d00af['message']);}}},_0x170d82=async _0x2602ee=>{const _0x135525=_0x242833,_0x4053c8=_0x4b0b6b[_0x135525(0x215)][_0x135525(0x2cf)]['chainingBaseUrl'];if(!_0x4053c8){_0x2602ee[_0x135525(0x1d3)][_0x135525(0x21d)]=0x1f4,_0x4b0b6b[_0x135525(0x228)][_0x135525(0x24e)](_0x4b0b6b[_0x135525(0x2d2)]+'['+_0x4b0b6b[_0x135525(0x23c)]+']\x20onChainingHandler\x20error:\x20configuration\x20scimgateway.chainingBaseUrl\x20missing');return;}try{new URL(_0x4053c8);}catch(_0x551c70){_0x2602ee[_0x135525(0x1d3)][_0x135525(0x21d)]=0x1f4,_0x4b0b6b['logger']['error'](_0x4b0b6b[_0x135525(0x2d2)]+'['+_0x4b0b6b['pluginName']+_0x135525(0x2af)+_0x551c70['message']);return;}try{if(!_0x4b0b6b[_0x135525(0x283)])_0x4b0b6b[_0x135525(0x283)]=_0x4b0b6b[_0x135525(0x2a4)]();const _0x9ffea3=new URL(_0x2602ee['request'][_0x135525(0x297)]),_0x288398=_0x2602ee['request']['method'],_0x133073=_0x2602ee[_0x135525(0x2ed)][_0x135525(0x297)][_0x135525(0x1d6)](_0x9ffea3[_0x135525(0x1ef)],_0x4053c8),_0x5bfaf0=_0x2602ee[_0x135525(0x2ed)][_0x135525(0x20e)],_0xbc5994={'headers':{'Authorization':_0x2602ee[_0x135525(0x2ed)][_0x135525(0x246)][_0x135525(0x1d4)]}},_0x406146=await _0x4b0b6b[_0x135525(0x283)][_0x135525(0x1f3)](_0x135525(0x205),_0x288398,_0x133073,_0x5bfaf0,undefined,_0xbc5994);_0x2602ee[_0x135525(0x1d3)][_0x135525(0x21d)]=_0x406146[_0x135525(0x277)];try{_0x2602ee[_0x135525(0x1d3)][_0x135525(0x20e)]=JSON['stringify'](_0x406146[_0x135525(0x20e)]);}catch(_0x5b51a0){_0x2602ee[_0x135525(0x1d3)][_0x135525(0x20e)]=_0x406146[_0x135525(0x20e)];}}catch(_0x508c6c){try{const _0x7dc66=JSON[_0x135525(0x266)](_0x508c6c[_0x135525(0x1de)]);_0x2602ee['response'][_0x135525(0x21d)]=_0x7dc66?.['body']?.[_0x135525(0x21d)]||_0x7dc66?.[_0x135525(0x277)]||0x1f4,_0x2602ee[_0x135525(0x1d3)][_0x135525(0x20e)]=_0x7dc66[_0x135525(0x20e)]?JSON[_0x135525(0x22a)](_0x7dc66[_0x135525(0x20e)]):_0x508c6c[_0x135525(0x1de)];}catch(_0x5232b5){_0x2602ee[_0x135525(0x1d3)][_0x135525(0x21d)]=0x1f4,_0x4b0b6b[_0x135525(0x228)][_0x135525(0x24e)](_0x4b0b6b['gwName']+'['+_0x4b0b6b[_0x135525(0x23c)]+']\x20onChainingHandler\x20error:\x20'+_0x508c6c[_0x135525(0x1de)]);}}};}}export class Publisher{constructor(_0x282650){const _0x1f62f9=a0_0xecb8,_0x360a2e=_0x282650,_0x2108c4={},_0xd1b037=async(_0x259702,_0x2630c4)=>{const _0xd12941=a0_0xecb8,_0x2b19ee=_0x2108c4[_0x259702]['config']?.[_0xd12941(0x249)]?.['subject'];let _0x438d33=0x0;for await(const _0xc86bee of _0x2630c4[_0xd12941(0x21d)]()){switch(_0xc86bee['type']){case _0xd12941(0x286):_0x360a2e[_0xd12941(0x228)]['error'](_0x360a2e[_0xd12941(0x2d2)]+'['+_0x360a2e['pluginName']+_0xd12941(0x2f9)+_0x259702+']['+_0x2b19ee+_0xd12941(0x1df)+_0xc86bee[_0xd12941(0x1f6)]+'\x20-\x20will\x20do\x20auto\x20reconnect\x20when\x20connection\x20becomes\x20available'),_0x438d33=0x0;break;case'reconnect':_0x360a2e[_0xd12941(0x228)][_0xd12941(0x273)](_0x360a2e[_0xd12941(0x2d2)]+'['+_0x360a2e[_0xd12941(0x23c)]+_0xd12941(0x2f9)+_0x259702+']['+_0x2b19ee+']\x20client\x20reconnected\x20'+_0xc86bee[_0xd12941(0x1f6)]);break;case _0xd12941(0x24e):_0x360a2e[_0xd12941(0x228)][_0xd12941(0x24e)](_0x360a2e[_0xd12941(0x2d2)]+'['+_0x360a2e['pluginName']+_0xd12941(0x2f9)+_0x259702+']['+_0x2b19ee+']\x20client\x20error\x20'+_0xc86bee[_0xd12941(0x1f6)]);break;case _0xd12941(0x278):_0x438d33+=0x1;_0x438d33%0x1e===0x0&&_0x360a2e['logger']['debug'](_0x360a2e[_0xd12941(0x2d2)]+'['+_0x360a2e[_0xd12941(0x23c)]+_0xd12941(0x2f9)+_0x259702+']['+_0x2b19ee+_0xd12941(0x1ff)+_0xc86bee['data']+'\x20(count='+_0x438d33+')');break;case'staleConnection':_0x360a2e[_0xd12941(0x228)][_0xd12941(0x299)](_0x360a2e[_0xd12941(0x2d2)]+'['+_0x360a2e[_0xd12941(0x23c)]+']\x20publisher['+_0x259702+']['+_0x2b19ee+_0xd12941(0x2a8)+_0xc86bee[_0xd12941(0x1f6)]);break;}}},_0x75ee59=async(_0x36170d,_0x2846ca)=>{const _0x23301d=a0_0xecb8,_0x43e123=_0x2108c4[_0x36170d][_0x23301d(0x215)]?.['nats']?.[_0x23301d(0x2db)];let _0x1c94b8;try{_0x1c94b8=await a0_0x378352(_0x2846ca);if(_0x1c94b8['info'][_0x23301d(0x1f0)]!==_0x23301d(0x288)){_0x1c94b8['close']();return;}_0x2108c4[_0x36170d]['nc']=_0x1c94b8,_0xd1b037(_0x36170d,_0x1c94b8);}catch(_0x9710f9){_0x360a2e[_0x23301d(0x228)][_0x23301d(0x24e)](_0x360a2e[_0x23301d(0x2d2)]+'['+_0x360a2e[_0x23301d(0x23c)]+_0x23301d(0x2f9)+_0x36170d+']['+_0x43e123+_0x23301d(0x2dd)+_0x9710f9[_0x23301d(0x1de)]+_0x23301d(0x1e3)),_0x2846ca['waitOnFirstConnect']=!![];try{_0x1c94b8=await a0_0x378352(_0x2846ca);if(_0x1c94b8['info'][_0x23301d(0x1f0)]!==_0x23301d(0x288)){_0x1c94b8['close']();return;}_0x2108c4[_0x36170d]['nc']=_0x1c94b8,_0xd1b037(_0x36170d,_0x1c94b8);}catch(_0x2a65fc){_0x360a2e['logger'][_0x23301d(0x24e)](_0x360a2e[_0x23301d(0x2d2)]+'['+_0x360a2e[_0x23301d(0x23c)]+_0x23301d(0x2f9)+_0x36170d+']['+_0x43e123+_0x23301d(0x2dd)+_0x2a65fc[_0x23301d(0x1de)]);return;}}_0x360a2e['logger'][_0x23301d(0x299)](_0x360a2e[_0x23301d(0x2d2)]+'['+_0x360a2e[_0x23301d(0x23c)]+_0x23301d(0x2f9)+_0x36170d+']['+_0x43e123+']\x20connected\x20'+(_0x2846ca[_0x23301d(0x204)]['ca']?_0x23301d(0x204):'')+'\x20'+_0x1c94b8[_0x23301d(0x231)]()),_0x1c94b8[_0x23301d(0x240)]()[_0x23301d(0x2d8)](_0x3dcd80=>{const _0x2b5f22=_0x23301d;_0x3dcd80&&_0x360a2e['logger'][_0x2b5f22(0x24e)](_0x360a2e[_0x2b5f22(0x2d2)]+'['+_0x360a2e[_0x2b5f22(0x23c)]+_0x2b5f22(0x2f9)+_0x36170d+']['+_0x43e123+_0x2b5f22(0x1fd)+_0x3dcd80[_0x2b5f22(0x1de)]);});};this['add']=async(_0x5c6882,_0xde7e6b)=>{const _0x18c783=a0_0xecb8;if(!_0xde7e6b?.[_0x18c783(0x249)]){_0x360a2e[_0x18c783(0x228)]['error'](_0x360a2e['gwName']+'['+_0x360a2e[_0x18c783(0x23c)]+_0x18c783(0x2f9)+_0x5c6882+_0x18c783(0x1ed));return;}if(!_0xde7e6b?.[_0x18c783(0x249)]?.[_0x18c783(0x23d)]){_0x360a2e[_0x18c783(0x228)][_0x18c783(0x24e)](_0x360a2e[_0x18c783(0x2d2)]+'['+_0x360a2e[_0x18c783(0x23c)]+_0x18c783(0x2f9)+_0x5c6882+']\x20initialization\x20error:\x20missing\x20configuration\x20nats.tenant');return;}if(!_0xde7e6b?.[_0x18c783(0x249)]?.[_0x18c783(0x2db)]){_0x360a2e[_0x18c783(0x228)][_0x18c783(0x24e)](_0x360a2e[_0x18c783(0x2d2)]+'['+_0x360a2e[_0x18c783(0x23c)]+']\x20publisher['+_0x5c6882+_0x18c783(0x22d));return;}if(!_0xde7e6b?.[_0x18c783(0x249)]?.[_0x18c783(0x2db)][_0x18c783(0x2a2)]('GW.')){_0x360a2e['logger'][_0x18c783(0x24e)](_0x360a2e[_0x18c783(0x2d2)]+'['+_0x360a2e[_0x18c783(0x23c)]+_0x18c783(0x2f9)+_0x5c6882+_0x18c783(0x279));return;}if(!_0xde7e6b[_0x18c783(0x2f8)]||!Array['isArray'](_0xde7e6b[_0x18c783(0x2f8)])||_0xde7e6b[_0x18c783(0x2f8)][_0x18c783(0x269)]<0x1){_0x360a2e[_0x18c783(0x228)]['error'](_0x360a2e['gwName']+'['+_0x360a2e['pluginName']+_0x18c783(0x2f9)+_0x5c6882+_0x18c783(0x22b));return;}if(!_0xde7e6b?.['certificate']?.['ca']){_0x360a2e[_0x18c783(0x228)]['error'](_0x360a2e['gwName']+'['+_0x360a2e[_0x18c783(0x23c)]+_0x18c783(0x2f9)+_0x5c6882+']\x20initialization\x20error:\x20missing\x20certificate\x20configuration');return;}const _0x112533={};try{let _0xe40604=a0_0x2546bd[_0x18c783(0x256)](_0x360a2e[_0x18c783(0x211)],_0x18c783(0x27c),_0xde7e6b?.[_0x18c783(0x1dd)]?.['ca']||'file-not-configured');(_0xde7e6b?.[_0x18c783(0x1dd)]?.['ca']?.['startsWith']('/')||_0xde7e6b?.[_0x18c783(0x1dd)]?.['ca']?.['includes']('\x5c'))&&(_0xe40604=_0xde7e6b[_0x18c783(0x1dd)]['ca']),_0x112533['ca']=[a0_0x7dda52[_0x18c783(0x234)](_0xe40604)],_0x112533[_0x18c783(0x244)]=!![];}catch(_0x8965c8){_0x360a2e['logger'][_0x18c783(0x24e)](_0x360a2e[_0x18c783(0x2d2)]+'['+_0x360a2e['pluginName']+']\x20publisher['+_0x5c6882+']\x20initialization\x20certificate\x20error:\x20'+_0x8965c8[_0x18c783(0x1de)]);return;}const _0x490b62={},_0x160b25=new TextEncoder()[_0x18c783(0x210)](_0xde7e6b?.['nats']?.[_0x18c783(0x289)]),_0x23dcf7=_0xde7e6b?.[_0x18c783(0x249)]?.[_0x18c783(0x26f)];_0x490b62[_0x18c783(0x1d5)]=jwtAuthenticator(_0x23dcf7,_0x160b25),_0x490b62[_0x18c783(0x1d1)]=_0xde7e6b['baseUrls'],_0x490b62['tls']=_0x112533,_0x490b62[_0x18c783(0x230)]=![],_0x490b62[_0x18c783(0x263)]=!![],_0x490b62[_0x18c783(0x218)]=0x3e8*0xa,_0x490b62['maxReconnectAttempts']=-0x1,_0x490b62[_0x18c783(0x221)]=0x2*0x3c*0x3e8,_0x490b62[_0x18c783(0x293)]=0x5,_0x490b62[_0x18c783(0x299)]=![],_0x2108c4[_0x5c6882]={},_0x2108c4[_0x5c6882]['config']=_0xde7e6b,_0x2108c4[_0x5c6882]['nc']=undefined,_0x75ee59(_0x5c6882,_0x490b62);},this[_0x1f62f9(0x241)]=async _0x8b9869=>{const _0x542f14=_0x1f62f9;let _0x3e2f2e;const _0x2e9f9b=a0_0x368ba7[_0x542f14(0x2b3)]();try{if(_0x8b9869[_0x542f14(0x2c2)]===Object){_0x3e2f2e=_0x8b9869[_0x542f14(0x2a0)];if(!_0x3e2f2e)_0x8b9869['baseEntity']='undefined';if(_0x8b9869?.[_0x542f14(0x298)]?.[_0x542f14(0x2ed)]?.[_0x542f14(0x246)]){const _0x570f0d=_0x8b9869[_0x542f14(0x298)][_0x542f14(0x2ed)][_0x542f14(0x246)][_0x542f14(0x2f6)](_0x542f14(0x1d4));if(_0x570f0d)_0x8b9869[_0x542f14(0x298)][_0x542f14(0x2ed)][_0x542f14(0x246)][_0x542f14(0x1d0)]('authorization',a0_0x3465c4[_0x542f14(0x1e0)](_0x570f0d,_0x2e9f9b));}if(_0x8b9869?.[_0x542f14(0x298)]?.[_0x542f14(0x29f)]?.['headers']){const _0x59b1b9=_0x8b9869[_0x542f14(0x298)][_0x542f14(0x29f)]['headers'][_0x542f14(0x2f6)](_0x542f14(0x1d4));if(_0x59b1b9)_0x8b9869[_0x542f14(0x298)][_0x542f14(0x29f)]['headers'][_0x542f14(0x1d0)](_0x542f14(0x1d4),a0_0x3465c4[_0x542f14(0x1e0)](_0x59b1b9,_0x2e9f9b));}_0x8b9869=JSON[_0x542f14(0x22a)](_0x8b9869);}else{const _0x1d4b6f=JSON['parse'](_0x8b9869);_0x3e2f2e=_0x1d4b6f['baseEntity'];}}catch(_0x2ba630){throw new Error('publisher['+_0x3e2f2e+_0x542f14(0x2da));}if(!_0x2108c4[_0x3e2f2e])throw new Error(_0x542f14(0x1fb)+_0x3e2f2e+_0x542f14(0x2b6)+_0x3e2f2e);const _0x18bd50=headers();_0x18bd50[_0x542f14(0x2c4)]('Msg-Id',_0x2e9f9b);let _0x39525e;try{if(!_0x2108c4[_0x3e2f2e]['nc'])throw new Error('publisher\x20not\x20initialized/connected');_0x39525e=await _0x2108c4[_0x3e2f2e]['nc'][_0x542f14(0x2ed)](_0x2108c4[_0x3e2f2e][_0x542f14(0x215)]?.[_0x542f14(0x249)]?.['subject'],_0x8b9869,{'headers':_0x18bd50});}catch(_0x21ce1a){if(_0x21ce1a[_0x542f14(0x1de)]===_0x542f14(0x20c))throw new Error(_0x542f14(0x1fb)+_0x3e2f2e+_0x542f14(0x280)+_0x2108c4[_0x3e2f2e][_0x542f14(0x215)]?.[_0x542f14(0x249)]?.[_0x542f14(0x2db)]);else throw new Error(_0x542f14(0x1fb)+_0x3e2f2e+_0x542f14(0x270)+_0x21ce1a[_0x542f14(0x1de)]);}let _0x4411ea;try{_0x4411ea=JSON[_0x542f14(0x266)](_0x39525e[_0x542f14(0x2c7)]());try{JSON[_0x542f14(0x266)](_0x4411ea['body']);if(!_0x4411ea[_0x542f14(0x246)])_0x4411ea[_0x542f14(0x246)]={};if(!_0x4411ea[_0x542f14(0x246)][_0x542f14(0x268)])_0x4411ea[_0x542f14(0x246)][_0x542f14(0x268)]=_0x542f14(0x2ec);}catch(_0x6abcbe){void 0x0;}}catch(_0x224454){throw new Error(_0x542f14(0x2a5)+_0x39525e['string']());}if(_0x4411ea?.['error']){const _0x60fd35=new Error(_0x542f14(0x2e6)+_0x4411ea[_0x542f14(0x24e)]);_0x60fd35[_0x542f14(0x2bd)]=_0x4411ea[_0x542f14(0x271)];throw _0x60fd35;}return _0x4411ea;},process['on'](_0x1f62f9(0x224),async()=>{const _0x298a46=_0x1f62f9;for(const _0x15f8be in _0x2108c4){_0x2108c4[_0x15f8be]['nc']&&!_0x2108c4[_0x15f8be]['nc'][_0x298a46(0x2de)]()&&await _0x2108c4[_0x15f8be]['nc']['drain']();}}),process['on'](_0x1f62f9(0x2cc),async()=>{const _0xbec881=_0x1f62f9;for(const _0x1c2d0a in _0x2108c4){_0x2108c4[_0x1c2d0a]['nc']&&!_0x2108c4[_0x1c2d0a]['nc']['isClosed']()&&await _0x2108c4[_0x1c2d0a]['nc'][_0xbec881(0x2d5)]();}});}}export const getAppRoles=async(_0x2c91c8,_0x2b75c9)=>{const _0x481764=a0_0xecb8,_0x43ce77=_0x481764(0x29d),_0x4706d1=_0x2c91c8;_0x4706d1[_0x481764(0x228)][_0x481764(0x299)](_0x4706d1[_0x481764(0x2d2)]+'['+_0x4706d1[_0x481764(0x23c)]+']\x20handling\x20\x22'+_0x43ce77+'\x22');try{if(!a0_0x7dda52[_0x481764(0x2bc)](_0x4706d1['configDir']+_0x481764(0x1e6)))a0_0x7dda52[_0x481764(0x28b)](_0x4706d1[_0x481764(0x211)]+_0x481764(0x1e6));}catch(_0x380770){void 0x0;}const _0x20d21b=a0_0x2546bd['join'](''+_0x4706d1[_0x481764(0x211)],'approles','approles_'+_0x4706d1['pluginName']+_0x481764(0x226)),_0x56026b={};a0_0x3465c4[_0x481764(0x239)](_0x20d21b)&&a0_0x7dda52[_0x481764(0x234)](_0x20d21b,_0x481764(0x267))[_0x481764(0x2b7)](/\r?\n/)[_0x481764(0x2c5)](_0x5ec679=>{const _0x12cf8c=_0x481764,_0x22e2f6=_0x5ec679['split']('\x20');_0x22e2f6[_0x12cf8c(0x269)]===0x2&&(_0x56026b[_0x22e2f6[0x0]]=_0x22e2f6[0x1]);});const _0x5b5ac8=a0_0x7dda52[_0x481764(0x1da)](_0x20d21b,{'flags':'w','encoding':_0x481764(0x262),'mode':0x1b6,'autoClose':!![]}),_0x2c3a51=[],_0x4f837c=await _0x4706d1[_0x481764(0x233)](_0x2b75c9,{'attribute':undefined,'operator':undefined,'value':undefined},['id',_0x481764(0x2d6)]);return _0x4f837c['Resources']['forEach'](_0x1b1688=>{const _0x51a774=_0x481764;if(_0x1b1688['id']){let _0x2a31a7=a0_0x368ba7[_0x51a774(0x2b3)]();if(_0x56026b[_0x1b1688['id']])_0x2a31a7=_0x56026b[_0x1b1688['id']];const _0x59b5e1={'allowedMemberTypes':['User'],'description':_0x51a774(0x28c),'displayName':_0x1b1688[_0x51a774(0x2d6)]||_0x1b1688['id'],'id':_0x2a31a7,'isEnabled':!![],'lang':null,'origin':_0x51a774(0x223),'value':decodeURIComponent(_0x1b1688['id'])};_0x2c3a51['push'](_0x59b5e1),_0x5b5ac8[_0x51a774(0x236)](_0x1b1688['id']+'\x20'+_0x2a31a7+'\x0a');}}),_0x5b5ac8['close'](),_0x4706d1[_0x481764(0x228)][_0x481764(0x299)](_0x4706d1['gwName']+'['+_0x4706d1[_0x481764(0x23c)]+_0x481764(0x276)+_0x20d21b),{'Resources':[{'appRoles':_0x2c3a51}]};};