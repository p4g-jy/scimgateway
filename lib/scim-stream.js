// ================================================================
// File:    scim-stream.js
//
// Author:  Jarle Elshaug
//
// Purpose: SCIM Stream message subscription and automated provisioning
//          Gateway publishing to SCIM Stream having other gateways as subscribers handling requests
//          getApproles() for exporting all groups into Entra ID AppRole manifest-format
//
// Note: scim-stream.js is part of the licensed SCIM Stream which is a prerequisite for message Pub/Sub
//       for details see: https://elshaug.xyz/docs/scim-stream
//
// ================================================================
'use strict';function a0_0x170e(){const _0x334f16=['publisher\x20error:\x20none\x20JSON\x20formatted\x20response:\x20','server_name','configDir','errName','\x20Delete\x20User\x20userName=','onCreate','&attributes=','origin','doRequest',']\x20error:\x20missing\x20entity\x20configuration\x20for\x20baseEntity=','content-type','DELETE\x20api','\x20-\x20will\x20do\x20auto\x20reconnect\x20when\x20connection\x20becomes\x20available','}\x20message\x20response:\x20','error','parse','stringify','firstn','SCIM\x20Stream','503','auth','typeId','password','randomUUID','drain','\x20Create\x20userName=','replace','getHandlerServiceProviderConfig','{\x22error\x22:\x22','response','isArray','normalize','/approles',']\x20onChainingHandler\x20error:\x20configuration\x20scimgateway.chainingBaseUrl\x20missing','groups','DELETE','getServer','NOT_FOUND','body','\x20error:\x20','DELETE\x20users','/Users','\x20handling\x20message:\x20',']\x20publisher[','1600976cPxSCM','putApiHandler','DELETE\x20groups','\x20message:\x20user\x20not\x20created\x20because\x20of\x20active=false','write','path','split',']\x20initialization\x20error:\x20missing\x20configuration\x20nats','attribute','subscribe','helperRest','username','modifyUser',']\x20client\x20error\x20','PUT\x20api','authenticator','\x20group\x20removal\x20error:\x20','skipConvertRolesToGroups','usePutSoftSync','operation','consumers','join','type','getUsers','deleteApiHandler','false','Resources','GET\x20users','\x20roles\x20converted\x20to\x20groups:\x20','}\x20message\x20error\x20response:\x20','User','add','ctx','application/scim+json;\x20charset=utf-8','startsWith',']\x20initialization\x20error:\x20missing\x20configuration\x20nats.subject','getHandlerId',']\x20initialization\x20certificate\x20error:\x20',']\x20error:\x20client\x20have\x20not\x20been\x20initialized','publisher\x20response\x20error:\x20','8QZvCjS','close','url','getGroups','Explicit','status','Basic\x20','/certs/','POST','baseEntity','constructor','readFileSync','putHandler','createWriteStream','POST\x20api','?attributes=','elementnumber','14iupSmQ',']\x20client\x20reconnected\x20','pingInterval','\x20missing\x20user\x20object\x20in\x20message:\x20','getHandler','jwt','forEach','newHelperRest','207042pbUGyI','config','\x20Delete\x20User\x20id=','6tdjoHr','\x20convertedScim20\x20error:\x20','active','GET','approles','\x20createUser()\x20obj=','tenant','routeObj','deleteUser','pluginName','internal\x20stream\x20policy\x20have\x20been\x20changed\x20-\x20central\x20SCIM\x20Stream\x20must\x20be\x20stopped\x20and\x20corresponding\x20./jetstream\x20folder\x20deleted\x20before\x20startup\x20allowing\x20new\x20policy','value','activityOperation','utf-8','message','reconnect','fsExistsSync','getEncrypted','\x20message\x20json\x20parsing\x20error:\x20','statusCode','userName','1754361vwhkuH','\x20error:\x20missing\x20id}',']\x20client\x20has\x20a\x20stale\x20connection\x20','gwName','GET\x20serviceplans','POST\x20users','set','_autogenerated.cfg','\x20error:\x20missing\x20result',']\x20client\x20is\x20attempting\x20to\x20reconnect\x20','replaceAll','\x22,\x22errName\x22:\x22','UnableConnectingHost','PUT\x20groups','382640wwZSgC','\x20missing\x20mandatory\x20user.userName\x20in\x20message:\x20',']\x20initialization\x20error:\x20nats.subject\x20root\x20topic\x20must\x20be\x20\x27GW\x27,\x20nats.subject\x20example:\x20GW.APP1',']\x20connect\x20error:\x20','respond','PUT\x20users','base64','true','getHandlerSchemas','Msg-Id','\x20done','debug',']\x20closed\x20with\x20error:\x20','indexOf','\x20message:\x20',']\x20initialization\x20error:\x20missing\x20configuration\x20stream.baseUrls','sub','publish','data','toString','postApiHandler','GET\x20serviceproviderconfigs','reconnecting','PATCH\x20users','\x20=>\x20subscriber\x20not\x20activated','info','certificate','charAt','rejectUnauthorized','from','delete','bearerToken',']\x20client\x20consumer\x20reinitiated\x20because\x20of\x20','patchHandler','nats',',\x20id=','copyObj','closed','Operations','trim','undefined','\x20message:\x20user\x20not\x20deleted\x20because\x20of\x20configuration\x20modifyOnly=true','basic',']\x20approle\x20uuid\x20file\x20created:\x20','waitOnFirstConnect','name','display','ENOTFOUND','\x20message:\x20user\x20does\x20not\x20exist','isClosed','\x20Create\x20User\x20userName=','tls','scimgateway','Users','all','\x20message\x20handled:\x20','headers','getUsers()\x20getObj=','token','roles',']\x20subscriber[','consume','substring','publisher[','call','passThrough','filter_subject','\x20subscriber\x20error:\x20scimgateway\x20endpoint\x20connect\x20problem\x20-\x20will\x20do\x20auto\x20retry\x20until\x20connected','users','All','290613uAxRZa','GET\x20groups','modifyOnly','logger','deleteHandler',']\x20client\x20disconnected\x20','file-not-configured','obj','\x20-\x20','lowercase','\x20message:\x20user\x20not\x20created\x20because\x20of\x20configuration\x20modifyOnly=true','getAppRoles','encode','request','append','generateUserPassword','staleConnection','streamChaining\x20error:\x20','authorization','servers',']\x20error:\x20','createRandomPassword','chainingBaseUrl',']\x20onChainingHandler\x20error:\x20','replaceUsrGrp()\x20error:\x20stream\x20replaceUsrGrp\x20must\x20be\x20type\x20\x22Users\x22','string','toUpperCase','replaceDomains','displayName','/Users/','getuniquevalue','subject','get',']\x20onChainingHandler\x20error:\x20configuration\x20scimgateway.chainingBaseUrl\x20must\x20use\x20correct\x20syntax\x20\x27http(s)://host:port\x27\x20error:\x20','push','streamChaining\x20called\x20but\x20missing\x20chainingBaseUrl','reconnectTimeWait','baseUrls','396054HSlofK','\x20(count=','modifyGroup',',false',']\x20subscriber\x20stopped\x20error:\x20','foldReplacing','Application','GET\x20serviceproviderconfig','ack','PATCH\x20groups','toLowerCase','ETIMEDOUT','uppercase',']\x20error:\x20no\x20subscribers/responders\x20to\x20subject\x20','postHandler','secret','operator','45727xzVFUv','then','length','##doIncrement','schemas','func','\x20error:\x20more\x20than\x20one\x20user\x20were\x20found}','disconnect','replaceUsrGrp','\x20Replace\x20User\x20id=','existsSync','increment','SCIM\x20Stream\x20-\x20Autogenerated',']\x20initialization\x20error:\x20missing\x20configuration\x20nats.tenant','maxReconnectAttempts','includes','durable_','POST\x20groups','update','hasOwnProperty','810uMZZBl',',\x20obj=','?filter=externalId\x20eq\x20\x22','\x20-\x20will\x20do\x20auto\x20connect\x20when\x20available\x20-\x20however,\x20please\x20verify\x20stream\x20configuration','_info','method',']\x20handling\x20\x22','SIGTERM','\x20role\x20removal\x20error:\x20','maxPingOut','deliver_policy'];a0_0x170e=function(){return _0x334f16;};return a0_0x170e();}(function(_0x372b67,_0x2f5acf){const _0x304ab2=a0_0x34a9,_0x3e462a=_0x372b67();while(!![]){try{const _0x91bfc3=parseInt(_0x304ab2(0x179))/0x1+parseInt(_0x304ab2(0x219))/0x2*(-parseInt(_0x304ab2(0x153))/0x3)+-parseInt(_0x304ab2(0x1d5))/0x4+parseInt(_0x304ab2(0x10d))/0x5+-parseInt(_0x304ab2(0x216))/0x6*(-parseInt(_0x304ab2(0x20e))/0x7)+-parseInt(_0x304ab2(0x1fd))/0x8*(-parseInt(_0x304ab2(0x22e))/0x9)+parseInt(_0x304ab2(0x19e))/0xa*(parseInt(_0x304ab2(0x18a))/0xb);if(_0x91bfc3===_0x2f5acf)break;else _0x3e462a['push'](_0x3e462a['shift']());}catch(_0x44eeb1){_0x3e462a['push'](_0x3e462a['shift']());}}}(a0_0x170e,0x5d5b1));import{jwtAuthenticator,headers}from'@nats-io/nats-core';import{jetstream,jetstreamManager,DeliverPolicy,AckPolicy}from'@nats-io/jetstream';import{connect as a0_0xa30659}from'@nats-io/transport-node';import a0_0x3ae810 from'fold-to-ascii';import a0_0x1d49b8 from'node:fs';import a0_0x486815 from'node:path';import a0_0x7ebed9 from'node:crypto';import*as a0_0x197b83 from'./utils.ts';import*as a0_0x2ff7a4 from'./utils-scim.ts';function a0_0x34a9(_0xcc8408,_0x14e51a){const _0x170e8d=a0_0x170e();return a0_0x34a9=function(_0x34a991,_0x4742cb){_0x34a991=_0x34a991-0x103;let _0x46beb9=_0x170e8d[_0x34a991];return _0x46beb9;},a0_0x34a9(_0xcc8408,_0x14e51a);}export class Subscriber{constructor(_0x3e80b4,_0x273e9f){const _0x47219f=a0_0x34a9,_0x441b67=_0x3e80b4,_0x5f661d={},_0x591fdb=_0x441b67['config'][_0x47219f(0x141)]['chainingBaseUrl'];let _0x56f56b='';if(_0x591fdb){if(_0x441b67[_0x47219f(0x217)][_0x47219f(0x141)]?.[_0x47219f(0x1bd)]?.['bearerToken']&&Array[_0x47219f(0x1c7)](_0x441b67[_0x47219f(0x217)][_0x47219f(0x141)][_0x47219f(0x1bd)][_0x47219f(0x12c)])&&_0x441b67[_0x47219f(0x217)][_0x47219f(0x141)][_0x47219f(0x1bd)][_0x47219f(0x12c)][_0x47219f(0x18c)]>0x0){const _0x245b9f=_0x441b67['config']['scimgateway'][_0x47219f(0x1bd)][_0x47219f(0x12c)];if(_0x245b9f[0x0][_0x47219f(0x147)]){const _0x5a911a=Buffer[_0x47219f(0x12a)](_0x245b9f[0x0][_0x47219f(0x147)])[_0x47219f(0x120)](_0x47219f(0x113));_0x56f56b='Bearer\x20'+_0x5a911a;}}if(!_0x56f56b&&_0x441b67[_0x47219f(0x217)][_0x47219f(0x141)]?.[_0x47219f(0x1bd)]?.[_0x47219f(0x137)]&&Array[_0x47219f(0x1c7)](_0x441b67[_0x47219f(0x217)]['scimgateway'][_0x47219f(0x1bd)][_0x47219f(0x137)])&&_0x441b67[_0x47219f(0x217)][_0x47219f(0x141)][_0x47219f(0x1bd)][_0x47219f(0x137)][_0x47219f(0x18c)]>0x0){const _0x1554bd=_0x441b67['config'][_0x47219f(0x141)][_0x47219f(0x1bd)]['basic'];if(_0x1554bd[0x0][_0x47219f(0x1e0)]&&_0x1554bd[0x0]['password']){const _0xb9adcf=Buffer[_0x47219f(0x12a)](_0x1554bd[0x0][_0x47219f(0x1e0)]+':'+_0x1554bd[0x0][_0x47219f(0x1bf)])['toString'](_0x47219f(0x113));_0x56f56b=_0x47219f(0x203)+_0xb9adcf;}}}const _0x321a66=async(_0x142435,_0x513f05)=>{const _0x5eedde=_0x47219f,_0x4e3063=_0x5f661d[_0x142435][_0x5eedde(0x217)]?.[_0x5eedde(0x12f)]?.['subject'];let _0x24f2b3;try{_0x24f2b3=await a0_0xa30659(_0x513f05);if(_0x24f2b3[_0x5eedde(0x126)][_0x5eedde(0x1aa)]!==_0x5eedde(0x1bb)){_0x24f2b3['close']();return;}_0x5f661d[_0x142435]['nc']=_0x24f2b3,_0x49faf8(_0x142435,_0x24f2b3),_0x5a2539(_0x142435,_0x24f2b3);}catch(_0x3f0fb1){_0x441b67['logger'][_0x5eedde(0x1b7)](_0x441b67[_0x5eedde(0x231)]+'['+_0x441b67[_0x5eedde(0x222)]+']\x20subscriber['+_0x142435+']['+_0x4e3063+_0x5eedde(0x110)+_0x3f0fb1[_0x5eedde(0x227)]+_0x5eedde(0x1a1)),_0x513f05[_0x5eedde(0x139)]=!![];try{_0x24f2b3=await a0_0xa30659(_0x513f05);if(_0x24f2b3[_0x5eedde(0x126)][_0x5eedde(0x1aa)]!==_0x5eedde(0x1bb)){_0x24f2b3[_0x5eedde(0x1fe)]();return;}_0x5f661d[_0x142435]['nc']=_0x24f2b3,_0x49faf8(_0x142435,_0x24f2b3),_0x5a2539(_0x142435,_0x24f2b3);}catch(_0x14f157){_0x441b67[_0x5eedde(0x156)][_0x5eedde(0x1b7)](_0x441b67['gwName']+'['+_0x441b67['pluginName']+_0x5eedde(0x149)+_0x142435+']['+_0x4e3063+_0x5eedde(0x110)+_0x14f157['message']);return;}}_0x441b67[_0x5eedde(0x156)][_0x5eedde(0x118)](_0x441b67['gwName']+'['+_0x441b67['pluginName']+_0x5eedde(0x149)+_0x142435+']['+_0x4e3063+']\x20connected\x20'+(_0x513f05['tls']['ca']?_0x5eedde(0x140):'')+'\x20'+_0x24f2b3['getServer']()),_0x24f2b3[_0x5eedde(0x132)]()['then'](_0x18960d=>{const _0x36f5ec=_0x5eedde;_0x18960d&&_0x441b67[_0x36f5ec(0x156)][_0x36f5ec(0x1b7)](_0x441b67[_0x36f5ec(0x231)]+'['+_0x441b67[_0x36f5ec(0x222)]+']\x20subscriber['+_0x142435+']['+_0x4e3063+_0x36f5ec(0x119)+_0x18960d['message']);});};this[_0x47219f(0x1f4)]=async(_0x24a14c,_0x1526f0)=>{const _0x52dd7b=_0x47219f;if(!_0x1526f0?.[_0x52dd7b(0x12f)]){_0x441b67[_0x52dd7b(0x156)][_0x52dd7b(0x1b7)](_0x441b67['gwName']+'['+_0x441b67['pluginName']+']\x20subscriber['+_0x24a14c+_0x52dd7b(0x1dc));return;}if(!_0x1526f0?.[_0x52dd7b(0x12f)]?.[_0x52dd7b(0x21f)]){_0x441b67[_0x52dd7b(0x156)]['error'](_0x441b67[_0x52dd7b(0x231)]+'['+_0x441b67[_0x52dd7b(0x222)]+_0x52dd7b(0x149)+_0x24a14c+_0x52dd7b(0x197));return;}if(!_0x1526f0?.[_0x52dd7b(0x12f)]?.[_0x52dd7b(0x172)]){_0x441b67[_0x52dd7b(0x156)][_0x52dd7b(0x1b7)](_0x441b67[_0x52dd7b(0x231)]+'['+_0x441b67[_0x52dd7b(0x222)]+_0x52dd7b(0x149)+_0x24a14c+_0x52dd7b(0x1f8));return;}if(!_0x1526f0?.['certificate']?.['ca']){_0x441b67[_0x52dd7b(0x156)][_0x52dd7b(0x1b7)](_0x441b67[_0x52dd7b(0x231)]+'['+_0x441b67['pluginName']+']\x20subscriber['+_0x24a14c+']\x20initialization\x20error:\x20missing\x20certificate\x20configuration');return;}if(!_0x1526f0[_0x52dd7b(0x178)]||!Array['isArray'](_0x1526f0[_0x52dd7b(0x178)])||_0x1526f0[_0x52dd7b(0x178)][_0x52dd7b(0x18c)]<0x1){_0x441b67[_0x52dd7b(0x156)][_0x52dd7b(0x1b7)](_0x441b67[_0x52dd7b(0x231)]+'['+_0x441b67['pluginName']+']\x20subscriber['+_0x24a14c+_0x52dd7b(0x11c));return;}if(!_0x1526f0[_0x52dd7b(0x1e7)]){const _0x461622=_0x1526f0?.[_0x52dd7b(0x12f)]?.[_0x52dd7b(0x172)]['toUpperCase']();if(_0x461622[_0x52dd7b(0x1f7)]('HR.'))_0x1526f0[_0x52dd7b(0x1e7)]=!![];}const _0x8b3f9a={};try{let _0x5cf0ac=a0_0x486815[_0x52dd7b(0x1ea)](_0x441b67[_0x52dd7b(0x1ab)],_0x52dd7b(0x204),_0x1526f0?.['certificate']?.['ca']||_0x52dd7b(0x159));(_0x1526f0?.[_0x52dd7b(0x127)]?.['ca']?.[_0x52dd7b(0x1f7)]('/')||_0x1526f0?.[_0x52dd7b(0x127)]?.['ca']?.[_0x52dd7b(0x199)]('\x5c'))&&(_0x5cf0ac=_0x1526f0['certificate']['ca']),_0x8b3f9a['ca']=[a0_0x1d49b8[_0x52dd7b(0x208)](_0x5cf0ac)],_0x8b3f9a[_0x52dd7b(0x129)]=!![];}catch(_0x2f935c){_0x441b67[_0x52dd7b(0x156)]['error'](_0x441b67['gwName']+'['+_0x441b67[_0x52dd7b(0x222)]+_0x52dd7b(0x149)+_0x24a14c+']\x20initialization\x20certificate\x20error:\x20'+_0x2f935c[_0x52dd7b(0x227)]);return;}const _0x51aa88={},_0x5b7e88=new TextEncoder()['encode'](_0x1526f0?.[_0x52dd7b(0x12f)]?.[_0x52dd7b(0x188)]),_0x10d55d=_0x1526f0?.[_0x52dd7b(0x12f)]?.[_0x52dd7b(0x213)];_0x51aa88['authenticator']=jwtAuthenticator(_0x10d55d,_0x5b7e88),_0x51aa88['servers']=_0x1526f0['baseUrls'],_0x51aa88[_0x52dd7b(0x140)]=_0x8b3f9a,_0x51aa88['waitOnFirstConnect']=![],_0x51aa88[_0x52dd7b(0x228)]=!![],_0x51aa88['reconnectTimeWait']=0x3e8*0xa,_0x51aa88[_0x52dd7b(0x198)]=-0x1,_0x51aa88[_0x52dd7b(0x210)]=0x2*0x3c*0x3e8,_0x51aa88[_0x52dd7b(0x1a7)]=0x5,_0x51aa88['debug']=![],_0x5f661d[_0x24a14c]={},_0x5f661d[_0x24a14c][_0x52dd7b(0x217)]=_0x1526f0,_0x5f661d[_0x24a14c]['nc']=undefined,_0x5f661d[_0x24a14c][_0x52dd7b(0x11d)]=undefined,_0x321a66(_0x24a14c,_0x51aa88);};const _0x5a2539=async(_0xd3c5e0,_0x47792e)=>{const _0x2e2d2b=_0x47219f,_0x2d242c=_0x5f661d[_0xd3c5e0]['config'],_0xb4fa13=_0x2d242c?.[_0x2e2d2b(0x12f)]?.[_0x2e2d2b(0x172)];if(!_0x47792e){_0x441b67['logger'][_0x2e2d2b(0x1b7)](_0x441b67[_0x2e2d2b(0x231)]+'['+_0x441b67[_0x2e2d2b(0x222)]+_0x2e2d2b(0x149)+_0xd3c5e0+']['+_0xb4fa13+_0x2e2d2b(0x1fb));return;}const _0x5d1900=async(_0x4c414f,_0x32e65c)=>{const _0x55aad7=_0x2e2d2b;try{_0x441b67[_0x55aad7(0x156)]['info'](_0x4c414f+_0x55aad7(0x1d3)+_0x32e65c);let _0x1821df;try{if(_0x2d242c[_0x55aad7(0x16e)]&&Array[_0x55aad7(0x1c7)](_0x2d242c[_0x55aad7(0x16e)]))for(let _0x392f72=0x0;_0x392f72<_0x2d242c['replaceDomains'][_0x55aad7(0x18c)];_0x392f72++){const _0x32be52=_0x2d242c[_0x55aad7(0x16e)][_0x392f72];if(!_0x32be52['from']||!_0x32be52[_0x55aad7(0x12a)][_0x55aad7(0x199)]('.')||!_0x32be52['to']||!_0x32be52['to'][_0x55aad7(0x199)]('.'))continue;const _0x5789e3=new RegExp('@'+_0x32be52[_0x55aad7(0x12a)]+'\x22','gi');_0x32e65c=_0x32e65c[_0x55aad7(0x1c3)](_0x5789e3,'@'+_0x32be52['to']+'\x22');}_0x1821df=JSON[_0x55aad7(0x1b8)](_0x32e65c);}catch(_0x5a914e){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x1b7)](_0x4c414f+_0x55aad7(0x22b)+_0x5a914e[_0x55aad7(0x227)]+_0x55aad7(0x11b)+_0x32e65c),_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x117));return;}const _0x34d1b3=_0x1821df['user'];if(!_0x34d1b3){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x1b7)](_0x4c414f+_0x55aad7(0x211)+JSON[_0x55aad7(0x1b9)](_0x1821df)),_0x441b67[_0x55aad7(0x156)]['debug'](_0x4c414f+_0x55aad7(0x117));return;}if(!_0x34d1b3[_0x55aad7(0x22d)]){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x1b7)](_0x4c414f+_0x55aad7(0x10e)+JSON[_0x55aad7(0x1b9)](_0x1821df)),_0x441b67[_0x55aad7(0x156)]['debug'](_0x4c414f+_0x55aad7(0x117));return;}delete _0x34d1b3[_0x55aad7(0x18e)];let _0x11fd23;_0x34d1b3['id']&&(_0x11fd23=_0x34d1b3['id'],delete _0x34d1b3['id']);let _0x27fbe3;_0x34d1b3['onCreate']&&(_0x27fbe3=a0_0x197b83[_0x55aad7(0x131)](_0x34d1b3[_0x55aad7(0x1ae)]),delete _0x34d1b3[_0x55aad7(0x1ae)]);await _0x47e534(_0xd3c5e0,_0x34d1b3);const _0x1cbf3a=_0x34d1b3[_0x55aad7(0x22d)];let _0x29cde1,_0x135954;try{_0x29cde1=await _0x3f85b2(_0xd3c5e0,_0x55aad7(0x22d),_0x1cbf3a);}catch(_0x1fa588){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x1b7)](_0x4c414f+'\x20getUserId()\x20error:\x20'+_0x1fa588[_0x55aad7(0x227)]),_0x441b67['logger'][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x117));const _0x15f1e3=[_0x55aad7(0x10b),'UnableConnectingService','ECONNREFUSED',_0x55aad7(0x13c),_0x55aad7(0x184),'timeout'];for(const _0x261606 in _0x15f1e3){if(_0x1fa588['message'][_0x55aad7(0x199)](_0x261606))return!![];}return;}if(!_0x2d242c[_0x55aad7(0x1e6)]){let _0x3c2f35=![];if(_0x1821df['Operations']&&Array['isArray'](_0x1821df['Operations']))for(let _0x6d4843=0x0;_0x6d4843<_0x1821df[_0x55aad7(0x133)]['length'];_0x6d4843++){const _0xe5c2b5=_0x1821df[_0x55aad7(0x133)][_0x6d4843];_0xe5c2b5[_0x55aad7(0x1da)][_0x55aad7(0x1f7)](_0x55aad7(0x148))&&(_0xe5c2b5['path']=_0x55aad7(0x1cb),Array[_0x55aad7(0x1c7)](_0xe5c2b5[_0x55aad7(0x224)])?(_0xe5c2b5['value'][0x0]['id']=_0xe5c2b5[_0x55aad7(0x224)][0x0][_0x55aad7(0x224)],_0xe5c2b5[_0x55aad7(0x224)][0x0]['display']=_0xe5c2b5[_0x55aad7(0x224)][0x0][_0x55aad7(0x1eb)]+_0x55aad7(0x15b)+_0xe5c2b5[_0x55aad7(0x224)][0x0]['value'],delete _0xe5c2b5[_0x55aad7(0x224)][0x0]['value'],delete _0xe5c2b5[_0x55aad7(0x224)][0x0][_0x55aad7(0x1eb)]):_0xe5c2b5[_0x55aad7(0x224)]=[{'id':_0xe5c2b5[_0x55aad7(0x224)],'display':_0xe5c2b5['value']}],delete _0xe5c2b5[_0x55aad7(0x1be)],_0x3c2f35=!![]);}if(_0x34d1b3['roles']&&Array[_0x55aad7(0x1c7)](_0x34d1b3[_0x55aad7(0x148)])&&_0x34d1b3[_0x55aad7(0x148)][_0x55aad7(0x18c)]>0x0){if(!_0x34d1b3['groups'])_0x34d1b3[_0x55aad7(0x1cb)]=[];if(!Array[_0x55aad7(0x1c7)](_0x34d1b3['groups']))_0x34d1b3[_0x55aad7(0x1cb)]=[];for(let _0x1eda0a=0x0;_0x1eda0a<_0x34d1b3[_0x55aad7(0x148)][_0x55aad7(0x18c)];_0x1eda0a++){const _0x366d9f={},_0x534b73=_0x34d1b3[_0x55aad7(0x148)][_0x1eda0a];_0x366d9f[_0x55aad7(0x224)]=_0x534b73[_0x55aad7(0x224)],_0x366d9f[_0x55aad7(0x13b)]=_0x534b73[_0x55aad7(0x1eb)]+_0x55aad7(0x15b)+_0x534b73[_0x55aad7(0x13b)],_0x34d1b3[_0x55aad7(0x1cb)]['push'](_0x366d9f);}delete _0x34d1b3[_0x55aad7(0x148)],_0x3c2f35=!![];}if(_0x3c2f35)_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x1f1)+JSON[_0x55aad7(0x1b9)](_0x1821df));}if(!_0x29cde1){if(_0x1821df[_0x55aad7(0x225)]==='deleteUser'){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x1ad)+_0x1cbf3a+_0x55aad7(0x13d)),_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x117));return;}if(_0x2d242c[_0x55aad7(0x155)]&&_0x2d242c[_0x55aad7(0x155)]===!![]){_0x441b67[_0x55aad7(0x156)]['debug'](_0x4c414f+_0x55aad7(0x1c2)+_0x1cbf3a+_0x55aad7(0x15d)),_0x441b67['logger'][_0x55aad7(0x118)](_0x4c414f+'\x20done');return;}if(Object['prototype'][_0x55aad7(0x19d)][_0x55aad7(0x14d)](_0x34d1b3,_0x55aad7(0x21b))){if(typeof _0x34d1b3[_0x55aad7(0x21b)]===_0x55aad7(0x16c)){const _0x22c0ff=_0x34d1b3['active'][_0x55aad7(0x183)]();if(_0x22c0ff==='true')_0x34d1b3[_0x55aad7(0x21b)]=!![];else{if(_0x22c0ff===_0x55aad7(0x1ee))_0x34d1b3['active']=![];}}if(_0x34d1b3[_0x55aad7(0x21b)]===![]){_0x441b67[_0x55aad7(0x156)]['debug'](_0x4c414f+_0x55aad7(0x1c2)+_0x1cbf3a+_0x55aad7(0x1d8)),_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x117));return;}}_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x13f)+_0x1cbf3a);const _0x1ad06e=a0_0x197b83['copyObj'](_0x34d1b3);try{delete _0x1ad06e['groups'];!_0x1ad06e['password']&&_0x2d242c['generateUserPassword']&&_0x2d242c[_0x55aad7(0x162)]===!![]&&(_0x1ad06e[_0x55aad7(0x1bf)]=a0_0x197b83[_0x55aad7(0x168)](0xf));if(_0x27fbe3||_0x11fd23){if(_0x27fbe3)for(const _0x39a58b in _0x27fbe3){_0x1ad06e[_0x39a58b]=_0x27fbe3[_0x39a58b];}if(_0x11fd23)_0x1ad06e['id']=_0x11fd23;await _0x47e534(_0xd3c5e0,_0x1ad06e);}await _0x286a0c(_0xd3c5e0,_0x1ad06e),_0x34d1b3[_0x55aad7(0x1cb)]&&Array[_0x55aad7(0x1c7)](_0x34d1b3[_0x55aad7(0x1cb)])&&_0x34d1b3[_0x55aad7(0x1cb)][_0x55aad7(0x18c)]>0x0&&(_0x135954=await _0x3f85b2(_0xd3c5e0,_0x55aad7(0x22d),_0x1cbf3a));}catch(_0x207bca){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x1b7)](_0x4c414f+_0x55aad7(0x21e)+JSON[_0x55aad7(0x1b9)](_0x1ad06e)+_0x55aad7(0x1d0)+_0x207bca['message']+'}'),_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x117));return;}}if(_0x29cde1||_0x135954){if(_0x1821df['activityOperation']===_0x55aad7(0x221)){if(_0x2d242c[_0x55aad7(0x155)]&&_0x2d242c[_0x55aad7(0x155)]===!![]){_0x441b67['logger'][_0x55aad7(0x118)](_0x4c414f+'\x20Delete\x20User\x20id='+_0x29cde1+_0x55aad7(0x136)),_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+'\x20done');return;}_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x218)+_0x29cde1);try{await _0x3ad46f(_0xd3c5e0,_0x29cde1);}catch(_0x13b8a8){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x1b7)](_0x4c414f+'\x20Delete\x20User\x20id='+_0x29cde1+_0x55aad7(0x1d0)+_0x13b8a8['message']+'}'),_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x117));return;}}else{if(_0x135954)_0x29cde1=_0x135954;_0x441b67[_0x55aad7(0x156)]['debug'](_0x4c414f+'\x20Replace\x20User\x20id='+_0x29cde1);try{await _0x9718bd(_0x55aad7(0x142),_0xd3c5e0,_0x29cde1,_0x34d1b3,_0x2d242c[_0x55aad7(0x1e7)]);}catch(_0x317fc0){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x1b7)](_0x4c414f+_0x55aad7(0x193)+_0x29cde1+_0x55aad7(0x1d0)+_0x317fc0['message']),_0x441b67[_0x55aad7(0x156)]['debug'](_0x4c414f+'\x20done');return;}if(_0x2d242c[_0x55aad7(0x1e7)]){const [_0x1636f5,_0xdfee74]=a0_0x2ff7a4['convertedScim20']({'Operations':_0x1821df[_0x55aad7(0x133)]});if(_0xdfee74){_0x441b67['logger'][_0x55aad7(0x1b7)](_0x4c414f+'\x20Replace\x20User\x20id='+_0x29cde1+_0x55aad7(0x21a)+_0xdfee74[_0x55aad7(0x227)]),_0x441b67[_0x55aad7(0x156)]['debug'](_0x4c414f+'\x20done');return;}const _0x4b9ca1=[];if(_0x1636f5['roles']&&Array['isArray'](_0x1636f5[_0x55aad7(0x148)]))for(let _0x4d7139=0x0;_0x4d7139<_0x1636f5[_0x55aad7(0x148)][_0x55aad7(0x18c)];_0x4d7139++){_0x1636f5[_0x55aad7(0x148)][_0x4d7139][_0x55aad7(0x1e8)]&&_0x1636f5[_0x55aad7(0x148)][_0x4d7139]['operation']==='delete'&&_0x4b9ca1['push'](_0x1636f5['roles'][_0x4d7139]);}if(_0x4b9ca1[_0x55aad7(0x18c)]>0x0)try{await _0x441b67[_0x55aad7(0x1e1)](_0xd3c5e0,_0x29cde1,{'roles':_0x4b9ca1});}catch(_0x9b7612){_0x441b67['logger'][_0x55aad7(0x1b7)](_0x4c414f+_0x55aad7(0x193)+_0x29cde1+_0x55aad7(0x1a6)+_0x9b7612[_0x55aad7(0x227)]);}const _0x53902b=[];if(_0x1636f5[_0x55aad7(0x1cb)]&&Array[_0x55aad7(0x1c7)](_0x1636f5['groups']))for(let _0x78b387=0x0;_0x78b387<_0x1636f5[_0x55aad7(0x1cb)][_0x55aad7(0x18c)];_0x78b387++){_0x1636f5['groups'][_0x78b387][_0x55aad7(0x1e8)]&&_0x1636f5[_0x55aad7(0x1cb)][_0x78b387][_0x55aad7(0x1e8)]==='delete'&&_0x53902b['push'](_0x1636f5['groups'][_0x78b387]);}if(_0x53902b['length']>0x0)for(let _0x5badf6=0x0;_0x5badf6<_0x53902b[_0x55aad7(0x18c)];_0x5badf6++){try{await _0x441b67[_0x55aad7(0x17b)](_0xd3c5e0,_0x53902b[_0x5badf6]['id'],{'members':[{'operation':_0x55aad7(0x12b),'value':_0x29cde1}]});}catch(_0x3f2104){_0x441b67['logger'][_0x55aad7(0x1b7)](_0x4c414f+_0x55aad7(0x193)+_0x29cde1+_0x55aad7(0x1e5)+_0x3f2104[_0x55aad7(0x227)]);}}}if(_0x2d242c['deleteUserOnLastGroupRoleRemoval']&&_0x1821df[_0x55aad7(0x225)]===_0x55aad7(0x1e1)){if(_0x34d1b3[_0x55aad7(0x1cb)]&&Array[_0x55aad7(0x1c7)](_0x34d1b3['groups'])&&_0x34d1b3[_0x55aad7(0x1cb)][_0x55aad7(0x18c)]===0x0){if(_0x34d1b3[_0x55aad7(0x148)]&&Array[_0x55aad7(0x1c7)](_0x34d1b3[_0x55aad7(0x148)])&&_0x34d1b3['roles'][_0x55aad7(0x18c)]===0x0){if(_0x1821df[_0x55aad7(0x133)]&&Array[_0x55aad7(0x1c7)](_0x1821df[_0x55aad7(0x133)])&&_0x1821df[_0x55aad7(0x133)][_0x55aad7(0x18c)]>0x0){let _0x4a5105=![];for(let _0xfb8ad0=0x0;_0xfb8ad0<_0x1821df['Operations'][_0x55aad7(0x18c)];_0xfb8ad0++){const _0x30f659=_0x1821df['Operations'][_0xfb8ad0];if(_0x30f659['op']==='remove'){if(_0x30f659[_0x55aad7(0x1da)]){if(_0x30f659[_0x55aad7(0x1da)][_0x55aad7(0x1f7)](_0x55aad7(0x148))&&_0x30f659['typeId']){_0x4a5105=!![];break;}else{if(_0x30f659[_0x55aad7(0x1da)]===_0x55aad7(0x1cb)){_0x4a5105=!![];break;}}}}}if(_0x4a5105){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x218)+_0x29cde1);try{await _0x3ad46f(_0xd3c5e0,_0x29cde1);}catch(_0x111537){_0x441b67['logger']['error'](_0x4c414f+_0x55aad7(0x218)+_0x29cde1+_0x55aad7(0x1d0)+_0x111537[_0x55aad7(0x227)]+'}'),_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x117));return;}}}}}}}}_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x118)](_0x4c414f+_0x55aad7(0x117));}catch(_0x31b565){_0x441b67[_0x55aad7(0x156)][_0x55aad7(0x1b7)](_0x441b67['gwName']+'['+_0x441b67[_0x55aad7(0x222)]+_0x55aad7(0x149)+_0xd3c5e0+']['+_0xb4fa13+_0x55aad7(0x167)+_0x31b565['message']+_0x55aad7(0x125));}},_0x35ee19=jetstream(_0x47792e),_0x330474=(_0x2e2d2b(0x19a)+_0x441b67['pluginName']+'_'+_0xd3c5e0)[_0x2e2d2b(0x109)]('*','#')[_0x2e2d2b(0x109)]('>','##')[_0x2e2d2b(0x109)]('.','_'),_0x286a9b=_0xb4fa13[_0x2e2d2b(0x1db)]('.')[0x0]['toUpperCase']()==='GW',_0x479278=async()=>{const _0x2cd471=_0x2e2d2b;try{let _0x28a074;const _0x5af6f7=''+_0x2d242c?.[_0x2cd471(0x12f)]?.['tenant'],_0x52b1a7=await jetstreamManager(_0x47792e),_0x5a7199=async()=>{const _0xa29b83=_0x2cd471;let _0x3b4728;try{_0x3b4728=await _0x35ee19['consumers'][_0xa29b83(0x173)](_0x5af6f7,_0x330474);}catch(_0x57f617){const _0x31dfd8={'durable_name':_0x330474,'deliver_policy':DeliverPolicy[_0xa29b83(0x152)],'ack_policy':AckPolicy[_0xa29b83(0x201)],'filter_subject':_0xb4fa13};await _0x52b1a7[_0xa29b83(0x1e9)][_0xa29b83(0x1f4)](_0x5af6f7,_0x31dfd8),_0x3b4728=await _0x35ee19[_0xa29b83(0x1e9)]['get'](_0x5af6f7,_0x330474);}if(_0x3b4728?.[_0xa29b83(0x1a2)]?.[_0xa29b83(0x217)]?.[_0xa29b83(0x1a8)]!==_0xa29b83(0x143))throw new Error(_0xa29b83(0x223));_0x3b4728?.[_0xa29b83(0x1a2)]?.[_0xa29b83(0x217)]?.[_0xa29b83(0x14f)]!==_0xb4fa13&&(await _0x52b1a7[_0xa29b83(0x1e9)][_0xa29b83(0x19c)](_0x5af6f7,_0x330474,{'filter_subject':_0xb4fa13}),_0x3b4728=await _0x35ee19[_0xa29b83(0x1e9)][_0xa29b83(0x173)](_0x5af6f7,_0x330474)),_0x28a074=await _0x3b4728[_0xa29b83(0x14a)]({'max_messages':0x64}),_0x199c99(_0x28a074);},_0x199c99=async _0xabefb6=>{const _0x15d0ec=_0x2cd471;for await(const _0x588888 of await _0xabefb6['status']()){switch(_0x588888[_0x15d0ec(0x1eb)]){case'consumer_not_found':_0x441b67['logger'][_0x15d0ec(0x126)](_0x441b67[_0x15d0ec(0x231)]+'['+_0x441b67[_0x15d0ec(0x222)]+_0x15d0ec(0x149)+_0xd3c5e0+']['+_0xb4fa13+_0x15d0ec(0x12d)+_0x588888[_0x15d0ec(0x1eb)]),_0x5a7199();return;}}};await _0x5a7199();let _0x3af101=-0x1;do{for await(const _0x312d82 of _0x28a074){if(!_0x312d82[_0x2cd471(0x145)]||!_0x312d82[_0x2cd471(0x145)][_0x2cd471(0x173)](_0x2cd471(0x116))){_0x312d82[_0x2cd471(0x181)]();continue;}_0x3af101=_0x28a074['getProcessed']();const _0x175520=_0x441b67[_0x2cd471(0x231)]+'['+_0x441b67[_0x2cd471(0x222)]+_0x2cd471(0x149)+_0xd3c5e0+']['+_0x312d82[_0x2cd471(0x172)]+']['+_0x3af101+']['+(_0x312d82['headers']?_0x312d82['headers'][_0x2cd471(0x173)]('Msg-Id'):'')+']',_0x1df6ed=_0x312d82[_0x2cd471(0x16c)](),_0x2b5063=await _0x5d1900(_0x175520,_0x1df6ed);if(!_0x2b5063||_0x2b5063!==!![])_0x312d82['ack']();else _0x441b67[_0x2cd471(0x156)][_0x2cd471(0x1b7)](_0x175520+_0x2cd471(0x150));if(_0x3af101<0x1)break;}}while(_0x3af101===0x0);}catch(_0x1df911){_0x441b67[_0x2cd471(0x156)]['error'](_0x441b67[_0x2cd471(0x231)]+'['+_0x441b67[_0x2cd471(0x222)]+']\x20subscriber['+_0xd3c5e0+']['+_0xb4fa13+_0x2cd471(0x17d)+_0x1df911[_0x2cd471(0x227)]);}},_0x744171=async()=>{const _0x4cb41b=_0x2e2d2b,_0x52cdb6=_0x47792e[_0x4cb41b(0x1de)](_0xb4fa13,{'max':0x64});for await(const _0x19b281 of _0x52cdb6){const _0xd22acb=_0x19b281[_0x4cb41b(0x145)][_0x4cb41b(0x173)](_0x4cb41b(0x116));if(!_0x19b281['headers']||!_0xd22acb)continue;const _0x14fa3f=_0x441b67[_0x4cb41b(0x231)]+'['+_0x441b67[_0x4cb41b(0x222)]+']\x20subscriber['+_0xd3c5e0+']['+_0x19b281['subject']+']['+(_0x19b281['headers']?_0xd22acb:'')+']';_0x441b67[_0x4cb41b(0x156)][_0x4cb41b(0x118)](_0x14fa3f+'\x20processing\x20incoming\x20message');const _0x3e5a70={'func':'','id':'','obj':''};let _0x25c255;try{try{_0x25c255=JSON['parse'](_0x19b281[_0x4cb41b(0x16c)]());}catch(_0x32c58d){const _0x1602b8='subscriber\x20message\x20error:\x20message\x20not\x20JSON\x20formatted';_0x441b67[_0x4cb41b(0x156)][_0x4cb41b(0x1b7)](_0x441b67[_0x4cb41b(0x231)]+'['+_0x441b67['pluginName']+']\x20subscriber['+_0xd3c5e0+']['+_0xb4fa13+']\x20'+_0x1602b8+':\x20'+_0x19b281[_0x4cb41b(0x16c)]());throw new Error(_0x1602b8);}const _0x397edd=_0x25c255['ctx'];if(_0x397edd?.[_0x4cb41b(0x220)]?.['id'])_0x3e5a70['id']=_0x397edd[_0x4cb41b(0x220)]['id'];if(_0x397edd?.[_0x4cb41b(0x160)]?.[_0x4cb41b(0x1cf)])_0x3e5a70[_0x4cb41b(0x15a)]=a0_0x197b83[_0x4cb41b(0x131)](_0x397edd[_0x4cb41b(0x160)][_0x4cb41b(0x1cf)]);if(_0x397edd?.['request']?.['headers']?.['authorization']){const _0x4b2c2c=_0x397edd[_0x4cb41b(0x160)][_0x4cb41b(0x145)]['authorization'];if(_0x4b2c2c)_0x397edd[_0x4cb41b(0x160)][_0x4cb41b(0x145)][_0x4cb41b(0x165)]=a0_0x197b83[_0x4cb41b(0x22a)](_0x4b2c2c,_0xd22acb);}if(_0x397edd?.[_0x4cb41b(0x14e)]?.['headers']?.[_0x4cb41b(0x165)]){const _0x353189=_0x397edd[_0x4cb41b(0x14e)][_0x4cb41b(0x145)]['authorization'];if(_0x353189)_0x397edd['passThrough'][_0x4cb41b(0x145)][_0x4cb41b(0x165)]=a0_0x197b83[_0x4cb41b(0x22a)](_0x353189,_0xd22acb);}if(_0x441b67[_0x4cb41b(0x217)]['scimgateway'][_0x4cb41b(0x169)])await _0x31b666(_0x397edd);else{const _0x5957f0=_0x397edd?.['routeObj']?.['method']+'\x20'+_0x397edd?.[_0x4cb41b(0x220)]?.['handle'];_0x3e5a70[_0x4cb41b(0x18f)]=_0x5957f0;switch(_0x5957f0){case _0x4cb41b(0x1f0):case _0x4cb41b(0x154):case _0x4cb41b(0x103):if(_0x397edd['routeObj']['id'])await _0x273e9f[_0x4cb41b(0x1f9)](_0x397edd);else await _0x273e9f[_0x4cb41b(0x212)](_0x397edd);break;case'GET\x20api':await _0x273e9f['getApiHandler'](_0x397edd);break;case'GET\x20schemas':await _0x273e9f[_0x4cb41b(0x115)](_0x397edd);break;case _0x4cb41b(0x180):case _0x4cb41b(0x122):await _0x273e9f[_0x4cb41b(0x1c4)](_0x397edd);break;case _0x4cb41b(0x124):case _0x4cb41b(0x182):await _0x273e9f[_0x4cb41b(0x12e)](_0x397edd);break;case'PATCH\x20api':await _0x273e9f['patchApiHandler'](_0x397edd);break;case _0x4cb41b(0x112):case _0x4cb41b(0x10c):await _0x273e9f[_0x4cb41b(0x209)](_0x397edd);break;case _0x4cb41b(0x1e3):await _0x273e9f[_0x4cb41b(0x1d6)](_0x397edd);break;case _0x4cb41b(0x104):case _0x4cb41b(0x19b):await _0x273e9f[_0x4cb41b(0x187)](_0x397edd);break;case _0x4cb41b(0x20b):await _0x273e9f[_0x4cb41b(0x121)](_0x397edd);break;case _0x4cb41b(0x1d1):case _0x4cb41b(0x1d7):await _0x273e9f[_0x4cb41b(0x157)](_0x397edd);break;case _0x4cb41b(0x1b4):await _0x273e9f[_0x4cb41b(0x1ed)](_0x397edd);break;default:_0x397edd['response']=new Response(_0x4cb41b(0x1ce),{'status':0x194});}}if(!_0x397edd['response'])_0x397edd[_0x4cb41b(0x1c6)]=null;const _0x1ad2e4=JSON[_0x4cb41b(0x1b9)](_0x397edd['response']);_0x19b281['respond'](_0x1ad2e4),_0x441b67[_0x4cb41b(0x156)][_0x4cb41b(0x126)](_0x14fa3f+_0x4cb41b(0x144)+_0x3e5a70[_0x4cb41b(0x18f)]+',\x20obj='+(_0x3e5a70[_0x4cb41b(0x15a)]?JSON[_0x4cb41b(0x1b9)](_0x3e5a70[_0x4cb41b(0x15a)]):'')+_0x4cb41b(0x130)+(_0x3e5a70['id']?_0x3e5a70['id']:'')+_0x4cb41b(0x1b6)+_0x1ad2e4);}catch(_0x44b971){const _0x13afca=_0x4cb41b(0x1c5)+_0x44b971[_0x4cb41b(0x227)]+_0x4cb41b(0x10a)+_0x44b971[_0x4cb41b(0x13a)]+'\x22}';_0x19b281[_0x4cb41b(0x111)](_0x13afca),_0x441b67['logger'][_0x4cb41b(0x126)]((_0x14fa3f||'')+_0x4cb41b(0x144)+_0x3e5a70['func']+_0x4cb41b(0x19f)+(_0x3e5a70[_0x4cb41b(0x15a)]?JSON['stringify'](_0x3e5a70['obj']):'')+_0x4cb41b(0x130)+(_0x3e5a70['id']?_0x3e5a70['id']:'')+_0x4cb41b(0x1f2)+_0x13afca);}}};if(_0x286a9b)_0x744171();else _0x479278();},_0x49faf8=async(_0x2d4ea4,_0x5d55b0)=>{const _0x38d514=_0x47219f,_0x513e13=_0x5f661d[_0x2d4ea4][_0x38d514(0x217)]?.[_0x38d514(0x12f)]?.[_0x38d514(0x172)];let _0xbb792a=0x0;for await(const _0x55036a of _0x5d55b0[_0x38d514(0x202)]()){switch(_0x55036a[_0x38d514(0x1eb)]){case _0x38d514(0x191):_0x441b67[_0x38d514(0x156)]['error'](_0x441b67[_0x38d514(0x231)]+'['+_0x441b67[_0x38d514(0x222)]+_0x38d514(0x149)+_0x2d4ea4+']['+_0x513e13+_0x38d514(0x158)+_0x55036a[_0x38d514(0x11f)]+_0x38d514(0x1b5)),_0xbb792a=0x0;break;case'reconnect':_0x441b67['logger'][_0x38d514(0x126)](_0x441b67[_0x38d514(0x231)]+'['+_0x441b67['pluginName']+']\x20subscriber['+_0x2d4ea4+']['+_0x513e13+_0x38d514(0x20f)+_0x55036a[_0x38d514(0x11f)]);break;case _0x38d514(0x1b7):_0x441b67[_0x38d514(0x156)][_0x38d514(0x1b7)](_0x441b67['gwName']+'['+_0x441b67[_0x38d514(0x222)]+_0x38d514(0x149)+_0x2d4ea4+']['+_0x513e13+_0x38d514(0x1e2)+_0x55036a[_0x38d514(0x11f)]);break;case'reconnecting':_0xbb792a+=0x1;_0xbb792a%0x1e===0x0&&_0x441b67[_0x38d514(0x156)][_0x38d514(0x118)](_0x441b67['gwName']+'['+_0x441b67['pluginName']+_0x38d514(0x149)+_0x2d4ea4+']['+_0x513e13+']\x20client\x20is\x20attempting\x20to\x20reconnect\x20'+_0x55036a[_0x38d514(0x11f)]+_0x38d514(0x17a)+_0xbb792a+')');break;case _0x38d514(0x163):_0x441b67[_0x38d514(0x156)]['debug'](_0x441b67[_0x38d514(0x231)]+'['+_0x441b67['pluginName']+_0x38d514(0x149)+_0x2d4ea4+']['+_0x513e13+_0x38d514(0x230)+_0x55036a[_0x38d514(0x11f)]);break;}}};process['on'](_0x47219f(0x1a5),async()=>{const _0x1ea7c8=_0x47219f;for(const _0x178020 in _0x5f661d){_0x5f661d[_0x178020]['nc']&&!_0x5f661d[_0x178020]['nc'][_0x1ea7c8(0x13e)]()&&await _0x5f661d[_0x178020]['nc']['drain']();}}),process['on']('SIGINT',async()=>{const _0x5a6bb1=_0x47219f;for(const _0x237409 in _0x5f661d){_0x5f661d[_0x237409]['nc']&&!_0x5f661d[_0x237409]['nc'][_0x5a6bb1(0x13e)]()&&await _0x5f661d[_0x237409]['nc'][_0x5a6bb1(0x1c1)]();}});const _0x3f85b2=async(_0x502ca1,_0xf679c9,_0x560038)=>{const _0x53de9a=_0x47219f,_0x1a0583={'attribute':_0xf679c9,'operator':'eq','value':_0x560038,'rawFilter':undefined,'startIndex':undefined,'count':undefined},_0x364979=[_0xf679c9];if(_0xf679c9!=='id')_0x364979[_0x53de9a(0x175)]('id');try{const _0x492c57=await _0x2938b3(_0x502ca1,_0x1a0583,_0x364979);if(!_0x492c57||!_0x492c57['Resources']||!Array[_0x53de9a(0x1c7)](_0x492c57['Resources']))throw new Error(_0x53de9a(0x146)+JSON[_0x53de9a(0x1b9)](_0x1a0583)+_0x53de9a(0x107));if(_0x492c57[_0x53de9a(0x1ef)][_0x53de9a(0x18c)]===0x0)return null;else{if(_0x492c57[_0x53de9a(0x1ef)][_0x53de9a(0x18c)]>0x2)throw new Error('getUsers()\x20getObj='+JSON[_0x53de9a(0x1b9)](_0x1a0583)+_0x53de9a(0x190));else{const _0x7cabca=_0x492c57[_0x53de9a(0x1ef)][0x0];if(!_0x7cabca['id'])throw new Error(_0x53de9a(0x146)+JSON['stringify'](_0x1a0583)+'\x20result='+JSON['stringify'](_0x7cabca)+_0x53de9a(0x22f));return decodeURIComponent(_0x7cabca['id']);}}}catch(_0x2ab195){throw new Error(_0x53de9a(0x146)+JSON[_0x53de9a(0x1b9)](_0x1a0583)+'\x20error:\x20'+_0x2ab195[_0x53de9a(0x227)]+'}');}},_0x2938b3=async(_0x4a23d8,_0x46ec00,_0x16bcc4)=>{const _0x2f28b6=_0x47219f;if(!_0x591fdb)return await _0x441b67[_0x2f28b6(0x1ec)](_0x4a23d8,_0x46ec00,_0x16bcc4);if(!_0x46ec00?.[_0x2f28b6(0x189)]||_0x46ec00[_0x2f28b6(0x189)]!=='eq')throw new Error('getUsers()\x20error:\x20unsupported\x20operator\x20for\x20getObj:\x20'+JSON[_0x2f28b6(0x1b9)](_0x46ec00));if(_0x4a23d8==='undefined')_0x4a23d8=undefined;let _0x7e3fca=_0x4a23d8?'/'+_0x4a23d8+_0x2f28b6(0x1d2):'/Users';if(_0x46ec00['attribute']==='id'){_0x7e3fca+='/'+_0x46ec00[_0x2f28b6(0x224)];if(_0x16bcc4&&_0x16bcc4[_0x2f28b6(0x18c)]>0x0)_0x7e3fca+=_0x2f28b6(0x20c)+_0x16bcc4['join'](',');}else{if(_0x46ec00['attribute']===_0x2f28b6(0x22d)){_0x7e3fca+='?filter=userName\x20eq\x20\x22'+_0x46ec00[_0x2f28b6(0x224)]+'\x22';if(_0x16bcc4&&_0x16bcc4[_0x2f28b6(0x18c)]>0x0)_0x7e3fca+=_0x2f28b6(0x1af)+_0x16bcc4[_0x2f28b6(0x1ea)](',');}else{if(_0x46ec00[_0x2f28b6(0x1dd)]==='externalId'){_0x7e3fca+=_0x2f28b6(0x1a0)+_0x46ec00[_0x2f28b6(0x224)]+'\x22';if(_0x16bcc4&&_0x16bcc4[_0x2f28b6(0x18c)]>0x0)_0x7e3fca+=_0x2f28b6(0x1af)+_0x16bcc4[_0x2f28b6(0x1ea)](',');}else throw new Error('getUsers()\x20error:\x20unsupported\x20operator\x20for\x20getObj:\x20'+JSON['stringify'](_0x46ec00));}}return await _0x2ffa50(_0x4a23d8,_0x2f28b6(0x21c),_0x7e3fca);},_0x286a0c=async(_0x4a0011,_0x8cf4af)=>{const _0x478360=_0x47219f;if(!_0x591fdb)return await _0x441b67['createUser'](_0x4a0011,_0x8cf4af);if(_0x4a0011===_0x478360(0x135))_0x4a0011=undefined;const _0x331656=_0x4a0011?'/'+_0x4a0011+'/Users':_0x478360(0x1d2);return await _0x2ffa50(_0x4a0011,_0x478360(0x205),_0x331656,_0x8cf4af);},_0x9718bd=async(_0x56a312,_0x3146b7,_0x27474c,_0x486567,_0x2d5bcd)=>{const _0x54168f=_0x47219f;if(!_0x56a312||_0x56a312[_0x54168f(0x183)]()!==_0x54168f(0x151))throw new Error(_0x54168f(0x16b));if(!_0x591fdb)return await _0x273e9f[_0x54168f(0x192)]('Users',_0x3146b7,_0x27474c,_0x486567,_0x2d5bcd);if(_0x3146b7===_0x54168f(0x135))_0x3146b7=undefined;const _0x1f77f5=_0x3146b7?'/'+_0x3146b7+_0x54168f(0x170)+_0x27474c:_0x54168f(0x170)+_0x27474c;return await _0x2ffa50(_0x3146b7,'PUT',_0x1f77f5,_0x486567);},_0x3ad46f=async(_0x43fe5d,_0x47a753)=>{const _0x3bfc38=_0x47219f;!_0x591fdb&&await _0x441b67[_0x3bfc38(0x221)](_0x43fe5d,_0x47a753);if(_0x43fe5d===_0x3bfc38(0x135))_0x43fe5d=undefined;const _0x5eddfa=_0x43fe5d?'/'+_0x43fe5d+_0x3bfc38(0x170)+_0x47a753:_0x3bfc38(0x170)+_0x47a753;return await _0x2ffa50(_0x43fe5d,_0x3bfc38(0x1cc),_0x5eddfa);},_0x21e23a=_0x5e0b11=>{const _0x395bba=_0x47219f;if(!_0x5e0b11||typeof _0x5e0b11!==_0x395bba(0x16c))return[null,null];_0x5e0b11=_0x5e0b11[_0x395bba(0x134)]();const _0x5f5db6=_0x5e0b11[_0x395bba(0x11a)]('(');if(_0x5f5db6<0x1)return[null,null];if(_0x5e0b11[_0x395bba(0x14b)](_0x5e0b11[_0x395bba(0x18c)]-0x1)!==')')return[null,null];if(_0x491ad9(_0x5e0b11,'(')!==_0x491ad9(_0x5e0b11,')'))return[null,null];const _0x56ad4b=_0x5e0b11[_0x395bba(0x14b)](0x0,_0x5f5db6),_0x4d69df=_0x5e0b11[_0x395bba(0x14b)](_0x5f5db6+0x1,_0x5e0b11[_0x395bba(0x18c)]-0x1);let _0x44b29b=[];const _0x6fb05d=_0x4d69df[_0x395bba(0x1db)](',');let _0x584ca8='';for(let _0x1249bd=0x0;_0x1249bd<_0x6fb05d[_0x395bba(0x18c)];_0x1249bd++){const _0x1a434b=_0x584ca8?_0x584ca8+','+_0x6fb05d[_0x1249bd]:_0x6fb05d[_0x1249bd],_0xbb1d1f=_0x491ad9(_0x1a434b,'('),_0x40cff4=_0x491ad9(_0x1a434b,')');if(_0xbb1d1f===_0x40cff4)_0x44b29b[_0x395bba(0x175)](_0xf40172(_0x1a434b,'\x22')),_0x584ca8='';else{if(_0x584ca8)_0x584ca8+=','+_0x6fb05d[_0x1249bd];else _0x584ca8+=_0x6fb05d[_0x1249bd];}}if(_0x44b29b[_0x395bba(0x18c)]===0x0)_0x44b29b=null;return[_0x56ad4b,_0x44b29b];};function _0x491ad9(_0x4de6b3,_0x5bebed){const _0xdaeb7d=_0x47219f;let _0x13c27a=0x0;for(let _0x1d3598=0x0;_0x1d3598<_0x4de6b3[_0xdaeb7d(0x18c)];_0x1d3598++){_0x4de6b3[_0xdaeb7d(0x128)](_0x1d3598)===_0x5bebed&&(_0x13c27a+=0x1);}return _0x13c27a;}const _0xf40172=(_0x23508b,_0x25a70a)=>{const _0x4bff2a=_0x47219f;if(typeof _0x23508b!=='string'||typeof _0x25a70a!==_0x4bff2a(0x16c))return _0x23508b;if(_0x23508b['length']===0x1)return _0x23508b;if(_0x25a70a[_0x4bff2a(0x18c)]!==0x1)return _0x23508b;return _0x23508b=_0x23508b[_0x4bff2a(0x134)](),_0x23508b[_0x4bff2a(0x14b)](0x0,0x1)===_0x25a70a&&(_0x23508b=_0x23508b[_0x4bff2a(0x14b)](0x1)),_0x23508b[_0x4bff2a(0x14b)](_0x23508b['length']-0x1)===_0x25a70a&&(_0x23508b=_0x23508b[_0x4bff2a(0x14b)](0x0,_0x23508b[_0x4bff2a(0x18c)]-0x1)),_0x23508b;},_0x1fe768=async(_0x17cc03,_0x364119,_0x42a811,_0x13cea3)=>{const _0x5d6d08=_0x47219f;if(!_0x364119||!_0x42a811||!_0x13cea3)return null;const [_0x3460f3,_0x1d5aa3]=_0x21e23a(_0x13cea3);if(!_0x3460f3||!_0x1d5aa3){const _0x1f9f18=_0x13cea3[_0x5d6d08(0x1db)]('(');if(_0x1f9f18[_0x5d6d08(0x18c)]>0x1){const _0x16760f=[_0x5d6d08(0x15c),_0x5d6d08(0x185),_0x5d6d08(0x1ba),_0x5d6d08(0x20d),_0x5d6d08(0x1ea),_0x5d6d08(0x1c3),_0x5d6d08(0x1c8),_0x5d6d08(0x195),_0x5d6d08(0x171)],_0x237e6f=_0x1f9f18[0x0][_0x5d6d08(0x183)]();if(_0x16760f[_0x5d6d08(0x199)](_0x237e6f))return null;}return _0x13cea3;}for(let _0xd773e6=0x0;_0xd773e6<_0x1d5aa3['length'];_0xd773e6++){if(_0x1d5aa3[_0xd773e6][_0x5d6d08(0x14b)](0x0,0x1)==='['){const _0x5797f8=_0x1d5aa3[_0xd773e6][_0x5d6d08(0x11a)](']');if(_0x5797f8<0x0)return null;const _0x438c6f=_0x1d5aa3[_0xd773e6][_0x5d6d08(0x14b)](0x1,_0x5797f8),_0x5d142a=_0x438c6f['split']('.');let _0xb886bc;for(let _0x34a18c=0x0;_0x34a18c<_0x5d142a[_0x5d6d08(0x18c)];_0x34a18c++){if(_0x34a18c===0x0)_0xb886bc=_0x364119[_0x5d142a[_0x34a18c]];else{if(!_0xb886bc)return null;_0xb886bc=_0xb886bc[_0x5d142a[_0x34a18c]];}}if(!_0xb886bc)return null;_0x1d5aa3[_0xd773e6]=_0xb886bc;}}for(let _0x5db66c=0x0;_0x5db66c<_0x1d5aa3[_0x5d6d08(0x18c)];_0x5db66c++){const [_0x2a1215]=_0x21e23a(_0x1d5aa3[_0x5db66c]);_0x2a1215&&(_0x1d5aa3[_0x5db66c]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x1d5aa3[_0x5db66c]));}if(_0x1d5aa3[0x0]===null)return null;switch(_0x3460f3[_0x5d6d08(0x183)]()){case'lowercase':{if(_0x1d5aa3[_0x5d6d08(0x18c)]!==0x1)return null;const [_0x3d034e]=_0x21e23a(_0x1d5aa3[0x0]);if(_0x3d034e)_0x1d5aa3[0x0]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x3d034e);if(_0x1d5aa3[0x0]===null)return null;return _0x1d5aa3[0x0][_0x5d6d08(0x183)]();}case _0x5d6d08(0x185):{if(_0x1d5aa3[_0x5d6d08(0x18c)]!==0x1)return null;const [_0x158f21]=_0x21e23a(_0x1d5aa3[0x0]);if(_0x158f21)_0x1d5aa3[0x0]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x158f21);if(_0x1d5aa3[0x0]===null)return null;return _0x1d5aa3[0x0][_0x5d6d08(0x16d)]();}case'firstn':{if(_0x1d5aa3[_0x5d6d08(0x18c)]!==0x2)return null;const [_0x313be7]=_0x21e23a(_0x1d5aa3[0x0]);if(_0x313be7)_0x1d5aa3[0x0]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x313be7);if(_0x1d5aa3[0x0]===null)return null;if(isNaN(_0x1d5aa3[0x1]))return null;return _0x1d5aa3[0x0][_0x5d6d08(0x14b)](0x0,_0x1d5aa3[0x1]);}case'elementnumber':{const [_0x13f07e]=_0x21e23a(_0x1d5aa3[0x0]);if(_0x1d5aa3[_0x5d6d08(0x18c)]<0x2)return null;if(_0x13f07e)_0x1d5aa3[0x0]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x13f07e);if(_0x1d5aa3[0x0]===null)return null;const _0xf4fbd1=_0x1d5aa3[0x1];if(isNaN(_0xf4fbd1))return null;let _0x4eada0;if(_0x1d5aa3[_0x5d6d08(0x18c)]===0x3)_0x4eada0=_0x1d5aa3[0x0][_0x5d6d08(0x1db)](_0x1d5aa3[0x2]);else _0x4eada0=_0x4eada0=_0x1d5aa3[0x0][_0x5d6d08(0x1db)]('\x20');if(_0xf4fbd1<=_0x4eada0[_0x5d6d08(0x18c)])return _0x4eada0[_0xf4fbd1-0x1];else return'';}case'replace':{const [_0x133152]=_0x21e23a(_0x1d5aa3[0x0]);if(_0x133152)_0x1d5aa3[0x0]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x133152);if(_0x1d5aa3[0x0]===null)return null;if(_0x1d5aa3['length']!==0x3)return null;return _0x1d5aa3[0x0][_0x5d6d08(0x109)](_0x1d5aa3[0x1],_0x1d5aa3[0x2]);}case'normalize':{if(_0x1d5aa3[_0x5d6d08(0x18c)]!==0x1)return null;const [_0x7c1f1c]=_0x21e23a(_0x1d5aa3[0x0]);if(_0x7c1f1c)_0x1d5aa3[0x0]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x7c1f1c);if(_0x1d5aa3[0x0]===null)return null;return a0_0x3ae810[_0x5d6d08(0x17e)](_0x1d5aa3[0x0]);}case _0x5d6d08(0x1ea):{let _0x1b08e4='';for(let _0x3aa763=0x0;_0x3aa763<_0x1d5aa3[_0x5d6d08(0x18c)];_0x3aa763++){const [_0x31487a]=_0x21e23a(_0x1d5aa3[_0x3aa763]);if(_0x31487a)_0x1d5aa3[_0x3aa763]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x31487a);if(_0x1d5aa3[_0x3aa763]===null)return null;_0x1b08e4+=_0x1d5aa3[_0x3aa763];}return _0x1b08e4;}case _0x5d6d08(0x195):{if(_0x1d5aa3['length']>0x2)return null;const [_0x1c16fa]=_0x21e23a(_0x1d5aa3[0x0]);if(_0x1c16fa)_0x1d5aa3[0x0]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x1c16fa);if(_0x1d5aa3[0x0]===null)return null;const _0x36de28=parseInt(_0x1d5aa3[0x0]);if(isNaN(_0x36de28))return null;let _0x58cbf0=_0x5d6d08(0x18d);_0x58cbf0+=','+_0x1d5aa3[0x0];if(_0x1d5aa3[_0x5d6d08(0x18c)]===0x2&&_0x1d5aa3[0x1][_0x5d6d08(0x183)]()===_0x5d6d08(0x114))_0x58cbf0+=',true';else _0x58cbf0+=_0x5d6d08(0x17c);return _0x58cbf0+='##',_0x58cbf0;}case _0x5d6d08(0x171):{if(_0x1d5aa3[_0x5d6d08(0x18c)]!==0x1)return null;const [_0x2e9e3a]=_0x21e23a(_0x1d5aa3[0x0]);if(_0x2e9e3a)_0x1d5aa3[0x0]=await _0x1fe768(_0x17cc03,_0x364119,_0x42a811,_0x2e9e3a);if(_0x1d5aa3[0x0]===null)return null;let _0x3e97c0,_0x55252e=![],_0x257973='';const _0x3d75e2=_0x1d5aa3[0x0]['split']('##');if(_0x3d75e2[_0x5d6d08(0x18c)]>0x2)for(let _0x5b628d=0x0;_0x5b628d<_0x3d75e2[_0x5d6d08(0x18c)];_0x5b628d++){if(_0x3d75e2[_0x5b628d][_0x5d6d08(0x1f7)]('doIncrement')){const _0x4ec8b4=_0x3d75e2[_0x5b628d][_0x5d6d08(0x1db)](',');if(_0x4ec8b4[_0x5d6d08(0x18c)]<0x2)return null;const _0x4a724f=parseInt(_0x4ec8b4[0x1]);if(isNaN(_0x4a724f))return null;_0x257973='##'+_0x3d75e2[_0x5b628d]+'##',_0x3e97c0=_0x4ec8b4[0x1],_0x4ec8b4[_0x5d6d08(0x18c)]>0x2&&(_0x55252e=_0x4ec8b4[0x2][_0x5d6d08(0x183)]()===_0x5d6d08(0x114));}}let _0x12d69d,_0x1cca43=0x0,_0x2d60dd=0x0;if(_0x3e97c0){_0x2d60dd=_0x3e97c0[_0x5d6d08(0x18c)],_0x1cca43=0xa;for(let _0x13e2aa=0x1;_0x13e2aa<_0x2d60dd;_0x13e2aa++){_0x1cca43*=0xa;}_0x1cca43-=0x1,_0x12d69d=parseInt(_0x3e97c0);if(isNaN(_0x12d69d))return null;_0x12d69d-=0x1;}else _0x12d69d=0x0;do{_0x12d69d+=0x1;let _0x57e5f4=_0x1d5aa3[0x0];if(_0x3e97c0!==undefined&&_0x257973){let _0x48586f=_0x12d69d[_0x5d6d08(0x120)]();while(_0x48586f['length']<_0x2d60dd){_0x48586f='0'+_0x48586f;}_0x55252e?_0x57e5f4=_0x57e5f4[_0x5d6d08(0x1c3)](_0x257973,_0x48586f):(_0x57e5f4=_0x57e5f4['replace'](_0x257973,''),_0x55252e=!![],_0x12d69d-=0x1);}try{const _0x329018=await _0x3f85b2(_0x17cc03,_0x42a811,_0x57e5f4);if(!_0x329018)return _0x57e5f4;}catch(_0x497207){return _0x441b67[_0x5d6d08(0x156)][_0x5d6d08(0x1b7)](_0x441b67[_0x5d6d08(0x231)]+'['+_0x441b67[_0x5d6d08(0x222)]+']\x20'+_0x3460f3+'\x20getUserId()\x20error:\x20'+_0x497207['message']),null;}}while(_0x12d69d<_0x1cca43);return null;}default:}return null;},_0x47e534=async(_0x37bedf,_0x375bec)=>{const _0x37104b=_0x47219f;for(const _0x5b7fe6 in _0x375bec){const _0x1497bb=_0x375bec[_0x5b7fe6],[_0x32552a,_0x5741c3]=_0x21e23a(_0x1497bb);if(_0x32552a){const _0x3dc929=''+_0x5b7fe6,_0x162157=_0x32552a+'('+_0x5741c3['join'](',')+')',_0x5180bc=await _0x1fe768(_0x37bedf,_0x375bec,_0x3dc929,_0x162157);if(_0x5180bc===null)delete _0x375bec[_0x5b7fe6];else _0x375bec[_0x5b7fe6]=_0x5180bc;}for(const _0x3a532d in _0x1497bb){const _0x4b77a3=_0x1497bb[_0x3a532d],[_0x7adc90,_0x3f4e82]=_0x21e23a(_0x4b77a3);if(_0x7adc90){const _0x138308=_0x5b7fe6+'.'+_0x3a532d,_0x3588ea=_0x7adc90+'('+_0x3f4e82[_0x37104b(0x1ea)](',')+')',_0x26dfa6=await _0x1fe768(_0x37bedf,_0x375bec,_0x138308,_0x3588ea);if(_0x26dfa6===null)delete _0x1497bb[_0x3a532d];else _0x1497bb[_0x3a532d]=_0x26dfa6;}}}return _0x375bec;},_0x2ffa50=async(_0x5b81f1,_0x32ea05,_0x4a11d7,_0x12741d)=>{const _0x4286dd=_0x47219f;if(!_0x591fdb)throw new Error(_0x4286dd(0x176));if(!_0x56f56b)throw new Error('subscriber\x20using\x20remote\x20gateway\x20through\x20chainingBaseUrl\x20requires\x20either\x20auth.tokenBearer\x20or\x20auth.basic\x20to\x20be\x20configured');try{if(!_0x441b67[_0x4286dd(0x1df)])_0x441b67[_0x4286dd(0x1df)]=_0x441b67[_0x4286dd(0x215)]();const _0x262db6={'headers':{'Authorization':_0x56f56b}},_0x17748b=await _0x441b67[_0x4286dd(0x1df)]['doRequest'](undefined,_0x32ea05,_0x591fdb+_0x4a11d7,_0x12741d,undefined,_0x262db6);return _0x17748b[_0x4286dd(0x1cf)];}catch(_0x46656a){try{const _0x16c391=JSON[_0x4286dd(0x1b8)](_0x46656a['message']);if(_0x16c391['body'])throw new Error(JSON[_0x4286dd(0x1b9)](_0x16c391['body']));throw new Error(_0x46656a['message']);}catch(_0x3db80d){throw new Error(_0x4286dd(0x164)+_0x3db80d[_0x4286dd(0x227)]);}}},_0x31b666=async _0x4e00c6=>{const _0x23af70=_0x47219f,_0x5e5cc5=_0x441b67[_0x23af70(0x217)][_0x23af70(0x141)][_0x23af70(0x169)];if(!_0x5e5cc5){_0x4e00c6[_0x23af70(0x1c6)]['status']=0x1f4,_0x441b67[_0x23af70(0x156)][_0x23af70(0x1b7)](_0x441b67['gwName']+'['+_0x441b67[_0x23af70(0x222)]+_0x23af70(0x1ca));return;}try{new URL(_0x5e5cc5);}catch(_0x988289){_0x4e00c6['response'][_0x23af70(0x202)]=0x1f4,_0x441b67[_0x23af70(0x156)]['error'](_0x441b67['gwName']+'['+_0x441b67[_0x23af70(0x222)]+_0x23af70(0x174)+_0x988289['message']);return;}try{if(!_0x441b67[_0x23af70(0x1df)])_0x441b67['helperRest']=_0x441b67[_0x23af70(0x215)]();const _0x5b6ed1=new URL(_0x4e00c6[_0x23af70(0x160)][_0x23af70(0x1ff)]),_0x2066a3=_0x4e00c6[_0x23af70(0x160)][_0x23af70(0x1a3)],_0x3a7919=_0x4e00c6['request'][_0x23af70(0x1ff)]['replace'](_0x5b6ed1[_0x23af70(0x1b0)],_0x5e5cc5),_0x6b29f9=_0x4e00c6[_0x23af70(0x160)][_0x23af70(0x1cf)],_0x4da6e8={'headers':{'Authorization':_0x4e00c6[_0x23af70(0x160)]['headers']['authorization']}},_0x3eedda=await _0x441b67[_0x23af70(0x1df)][_0x23af70(0x1b1)](_0x23af70(0x135),_0x2066a3,_0x3a7919,_0x6b29f9,undefined,_0x4da6e8);_0x4e00c6['response'][_0x23af70(0x202)]=_0x3eedda[_0x23af70(0x22c)];try{_0x4e00c6[_0x23af70(0x1c6)][_0x23af70(0x1cf)]=JSON['stringify'](_0x3eedda[_0x23af70(0x1cf)]);}catch(_0x5d2d26){_0x4e00c6[_0x23af70(0x1c6)][_0x23af70(0x1cf)]=_0x3eedda['body'];}}catch(_0x5ec733){try{const _0xd0add5=JSON[_0x23af70(0x1b8)](_0x5ec733[_0x23af70(0x227)]);_0x4e00c6['response'][_0x23af70(0x202)]=_0xd0add5?.[_0x23af70(0x1cf)]?.['status']||_0xd0add5?.[_0x23af70(0x22c)]||0x1f4,_0x4e00c6[_0x23af70(0x1c6)]['body']=_0xd0add5[_0x23af70(0x1cf)]?JSON[_0x23af70(0x1b9)](_0xd0add5[_0x23af70(0x1cf)]):_0x5ec733[_0x23af70(0x227)];}catch(_0x1796fe){_0x4e00c6[_0x23af70(0x1c6)][_0x23af70(0x202)]=0x1f4,_0x441b67[_0x23af70(0x156)]['error'](_0x441b67[_0x23af70(0x231)]+'['+_0x441b67[_0x23af70(0x222)]+_0x23af70(0x16a)+_0x5ec733['message']);}}};}}export class Publisher{constructor(_0x34a17d){const _0x2821b2=a0_0x34a9,_0xdf5cee=_0x34a17d,_0x1135bc={},_0x57c9e7=async(_0x238fd1,_0x520cd1)=>{const _0x532dfc=a0_0x34a9,_0x42536e=_0x1135bc[_0x238fd1]['config']?.[_0x532dfc(0x12f)]?.['subject'];let _0x1b2219=0x0;for await(const _0x257a56 of _0x520cd1[_0x532dfc(0x202)]()){switch(_0x257a56[_0x532dfc(0x1eb)]){case'disconnect':_0xdf5cee[_0x532dfc(0x156)]['error'](_0xdf5cee['gwName']+'['+_0xdf5cee['pluginName']+_0x532dfc(0x1d4)+_0x238fd1+']['+_0x42536e+_0x532dfc(0x158)+_0x257a56[_0x532dfc(0x11f)]+_0x532dfc(0x1b5)),_0x1b2219=0x0;break;case'reconnect':_0xdf5cee['logger'][_0x532dfc(0x126)](_0xdf5cee['gwName']+'['+_0xdf5cee['pluginName']+_0x532dfc(0x1d4)+_0x238fd1+']['+_0x42536e+_0x532dfc(0x20f)+_0x257a56['data']);break;case _0x532dfc(0x1b7):_0xdf5cee['logger'][_0x532dfc(0x1b7)](_0xdf5cee['gwName']+'['+_0xdf5cee[_0x532dfc(0x222)]+_0x532dfc(0x1d4)+_0x238fd1+']['+_0x42536e+']\x20client\x20error\x20'+_0x257a56[_0x532dfc(0x11f)]);break;case _0x532dfc(0x123):_0x1b2219+=0x1;_0x1b2219%0x1e===0x0&&_0xdf5cee[_0x532dfc(0x156)]['debug'](_0xdf5cee[_0x532dfc(0x231)]+'['+_0xdf5cee[_0x532dfc(0x222)]+_0x532dfc(0x1d4)+_0x238fd1+']['+_0x42536e+_0x532dfc(0x108)+_0x257a56[_0x532dfc(0x11f)]+_0x532dfc(0x17a)+_0x1b2219+')');break;case _0x532dfc(0x163):_0xdf5cee['logger'][_0x532dfc(0x118)](_0xdf5cee[_0x532dfc(0x231)]+'['+_0xdf5cee[_0x532dfc(0x222)]+']\x20publisher['+_0x238fd1+']['+_0x42536e+_0x532dfc(0x230)+_0x257a56[_0x532dfc(0x11f)]);break;}}},_0x58b20e=async(_0x164c19,_0x3918c0)=>{const _0x2b2ff1=a0_0x34a9,_0x180dc2=_0x1135bc[_0x164c19]['config']?.[_0x2b2ff1(0x12f)]?.[_0x2b2ff1(0x172)];let _0xc2c572;try{_0xc2c572=await a0_0xa30659(_0x3918c0);if(_0xc2c572[_0x2b2ff1(0x126)][_0x2b2ff1(0x1aa)]!==_0x2b2ff1(0x1bb)){_0xc2c572[_0x2b2ff1(0x1fe)]();return;}_0x1135bc[_0x164c19]['nc']=_0xc2c572,_0x57c9e7(_0x164c19,_0xc2c572);}catch(_0x5626b5){_0xdf5cee[_0x2b2ff1(0x156)][_0x2b2ff1(0x1b7)](_0xdf5cee[_0x2b2ff1(0x231)]+'['+_0xdf5cee[_0x2b2ff1(0x222)]+_0x2b2ff1(0x1d4)+_0x164c19+']['+_0x180dc2+_0x2b2ff1(0x110)+_0x5626b5['message']+_0x2b2ff1(0x1a1)),_0x3918c0[_0x2b2ff1(0x139)]=!![];try{_0xc2c572=await a0_0xa30659(_0x3918c0);if(_0xc2c572[_0x2b2ff1(0x126)][_0x2b2ff1(0x1aa)]!==_0x2b2ff1(0x1bb)){_0xc2c572[_0x2b2ff1(0x1fe)]();return;}_0x1135bc[_0x164c19]['nc']=_0xc2c572,_0x57c9e7(_0x164c19,_0xc2c572);}catch(_0x2521e){_0xdf5cee[_0x2b2ff1(0x156)][_0x2b2ff1(0x1b7)](_0xdf5cee[_0x2b2ff1(0x231)]+'['+_0xdf5cee[_0x2b2ff1(0x222)]+']\x20publisher['+_0x164c19+']['+_0x180dc2+_0x2b2ff1(0x110)+_0x2521e[_0x2b2ff1(0x227)]);return;}}_0xdf5cee[_0x2b2ff1(0x156)][_0x2b2ff1(0x118)](_0xdf5cee[_0x2b2ff1(0x231)]+'['+_0xdf5cee[_0x2b2ff1(0x222)]+']\x20publisher['+_0x164c19+']['+_0x180dc2+']\x20connected\x20'+(_0x3918c0[_0x2b2ff1(0x140)]['ca']?_0x2b2ff1(0x140):'')+'\x20'+_0xc2c572[_0x2b2ff1(0x1cd)]()),_0xc2c572[_0x2b2ff1(0x132)]()[_0x2b2ff1(0x18b)](_0x51a041=>{const _0x1d5c7c=_0x2b2ff1;_0x51a041&&_0xdf5cee[_0x1d5c7c(0x156)]['error'](_0xdf5cee[_0x1d5c7c(0x231)]+'['+_0xdf5cee[_0x1d5c7c(0x222)]+_0x1d5c7c(0x1d4)+_0x164c19+']['+_0x180dc2+_0x1d5c7c(0x119)+_0x51a041[_0x1d5c7c(0x227)]);});};this[_0x2821b2(0x1f4)]=async(_0x4731e4,_0x20c1b6)=>{const _0x2e16a3=_0x2821b2;if(!_0x20c1b6?.[_0x2e16a3(0x12f)]){_0xdf5cee[_0x2e16a3(0x156)][_0x2e16a3(0x1b7)](_0xdf5cee[_0x2e16a3(0x231)]+'['+_0xdf5cee[_0x2e16a3(0x222)]+_0x2e16a3(0x1d4)+_0x4731e4+_0x2e16a3(0x1dc));return;}if(!_0x20c1b6?.[_0x2e16a3(0x12f)]?.[_0x2e16a3(0x21f)]){_0xdf5cee[_0x2e16a3(0x156)][_0x2e16a3(0x1b7)](_0xdf5cee[_0x2e16a3(0x231)]+'['+_0xdf5cee[_0x2e16a3(0x222)]+_0x2e16a3(0x1d4)+_0x4731e4+_0x2e16a3(0x197));return;}if(!_0x20c1b6?.[_0x2e16a3(0x12f)]?.[_0x2e16a3(0x172)]){_0xdf5cee[_0x2e16a3(0x156)][_0x2e16a3(0x1b7)](_0xdf5cee[_0x2e16a3(0x231)]+'['+_0xdf5cee['pluginName']+_0x2e16a3(0x1d4)+_0x4731e4+_0x2e16a3(0x1f8));return;}if(!_0x20c1b6?.[_0x2e16a3(0x12f)]?.[_0x2e16a3(0x172)][_0x2e16a3(0x1f7)]('GW.')){_0xdf5cee[_0x2e16a3(0x156)][_0x2e16a3(0x1b7)](_0xdf5cee['gwName']+'['+_0xdf5cee[_0x2e16a3(0x222)]+_0x2e16a3(0x1d4)+_0x4731e4+_0x2e16a3(0x10f));return;}if(!_0x20c1b6[_0x2e16a3(0x178)]||!Array[_0x2e16a3(0x1c7)](_0x20c1b6[_0x2e16a3(0x178)])||_0x20c1b6['baseUrls']['length']<0x1){_0xdf5cee[_0x2e16a3(0x156)][_0x2e16a3(0x1b7)](_0xdf5cee[_0x2e16a3(0x231)]+'['+_0xdf5cee[_0x2e16a3(0x222)]+']\x20publisher['+_0x4731e4+']\x20initialization\x20error:\x20missing\x20configuration\x20stream.baseUrls');return;}if(!_0x20c1b6?.[_0x2e16a3(0x127)]?.['ca']){_0xdf5cee[_0x2e16a3(0x156)][_0x2e16a3(0x1b7)](_0xdf5cee[_0x2e16a3(0x231)]+'['+_0xdf5cee[_0x2e16a3(0x222)]+_0x2e16a3(0x1d4)+_0x4731e4+']\x20initialization\x20error:\x20missing\x20certificate\x20configuration');return;}const _0x2ee33f={};try{let _0x521168=a0_0x486815[_0x2e16a3(0x1ea)](_0xdf5cee[_0x2e16a3(0x1ab)],_0x2e16a3(0x204),_0x20c1b6?.[_0x2e16a3(0x127)]?.['ca']||_0x2e16a3(0x159));(_0x20c1b6?.[_0x2e16a3(0x127)]?.['ca']?.[_0x2e16a3(0x1f7)]('/')||_0x20c1b6?.[_0x2e16a3(0x127)]?.['ca']?.['includes']('\x5c'))&&(_0x521168=_0x20c1b6[_0x2e16a3(0x127)]['ca']),_0x2ee33f['ca']=[a0_0x1d49b8[_0x2e16a3(0x208)](_0x521168)],_0x2ee33f[_0x2e16a3(0x129)]=!![];}catch(_0x134a57){_0xdf5cee[_0x2e16a3(0x156)][_0x2e16a3(0x1b7)](_0xdf5cee[_0x2e16a3(0x231)]+'['+_0xdf5cee[_0x2e16a3(0x222)]+_0x2e16a3(0x1d4)+_0x4731e4+_0x2e16a3(0x1fa)+_0x134a57[_0x2e16a3(0x227)]);return;}const _0xfc3920={},_0x20281d=new TextEncoder()[_0x2e16a3(0x15f)](_0x20c1b6?.[_0x2e16a3(0x12f)]?.['secret']),_0x123e16=_0x20c1b6?.[_0x2e16a3(0x12f)]?.['jwt'];_0xfc3920[_0x2e16a3(0x1e4)]=jwtAuthenticator(_0x123e16,_0x20281d),_0xfc3920[_0x2e16a3(0x166)]=_0x20c1b6[_0x2e16a3(0x178)],_0xfc3920[_0x2e16a3(0x140)]=_0x2ee33f,_0xfc3920[_0x2e16a3(0x139)]=![],_0xfc3920[_0x2e16a3(0x228)]=!![],_0xfc3920[_0x2e16a3(0x177)]=0x3e8*0xa,_0xfc3920[_0x2e16a3(0x198)]=-0x1,_0xfc3920[_0x2e16a3(0x210)]=0x2*0x3c*0x3e8,_0xfc3920['maxPingOut']=0x5,_0xfc3920[_0x2e16a3(0x118)]=![],_0x1135bc[_0x4731e4]={},_0x1135bc[_0x4731e4][_0x2e16a3(0x217)]=_0x20c1b6,_0x1135bc[_0x4731e4]['nc']=undefined,_0x58b20e(_0x4731e4,_0xfc3920);},this[_0x2821b2(0x11e)]=async _0x592ec3=>{const _0x3c4775=_0x2821b2;let _0x9877b9;const _0x5dc394=a0_0x7ebed9[_0x3c4775(0x1c0)]();try{if(_0x592ec3[_0x3c4775(0x207)]===Object){_0x9877b9=_0x592ec3[_0x3c4775(0x206)];if(!_0x9877b9)_0x592ec3['baseEntity']=_0x3c4775(0x135);if(_0x592ec3?.[_0x3c4775(0x1f5)]?.[_0x3c4775(0x160)]?.[_0x3c4775(0x145)]){const _0x3e19e9=_0x592ec3[_0x3c4775(0x1f5)][_0x3c4775(0x160)]['headers'][_0x3c4775(0x173)](_0x3c4775(0x165));if(_0x3e19e9)_0x592ec3['ctx'][_0x3c4775(0x160)][_0x3c4775(0x145)][_0x3c4775(0x105)](_0x3c4775(0x165),a0_0x197b83[_0x3c4775(0x22a)](_0x3e19e9,_0x5dc394));}if(_0x592ec3?.['ctx']?.['passThrough']?.[_0x3c4775(0x145)]){const _0x53e597=_0x592ec3[_0x3c4775(0x1f5)][_0x3c4775(0x14e)]['headers'][_0x3c4775(0x173)](_0x3c4775(0x165));if(_0x53e597)_0x592ec3[_0x3c4775(0x1f5)][_0x3c4775(0x14e)][_0x3c4775(0x145)][_0x3c4775(0x105)](_0x3c4775(0x165),a0_0x197b83['getEncrypted'](_0x53e597,_0x5dc394));}_0x592ec3=JSON[_0x3c4775(0x1b9)](_0x592ec3);}else{const _0x5b5f40=JSON[_0x3c4775(0x1b8)](_0x592ec3);_0x9877b9=_0x5b5f40[_0x3c4775(0x206)];}}catch(_0xcbedbe){throw new Error('publisher['+_0x9877b9+']\x20error:\x20message\x20must\x20be\x20JSON\x20formatted');}if(!_0x1135bc[_0x9877b9])throw new Error(_0x3c4775(0x14c)+_0x9877b9+_0x3c4775(0x1b2)+_0x9877b9);const _0x579dee=headers();_0x579dee[_0x3c4775(0x161)](_0x3c4775(0x116),_0x5dc394);let _0x530bd2;try{if(!_0x1135bc[_0x9877b9]['nc'])throw new Error('publisher\x20not\x20initialized/connected');_0x530bd2=await _0x1135bc[_0x9877b9]['nc']['request'](_0x1135bc[_0x9877b9][_0x3c4775(0x217)]?.[_0x3c4775(0x12f)]?.[_0x3c4775(0x172)],_0x592ec3,{'headers':_0x579dee});}catch(_0x4a9429){if(_0x4a9429['message']===_0x3c4775(0x1bc))throw new Error(_0x3c4775(0x14c)+_0x9877b9+_0x3c4775(0x186)+_0x1135bc[_0x9877b9][_0x3c4775(0x217)]?.[_0x3c4775(0x12f)]?.[_0x3c4775(0x172)]);else throw new Error(_0x3c4775(0x14c)+_0x9877b9+_0x3c4775(0x167)+_0x4a9429[_0x3c4775(0x227)]);}let _0x4a9268;try{_0x4a9268=JSON['parse'](_0x530bd2[_0x3c4775(0x16c)]());try{JSON['parse'](_0x4a9268[_0x3c4775(0x1cf)]);if(!_0x4a9268['headers'])_0x4a9268[_0x3c4775(0x145)]={};if(!_0x4a9268[_0x3c4775(0x145)][_0x3c4775(0x1b3)])_0x4a9268[_0x3c4775(0x145)][_0x3c4775(0x1b3)]=_0x3c4775(0x1f6);}catch(_0x48291b){void 0x0;}}catch(_0x193e75){throw new Error(_0x3c4775(0x1a9)+_0x530bd2[_0x3c4775(0x16c)]());}if(_0x4a9268?.[_0x3c4775(0x1b7)]){const _0x3421ff=new Error(_0x3c4775(0x1fc)+_0x4a9268[_0x3c4775(0x1b7)]);_0x3421ff['name']=_0x4a9268[_0x3c4775(0x1ac)];throw _0x3421ff;}return _0x4a9268;},process['on']('SIGTERM',async()=>{const _0x2567ca=_0x2821b2;for(const _0x15fd82 in _0x1135bc){_0x1135bc[_0x15fd82]['nc']&&!_0x1135bc[_0x15fd82]['nc'][_0x2567ca(0x13e)]()&&await _0x1135bc[_0x15fd82]['nc'][_0x2567ca(0x1c1)]();}}),process['on']('SIGINT',async()=>{const _0x2f5349=_0x2821b2;for(const _0x18ee49 in _0x1135bc){_0x1135bc[_0x18ee49]['nc']&&!_0x1135bc[_0x18ee49]['nc']['isClosed']()&&await _0x1135bc[_0x18ee49]['nc'][_0x2f5349(0x1c1)]();}});}}export const getAppRoles=async(_0x2975d2,_0x49aff4)=>{const _0x2fc120=a0_0x34a9,_0x28a463=_0x2fc120(0x15e),_0x3b55c6=_0x2975d2;_0x3b55c6[_0x2fc120(0x156)][_0x2fc120(0x118)](_0x3b55c6[_0x2fc120(0x231)]+'['+_0x3b55c6[_0x2fc120(0x222)]+_0x2fc120(0x1a4)+_0x28a463+'\x22');try{if(!a0_0x1d49b8[_0x2fc120(0x194)](_0x3b55c6['configDir']+_0x2fc120(0x1c9)))a0_0x1d49b8['mkdirSync'](_0x3b55c6[_0x2fc120(0x1ab)]+_0x2fc120(0x1c9));}catch(_0x4b5733){void 0x0;}const _0x5cddf1=a0_0x486815[_0x2fc120(0x1ea)](''+_0x3b55c6[_0x2fc120(0x1ab)],_0x2fc120(0x21d),'approles_'+_0x3b55c6[_0x2fc120(0x222)]+_0x2fc120(0x106)),_0x971eb={};a0_0x197b83[_0x2fc120(0x229)](_0x5cddf1)&&a0_0x1d49b8['readFileSync'](_0x5cddf1,_0x2fc120(0x226))['split'](/\r?\n/)[_0x2fc120(0x214)](_0xef7148=>{const _0xe9cf16=_0x2fc120,_0x4d19d4=_0xef7148['split']('\x20');_0x4d19d4[_0xe9cf16(0x18c)]===0x2&&(_0x971eb[_0x4d19d4[0x0]]=_0x4d19d4[0x1]);});const _0x4855eb=a0_0x1d49b8[_0x2fc120(0x20a)](_0x5cddf1,{'flags':'w','encoding':'utf8','mode':0x1b6,'autoClose':!![]}),_0x29fafc=[],_0x104564=await _0x3b55c6[_0x2fc120(0x200)](_0x49aff4,{'attribute':undefined,'operator':undefined,'value':undefined},['id',_0x2fc120(0x16f)]);return _0x104564['Resources'][_0x2fc120(0x214)](_0x1dacc1=>{const _0x27720f=_0x2fc120;if(_0x1dacc1['id']){let _0x457b54=a0_0x7ebed9['randomUUID']();if(_0x971eb[_0x1dacc1['id']])_0x457b54=_0x971eb[_0x1dacc1['id']];const _0x55b443={'allowedMemberTypes':[_0x27720f(0x1f3)],'description':_0x27720f(0x196),'displayName':_0x1dacc1['displayName']||_0x1dacc1['id'],'id':_0x457b54,'isEnabled':!![],'lang':null,'origin':_0x27720f(0x17f),'value':decodeURIComponent(_0x1dacc1['id'])};_0x29fafc[_0x27720f(0x175)](_0x55b443),_0x4855eb[_0x27720f(0x1d9)](_0x1dacc1['id']+'\x20'+_0x457b54+'\x0a');}}),_0x4855eb[_0x2fc120(0x1fe)](),_0x3b55c6[_0x2fc120(0x156)][_0x2fc120(0x118)](_0x3b55c6['gwName']+'['+_0x3b55c6[_0x2fc120(0x222)]+_0x2fc120(0x138)+_0x5cddf1),{'Resources':[{'appRoles':_0x29fafc}]};};