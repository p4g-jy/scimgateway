// ================================================================
// File:    scim-stream.js
//
// Author:  Jarle Elshaug
//
// Purpose: SCIM Stream message subscription and automated provisioning
//          Gateway publishing to SCIM Stream having other gateways as subscribers handling requests
//          getApproles() for exporting all groups into Entra ID AppRole manifest-format
//
// Note: scim-stream.js is part of the licensed SCIM Stream which is a prerequisite for message Pub/Sub
//       for details see: https://elshaug.xyz/docs/scim-stream
//
// ================================================================
'use strict';(function(_0x3fb99c,_0x33584e){const _0x2a378e=a0_0xab49,_0xcc2341=_0x3fb99c();while(!![]){try{const _0x50162b=parseInt(_0x2a378e(0x71))/0x1+parseInt(_0x2a378e(0x118))/0x2*(-parseInt(_0x2a378e(0x11d))/0x3)+parseInt(_0x2a378e(0x96))/0x4*(parseInt(_0x2a378e(0x133))/0x5)+parseInt(_0x2a378e(0x6c))/0x6*(-parseInt(_0x2a378e(0x11c))/0x7)+-parseInt(_0x2a378e(0xa4))/0x8*(parseInt(_0x2a378e(0x188))/0x9)+-parseInt(_0x2a378e(0x127))/0xa+parseInt(_0x2a378e(0xf5))/0xb;if(_0x50162b===_0x33584e)break;else _0xcc2341['push'](_0xcc2341['shift']());}catch(_0x2cfb02){_0xcc2341['push'](_0xcc2341['shift']());}}}(a0_0x40c3,0xc84c6));import{jwtAuthenticator,headers}from'@nats-io/nats-core';import{jetstream,jetstreamManager,DeliverPolicy,AckPolicy}from'@nats-io/jetstream';import{connect as a0_0x2cc5a3}from'@nats-io/transport-node';function a0_0xab49(_0x3379b6,_0x52db9f){const _0x40c392=a0_0x40c3();return a0_0xab49=function(_0xab49a0,_0x5477ed){_0xab49a0=_0xab49a0-0x67;let _0x51d573=_0x40c392[_0xab49a0];return _0x51d573;},a0_0xab49(_0x3379b6,_0x52db9f);}import a0_0x38a5e6 from'fold-to-ascii';import a0_0x4b3d48 from'node:fs';function a0_0x40c3(){const _0x4470bd=['replaceAll','POST',']\x20handling\x20\x22','?filter=userName\x20eq\x20\x22','readFileSync','publisher\x20not\x20initialized/connected','routeObj',',\x20obj=','Msg-Id','subscribe','tls','data','close',']\x20connected\x20','typeId',']\x20initialization\x20error:\x20missing\x20configuration\x20nats.tenant','DELETE\x20users','newHelperRest','?attributes=','ctx','POST\x20groups','_autogenerated.cfg','generateUserPassword','set','modifyUser','errName','/Users/','\x20error:\x20missing\x20id}',']\x20initialization\x20error:\x20missing\x20configuration\x20stream.baseUrls','write','##doIncrement','firstn','lowercase','POST\x20users','encode','url','username','publisher\x20response\x20error:\x20','putHandler','\x20subscriber\x20error:\x20scimgateway\x20endpoint\x20connect\x20problem\x20-\x20will\x20do\x20auto\x20retry\x20until\x20connected','statusCode','value','secret','externalId',']\x20error:\x20client\x20have\x20not\x20been\x20initialized','nats','type','gwName','\x20message:\x20','ack','info','server_name','\x20Replace\x20User\x20id=','{\x22error\x22:\x22','PUT\x20api','}\x20message\x20response:\x20','headers','from','\x20missing\x20mandatory\x20user.userName\x20in\x20message:\x20','DELETE\x20groups','authenticator','consumers','onCreate','elementnumber','\x20Delete\x20User\x20id=','user','Users','foldReplacing','23784332vhFiKX','trim','Explicit','constructor',']\x20initialization\x20certificate\x20error:\x20','userName','PATCH\x20users','activityOperation','getApiHandler','Operations','maxReconnectAttempts','publisher\x20error:\x20none\x20JSON\x20formatted\x20response:\x20','then','substring','GET\x20serviceproviderconfigs','name','&attributes=','startsWith',']\x20onChainingHandler\x20error:\x20configuration\x20scimgateway.chainingBaseUrl\x20must\x20use\x20correct\x20syntax\x20\x27http(s)://host:port\x27\x20error:\x20','length','error','split','rejectUnauthorized','forEach','GET\x20api','deleteUser','getHandlerId',',\x20id=','getUsers()\x20error:\x20unsupported\x20operator\x20for\x20getObj:\x20','application/scim+json;\x20charset=utf-8','patchApiHandler','certificate','baseUrls','handle','passThrough','13814ORfZJa','roles','scimgateway','includes','228557dzOwUl','378rBadZb','operation','}\x20message\x20error\x20response:\x20',']\x20client\x20has\x20a\x20stale\x20connection\x20','basic',']\x20initialization\x20error:\x20missing\x20certificate\x20configuration','jwt','DELETE\x20api','replaceUsrGrp','GET\x20schemas','13462210UnVPYp',']\x20initialization\x20error:\x20missing\x20configuration\x20nats','false','utf-8','getEncrypted','active','password','base64','chainingBaseUrl',']\x20initialization\x20error:\x20nats.subject\x20root\x20topic\x20must\x20be\x20\x27GW\x27,\x20nats.subject\x20example:\x20GW.APP1','convertedScim20','randomUUID','1867475SeepDC','display','SCIM-Stream',']\x20closed\x20with\x20error:\x20',']\x20initialization\x20error:\x20missing\x20configuration\x20nats.subject','logger','method','approles_','respond','\x20handling\x20message:\x20','isClosed','config','\x20message\x20json\x20parsing\x20error:\x20','path','staleConnection','join','message','pluginName',']\x20onChainingHandler\x20error:\x20configuration\x20scimgateway.chainingBaseUrl\x20missing','toString','delete','auth','pingInterval','toUpperCase','baseEntity','debug','stringify',']\x20approle\x20uuid\x20file\x20created:\x20','\x20error:\x20more\x20than\x20one\x20user\x20were\x20found}','/approles','\x20(count=',']\x20error:\x20missing\x20entity\x20configuration\x20for\x20baseEntity=','getServer','GET\x20serviceplans',']\x20connect\x20error:\x20','\x20=>\x20subscriber\x20not\x20activated','doRequest','\x20role\x20removal\x20error:\x20','disconnect','?filter=externalId\x20eq\x20\x22','charAt','/Users','subscriber\x20using\x20remote\x20gateway\x20through\x20chainingBaseUrl\x20requires\x20either\x20auth.tokenBearer\x20or\x20auth.basic\x20to\x20be\x20configured','doIncrement','response','PATCH\x20api','internal\x20stream\x20policy\x20have\x20been\x20changed\x20-\x20central\x20SCIM\x20Stream\x20must\x20be\x20stopped\x20and\x20corresponding\x20./jetstream\x20folder\x20deleted\x20before\x20startup\x20allowing\x20new\x20policy','\x20message:\x20user\x20does\x20not\x20exist','\x20done','reconnectTimeWait','modifyOnly','publish','HR.','publisher[','usePutSoftSync','replace','all','helperRest',']\x20publisher[','origin','PUT\x20users',']\x20client\x20error\x20','POST\x20api',']\x20error:\x20','get','getHandler','prototype','filter_subject','obj','reconnecting','GET\x20users','\x20message\x20handled:\x20','remove','streamChaining\x20error:\x20','toLowerCase','Resources','UnableConnectingHost','PUT\x20groups','fsExistsSync','getuniquevalue','SIGINT','parse','closed','\x20-\x20will\x20do\x20auto\x20reconnect\x20when\x20connection\x20becomes\x20available','getGroups','63aLpULJ','deleteApiHandler','normalize',']\x20client\x20reconnected\x20',',true','servers','content-type','waitOnFirstConnect','42wpgpyG','drain','groups','\x20getUserId()\x20error:\x20','subject','1620462dmlTvv',']\x20error:\x20message\x20must\x20be\x20JSON\x20formatted','mkdirSync','maxPingOut','durable_','/certs/','\x20processing\x20incoming\x20message','\x20message:\x20user\x20not\x20created\x20because\x20of\x20configuration\x20modifyOnly=true','add',']\x20error:\x20no\x20subscribers/responders\x20to\x20subject\x20','patchHandler','undefined','request','consumer_not_found','append','PATCH\x20groups','attribute','createWriteStream','SIGTERM','string','\x20Create\x20User\x20userName=','ETIMEDOUT','Application','configDir','_info','replaceDomains','bearerToken','streamChaining\x20called\x20but\x20missing\x20chainingBaseUrl','\x20error:\x20missing\x20result',']\x20client\x20is\x20attempting\x20to\x20reconnect\x20','authorization','status','\x20Create\x20userName=','func','uppercase','Bearer\x20','getUsers','4woMOIe','\x20message:\x20user\x20not\x20created\x20because\x20of\x20active=false','\x20-\x20','getHandlerSchemas',']\x20subscriber[','sub','tenant','indexOf','reconnect','copyObj',']\x20onChainingHandler\x20error:\x20','isArray','displayName','\x20error:\x20','1017928prYiOs','503','token','All','PUT',']\x20client\x20disconnected\x20','true','file-not-configured','push','skipConvertRolesToGroups','timeout','getUsers()\x20getObj=','body'];a0_0x40c3=function(){return _0x4470bd;};return a0_0x40c3();}import a0_0x3f43f4 from'node:path';import a0_0xc5a644 from'node:crypto';import*as a0_0x5892aa from'./utils.ts';import*as a0_0x502367 from'./utils-scim.ts';export class Subscriber{constructor(_0x174530,_0x5d2fa5){const _0x2fe9b2=a0_0xab49,_0x2730d1=_0x174530,_0x25503f={},_0x4e0537=_0x2730d1[_0x2fe9b2(0x13e)][_0x2fe9b2(0x11a)]['chainingBaseUrl'];let _0x2a68a4='';if(_0x4e0537){if(_0x2730d1['config']['scimgateway']?.[_0x2fe9b2(0x148)]?.['bearerToken']&&Array['isArray'](_0x2730d1[_0x2fe9b2(0x13e)][_0x2fe9b2(0x11a)][_0x2fe9b2(0x148)][_0x2fe9b2(0x8b)])&&_0x2730d1[_0x2fe9b2(0x13e)][_0x2fe9b2(0x11a)]['auth'][_0x2fe9b2(0x8b)][_0x2fe9b2(0x108)]>0x0){const _0x353b91=_0x2730d1['config']['scimgateway']['auth'][_0x2fe9b2(0x8b)];if(_0x353b91[0x0][_0x2fe9b2(0xa6)]){const _0x25fc28=Buffer[_0x2fe9b2(0xea)](_0x353b91[0x0]['token'])[_0x2fe9b2(0x146)](_0x2fe9b2(0x12e));_0x2a68a4=_0x2fe9b2(0x94)+_0x25fc28;}}if(!_0x2a68a4&&_0x2730d1[_0x2fe9b2(0x13e)][_0x2fe9b2(0x11a)]?.[_0x2fe9b2(0x148)]?.[_0x2fe9b2(0x121)]&&Array['isArray'](_0x2730d1[_0x2fe9b2(0x13e)][_0x2fe9b2(0x11a)][_0x2fe9b2(0x148)][_0x2fe9b2(0x121)])&&_0x2730d1[_0x2fe9b2(0x13e)][_0x2fe9b2(0x11a)][_0x2fe9b2(0x148)][_0x2fe9b2(0x121)][_0x2fe9b2(0x108)]>0x0){const _0x234899=_0x2730d1[_0x2fe9b2(0x13e)][_0x2fe9b2(0x11a)][_0x2fe9b2(0x148)][_0x2fe9b2(0x121)];if(_0x234899[0x0][_0x2fe9b2(0xd5)]&&_0x234899[0x0][_0x2fe9b2(0x12d)]){const _0x23a5ee=Buffer[_0x2fe9b2(0xea)](_0x234899[0x0]['username']+':'+_0x234899[0x0][_0x2fe9b2(0x12d)])[_0x2fe9b2(0x146)]('base64');_0x2a68a4='Basic\x20'+_0x23a5ee;}}}const _0xfc3216=async(_0x6148eb,_0x2ba0c4)=>{const _0x466898=_0x2fe9b2,_0x5efcbe=_0x25503f[_0x6148eb][_0x466898(0x13e)]?.['nats']?.[_0x466898(0x70)];let _0x10268b;try{_0x10268b=await a0_0x2cc5a3(_0x2ba0c4);if(_0x10268b[_0x466898(0xe3)][_0x466898(0xe4)]!==_0x466898(0x135)){_0x10268b['close']();return;}_0x25503f[_0x6148eb]['nc']=_0x10268b,_0x10b2ac(_0x6148eb,_0x10268b),_0x1cdc48(_0x6148eb,_0x10268b);}catch(_0x20086a){_0x2730d1['logger']['error'](_0x2730d1[_0x466898(0xe0)]+'['+_0x2730d1[_0x466898(0x144)]+']\x20subscriber['+_0x6148eb+']['+_0x5efcbe+_0x466898(0x155)+_0x20086a[_0x466898(0x143)]+'\x20-\x20will\x20do\x20auto\x20connect\x20when\x20available\x20-\x20however,\x20please\x20verify\x20stream\x20configuration'),_0x2ba0c4[_0x466898(0x6b)]=!![];try{_0x10268b=await a0_0x2cc5a3(_0x2ba0c4);if(_0x10268b[_0x466898(0xe3)][_0x466898(0xe4)]!==_0x466898(0x135)){_0x10268b[_0x466898(0xbd)]();return;}_0x25503f[_0x6148eb]['nc']=_0x10268b,_0x10b2ac(_0x6148eb,_0x10268b),_0x1cdc48(_0x6148eb,_0x10268b);}catch(_0x309db4){_0x2730d1[_0x466898(0x138)][_0x466898(0x109)](_0x2730d1[_0x466898(0xe0)]+'['+_0x2730d1['pluginName']+_0x466898(0x9a)+_0x6148eb+']['+_0x5efcbe+']\x20connect\x20error:\x20'+_0x309db4[_0x466898(0x143)]);return;}}_0x2730d1['logger']['debug'](_0x2730d1[_0x466898(0xe0)]+'['+_0x2730d1[_0x466898(0x144)]+_0x466898(0x9a)+_0x6148eb+']['+_0x5efcbe+_0x466898(0xbe)+(_0x2ba0c4[_0x466898(0xbb)]['ca']?_0x466898(0xbb):'')+'\x20'+_0x10268b['getServer']()),_0x10268b['closed']()['then'](_0x177849=>{const _0x4d5d27=_0x466898;_0x177849&&_0x2730d1[_0x4d5d27(0x138)][_0x4d5d27(0x109)](_0x2730d1[_0x4d5d27(0xe0)]+'['+_0x2730d1[_0x4d5d27(0x144)]+_0x4d5d27(0x9a)+_0x6148eb+']['+_0x5efcbe+_0x4d5d27(0x136)+_0x177849[_0x4d5d27(0x143)]);});};this[_0x2fe9b2(0x79)]=async(_0x337936,_0x3eb117)=>{const _0x327f25=_0x2fe9b2;if(!_0x3eb117?.['nats']){_0x2730d1[_0x327f25(0x138)][_0x327f25(0x109)](_0x2730d1[_0x327f25(0xe0)]+'['+_0x2730d1[_0x327f25(0x144)]+_0x327f25(0x9a)+_0x337936+_0x327f25(0x128));return;}if(!_0x3eb117?.[_0x327f25(0xde)]?.['tenant']){_0x2730d1[_0x327f25(0x138)]['error'](_0x2730d1[_0x327f25(0xe0)]+'['+_0x2730d1[_0x327f25(0x144)]+']\x20subscriber['+_0x337936+_0x327f25(0xc0));return;}if(!_0x3eb117?.[_0x327f25(0xde)]?.['subject']){_0x2730d1[_0x327f25(0x138)][_0x327f25(0x109)](_0x2730d1[_0x327f25(0xe0)]+'['+_0x2730d1[_0x327f25(0x144)]+_0x327f25(0x9a)+_0x337936+_0x327f25(0x137));return;}if(!_0x3eb117?.[_0x327f25(0x114)]?.['ca']){_0x2730d1[_0x327f25(0x138)][_0x327f25(0x109)](_0x2730d1[_0x327f25(0xe0)]+'['+_0x2730d1['pluginName']+']\x20subscriber['+_0x337936+']\x20initialization\x20error:\x20missing\x20certificate\x20configuration');return;}if(!_0x3eb117[_0x327f25(0x115)]||!Array[_0x327f25(0xa1)](_0x3eb117['baseUrls'])||_0x3eb117['baseUrls'][_0x327f25(0x108)]<0x1){_0x2730d1['logger'][_0x327f25(0x109)](_0x2730d1[_0x327f25(0xe0)]+'['+_0x2730d1[_0x327f25(0x144)]+']\x20subscriber['+_0x337936+_0x327f25(0xcd));return;}if(!_0x3eb117['usePutSoftSync']){const _0x50f97b=_0x3eb117?.[_0x327f25(0xde)]?.[_0x327f25(0x70)][_0x327f25(0x14a)]();if(_0x50f97b['startsWith'](_0x327f25(0x167)))_0x3eb117['usePutSoftSync']=!![];}const _0x289e4e={};try{let _0x375d54=a0_0x3f43f4[_0x327f25(0x142)](_0x2730d1['configDir'],_0x327f25(0x76),_0x3eb117?.[_0x327f25(0x114)]?.['ca']||_0x327f25(0xab));(_0x3eb117?.['certificate']?.['ca']?.['startsWith']('/')||_0x3eb117?.[_0x327f25(0x114)]?.['ca']?.[_0x327f25(0x11b)]('\x5c'))&&(_0x375d54=_0x3eb117['certificate']['ca']),_0x289e4e['ca']=[a0_0x4b3d48['readFileSync'](_0x375d54)],_0x289e4e[_0x327f25(0x10b)]=!![];}catch(_0x24d7a6){_0x2730d1[_0x327f25(0x138)][_0x327f25(0x109)](_0x2730d1['gwName']+'['+_0x2730d1[_0x327f25(0x144)]+_0x327f25(0x9a)+_0x337936+_0x327f25(0xf9)+_0x24d7a6[_0x327f25(0x143)]);return;}const _0x3bb403={},_0x560010=new TextEncoder()[_0x327f25(0xd3)](_0x3eb117?.[_0x327f25(0xde)]?.['secret']),_0x2e9f53=_0x3eb117?.['nats']?.[_0x327f25(0x123)];_0x3bb403[_0x327f25(0xed)]=jwtAuthenticator(_0x2e9f53,_0x560010),_0x3bb403[_0x327f25(0x69)]=_0x3eb117['baseUrls'],_0x3bb403[_0x327f25(0xbb)]=_0x289e4e,_0x3bb403[_0x327f25(0x6b)]=![],_0x3bb403['reconnect']=!![],_0x3bb403[_0x327f25(0x164)]=0x3e8*0xa,_0x3bb403[_0x327f25(0xff)]=-0x1,_0x3bb403[_0x327f25(0x149)]=0x2*0x3c*0x3e8,_0x3bb403[_0x327f25(0x74)]=0x5,_0x3bb403['debug']=![],_0x25503f[_0x337936]={},_0x25503f[_0x337936][_0x327f25(0x13e)]=_0x3eb117,_0x25503f[_0x337936]['nc']=undefined,_0x25503f[_0x337936][_0x327f25(0x9b)]=undefined,_0xfc3216(_0x337936,_0x3bb403);};const _0x1cdc48=async(_0x5b9749,_0x2c09e0)=>{const _0x5c75a6=_0x2fe9b2,_0x56cd96=_0x25503f[_0x5b9749][_0x5c75a6(0x13e)],_0xba9185=_0x56cd96?.['nats']?.[_0x5c75a6(0x70)];if(!_0x2c09e0){_0x2730d1[_0x5c75a6(0x138)][_0x5c75a6(0x109)](_0x2730d1[_0x5c75a6(0xe0)]+'['+_0x2730d1[_0x5c75a6(0x144)]+_0x5c75a6(0x9a)+_0x5b9749+']['+_0xba9185+_0x5c75a6(0xdd));return;}const _0xe41422=async(_0x1d7ddc,_0x55f6b4)=>{const _0x467783=_0x5c75a6;try{_0x2730d1[_0x467783(0x138)][_0x467783(0xe3)](_0x1d7ddc+_0x467783(0x13c)+_0x55f6b4);let _0x5b8452;try{if(_0x56cd96[_0x467783(0x8a)]&&Array['isArray'](_0x56cd96['replaceDomains']))for(let _0x577e75=0x0;_0x577e75<_0x56cd96['replaceDomains'][_0x467783(0x108)];_0x577e75++){const _0xae1965=_0x56cd96[_0x467783(0x8a)][_0x577e75];if(!_0xae1965[_0x467783(0xea)]||!_0xae1965[_0x467783(0xea)][_0x467783(0x11b)]('.')||!_0xae1965['to']||!_0xae1965['to'][_0x467783(0x11b)]('.'))continue;const _0x3e811b=new RegExp('@'+_0xae1965['from']+'\x22','gi');_0x55f6b4=_0x55f6b4[_0x467783(0x16a)](_0x3e811b,'@'+_0xae1965['to']+'\x22');}_0x5b8452=JSON['parse'](_0x55f6b4);}catch(_0x2ddaa4){_0x2730d1[_0x467783(0x138)][_0x467783(0x109)](_0x1d7ddc+_0x467783(0x13f)+_0x2ddaa4[_0x467783(0x143)]+_0x467783(0xe1)+_0x55f6b4),_0x2730d1[_0x467783(0x138)]['debug'](_0x1d7ddc+_0x467783(0x163));return;}const _0x329483=_0x5b8452[_0x467783(0xf2)];if(!_0x329483){_0x2730d1[_0x467783(0x138)]['error'](_0x1d7ddc+'\x20missing\x20user\x20object\x20in\x20message:\x20'+JSON[_0x467783(0x14d)](_0x5b8452)),_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x163));return;}if(!_0x329483['userName']){_0x2730d1[_0x467783(0x138)]['error'](_0x1d7ddc+_0x467783(0xeb)+JSON[_0x467783(0x14d)](_0x5b8452)),_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x163));return;}delete _0x329483['schemas'];let _0x566aac;_0x329483['id']&&(_0x566aac=_0x329483['id'],delete _0x329483['id']);let _0x5ea082;_0x329483[_0x467783(0xef)]&&(_0x5ea082=a0_0x5892aa['copyObj'](_0x329483[_0x467783(0xef)]),delete _0x329483[_0x467783(0xef)]);await _0x557960(_0x5b9749,_0x329483);const _0x398e73=_0x329483[_0x467783(0xfa)];let _0x170ea7,_0x12820c;try{_0x170ea7=await _0x4711f7(_0x5b9749,'userName',_0x398e73);}catch(_0x46c1c9){_0x2730d1['logger'][_0x467783(0x109)](_0x1d7ddc+'\x20getUserId()\x20error:\x20'+_0x46c1c9[_0x467783(0x143)]),_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x163));const _0x25558a=[_0x467783(0x17f),'UnableConnectingService','ECONNREFUSED','ENOTFOUND',_0x467783(0x86),_0x467783(0xae)];for(const _0x1657ba in _0x25558a){if(_0x46c1c9[_0x467783(0x143)][_0x467783(0x11b)](_0x1657ba))return!![];}return;}if(!_0x56cd96[_0x467783(0xad)]){let _0xd88d=![];if(_0x5b8452[_0x467783(0xfe)]&&Array[_0x467783(0xa1)](_0x5b8452[_0x467783(0xfe)]))for(let _0x4b7c62=0x0;_0x4b7c62<_0x5b8452[_0x467783(0xfe)]['length'];_0x4b7c62++){const _0x12d827=_0x5b8452[_0x467783(0xfe)][_0x4b7c62];_0x12d827['path']['startsWith']('roles')&&(_0x12d827[_0x467783(0x140)]='groups',Array[_0x467783(0xa1)](_0x12d827['value'])?(_0x12d827[_0x467783(0xda)][0x0]['id']=_0x12d827['value'][0x0][_0x467783(0xda)],_0x12d827[_0x467783(0xda)][0x0][_0x467783(0x134)]=_0x12d827[_0x467783(0xda)][0x0][_0x467783(0xdf)]+_0x467783(0x98)+_0x12d827['value'][0x0][_0x467783(0xda)],delete _0x12d827[_0x467783(0xda)][0x0][_0x467783(0xda)],delete _0x12d827['value'][0x0][_0x467783(0xdf)]):_0x12d827[_0x467783(0xda)]=[{'id':_0x12d827[_0x467783(0xda)],'display':_0x12d827[_0x467783(0xda)]}],delete _0x12d827[_0x467783(0xbf)],_0xd88d=!![]);}if(_0x329483[_0x467783(0x119)]&&Array[_0x467783(0xa1)](_0x329483['roles'])&&_0x329483[_0x467783(0x119)][_0x467783(0x108)]>0x0){if(!_0x329483[_0x467783(0x6e)])_0x329483[_0x467783(0x6e)]=[];if(!Array[_0x467783(0xa1)](_0x329483[_0x467783(0x6e)]))_0x329483[_0x467783(0x6e)]=[];for(let _0x149def=0x0;_0x149def<_0x329483[_0x467783(0x119)][_0x467783(0x108)];_0x149def++){const _0x3e0797={},_0x5def1d=_0x329483[_0x467783(0x119)][_0x149def];_0x3e0797['value']=_0x5def1d[_0x467783(0xda)],_0x3e0797[_0x467783(0x134)]=_0x5def1d['type']+'\x20-\x20'+_0x5def1d['display'],_0x329483[_0x467783(0x6e)]['push'](_0x3e0797);}delete _0x329483[_0x467783(0x119)],_0xd88d=!![];}if(_0xd88d)_0x2730d1[_0x467783(0x138)]['debug'](_0x1d7ddc+'\x20roles\x20converted\x20to\x20groups:\x20'+JSON[_0x467783(0x14d)](_0x5b8452));}if(!_0x170ea7){if(_0x5b8452[_0x467783(0xfc)]==='deleteUser'){_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+'\x20Delete\x20User\x20userName='+_0x398e73+_0x467783(0x162)),_0x2730d1[_0x467783(0x138)]['debug'](_0x1d7ddc+_0x467783(0x163));return;}if(_0x56cd96[_0x467783(0x165)]&&_0x56cd96[_0x467783(0x165)]===!![]){_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x91)+_0x398e73+_0x467783(0x78)),_0x2730d1[_0x467783(0x138)]['debug'](_0x1d7ddc+_0x467783(0x163));return;}if(Object[_0x467783(0x175)]['hasOwnProperty']['call'](_0x329483,'active')){if(typeof _0x329483[_0x467783(0x12c)]===_0x467783(0x84)){const _0x355d07=_0x329483[_0x467783(0x12c)][_0x467783(0x17d)]();if(_0x355d07===_0x467783(0xaa))_0x329483[_0x467783(0x12c)]=!![];else{if(_0x355d07===_0x467783(0x129))_0x329483[_0x467783(0x12c)]=![];}}if(_0x329483[_0x467783(0x12c)]===![]){_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x91)+_0x398e73+_0x467783(0x97)),_0x2730d1['logger'][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x163));return;}}_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x85)+_0x398e73);const _0x5cfbba=a0_0x5892aa[_0x467783(0x9f)](_0x329483);try{delete _0x5cfbba[_0x467783(0x6e)];!_0x5cfbba['password']&&_0x56cd96[_0x467783(0xc7)]&&_0x56cd96[_0x467783(0xc7)]===!![]&&(_0x5cfbba[_0x467783(0x12d)]=a0_0x5892aa['createRandomPassword'](0xf));if(_0x5ea082||_0x566aac){if(_0x5ea082)for(const _0x43c3f3 in _0x5ea082){_0x5cfbba[_0x43c3f3]=_0x5ea082[_0x43c3f3];}if(_0x566aac)_0x5cfbba['id']=_0x566aac;await _0x557960(_0x5b9749,_0x5cfbba);}await _0x2313a6(_0x5b9749,_0x5cfbba),_0x329483['groups']&&Array[_0x467783(0xa1)](_0x329483[_0x467783(0x6e)])&&_0x329483[_0x467783(0x6e)]['length']>0x0&&(_0x12820c=await _0x4711f7(_0x5b9749,'userName',_0x398e73));}catch(_0x51868f){_0x2730d1[_0x467783(0x138)][_0x467783(0x109)](_0x1d7ddc+'\x20createUser()\x20obj='+JSON[_0x467783(0x14d)](_0x5cfbba)+_0x467783(0xa3)+_0x51868f['message']+'}'),_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x163));return;}}if(_0x170ea7||_0x12820c){if(_0x5b8452[_0x467783(0xfc)]===_0x467783(0x10e)){if(_0x56cd96[_0x467783(0x165)]&&_0x56cd96['modifyOnly']===!![]){_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0xf1)+_0x170ea7+'\x20message:\x20user\x20not\x20deleted\x20because\x20of\x20configuration\x20modifyOnly=true'),_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x163));return;}_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0xf1)+_0x170ea7);try{await _0x214cda(_0x5b9749,_0x170ea7);}catch(_0x154879){_0x2730d1[_0x467783(0x138)][_0x467783(0x109)](_0x1d7ddc+_0x467783(0xf1)+_0x170ea7+_0x467783(0xa3)+_0x154879['message']+'}'),_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+'\x20done');return;}}else{if(_0x12820c)_0x170ea7=_0x12820c;_0x2730d1[_0x467783(0x138)]['debug'](_0x1d7ddc+_0x467783(0xe5)+_0x170ea7);try{await _0x1a4ddc('Users',_0x5b9749,_0x170ea7,_0x329483,_0x56cd96[_0x467783(0x169)]);}catch(_0x53b38a){_0x2730d1[_0x467783(0x138)]['error'](_0x1d7ddc+'\x20Replace\x20User\x20id='+_0x170ea7+_0x467783(0xa3)+_0x53b38a[_0x467783(0x143)]),_0x2730d1['logger'][_0x467783(0x14c)](_0x1d7ddc+'\x20done');return;}if(_0x56cd96[_0x467783(0x169)]){const [_0x3c7030,_0x315a7b]=a0_0x502367[_0x467783(0x131)]({'Operations':_0x5b8452[_0x467783(0xfe)]});if(_0x315a7b){_0x2730d1['logger'][_0x467783(0x109)](_0x1d7ddc+_0x467783(0xe5)+_0x170ea7+'\x20convertedScim20\x20error:\x20'+_0x315a7b[_0x467783(0x143)]),_0x2730d1[_0x467783(0x138)][_0x467783(0x14c)](_0x1d7ddc+'\x20done');return;}const _0x4cdeb2=[];if(_0x3c7030[_0x467783(0x119)]&&Array[_0x467783(0xa1)](_0x3c7030[_0x467783(0x119)]))for(let _0x14c3a5=0x0;_0x14c3a5<_0x3c7030[_0x467783(0x119)][_0x467783(0x108)];_0x14c3a5++){_0x3c7030[_0x467783(0x119)][_0x14c3a5][_0x467783(0x11e)]&&_0x3c7030[_0x467783(0x119)][_0x14c3a5]['operation']==='delete'&&_0x4cdeb2[_0x467783(0xac)](_0x3c7030[_0x467783(0x119)][_0x14c3a5]);}if(_0x4cdeb2[_0x467783(0x108)]>0x0)try{await _0x2730d1[_0x467783(0xc9)](_0x5b9749,_0x170ea7,{'roles':_0x4cdeb2});}catch(_0x309018){_0x2730d1[_0x467783(0x138)][_0x467783(0x109)](_0x1d7ddc+_0x467783(0xe5)+_0x170ea7+_0x467783(0x158)+_0x309018[_0x467783(0x143)]);}const _0x242f9d=[];if(_0x3c7030[_0x467783(0x6e)]&&Array[_0x467783(0xa1)](_0x3c7030[_0x467783(0x6e)]))for(let _0x361247=0x0;_0x361247<_0x3c7030[_0x467783(0x6e)][_0x467783(0x108)];_0x361247++){_0x3c7030['groups'][_0x361247][_0x467783(0x11e)]&&_0x3c7030[_0x467783(0x6e)][_0x361247][_0x467783(0x11e)]===_0x467783(0x147)&&_0x242f9d[_0x467783(0xac)](_0x3c7030[_0x467783(0x6e)][_0x361247]);}if(_0x242f9d[_0x467783(0x108)]>0x0)for(let _0xe9980=0x0;_0xe9980<_0x242f9d['length'];_0xe9980++){try{await _0x2730d1['modifyGroup'](_0x5b9749,_0x242f9d[_0xe9980]['id'],{'members':[{'operation':_0x467783(0x147),'value':_0x170ea7}]});}catch(_0x365d1c){_0x2730d1[_0x467783(0x138)][_0x467783(0x109)](_0x1d7ddc+_0x467783(0xe5)+_0x170ea7+'\x20group\x20removal\x20error:\x20'+_0x365d1c[_0x467783(0x143)]);}}}if(_0x56cd96['deleteUserOnLastGroupRoleRemoval']&&_0x5b8452[_0x467783(0xfc)]===_0x467783(0xc9)){if(_0x329483[_0x467783(0x6e)]&&Array[_0x467783(0xa1)](_0x329483['groups'])&&_0x329483[_0x467783(0x6e)]['length']===0x0){if(_0x329483[_0x467783(0x119)]&&Array[_0x467783(0xa1)](_0x329483[_0x467783(0x119)])&&_0x329483[_0x467783(0x119)]['length']===0x0){if(_0x5b8452[_0x467783(0xfe)]&&Array['isArray'](_0x5b8452[_0x467783(0xfe)])&&_0x5b8452[_0x467783(0xfe)][_0x467783(0x108)]>0x0){let _0x3d831a=![];for(let _0x304300=0x0;_0x304300<_0x5b8452[_0x467783(0xfe)]['length'];_0x304300++){const _0x5090c9=_0x5b8452['Operations'][_0x304300];if(_0x5090c9['op']===_0x467783(0x17b)){if(_0x5090c9[_0x467783(0x140)]){if(_0x5090c9[_0x467783(0x140)]['startsWith'](_0x467783(0x119))&&_0x5090c9[_0x467783(0xbf)]){_0x3d831a=!![];break;}else{if(_0x5090c9[_0x467783(0x140)]===_0x467783(0x6e)){_0x3d831a=!![];break;}}}}}if(_0x3d831a){_0x2730d1['logger'][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0xf1)+_0x170ea7);try{await _0x214cda(_0x5b9749,_0x170ea7);}catch(_0x59c92e){_0x2730d1[_0x467783(0x138)][_0x467783(0x109)](_0x1d7ddc+'\x20Delete\x20User\x20id='+_0x170ea7+_0x467783(0xa3)+_0x59c92e[_0x467783(0x143)]+'}'),_0x2730d1['logger'][_0x467783(0x14c)](_0x1d7ddc+_0x467783(0x163));return;}}}}}}}}_0x2730d1[_0x467783(0x138)]['debug'](_0x1d7ddc+_0x467783(0x163));}catch(_0x2e9f2e){_0x2730d1[_0x467783(0x138)][_0x467783(0x109)](_0x2730d1[_0x467783(0xe0)]+'['+_0x2730d1[_0x467783(0x144)]+_0x467783(0x9a)+_0x5b9749+']['+_0xba9185+_0x467783(0x172)+_0x2e9f2e['message']+_0x467783(0x156));}},_0xe0ea44=jetstream(_0x2c09e0),_0x38b913=(_0x5c75a6(0x75)+_0x2730d1[_0x5c75a6(0x144)]+'_'+_0x5b9749)['replaceAll']('*','#')['replaceAll']('>','##')['replaceAll']('.','_'),_0x1d15b=_0xba9185[_0x5c75a6(0x10a)]('.')[0x0][_0x5c75a6(0x14a)]()==='GW',_0x30df98=async()=>{const _0x3a40ba=_0x5c75a6;try{let _0x29001d;const _0x32de5e=''+_0x56cd96?.[_0x3a40ba(0xde)]?.[_0x3a40ba(0x9c)],_0x4af91e=await jetstreamManager(_0x2c09e0),_0x5055d2=async()=>{const _0x56af9c=_0x3a40ba;let _0x36b016;try{_0x36b016=await _0xe0ea44[_0x56af9c(0xee)][_0x56af9c(0x173)](_0x32de5e,_0x38b913);}catch(_0x1db7b5){const _0x101815={'durable_name':_0x38b913,'deliver_policy':DeliverPolicy[_0x56af9c(0xa7)],'ack_policy':AckPolicy[_0x56af9c(0xf7)],'filter_subject':_0xba9185};await _0x4af91e[_0x56af9c(0xee)][_0x56af9c(0x79)](_0x32de5e,_0x101815),_0x36b016=await _0xe0ea44[_0x56af9c(0xee)]['get'](_0x32de5e,_0x38b913);}if(_0x36b016?.[_0x56af9c(0x89)]?.[_0x56af9c(0x13e)]?.['deliver_policy']!==_0x56af9c(0x16b))throw new Error(_0x56af9c(0x161));_0x36b016?.[_0x56af9c(0x89)]?.[_0x56af9c(0x13e)]?.[_0x56af9c(0x176)]!==_0xba9185&&(await _0x4af91e[_0x56af9c(0xee)]['update'](_0x32de5e,_0x38b913,{'filter_subject':_0xba9185}),_0x36b016=await _0xe0ea44['consumers'][_0x56af9c(0x173)](_0x32de5e,_0x38b913)),_0x29001d=await _0x36b016['consume']({'max_messages':0x64}),_0x3732e8(_0x29001d);},_0x3732e8=async _0x356bd0=>{const _0x44db9f=_0x3a40ba;for await(const _0xa528c4 of await _0x356bd0[_0x44db9f(0x90)]()){switch(_0xa528c4[_0x44db9f(0xdf)]){case _0x44db9f(0x7e):_0x2730d1[_0x44db9f(0x138)][_0x44db9f(0xe3)](_0x2730d1[_0x44db9f(0xe0)]+'['+_0x2730d1['pluginName']+_0x44db9f(0x9a)+_0x5b9749+']['+_0xba9185+']\x20client\x20consumer\x20reinitiated\x20because\x20of\x20'+_0xa528c4[_0x44db9f(0xdf)]),_0x5055d2();return;}}};await _0x5055d2();let _0x443c1b=-0x1;do{for await(const _0x3000f8 of _0x29001d){if(!_0x3000f8[_0x3a40ba(0xe9)]||!_0x3000f8['headers']['get'](_0x3a40ba(0xb9))){_0x3000f8['ack']();continue;}_0x443c1b=_0x29001d['getProcessed']();const _0x4c2be6=_0x2730d1['gwName']+'['+_0x2730d1[_0x3a40ba(0x144)]+_0x3a40ba(0x9a)+_0x5b9749+']['+_0x3000f8[_0x3a40ba(0x70)]+']['+_0x443c1b+']['+(_0x3000f8[_0x3a40ba(0xe9)]?_0x3000f8['headers']['get']('Msg-Id'):'')+']',_0x5041d9=_0x3000f8[_0x3a40ba(0x84)](),_0x19c5fb=await _0xe41422(_0x4c2be6,_0x5041d9);if(!_0x19c5fb||_0x19c5fb!==!![])_0x3000f8[_0x3a40ba(0xe2)]();else _0x2730d1['logger'][_0x3a40ba(0x109)](_0x4c2be6+_0x3a40ba(0xd8));if(_0x443c1b<0x1)break;}}while(_0x443c1b===0x0);}catch(_0x4d72dd){_0x2730d1[_0x3a40ba(0x138)][_0x3a40ba(0x109)](_0x2730d1[_0x3a40ba(0xe0)]+'['+_0x2730d1['pluginName']+_0x3a40ba(0x9a)+_0x5b9749+']['+_0xba9185+']\x20subscriber\x20stopped\x20error:\x20'+_0x4d72dd[_0x3a40ba(0x143)]);}},_0x569123=async()=>{const _0x2e1f96=_0x5c75a6,_0x2bb45e=_0x2c09e0[_0x2e1f96(0xba)](_0xba9185,{'max':0x64});for await(const _0x1f749b of _0x2bb45e){const _0x552876=_0x1f749b[_0x2e1f96(0xe9)]['get'](_0x2e1f96(0xb9));if(!_0x1f749b[_0x2e1f96(0xe9)]||!_0x552876)continue;const _0x301032=_0x2730d1[_0x2e1f96(0xe0)]+'['+_0x2730d1[_0x2e1f96(0x144)]+_0x2e1f96(0x9a)+_0x5b9749+']['+_0x1f749b['subject']+']['+(_0x1f749b[_0x2e1f96(0xe9)]?_0x552876:'')+']';_0x2730d1[_0x2e1f96(0x138)][_0x2e1f96(0x14c)](_0x301032+_0x2e1f96(0x77));const _0x37bd5b={'func':'','id':'','obj':''};let _0xd3e3b0;try{try{_0xd3e3b0=JSON[_0x2e1f96(0x184)](_0x1f749b[_0x2e1f96(0x84)]());}catch(_0x3ec169){const _0x5770a9='subscriber\x20message\x20error:\x20message\x20not\x20JSON\x20formatted';_0x2730d1[_0x2e1f96(0x138)]['error'](_0x2730d1['gwName']+'['+_0x2730d1[_0x2e1f96(0x144)]+_0x2e1f96(0x9a)+_0x5b9749+']['+_0xba9185+']\x20'+_0x5770a9+':\x20'+_0x1f749b[_0x2e1f96(0x84)]());throw new Error(_0x5770a9);}const _0x458353=_0xd3e3b0['ctx'];if(_0x458353?.['routeObj']?.['id'])_0x37bd5b['id']=_0x458353['routeObj']['id'];if(_0x458353?.[_0x2e1f96(0x7d)]?.['body'])_0x37bd5b[_0x2e1f96(0x177)]=a0_0x5892aa[_0x2e1f96(0x9f)](_0x458353['request'][_0x2e1f96(0xb0)]);if(_0x458353?.[_0x2e1f96(0x7d)]?.[_0x2e1f96(0xe9)]?.[_0x2e1f96(0x8f)]){const _0x357860=_0x458353['request']['headers'][_0x2e1f96(0x8f)];if(_0x357860)_0x458353[_0x2e1f96(0x7d)][_0x2e1f96(0xe9)][_0x2e1f96(0x8f)]=a0_0x5892aa[_0x2e1f96(0x12b)](_0x357860,_0x552876);}if(_0x458353?.['passThrough']?.[_0x2e1f96(0xe9)]?.[_0x2e1f96(0x8f)]){const _0x2b5d86=_0x458353[_0x2e1f96(0x117)][_0x2e1f96(0xe9)][_0x2e1f96(0x8f)];if(_0x2b5d86)_0x458353[_0x2e1f96(0x117)][_0x2e1f96(0xe9)][_0x2e1f96(0x8f)]=a0_0x5892aa['getEncrypted'](_0x2b5d86,_0x552876);}if(_0x2730d1[_0x2e1f96(0x13e)][_0x2e1f96(0x11a)][_0x2e1f96(0x12f)])await _0x2850f9(_0x458353);else{const _0x38f08e=_0x458353?.[_0x2e1f96(0xb7)]?.[_0x2e1f96(0x139)]+'\x20'+_0x458353?.[_0x2e1f96(0xb7)]?.[_0x2e1f96(0x116)];_0x37bd5b[_0x2e1f96(0x92)]=_0x38f08e;switch(_0x38f08e){case _0x2e1f96(0x179):case'GET\x20groups':case _0x2e1f96(0x154):if(_0x458353['routeObj']['id'])await _0x5d2fa5[_0x2e1f96(0x10f)](_0x458353);else await _0x5d2fa5[_0x2e1f96(0x174)](_0x458353);break;case _0x2e1f96(0x10d):await _0x5d2fa5[_0x2e1f96(0xfd)](_0x458353);break;case _0x2e1f96(0x126):await _0x5d2fa5[_0x2e1f96(0x99)](_0x458353);break;case'GET\x20serviceproviderconfig':case _0x2e1f96(0x103):await _0x5d2fa5['getHandlerServiceProviderConfig'](_0x458353);break;case _0x2e1f96(0xfb):case _0x2e1f96(0x80):await _0x5d2fa5[_0x2e1f96(0x7b)](_0x458353);break;case _0x2e1f96(0x160):await _0x5d2fa5[_0x2e1f96(0x113)](_0x458353);break;case _0x2e1f96(0x16f):case _0x2e1f96(0x180):await _0x5d2fa5[_0x2e1f96(0xd7)](_0x458353);break;case _0x2e1f96(0xe7):await _0x5d2fa5['putApiHandler'](_0x458353);break;case _0x2e1f96(0xd2):case _0x2e1f96(0xc5):await _0x5d2fa5['postHandler'](_0x458353);break;case _0x2e1f96(0x171):await _0x5d2fa5['postApiHandler'](_0x458353);break;case _0x2e1f96(0xc1):case _0x2e1f96(0xec):await _0x5d2fa5['deleteHandler'](_0x458353);break;case _0x2e1f96(0x124):await _0x5d2fa5[_0x2e1f96(0x189)](_0x458353);break;default:_0x458353[_0x2e1f96(0x15f)]=new Response('NOT_FOUND',{'status':0x194});}}if(!_0x458353[_0x2e1f96(0x15f)])_0x458353[_0x2e1f96(0x15f)]=null;const _0xb29a17=JSON[_0x2e1f96(0x14d)](_0x458353[_0x2e1f96(0x15f)]);_0x1f749b[_0x2e1f96(0x13b)](_0xb29a17),_0x2730d1[_0x2e1f96(0x138)][_0x2e1f96(0xe3)](_0x301032+_0x2e1f96(0x17a)+_0x37bd5b[_0x2e1f96(0x92)]+',\x20obj='+(_0x37bd5b[_0x2e1f96(0x177)]?JSON['stringify'](_0x37bd5b[_0x2e1f96(0x177)]):'')+_0x2e1f96(0x110)+(_0x37bd5b['id']?_0x37bd5b['id']:'')+_0x2e1f96(0xe8)+_0xb29a17);}catch(_0x2a45e9){const _0x5c4abd=_0x2e1f96(0xe6)+_0x2a45e9[_0x2e1f96(0x143)]+'\x22,\x22errName\x22:\x22'+_0x2a45e9[_0x2e1f96(0x104)]+'\x22}';_0x1f749b['respond'](_0x5c4abd),_0x2730d1[_0x2e1f96(0x138)][_0x2e1f96(0xe3)]((_0x301032||'')+_0x2e1f96(0x17a)+_0x37bd5b['func']+_0x2e1f96(0xb8)+(_0x37bd5b[_0x2e1f96(0x177)]?JSON[_0x2e1f96(0x14d)](_0x37bd5b[_0x2e1f96(0x177)]):'')+',\x20id='+(_0x37bd5b['id']?_0x37bd5b['id']:'')+_0x2e1f96(0x11f)+_0x5c4abd);}}};if(_0x1d15b)_0x569123();else _0x30df98();},_0x10b2ac=async(_0x266364,_0x4fe08b)=>{const _0x3312a7=_0x2fe9b2,_0x2f02d5=_0x25503f[_0x266364]['config']?.[_0x3312a7(0xde)]?.['subject'];let _0x1432e0=0x0;for await(const _0x146785 of _0x4fe08b[_0x3312a7(0x90)]()){switch(_0x146785[_0x3312a7(0xdf)]){case _0x3312a7(0x159):_0x2730d1[_0x3312a7(0x138)][_0x3312a7(0x109)](_0x2730d1[_0x3312a7(0xe0)]+'['+_0x2730d1[_0x3312a7(0x144)]+_0x3312a7(0x9a)+_0x266364+']['+_0x2f02d5+_0x3312a7(0xa9)+_0x146785['data']+'\x20-\x20will\x20do\x20auto\x20reconnect\x20when\x20connection\x20becomes\x20available'),_0x1432e0=0x0;break;case'reconnect':_0x2730d1['logger'][_0x3312a7(0xe3)](_0x2730d1[_0x3312a7(0xe0)]+'['+_0x2730d1['pluginName']+_0x3312a7(0x9a)+_0x266364+']['+_0x2f02d5+']\x20client\x20reconnected\x20'+_0x146785[_0x3312a7(0xbc)]);break;case _0x3312a7(0x109):_0x2730d1['logger'][_0x3312a7(0x109)](_0x2730d1[_0x3312a7(0xe0)]+'['+_0x2730d1['pluginName']+_0x3312a7(0x9a)+_0x266364+']['+_0x2f02d5+_0x3312a7(0x170)+_0x146785[_0x3312a7(0xbc)]);break;case _0x3312a7(0x178):_0x1432e0+=0x1;_0x1432e0%0x1e===0x0&&_0x2730d1[_0x3312a7(0x138)][_0x3312a7(0x14c)](_0x2730d1[_0x3312a7(0xe0)]+'['+_0x2730d1['pluginName']+_0x3312a7(0x9a)+_0x266364+']['+_0x2f02d5+']\x20client\x20is\x20attempting\x20to\x20reconnect\x20'+_0x146785['data']+_0x3312a7(0x151)+_0x1432e0+')');break;case _0x3312a7(0x141):_0x2730d1[_0x3312a7(0x138)]['debug'](_0x2730d1[_0x3312a7(0xe0)]+'['+_0x2730d1[_0x3312a7(0x144)]+_0x3312a7(0x9a)+_0x266364+']['+_0x2f02d5+']\x20client\x20has\x20a\x20stale\x20connection\x20'+_0x146785[_0x3312a7(0xbc)]);break;}}};process['on'](_0x2fe9b2(0x83),async()=>{const _0x16a4c2=_0x2fe9b2;for(const _0x2b5c40 in _0x25503f){_0x25503f[_0x2b5c40]['nc']&&!_0x25503f[_0x2b5c40]['nc'][_0x16a4c2(0x13d)]()&&await _0x25503f[_0x2b5c40]['nc'][_0x16a4c2(0x6d)]();}}),process['on'](_0x2fe9b2(0x183),async()=>{const _0x276ae4=_0x2fe9b2;for(const _0x448dbf in _0x25503f){_0x25503f[_0x448dbf]['nc']&&!_0x25503f[_0x448dbf]['nc'][_0x276ae4(0x13d)]()&&await _0x25503f[_0x448dbf]['nc'][_0x276ae4(0x6d)]();}});const _0x4711f7=async(_0x2be8b4,_0x81c7aa,_0xf0e164)=>{const _0x29bcdf=_0x2fe9b2,_0x1e0d09={'attribute':_0x81c7aa,'operator':'eq','value':_0xf0e164,'rawFilter':undefined,'startIndex':undefined,'count':undefined},_0x2b4c78=[_0x81c7aa];if(_0x81c7aa!=='id')_0x2b4c78[_0x29bcdf(0xac)]('id');try{const _0x173c40=await _0x3dc962(_0x2be8b4,_0x1e0d09,_0x2b4c78);if(!_0x173c40||!_0x173c40['Resources']||!Array[_0x29bcdf(0xa1)](_0x173c40[_0x29bcdf(0x17e)]))throw new Error(_0x29bcdf(0xaf)+JSON[_0x29bcdf(0x14d)](_0x1e0d09)+_0x29bcdf(0x8d));if(_0x173c40[_0x29bcdf(0x17e)][_0x29bcdf(0x108)]===0x0)return null;else{if(_0x173c40['Resources'][_0x29bcdf(0x108)]>0x2)throw new Error('getUsers()\x20getObj='+JSON[_0x29bcdf(0x14d)](_0x1e0d09)+_0x29bcdf(0x14f));else{const _0x107ef6=_0x173c40['Resources'][0x0];if(!_0x107ef6['id'])throw new Error(_0x29bcdf(0xaf)+JSON[_0x29bcdf(0x14d)](_0x1e0d09)+'\x20result='+JSON[_0x29bcdf(0x14d)](_0x107ef6)+_0x29bcdf(0xcc));return decodeURIComponent(_0x107ef6['id']);}}}catch(_0x519c15){throw new Error(_0x29bcdf(0xaf)+JSON[_0x29bcdf(0x14d)](_0x1e0d09)+'\x20error:\x20'+_0x519c15[_0x29bcdf(0x143)]+'}');}},_0x3dc962=async(_0x46140,_0x2a2fb2,_0x276db4)=>{const _0x5df62d=_0x2fe9b2;if(!_0x4e0537)return await _0x2730d1[_0x5df62d(0x95)](_0x46140,_0x2a2fb2,_0x276db4);if(!_0x2a2fb2?.['operator']||_0x2a2fb2['operator']!=='eq')throw new Error('getUsers()\x20error:\x20unsupported\x20operator\x20for\x20getObj:\x20'+JSON['stringify'](_0x2a2fb2));if(_0x46140===_0x5df62d(0x7c))_0x46140=undefined;let _0x540fae=_0x46140?'/'+_0x46140+'/Users':_0x5df62d(0x15c);if(_0x2a2fb2[_0x5df62d(0x81)]==='id'){_0x540fae+='/'+_0x2a2fb2['value'];if(_0x276db4&&_0x276db4[_0x5df62d(0x108)]>0x0)_0x540fae+=_0x5df62d(0xc3)+_0x276db4[_0x5df62d(0x142)](',');}else{if(_0x2a2fb2[_0x5df62d(0x81)]===_0x5df62d(0xfa)){_0x540fae+=_0x5df62d(0xb4)+_0x2a2fb2['value']+'\x22';if(_0x276db4&&_0x276db4[_0x5df62d(0x108)]>0x0)_0x540fae+=_0x5df62d(0x105)+_0x276db4[_0x5df62d(0x142)](',');}else{if(_0x2a2fb2[_0x5df62d(0x81)]===_0x5df62d(0xdc)){_0x540fae+=_0x5df62d(0x15a)+_0x2a2fb2[_0x5df62d(0xda)]+'\x22';if(_0x276db4&&_0x276db4['length']>0x0)_0x540fae+=_0x5df62d(0x105)+_0x276db4[_0x5df62d(0x142)](',');}else throw new Error(_0x5df62d(0x111)+JSON[_0x5df62d(0x14d)](_0x2a2fb2));}}return await _0x4d7f62(_0x46140,'GET',_0x540fae);},_0x2313a6=async(_0x5b2605,_0x804271)=>{const _0x2896a5=_0x2fe9b2;if(!_0x4e0537)return await _0x2730d1['createUser'](_0x5b2605,_0x804271);if(_0x5b2605==='undefined')_0x5b2605=undefined;const _0x23fc9d=_0x5b2605?'/'+_0x5b2605+_0x2896a5(0x15c):_0x2896a5(0x15c);return await _0x4d7f62(_0x5b2605,_0x2896a5(0xb2),_0x23fc9d,_0x804271);},_0x1a4ddc=async(_0x4652ca,_0x2feed3,_0x12c7a4,_0xb97478,_0x53716b)=>{const _0x34ed9f=_0x2fe9b2;if(!_0x4652ca||_0x4652ca[_0x34ed9f(0x17d)]()!=='users')throw new Error('replaceUsrGrp()\x20error:\x20stream\x20replaceUsrGrp\x20must\x20be\x20type\x20\x22Users\x22');if(!_0x4e0537)return await _0x5d2fa5[_0x34ed9f(0x125)](_0x34ed9f(0xf3),_0x2feed3,_0x12c7a4,_0xb97478,_0x53716b);if(_0x2feed3===_0x34ed9f(0x7c))_0x2feed3=undefined;const _0x5313b7=_0x2feed3?'/'+_0x2feed3+_0x34ed9f(0xcb)+_0x12c7a4:_0x34ed9f(0xcb)+_0x12c7a4;return await _0x4d7f62(_0x2feed3,_0x34ed9f(0xa8),_0x5313b7,_0xb97478);},_0x214cda=async(_0x545386,_0x20d42f)=>{const _0x1e5283=_0x2fe9b2;!_0x4e0537&&await _0x2730d1[_0x1e5283(0x10e)](_0x545386,_0x20d42f);if(_0x545386===_0x1e5283(0x7c))_0x545386=undefined;const _0x433af=_0x545386?'/'+_0x545386+'/Users/'+_0x20d42f:'/Users/'+_0x20d42f;return await _0x4d7f62(_0x545386,'DELETE',_0x433af);},_0x6c74c7=_0x5136cd=>{const _0x3733b7=_0x2fe9b2;if(!_0x5136cd||typeof _0x5136cd!=='string')return[null,null];_0x5136cd=_0x5136cd[_0x3733b7(0xf6)]();const _0x52a80b=_0x5136cd[_0x3733b7(0x9d)]('(');if(_0x52a80b<0x1)return[null,null];if(_0x5136cd[_0x3733b7(0x102)](_0x5136cd[_0x3733b7(0x108)]-0x1)!==')')return[null,null];if(_0x44fb79(_0x5136cd,'(')!==_0x44fb79(_0x5136cd,')'))return[null,null];const _0x3e5b8b=_0x5136cd['substring'](0x0,_0x52a80b),_0x389cba=_0x5136cd[_0x3733b7(0x102)](_0x52a80b+0x1,_0x5136cd[_0x3733b7(0x108)]-0x1);let _0x4a73c5=[];const _0x387dd7=_0x389cba[_0x3733b7(0x10a)](',');let _0x3cfdba='';for(let _0x3b608e=0x0;_0x3b608e<_0x387dd7['length'];_0x3b608e++){const _0x17a7f4=_0x3cfdba?_0x3cfdba+','+_0x387dd7[_0x3b608e]:_0x387dd7[_0x3b608e],_0x46714b=_0x44fb79(_0x17a7f4,'('),_0x7bdfc8=_0x44fb79(_0x17a7f4,')');if(_0x46714b===_0x7bdfc8)_0x4a73c5[_0x3733b7(0xac)](_0x39fe17(_0x17a7f4,'\x22')),_0x3cfdba='';else{if(_0x3cfdba)_0x3cfdba+=','+_0x387dd7[_0x3b608e];else _0x3cfdba+=_0x387dd7[_0x3b608e];}}if(_0x4a73c5[_0x3733b7(0x108)]===0x0)_0x4a73c5=null;return[_0x3e5b8b,_0x4a73c5];};function _0x44fb79(_0x1614fe,_0x3295a2){const _0xb69b5d=_0x2fe9b2;let _0x335d79=0x0;for(let _0x2c439c=0x0;_0x2c439c<_0x1614fe['length'];_0x2c439c++){_0x1614fe[_0xb69b5d(0x15b)](_0x2c439c)===_0x3295a2&&(_0x335d79+=0x1);}return _0x335d79;}const _0x39fe17=(_0x49ba5f,_0x255364)=>{const _0x349639=_0x2fe9b2;if(typeof _0x49ba5f!==_0x349639(0x84)||typeof _0x255364!==_0x349639(0x84))return _0x49ba5f;if(_0x49ba5f['length']===0x1)return _0x49ba5f;if(_0x255364['length']!==0x1)return _0x49ba5f;return _0x49ba5f=_0x49ba5f['trim'](),_0x49ba5f['substring'](0x0,0x1)===_0x255364&&(_0x49ba5f=_0x49ba5f[_0x349639(0x102)](0x1)),_0x49ba5f[_0x349639(0x102)](_0x49ba5f[_0x349639(0x108)]-0x1)===_0x255364&&(_0x49ba5f=_0x49ba5f[_0x349639(0x102)](0x0,_0x49ba5f[_0x349639(0x108)]-0x1)),_0x49ba5f;},_0x38e199=async(_0x526755,_0x143c9f,_0x5a3eaf,_0x216bb5)=>{const _0x13a8bf=_0x2fe9b2;if(!_0x143c9f||!_0x5a3eaf||!_0x216bb5)return null;const [_0x2d71d9,_0x3fea78]=_0x6c74c7(_0x216bb5);if(!_0x2d71d9||!_0x3fea78){const _0x247ffa=_0x216bb5[_0x13a8bf(0x10a)]('(');if(_0x247ffa['length']>0x1){const _0x1488d0=[_0x13a8bf(0xd1),_0x13a8bf(0x93),_0x13a8bf(0xd0),'elementnumber',_0x13a8bf(0x142),_0x13a8bf(0x16a),'normalize','increment',_0x13a8bf(0x182)],_0x168f41=_0x247ffa[0x0][_0x13a8bf(0x17d)]();if(_0x1488d0[_0x13a8bf(0x11b)](_0x168f41))return null;}return _0x216bb5;}for(let _0x1d27d7=0x0;_0x1d27d7<_0x3fea78[_0x13a8bf(0x108)];_0x1d27d7++){if(_0x3fea78[_0x1d27d7][_0x13a8bf(0x102)](0x0,0x1)==='['){const _0x71f61d=_0x3fea78[_0x1d27d7][_0x13a8bf(0x9d)](']');if(_0x71f61d<0x0)return null;const _0x15b5d7=_0x3fea78[_0x1d27d7][_0x13a8bf(0x102)](0x1,_0x71f61d),_0x1060a2=_0x15b5d7[_0x13a8bf(0x10a)]('.');let _0x46918b;for(let _0x4b95bb=0x0;_0x4b95bb<_0x1060a2[_0x13a8bf(0x108)];_0x4b95bb++){if(_0x4b95bb===0x0)_0x46918b=_0x143c9f[_0x1060a2[_0x4b95bb]];else{if(!_0x46918b)return null;_0x46918b=_0x46918b[_0x1060a2[_0x4b95bb]];}}if(!_0x46918b)return null;_0x3fea78[_0x1d27d7]=_0x46918b;}}for(let _0x34d1bc=0x0;_0x34d1bc<_0x3fea78['length'];_0x34d1bc++){const [_0x1bbcbe]=_0x6c74c7(_0x3fea78[_0x34d1bc]);_0x1bbcbe&&(_0x3fea78[_0x34d1bc]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x3fea78[_0x34d1bc]));}if(_0x3fea78[0x0]===null)return null;switch(_0x2d71d9[_0x13a8bf(0x17d)]()){case _0x13a8bf(0xd1):{if(_0x3fea78[_0x13a8bf(0x108)]!==0x1)return null;const [_0x19391b]=_0x6c74c7(_0x3fea78[0x0]);if(_0x19391b)_0x3fea78[0x0]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x19391b);if(_0x3fea78[0x0]===null)return null;return _0x3fea78[0x0][_0x13a8bf(0x17d)]();}case _0x13a8bf(0x93):{if(_0x3fea78['length']!==0x1)return null;const [_0x42cca0]=_0x6c74c7(_0x3fea78[0x0]);if(_0x42cca0)_0x3fea78[0x0]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x42cca0);if(_0x3fea78[0x0]===null)return null;return _0x3fea78[0x0]['toUpperCase']();}case'firstn':{if(_0x3fea78[_0x13a8bf(0x108)]!==0x2)return null;const [_0x58a682]=_0x6c74c7(_0x3fea78[0x0]);if(_0x58a682)_0x3fea78[0x0]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x58a682);if(_0x3fea78[0x0]===null)return null;if(isNaN(_0x3fea78[0x1]))return null;return _0x3fea78[0x0][_0x13a8bf(0x102)](0x0,_0x3fea78[0x1]);}case _0x13a8bf(0xf0):{const [_0xef1a52]=_0x6c74c7(_0x3fea78[0x0]);if(_0x3fea78[_0x13a8bf(0x108)]<0x2)return null;if(_0xef1a52)_0x3fea78[0x0]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0xef1a52);if(_0x3fea78[0x0]===null)return null;const _0x6ae567=_0x3fea78[0x1];if(isNaN(_0x6ae567))return null;let _0x19ef57;if(_0x3fea78['length']===0x3)_0x19ef57=_0x3fea78[0x0][_0x13a8bf(0x10a)](_0x3fea78[0x2]);else _0x19ef57=_0x19ef57=_0x3fea78[0x0][_0x13a8bf(0x10a)]('\x20');if(_0x6ae567<=_0x19ef57['length'])return _0x19ef57[_0x6ae567-0x1];else return'';}case _0x13a8bf(0x16a):{const [_0x51b3d6]=_0x6c74c7(_0x3fea78[0x0]);if(_0x51b3d6)_0x3fea78[0x0]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x51b3d6);if(_0x3fea78[0x0]===null)return null;if(_0x3fea78[_0x13a8bf(0x108)]!==0x3)return null;return _0x3fea78[0x0][_0x13a8bf(0xb1)](_0x3fea78[0x1],_0x3fea78[0x2]);}case _0x13a8bf(0x18a):{if(_0x3fea78[_0x13a8bf(0x108)]!==0x1)return null;const [_0x37996f]=_0x6c74c7(_0x3fea78[0x0]);if(_0x37996f)_0x3fea78[0x0]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x37996f);if(_0x3fea78[0x0]===null)return null;return a0_0x38a5e6[_0x13a8bf(0xf4)](_0x3fea78[0x0]);}case _0x13a8bf(0x142):{let _0x49f318='';for(let _0x5c19d5=0x0;_0x5c19d5<_0x3fea78['length'];_0x5c19d5++){const [_0x22fc5a]=_0x6c74c7(_0x3fea78[_0x5c19d5]);if(_0x22fc5a)_0x3fea78[_0x5c19d5]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x22fc5a);if(_0x3fea78[_0x5c19d5]===null)return null;_0x49f318+=_0x3fea78[_0x5c19d5];}return _0x49f318;}case'increment':{if(_0x3fea78[_0x13a8bf(0x108)]>0x2)return null;const [_0x279a01]=_0x6c74c7(_0x3fea78[0x0]);if(_0x279a01)_0x3fea78[0x0]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x279a01);if(_0x3fea78[0x0]===null)return null;const _0x22766a=parseInt(_0x3fea78[0x0]);if(isNaN(_0x22766a))return null;let _0x43a3f4=_0x13a8bf(0xcf);_0x43a3f4+=','+_0x3fea78[0x0];if(_0x3fea78['length']===0x2&&_0x3fea78[0x1][_0x13a8bf(0x17d)]()===_0x13a8bf(0xaa))_0x43a3f4+=_0x13a8bf(0x68);else _0x43a3f4+=',false';return _0x43a3f4+='##',_0x43a3f4;}case _0x13a8bf(0x182):{if(_0x3fea78[_0x13a8bf(0x108)]!==0x1)return null;const [_0x334de8]=_0x6c74c7(_0x3fea78[0x0]);if(_0x334de8)_0x3fea78[0x0]=await _0x38e199(_0x526755,_0x143c9f,_0x5a3eaf,_0x334de8);if(_0x3fea78[0x0]===null)return null;let _0x332de5,_0x1e6158=![],_0x245483='';const _0x496f56=_0x3fea78[0x0][_0x13a8bf(0x10a)]('##');if(_0x496f56[_0x13a8bf(0x108)]>0x2)for(let _0x19d036=0x0;_0x19d036<_0x496f56[_0x13a8bf(0x108)];_0x19d036++){if(_0x496f56[_0x19d036][_0x13a8bf(0x106)](_0x13a8bf(0x15e))){const _0x42cfd4=_0x496f56[_0x19d036]['split'](',');if(_0x42cfd4[_0x13a8bf(0x108)]<0x2)return null;const _0x3c2a15=parseInt(_0x42cfd4[0x1]);if(isNaN(_0x3c2a15))return null;_0x245483='##'+_0x496f56[_0x19d036]+'##',_0x332de5=_0x42cfd4[0x1],_0x42cfd4[_0x13a8bf(0x108)]>0x2&&(_0x1e6158=_0x42cfd4[0x2][_0x13a8bf(0x17d)]()===_0x13a8bf(0xaa));}}let _0x246c0b,_0x2f0c4a=0x0,_0x2882e2=0x0;if(_0x332de5){_0x2882e2=_0x332de5[_0x13a8bf(0x108)],_0x2f0c4a=0xa;for(let _0x48847a=0x1;_0x48847a<_0x2882e2;_0x48847a++){_0x2f0c4a*=0xa;}_0x2f0c4a-=0x1,_0x246c0b=parseInt(_0x332de5);if(isNaN(_0x246c0b))return null;_0x246c0b-=0x1;}else _0x246c0b=0x0;do{_0x246c0b+=0x1;let _0x5a9fb0=_0x3fea78[0x0];if(_0x332de5!==undefined&&_0x245483){let _0x499c1e=_0x246c0b[_0x13a8bf(0x146)]();while(_0x499c1e[_0x13a8bf(0x108)]<_0x2882e2){_0x499c1e='0'+_0x499c1e;}_0x1e6158?_0x5a9fb0=_0x5a9fb0[_0x13a8bf(0x16a)](_0x245483,_0x499c1e):(_0x5a9fb0=_0x5a9fb0['replace'](_0x245483,''),_0x1e6158=!![],_0x246c0b-=0x1);}try{const _0x5082d1=await _0x4711f7(_0x526755,_0x5a3eaf,_0x5a9fb0);if(!_0x5082d1)return _0x5a9fb0;}catch(_0x5eb424){return _0x2730d1[_0x13a8bf(0x138)][_0x13a8bf(0x109)](_0x2730d1[_0x13a8bf(0xe0)]+'['+_0x2730d1[_0x13a8bf(0x144)]+']\x20'+_0x2d71d9+_0x13a8bf(0x6f)+_0x5eb424[_0x13a8bf(0x143)]),null;}}while(_0x246c0b<_0x2f0c4a);return null;}default:}return null;},_0x557960=async(_0x597633,_0xe01e9c)=>{const _0x2ac945=_0x2fe9b2;for(const _0x478bf3 in _0xe01e9c){const _0xa0bdae=_0xe01e9c[_0x478bf3],[_0x162134,_0x4e8246]=_0x6c74c7(_0xa0bdae);if(_0x162134){const _0x5d621b=''+_0x478bf3,_0xe4339c=_0x162134+'('+_0x4e8246[_0x2ac945(0x142)](',')+')',_0x1c4d8a=await _0x38e199(_0x597633,_0xe01e9c,_0x5d621b,_0xe4339c);if(_0x1c4d8a===null)delete _0xe01e9c[_0x478bf3];else _0xe01e9c[_0x478bf3]=_0x1c4d8a;}for(const _0x159459 in _0xa0bdae){const _0x3731e9=_0xa0bdae[_0x159459],[_0x3c2d99,_0x52366d]=_0x6c74c7(_0x3731e9);if(_0x3c2d99){const _0x17d970=_0x478bf3+'.'+_0x159459,_0x552b3c=_0x3c2d99+'('+_0x52366d[_0x2ac945(0x142)](',')+')',_0x1f6fbb=await _0x38e199(_0x597633,_0xe01e9c,_0x17d970,_0x552b3c);if(_0x1f6fbb===null)delete _0xa0bdae[_0x159459];else _0xa0bdae[_0x159459]=_0x1f6fbb;}}}return _0xe01e9c;},_0x4d7f62=async(_0x2b4381,_0xcbdf3c,_0x7c1aa0,_0x31d29b)=>{const _0x4ffa2a=_0x2fe9b2;if(!_0x4e0537)throw new Error(_0x4ffa2a(0x8c));if(!_0x2a68a4)throw new Error(_0x4ffa2a(0x15d));try{if(!_0x2730d1[_0x4ffa2a(0x16c)])_0x2730d1[_0x4ffa2a(0x16c)]=_0x2730d1['newHelperRest']();const _0x5adbb6={'headers':{'Authorization':_0x2a68a4}},_0x41fdc9=await _0x2730d1[_0x4ffa2a(0x16c)]['doRequest'](undefined,_0xcbdf3c,_0x4e0537+_0x7c1aa0,_0x31d29b,undefined,_0x5adbb6);return _0x41fdc9[_0x4ffa2a(0xb0)];}catch(_0x2a2f9a){try{const _0xc1118f=JSON['parse'](_0x2a2f9a[_0x4ffa2a(0x143)]);if(_0xc1118f[_0x4ffa2a(0xb0)])throw new Error(JSON[_0x4ffa2a(0x14d)](_0xc1118f[_0x4ffa2a(0xb0)]));throw new Error(_0x2a2f9a[_0x4ffa2a(0x143)]);}catch(_0x1ac986){throw new Error(_0x4ffa2a(0x17c)+_0x1ac986[_0x4ffa2a(0x143)]);}}},_0x2850f9=async _0x2c6807=>{const _0x260b57=_0x2fe9b2,_0xb5db13=_0x2730d1['config'][_0x260b57(0x11a)][_0x260b57(0x12f)];if(!_0xb5db13){_0x2c6807[_0x260b57(0x15f)][_0x260b57(0x90)]=0x1f4,_0x2730d1['logger'][_0x260b57(0x109)](_0x2730d1[_0x260b57(0xe0)]+'['+_0x2730d1['pluginName']+_0x260b57(0x145));return;}try{new URL(_0xb5db13);}catch(_0x1adec6){_0x2c6807[_0x260b57(0x15f)][_0x260b57(0x90)]=0x1f4,_0x2730d1[_0x260b57(0x138)]['error'](_0x2730d1[_0x260b57(0xe0)]+'['+_0x2730d1['pluginName']+_0x260b57(0x107)+_0x1adec6[_0x260b57(0x143)]);return;}try{if(!_0x2730d1[_0x260b57(0x16c)])_0x2730d1[_0x260b57(0x16c)]=_0x2730d1[_0x260b57(0xc2)]();const _0x5deb6f=new URL(_0x2c6807['request'][_0x260b57(0xd4)]),_0x4a3328=_0x2c6807[_0x260b57(0x7d)]['method'],_0x48dd4f=_0x2c6807[_0x260b57(0x7d)]['url'][_0x260b57(0x16a)](_0x5deb6f[_0x260b57(0x16e)],_0xb5db13),_0x246b18=_0x2c6807['request'][_0x260b57(0xb0)],_0x3dc7ab={'headers':{'Authorization':_0x2c6807[_0x260b57(0x7d)]['headers'][_0x260b57(0x8f)]}},_0x1d1efb=await _0x2730d1[_0x260b57(0x16c)][_0x260b57(0x157)](_0x260b57(0x7c),_0x4a3328,_0x48dd4f,_0x246b18,undefined,_0x3dc7ab);_0x2c6807[_0x260b57(0x15f)]['status']=_0x1d1efb[_0x260b57(0xd9)];try{_0x2c6807[_0x260b57(0x15f)]['body']=JSON[_0x260b57(0x14d)](_0x1d1efb[_0x260b57(0xb0)]);}catch(_0x544a80){_0x2c6807[_0x260b57(0x15f)][_0x260b57(0xb0)]=_0x1d1efb['body'];}}catch(_0x15be0e){try{const _0x9eb0cc=JSON[_0x260b57(0x184)](_0x15be0e[_0x260b57(0x143)]);_0x2c6807[_0x260b57(0x15f)][_0x260b57(0x90)]=_0x9eb0cc?.['body']?.['status']||_0x9eb0cc?.[_0x260b57(0xd9)]||0x1f4,_0x2c6807['response']['body']=_0x9eb0cc['body']?JSON[_0x260b57(0x14d)](_0x9eb0cc['body']):_0x15be0e[_0x260b57(0x143)];}catch(_0x16733e){_0x2c6807[_0x260b57(0x15f)][_0x260b57(0x90)]=0x1f4,_0x2730d1[_0x260b57(0x138)][_0x260b57(0x109)](_0x2730d1[_0x260b57(0xe0)]+'['+_0x2730d1[_0x260b57(0x144)]+_0x260b57(0xa0)+_0x15be0e[_0x260b57(0x143)]);}}};}}export class Publisher{constructor(_0x43eda9){const _0x3cfc2d=a0_0xab49,_0x72e218=_0x43eda9,_0x51e4fa={},_0x1ab482=async(_0x5968b9,_0x2efc54)=>{const _0x55f8f2=a0_0xab49,_0x175de2=_0x51e4fa[_0x5968b9]['config']?.[_0x55f8f2(0xde)]?.[_0x55f8f2(0x70)];let _0x83f2b3=0x0;for await(const _0x1c398c of _0x2efc54[_0x55f8f2(0x90)]()){switch(_0x1c398c['type']){case _0x55f8f2(0x159):_0x72e218[_0x55f8f2(0x138)][_0x55f8f2(0x109)](_0x72e218['gwName']+'['+_0x72e218[_0x55f8f2(0x144)]+_0x55f8f2(0x16d)+_0x5968b9+']['+_0x175de2+_0x55f8f2(0xa9)+_0x1c398c[_0x55f8f2(0xbc)]+_0x55f8f2(0x186)),_0x83f2b3=0x0;break;case _0x55f8f2(0x9e):_0x72e218[_0x55f8f2(0x138)][_0x55f8f2(0xe3)](_0x72e218[_0x55f8f2(0xe0)]+'['+_0x72e218[_0x55f8f2(0x144)]+']\x20publisher['+_0x5968b9+']['+_0x175de2+_0x55f8f2(0x67)+_0x1c398c[_0x55f8f2(0xbc)]);break;case _0x55f8f2(0x109):_0x72e218[_0x55f8f2(0x138)][_0x55f8f2(0x109)](_0x72e218['gwName']+'['+_0x72e218[_0x55f8f2(0x144)]+_0x55f8f2(0x16d)+_0x5968b9+']['+_0x175de2+_0x55f8f2(0x170)+_0x1c398c['data']);break;case _0x55f8f2(0x178):_0x83f2b3+=0x1;_0x83f2b3%0x1e===0x0&&_0x72e218[_0x55f8f2(0x138)][_0x55f8f2(0x14c)](_0x72e218[_0x55f8f2(0xe0)]+'['+_0x72e218[_0x55f8f2(0x144)]+_0x55f8f2(0x16d)+_0x5968b9+']['+_0x175de2+_0x55f8f2(0x8e)+_0x1c398c['data']+_0x55f8f2(0x151)+_0x83f2b3+')');break;case _0x55f8f2(0x141):_0x72e218[_0x55f8f2(0x138)][_0x55f8f2(0x14c)](_0x72e218[_0x55f8f2(0xe0)]+'['+_0x72e218[_0x55f8f2(0x144)]+_0x55f8f2(0x16d)+_0x5968b9+']['+_0x175de2+_0x55f8f2(0x120)+_0x1c398c[_0x55f8f2(0xbc)]);break;}}},_0x5b9475=async(_0x534079,_0x3a0563)=>{const _0x74c456=a0_0xab49,_0x13464e=_0x51e4fa[_0x534079][_0x74c456(0x13e)]?.['nats']?.[_0x74c456(0x70)];let _0x47e971;try{_0x47e971=await a0_0x2cc5a3(_0x3a0563);if(_0x47e971[_0x74c456(0xe3)]['server_name']!==_0x74c456(0x135)){_0x47e971[_0x74c456(0xbd)]();return;}_0x51e4fa[_0x534079]['nc']=_0x47e971,_0x1ab482(_0x534079,_0x47e971);}catch(_0x3efb6b){_0x72e218['logger'][_0x74c456(0x109)](_0x72e218[_0x74c456(0xe0)]+'['+_0x72e218[_0x74c456(0x144)]+_0x74c456(0x16d)+_0x534079+']['+_0x13464e+']\x20connect\x20error:\x20'+_0x3efb6b['message']+'\x20-\x20will\x20do\x20auto\x20connect\x20when\x20available\x20-\x20however,\x20please\x20verify\x20stream\x20configuration'),_0x3a0563[_0x74c456(0x6b)]=!![];try{_0x47e971=await a0_0x2cc5a3(_0x3a0563);if(_0x47e971[_0x74c456(0xe3)][_0x74c456(0xe4)]!==_0x74c456(0x135)){_0x47e971[_0x74c456(0xbd)]();return;}_0x51e4fa[_0x534079]['nc']=_0x47e971,_0x1ab482(_0x534079,_0x47e971);}catch(_0x2ed978){_0x72e218[_0x74c456(0x138)][_0x74c456(0x109)](_0x72e218[_0x74c456(0xe0)]+'['+_0x72e218[_0x74c456(0x144)]+']\x20publisher['+_0x534079+']['+_0x13464e+']\x20connect\x20error:\x20'+_0x2ed978[_0x74c456(0x143)]);return;}}_0x72e218[_0x74c456(0x138)][_0x74c456(0x14c)](_0x72e218[_0x74c456(0xe0)]+'['+_0x72e218[_0x74c456(0x144)]+_0x74c456(0x16d)+_0x534079+']['+_0x13464e+_0x74c456(0xbe)+(_0x3a0563['tls']['ca']?_0x74c456(0xbb):'')+'\x20'+_0x47e971[_0x74c456(0x153)]()),_0x47e971[_0x74c456(0x185)]()[_0x74c456(0x101)](_0x8f994e=>{const _0x26943d=_0x74c456;_0x8f994e&&_0x72e218['logger'][_0x26943d(0x109)](_0x72e218[_0x26943d(0xe0)]+'['+_0x72e218[_0x26943d(0x144)]+']\x20publisher['+_0x534079+']['+_0x13464e+']\x20closed\x20with\x20error:\x20'+_0x8f994e['message']);});};this['add']=async(_0x4ed6bf,_0x5e31ee)=>{const _0x14d87c=a0_0xab49;if(!_0x5e31ee?.['nats']){_0x72e218[_0x14d87c(0x138)][_0x14d87c(0x109)](_0x72e218[_0x14d87c(0xe0)]+'['+_0x72e218['pluginName']+']\x20publisher['+_0x4ed6bf+_0x14d87c(0x128));return;}if(!_0x5e31ee?.[_0x14d87c(0xde)]?.['tenant']){_0x72e218['logger'][_0x14d87c(0x109)](_0x72e218[_0x14d87c(0xe0)]+'['+_0x72e218[_0x14d87c(0x144)]+_0x14d87c(0x16d)+_0x4ed6bf+']\x20initialization\x20error:\x20missing\x20configuration\x20nats.tenant');return;}if(!_0x5e31ee?.[_0x14d87c(0xde)]?.['subject']){_0x72e218[_0x14d87c(0x138)][_0x14d87c(0x109)](_0x72e218[_0x14d87c(0xe0)]+'['+_0x72e218[_0x14d87c(0x144)]+_0x14d87c(0x16d)+_0x4ed6bf+_0x14d87c(0x137));return;}if(!_0x5e31ee?.[_0x14d87c(0xde)]?.['subject'][_0x14d87c(0x106)]('GW.')){_0x72e218[_0x14d87c(0x138)][_0x14d87c(0x109)](_0x72e218[_0x14d87c(0xe0)]+'['+_0x72e218[_0x14d87c(0x144)]+_0x14d87c(0x16d)+_0x4ed6bf+_0x14d87c(0x130));return;}if(!_0x5e31ee['baseUrls']||!Array[_0x14d87c(0xa1)](_0x5e31ee[_0x14d87c(0x115)])||_0x5e31ee['baseUrls'][_0x14d87c(0x108)]<0x1){_0x72e218[_0x14d87c(0x138)]['error'](_0x72e218[_0x14d87c(0xe0)]+'['+_0x72e218['pluginName']+_0x14d87c(0x16d)+_0x4ed6bf+_0x14d87c(0xcd));return;}if(!_0x5e31ee?.[_0x14d87c(0x114)]?.['ca']){_0x72e218[_0x14d87c(0x138)][_0x14d87c(0x109)](_0x72e218['gwName']+'['+_0x72e218[_0x14d87c(0x144)]+_0x14d87c(0x16d)+_0x4ed6bf+_0x14d87c(0x122));return;}const _0x120f15={};try{let _0x31a5fd=a0_0x3f43f4[_0x14d87c(0x142)](_0x72e218[_0x14d87c(0x88)],_0x14d87c(0x76),_0x5e31ee?.[_0x14d87c(0x114)]?.['ca']||_0x14d87c(0xab));(_0x5e31ee?.[_0x14d87c(0x114)]?.['ca']?.['startsWith']('/')||_0x5e31ee?.[_0x14d87c(0x114)]?.['ca']?.[_0x14d87c(0x11b)]('\x5c'))&&(_0x31a5fd=_0x5e31ee[_0x14d87c(0x114)]['ca']),_0x120f15['ca']=[a0_0x4b3d48[_0x14d87c(0xb5)](_0x31a5fd)],_0x120f15[_0x14d87c(0x10b)]=!![];}catch(_0x283fd8){_0x72e218[_0x14d87c(0x138)]['error'](_0x72e218[_0x14d87c(0xe0)]+'['+_0x72e218[_0x14d87c(0x144)]+']\x20publisher['+_0x4ed6bf+_0x14d87c(0xf9)+_0x283fd8['message']);return;}const _0x4057e9={},_0x5bbda8=new TextEncoder()[_0x14d87c(0xd3)](_0x5e31ee?.[_0x14d87c(0xde)]?.[_0x14d87c(0xdb)]),_0x4ed6ad=_0x5e31ee?.[_0x14d87c(0xde)]?.['jwt'];_0x4057e9['authenticator']=jwtAuthenticator(_0x4ed6ad,_0x5bbda8),_0x4057e9[_0x14d87c(0x69)]=_0x5e31ee['baseUrls'],_0x4057e9[_0x14d87c(0xbb)]=_0x120f15,_0x4057e9[_0x14d87c(0x6b)]=![],_0x4057e9[_0x14d87c(0x9e)]=!![],_0x4057e9[_0x14d87c(0x164)]=0x3e8*0xa,_0x4057e9[_0x14d87c(0xff)]=-0x1,_0x4057e9[_0x14d87c(0x149)]=0x2*0x3c*0x3e8,_0x4057e9['maxPingOut']=0x5,_0x4057e9['debug']=![],_0x51e4fa[_0x4ed6bf]={},_0x51e4fa[_0x4ed6bf][_0x14d87c(0x13e)]=_0x5e31ee,_0x51e4fa[_0x4ed6bf]['nc']=undefined,_0x5b9475(_0x4ed6bf,_0x4057e9);},this[_0x3cfc2d(0x166)]=async _0x30cdd8=>{const _0x32b120=_0x3cfc2d;let _0x17a28e;const _0xf18d75=a0_0xc5a644['randomUUID']();try{if(_0x30cdd8[_0x32b120(0xf8)]===Object){_0x17a28e=_0x30cdd8[_0x32b120(0x14b)];if(!_0x17a28e)_0x30cdd8[_0x32b120(0x14b)]=_0x32b120(0x7c);if(_0x30cdd8?.[_0x32b120(0xc4)]?.[_0x32b120(0x7d)]?.['headers']){const _0x369f69=_0x30cdd8[_0x32b120(0xc4)][_0x32b120(0x7d)][_0x32b120(0xe9)][_0x32b120(0x173)](_0x32b120(0x8f));if(_0x369f69)_0x30cdd8[_0x32b120(0xc4)]['request'][_0x32b120(0xe9)][_0x32b120(0xc8)](_0x32b120(0x8f),a0_0x5892aa[_0x32b120(0x12b)](_0x369f69,_0xf18d75));}if(_0x30cdd8?.[_0x32b120(0xc4)]?.[_0x32b120(0x117)]?.['headers']){const _0x1f8d1f=_0x30cdd8['ctx'][_0x32b120(0x117)][_0x32b120(0xe9)][_0x32b120(0x173)](_0x32b120(0x8f));if(_0x1f8d1f)_0x30cdd8[_0x32b120(0xc4)][_0x32b120(0x117)][_0x32b120(0xe9)][_0x32b120(0xc8)](_0x32b120(0x8f),a0_0x5892aa[_0x32b120(0x12b)](_0x1f8d1f,_0xf18d75));}_0x30cdd8=JSON['stringify'](_0x30cdd8);}else{const _0x30d502=JSON[_0x32b120(0x184)](_0x30cdd8);_0x17a28e=_0x30d502[_0x32b120(0x14b)];}}catch(_0x274967){throw new Error('publisher['+_0x17a28e+_0x32b120(0x72));}if(!_0x51e4fa[_0x17a28e])throw new Error('publisher['+_0x17a28e+_0x32b120(0x152)+_0x17a28e);const _0x59719=headers();_0x59719[_0x32b120(0x7f)]('Msg-Id',_0xf18d75);let _0x1db6be;try{if(!_0x51e4fa[_0x17a28e]['nc'])throw new Error(_0x32b120(0xb6));_0x1db6be=await _0x51e4fa[_0x17a28e]['nc'][_0x32b120(0x7d)](_0x51e4fa[_0x17a28e][_0x32b120(0x13e)]?.['nats']?.[_0x32b120(0x70)],_0x30cdd8,{'headers':_0x59719});}catch(_0x770f98){if(_0x770f98[_0x32b120(0x143)]===_0x32b120(0xa5))throw new Error(_0x32b120(0x168)+_0x17a28e+_0x32b120(0x7a)+_0x51e4fa[_0x17a28e][_0x32b120(0x13e)]?.['nats']?.[_0x32b120(0x70)]);else throw new Error('publisher['+_0x17a28e+_0x32b120(0x172)+_0x770f98[_0x32b120(0x143)]);}let _0x5e7943;try{_0x5e7943=JSON[_0x32b120(0x184)](_0x1db6be[_0x32b120(0x84)]());try{JSON[_0x32b120(0x184)](_0x5e7943[_0x32b120(0xb0)]);if(!_0x5e7943[_0x32b120(0xe9)])_0x5e7943[_0x32b120(0xe9)]={};if(!_0x5e7943[_0x32b120(0xe9)][_0x32b120(0x6a)])_0x5e7943[_0x32b120(0xe9)]['content-type']=_0x32b120(0x112);}catch(_0xbe64b3){void 0x0;}}catch(_0x15b218){throw new Error(_0x32b120(0x100)+_0x1db6be[_0x32b120(0x84)]());}if(_0x5e7943?.[_0x32b120(0x109)]){const _0x26ff12=new Error(_0x32b120(0xd6)+_0x5e7943[_0x32b120(0x109)]);_0x26ff12[_0x32b120(0x104)]=_0x5e7943[_0x32b120(0xca)];throw _0x26ff12;}return _0x5e7943;},process['on']('SIGTERM',async()=>{const _0x1ff39b=_0x3cfc2d;for(const _0x568afd in _0x51e4fa){_0x51e4fa[_0x568afd]['nc']&&!_0x51e4fa[_0x568afd]['nc'][_0x1ff39b(0x13d)]()&&await _0x51e4fa[_0x568afd]['nc'][_0x1ff39b(0x6d)]();}}),process['on'](_0x3cfc2d(0x183),async()=>{const _0x5326ab=_0x3cfc2d;for(const _0x178e87 in _0x51e4fa){_0x51e4fa[_0x178e87]['nc']&&!_0x51e4fa[_0x178e87]['nc']['isClosed']()&&await _0x51e4fa[_0x178e87]['nc'][_0x5326ab(0x6d)]();}});}}export const getAppRoles=async(_0x20ae39,_0x50aac4)=>{const _0x37c1c2=a0_0xab49,_0x3ee2d6='getAppRoles',_0x257a5c=_0x20ae39;_0x257a5c[_0x37c1c2(0x138)]['debug'](_0x257a5c[_0x37c1c2(0xe0)]+'['+_0x257a5c[_0x37c1c2(0x144)]+_0x37c1c2(0xb3)+_0x3ee2d6+'\x22');try{if(!a0_0x4b3d48['existsSync'](_0x257a5c[_0x37c1c2(0x88)]+_0x37c1c2(0x150)))a0_0x4b3d48[_0x37c1c2(0x73)](_0x257a5c[_0x37c1c2(0x88)]+_0x37c1c2(0x150));}catch(_0x37e5e5){void 0x0;}const _0x45b7b0=a0_0x3f43f4[_0x37c1c2(0x142)](''+_0x257a5c[_0x37c1c2(0x88)],'approles',_0x37c1c2(0x13a)+_0x257a5c[_0x37c1c2(0x144)]+_0x37c1c2(0xc6)),_0x226442={};a0_0x5892aa[_0x37c1c2(0x181)](_0x45b7b0)&&a0_0x4b3d48[_0x37c1c2(0xb5)](_0x45b7b0,_0x37c1c2(0x12a))['split'](/\r?\n/)[_0x37c1c2(0x10c)](_0x4ded35=>{const _0x424d56=_0x37c1c2,_0x199058=_0x4ded35[_0x424d56(0x10a)]('\x20');_0x199058['length']===0x2&&(_0x226442[_0x199058[0x0]]=_0x199058[0x1]);});const _0x3ecc29=a0_0x4b3d48[_0x37c1c2(0x82)](_0x45b7b0,{'flags':'w','encoding':'utf8','mode':0x1b6,'autoClose':!![]}),_0x3ed611=[],_0x19e0b0=await _0x257a5c[_0x37c1c2(0x187)](_0x50aac4,{'attribute':undefined,'operator':undefined,'value':undefined},['id',_0x37c1c2(0xa2)]);return _0x19e0b0[_0x37c1c2(0x17e)][_0x37c1c2(0x10c)](_0x4ebc54=>{const _0x6630f7=_0x37c1c2;if(_0x4ebc54['id']){let _0x3e2431=a0_0xc5a644[_0x6630f7(0x132)]();if(_0x226442[_0x4ebc54['id']])_0x3e2431=_0x226442[_0x4ebc54['id']];const _0x363adf={'allowedMemberTypes':['User'],'description':'SCIM\x20Stream\x20-\x20Autogenerated','displayName':_0x4ebc54[_0x6630f7(0xa2)]||_0x4ebc54['id'],'id':_0x3e2431,'isEnabled':!![],'lang':null,'origin':_0x6630f7(0x87),'value':decodeURIComponent(_0x4ebc54['id'])};_0x3ed611[_0x6630f7(0xac)](_0x363adf),_0x3ecc29[_0x6630f7(0xce)](_0x4ebc54['id']+'\x20'+_0x3e2431+'\x0a');}}),_0x3ecc29[_0x37c1c2(0xbd)](),_0x257a5c[_0x37c1c2(0x138)][_0x37c1c2(0x14c)](_0x257a5c[_0x37c1c2(0xe0)]+'['+_0x257a5c[_0x37c1c2(0x144)]+_0x37c1c2(0x14e)+_0x45b7b0),{'Resources':[{'appRoles':_0x3ed611}]};};